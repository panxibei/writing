打工仔咸鱼翻身，现场演示 Dell 服务器硬盘阵列扩容操作

副标题：打工仔咸鱼翻身，现场演示 Dell 服务器硬盘阵列扩容操作

英文：a-worker-bob-up-again-like-a-cork-and-demonstrate-how-to-expand-dell-server-hard-disk-arrays

关键字：dell,raid,阵列,upgrade,升级,扩容,expansion,expand,服务器,server





三伏天，大中午，日悬头顶，周围离地三尺直呼呼冒着热气。

一伙儿衣衫褴褛的打工仔，正冒着酷暑奋力拖着手腕般粗的电缆。

每个人的身体几乎摆成了 `45` 度角，此情此景犹如另一幅伏尔加河上的仟夫，令人震撼。



可惜的是，我不是看画人，而是这画中人。

只不过对于像我这样学校里刚毕业初出茅庐没有任何背景的人来说，已经是上天给予的莫大恩赐了！

虽然每天满身臭汗，穿得也不怎么体面，但好歹管吃管住，还有免费水喝。

再苦再累，高低有份工作，比那些个在家躺平的要强的多吧。

我是这样想的，人家躺平也是要有资格的，像我这样家里没矿连躺平的资格都没有，那唯有卖力才能换得吃和穿啊！



我一边用力拉，一边用思想武器武装自己，今晚鸡汤没有，鸡腿总有吧！

对啊，都两个礼拜了，差不多该加鸡腿了！

慢慢地，我的眼睛被口水，不，汗水湿润了、模糊了，只知道动作机械地跟着工友朝前一步一步艰难地挪动。

结果一个踉跄，差点没跪地上。

我毫不介意地吐了一口吐沫，这种事情经常发生，小 `case` 。

接着我用衣袖抹了一把脸上的汗水，打算起身接着干，这才发觉地上有双皮鞋！



“你个兔崽子，眼瞎啊！吐沫星子往哪喷呢！可惜了我这双新鞋，5000大洋买的啊！”

工头上来就给我一脚，边骂边擦他那双丑陋的破鞋。

“要不是看在经理的面上，你小子早该滚蛋了！”

“赶紧的，动作快点，跟我走一趟！”

见我愣在那儿，工头又好心给我补了一脚。



来到经理的办公室，工头点头哈腰退了出去，只留下我和经理两个人。

经理是个50多岁的中年人，是这家公司家族企业中的一员。

仗着他老婆是老板二兄弟的三舅舅的四妹妹的大儿子的远房表亲，在这儿给谋了个一官半职。

之前听工友们闲扯淡时说他有亲戚干着一本万利的买卖发了大财，也不知道他把我找来葫芦里卖的什么药。



“小X啊，来来，请坐请坐！”经理眯缝着小眼，皮笑肉不笑地怎么看都不是什么好东西。

“今天找你来啊，是有个事要请你帮帮忙！”

“呵呵，现在的年轻人啊，不是躺平，就是不努力工作，朝三暮四的，像你这样有上进心的不多哦！”

“我打听了一圈，咱们这儿啊有大把学计算机的，不过呢只有你有过18个星期外带38.8小时的相关工作经验！”

“是这样哈，我给你介绍个活，只要干得漂亮，我给你加工资，外加发个大红包，你看怎么样？”



“鸡……加鸡腿，行不？”我也不知怎么冒出来这么一句。

经理乐了：“没问题啊！我和你们工头打个招呼，管够！”

经理那贱贱的小眼睛直勾勾地盯着我，我刚想再说什么又给咽了回去，只好点头同意。

“哎！这就对了嘛，我就喜欢你这样的年轻人，说话痛快！”



当天中午，我还没来得及吃到心心念念的鸡腿，就是被塞进了一辆破面包车里，花了大概三个多小时才来到了一幢偏僻又陌生的大楼前。

大楼门前站着几个人，很警觉地搜了身后，将我带进了大楼某层的一个神秘房间中。

为啥说神秘呢？

因为全程我都被蒙着眼睛，直到进了房间才被解开。



随后门从外面反锁，只留我一人在里面。

房间不大，灯光昏暗，只有一个机柜、一张小床和一张桌子。

我寻摸了半天，才发现桌子上有张小纸条。

我展开纸条，上写着：“硬盘阵列扩容”六个歪歪扭扭的小字。

再抬头一看，果然在机架上有一台 `Dell` 服务器，架子上还放着几块硬盘。

我扑哧一乐，心想这帮人搞什么飞机，硬盘阵列扩容搞得跟玩间谍游戏似的，难不成是什么新型剧本杀？

机器不时地闪烁着幽暗的灯光，让我很快开始思考接下来应该做些什么。

片刻之后，我已经做到心里有数，不就是硬盘阵列扩容嘛，开干！



`Dell` 服务器通常自带有 `iDRAC` ，就是用来远程管理服务器的一种接口，看上去就是一个网口，可以接入网线。

图01



硬盘阵列扩容有很多方法，其中使用 `iDRAC` 会比较方便直观，不容易出现失误。

给 `iDRAC` 设置好 `IP` 地址后，我们就可以登录到里面。

图02



我们的任务是安装硬盘扩展容量，因此点击顶部菜单 `存储` > `概览` 。

图03



可以看到当前的物理硬盘一共 `4` 块，其中一块是专用热备盘。

图04



想要进一步确认的话可以选择 `物理磁盘` ，嗯，第四块也就是最后一块硬盘是专用热备盘（俗称 `hotspare` ）。

图05

图06



如果想保留这块（第 `4` 块）硬盘仍作为热备盘的话，那么可以不用对它操作。

图07



不过我是个完美主义者（强迫症），总喜欢将最后一块硬盘当热备。

也就是说，在扩容以后，我希望第 `8` 块硬盘（也就是扩容后的最后一块）做热备而不是第 `4` 块。

图08



因此，我们应该先将第 `4` 块硬盘从热备身份给改回成啥身份都不是才行。

好，点击 `虚拟磁盘` ，在当前虚拟磁盘右侧的操作下拉菜单中选择 `取消分配专用热备用 Physical Disk 0:1:3` 。

没错，这个 `Physical Disk 0:1:3` 就是第 `4` 块硬盘，因为它是从 `0` 开始算的嘛！

图09

图10

图11



阵列相关的操作可能会耗费一定的时间，甚至需要服务器重启才能生效，因此通常它会将任务放到计划或队列中逐步执行。

图12



在 `存储` > `任务` > `作业队列` 中我们可以看到作业执行的进度。

图13



要了解具体这个作业是在干吗，可以点击 `存储` > `任务` > `待处理的操作` 来一探究竟。

图14



好了，现在可以关机并插入四块新硬盘了。

再次开机，进入 `iDRAC` 后我们可以看到，有四块新加入的非 `RAID` 磁盘，当然前面那块热备盘已经取消了。

图15



要是不放心，可以到 `存储` > `概览` > `物理磁盘` 中进一步查看确认。

图16



没错吧？

好，为了让新加入的新硬盘能够融入团队，我们需要给它们赋予个新身份，也就是将它们转换成 `RAID` 成员身份。

如果不这么做，那么它们是加不到当前阵列中的。

选择新硬盘那一行右侧的操作菜单，点击 `转换为 RAID` 。

图17

图18

图19



在作业队列中可以看到进度。

图20



一旦完成了，它的状态就会由 `非 RAID` 转换成 `就绪` 。

图21



OK，依次类推，接着将剩下的第 `6` 、 `7` 、`8` 三块硬盘都这么转换一下。

最后应该是下面这个样子了，有五块准备就绪的新硬盘。

图22



哎，慢着，怎么变成五块了？

是啊，别忘了，前面有一块做热备的老硬盘呢，加上四块新的，不就一共五块嘛，可别晕啊！



好，我们接下来就要正式把准备就绪的四块（一块旧的，三块新的）硬盘加到阵列里了。

点击 `虚拟磁盘` ，这时可以记录一下哈，当前使用的是 `RAID-5` 阵列，容量大约在 `2234.5GB` 。

好，点击右侧操作的下拉菜单，再点击 `编辑磁盘容量` 。

图23



在左下侧有个 `添加物理磁盘` 的按钮，点击它后我们可以看到有好多新硬盘等待加入。

按顺序勾选前面四块硬盘，最后一块做热备不用选，然后点击添加磁盘 `Add Disks` 。

图24



确认再确认哈，加入的硬盘对不对，别选错了，还有增大后的容量。

图25



一切准备妥当，开始作业。

图26

图27



直到作业完成 `100%` 。

图28



查看一下结果符不符合预期。

图29



前面七块都已经是联机状态啦，完美！

图30



最后别忘记将最后一块硬盘转换成热备盘。

依次点击 `存储` > `概览` > `虚拟磁盘` ，在当前虚拟磁盘右侧操作菜单中选择 `分配专用热备用 Physical Disk 0:1:7` 。

图31



嗯，报错，什么情况？

图32



原来是由于前面一个作业（新硬盘联机加入阵列）还没有完全完成，即使它显示的是 `100%` ！

图33



操作状态显示为 `正在重新构建` ，进度只有 `5%` ，阵列大小没有变化，仍为 `2234.5GB` 。

我可以负责任地告诉小伙伴们，由于磁盘容量较大，这个追加硬盘扩容的操作整整花了近三天的时间才完成。

粗略算算大约 `40` 到 `50`小时，如果你有这样的操作，希望提前预定好时间啊！



最后彻底完成后，就可以看到新的变化了，容量上去了。

图34



再来转换热备盘就没有问题了。

图35

图36

图37



到这里是不是扩容工作完成了呢？

非也非也，还没完呢，这只是阵列的容量增加了，但不表示操作系统可以自动增加容量呀！

因此接下来还要帮助操作系统识别一下新容量。

当然了，`Windows` 的操作还算简单，如果是 `Linux` 呢就有些复杂了。

还好手头上的这台服务器跑的是 `Windows` 。



找到 `磁盘管理` ，可以看到多出来一块未分配的空间。

图38



右键点击 `D` 盘，选择 `扩展卷(X)...` 。

图39



下一步，好像只能点下一步哈。

图40



啥都不要动，未分配空间有多大它自动就识别了，下一步。

图41



这就完成了！

图42



你看吧，`D` 盘成功扩充了磁盘空间。

图43



好了，就是这么简单。

如果你想分个什么 `E` 盘之类的也可以，就像正常分区操作就行。



现在我来总结一下前面的操作吧，毕竟东一榔头西一锤的绕得我脑壳疼。

1. 原热备盘降级，成为就绪盘
2. 关机插入新硬盘
3. 将新硬盘都转换成阵列就绪状态
4. 除最后一块硬盘外，将就绪的硬盘添加到当前阵列中
5. 最后一块硬盘转换成热备盘
6. 操作系统按分区操作把扩展后的空间容量利用起来



阵列扩容的话，看图会比较清楚一些吧。

图44



操作说复杂也不复杂，说简单也不简单，只要步骤无误，一般不会有问题。

当然了，正规合理的做法是在做这些操作之前务必要做好系统备份工作，万一中间出现问题可以及时回滚。

不过嘛，完成整个磁盘阵列的同步足足花了将近三天的时间，让我好等啊！

在此期间，有人从门上的小窗户给我递吃的，至少没让我饿着。

机柜旁边还有一张小床，这几天我就靠这张小床歇息打盹。



在等待作业快结束时，我翘着二郎腿，心里美滋滋地盘算着，这要是出去了，不知道老板能给我多少工钱呢，肯定少不了吧！

嘿嘿，心里越想越美！

不知不觉肚子又叫上了，呃，怎么还没来送饭啊？

于是我走到门边想听听动静，却听到门外有人说话语气不正。



“都搞了三天了，还没搞好吗？”

“赵哥，那小子说快了，说是阵列数据同步挺花时间……”

“行了！别废话，老板有令，今晚等那小子整好了就……”

听到这儿我一激灵，差点没坐地上。



一会儿窗户开了，送饭的说：“辛苦了，兄弟！活干得差不多了吧？老板特意给加了鸡腿……”

我哆哆嗦嗦接过饭盒，此时此刻我已无心吃饭，脑子里只有飞快地思考着，该怎么办，该怎么办！



突然我似乎想到了什么，放下饭盒走到服务器前，想看一下这服务器里到底装的都是啥，这帮人到底是做什么的。

这一看不要紧，犹如冷水泼头，从头凉到脚！

心里埋怨自己，说不要来不要来，现在完了，芭比Q了，吾命休矣！

我呆呆地看着屏幕上不断滚动的手机号码和地址，心说我要怎么才能从这里逃出去呢？

哎，我灵机一动，计上心来……



**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc


