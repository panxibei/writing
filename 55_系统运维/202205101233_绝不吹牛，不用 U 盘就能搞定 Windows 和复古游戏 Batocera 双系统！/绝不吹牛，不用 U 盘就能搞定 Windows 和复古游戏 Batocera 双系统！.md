绝不吹牛，不用 U 盘就能搞定 Windows 和复古游戏 Batocera 双系统！

副标题：动手撸Win10、Batocera双系统，没U盘也能搞定！

英文：never-boast-i-made-the-dual-systems-of-windows-and-retro-games-batocera-without-usb-flash-disk

关键字：batocera,games,fc,nes,sfc,md,n64,play station,batocera,linux,模拟器,emu,emulators,街机,游戏,roms,odroid,raspberry,windows,win10,linux,win7



自从同事老刘介绍给我复古游戏系统 `Batocera` 后，我就爱不释手，天天乐此不疲地研究它。

没想到今天老刘突然找到我，满面愁容地说他的U盘坏了，玩不成游戏了！

我说巧了，正好这几天研究有所心得，干脆给你来个硬盘安装吧！



老刘听后急忙摆手，直言自己就一台电脑，还要处理文档，孩子还得上网课用，不可能把电脑单单搞成游戏机。

我笑着回他，不用破坏 `Windows` 系统，就在现有系统基础上再安装一个 `Batocera` ，完全可以做一个双系统。

想要工作学习时就启动 `Win10` 系统，想要游戏时就启动 `Batocera` ，互相完全不干扰，对原有系统没有任何影响。

老刘一听，小眼睛顿时瞪大了一圈，眼里放着光，嘴里催促着我赶快整一个瞧瞧！

我一看这架势就明白了，今天的晚饭又有着落了！

得勒，您晴好吧！



### 原理简述

我们都知道有双系统甚至多系统，是指在同一台电脑上安装两个以上的系统。

比如小伙伴们常见的 `Windows` + `Linux` 双系统等等。



在电脑启动时往往只能选择其中一个系统，而其他系统并不能一起同时启动。

这些系统之间是相互独立的，它们之间并没有什么直接影响。

虽然没有什么影响，但却可以互相间接使用，比如一个系统往另一个系统分区里复制或删除文件等等。

既然有双系统这种形式存在，那么我们当前使用的 `Win10` 系统是否也可以再安装一个 `Batocera` 系统呢？

答案自然是可以的，只要把 `Batocera` 当成一个 `Linux` 系统就行了，很好理解吧？

简单的原理就是这样，跟着我后面手把手的教程做实现起来一点儿也不算难，重要的是你并不需要特意准备一个U盘或其他的设备。

看看实现后的最终效果，想要工作学习就用 `Win10` ，想玩游戏用 `Batocera` 。

图42.GIF



OK，接下来就让我们具体看看在 `Windows` 电脑上如何再加入 `Batocera` 游戏系统！



### 创建两个空白分区

为啥要创建两个空白分区，在后面我会解释的，我们先照做哈。

打开 `磁盘管理` ，找到我们的硬盘。

如果你只有一块硬盘，那么就是它了，只要在这上面划拉个空间给 `Batocera` 就行了。

如果不止一块硬盘，那就根据你的个人喜好，只要有地方腾出来就行。

我在这儿只拿一块硬盘做演示，往下看你就知道，本质上是一样的。



首先找到 `C` 盘，看看能不能从这儿划一块地盘出来。

当然你想动 `D` 盘或其他盘的脑筋也不是不可以，只要空间够用就行。

图01



右键点击 `C` 盘，点击菜单中的 `压缩卷(H)...` 。

图02



先给空出 `16G` 的空间给引导分区吧，在 `输入压缩空间量(MB)(E)` 中打上 `16000` 。

图03



点击 `压缩` 按钮后，我们就得到了一块 `16G` 大小的未分配空间。

图04



右键刚才划分出来的未分配分区，在菜单中点击 `新建简单卷(I)...` 。

图05



我们来创建两个新分区，先来个引导区，给 `8G` 空间就够了。

注意，需要给新分区分配一个盘符（此处是 `E` 盘），但不需要格式化它。

图06

图07

图08

图09

图10



第一个引导用的新分区创建好后，它应该是这个样子滴。

图11



紧接着，我们来创建第二个数据分区。

老一套手法，右键剩下的未分配空间并点击 `新建简单卷(I)...` 。

图12



确认好卷大小后，给它分配一个盘符（此处是 `F` 盘），但是不用格式化。

图13

图14

图15

图16

图17



最后，两个分区准备完毕，注意一定都要有盘符，否则后面不好操作哦！

图18



### 解剖 `Batocera` 安装镜像

我们使用压缩软件管理器（比如 `7zip` ）打开 `Batocera` 的镜像文件，会发现它实际上包含了两个较小的镜像文件。

没错，你猜对了，这两个较小的镜像就是两个分区镜像。

在前面我们刚刚准备好了两个空白分区，就是为了将这两个镜像放回到上面去。

图19



那这两个镜像怎么对应两个空白分区呢？

很简单，从名称和文件系统两个地方我们就能分辨出来。

我们先看名称，一个是 `vfat` ，另一个是 `userdata` 。

那么很清楚，前者是 `FAT` 引导分区，后者是用户数据分区，这样基本可以判定前者是以 `UEFI` 方式启动的。

我们再来文件系统，一个是 `Windows BDP` ，另一个是 `Linux Data` 。

也很清楚，前者的确是引导分区（ `Boot Disk Partition` ），而后者则是数据分区。

最后我们就可以得出结论了，引导镜像覆盖到第一个空白分区，用户数据镜像则覆盖到第二个空白分区。

* `vfat.img` - 第一空白分区
* `userdata.img` - 第二空白分区



可以说，网上绝大多数现存的 `Batocera` 安装镜像都可以这么解剖拆分。



### 如何将镜像放回到分区上？

关于这个问题，网上曾有大神通过先制作U盘然后再将U盘上的分区覆盖回硬盘分区的做法。

实际上并不需要这么麻烦，我们掌握了前面的解剖原理，可以说连U盘都不用。

不信？走着！



欲善其工，必先利器，在正式开始之前，我们需要准备好三样神器。

* `DiskGenius`
* `SysLinux`
* `Bootice`



**DiskGenius.7z(18.47M)**

下载链接：https://pan.baidu.com/s/1uPx3HB9jIj4Swkw2BSb3sQ

提取码：75di



**SysLinux-6.03.zip(12.96M)**

下载链接：https://pan.baidu.com/s/1lcTE4uOoFmRzsJmTdSZfWw

提取码：8fjc



**Bootice.zip(881K)**

下载链接：https://pan.baidu.com/s/1fpeT8k3Mk0flCPLU9pyp0Q

提取码：qj3t



小伙伴们，你们准备好了吗？

开始！

我们首先打开第一个工具 `DiskGenius` ，在顶部菜单中找到 `工具` > `扇区复制` 。

这里插句话，对于前面介绍的分区操作，比较专业的小伙伴也可以用 `DG` 来分区。

如果你不太熟悉 `DG` 操作，那么并不建议你用它，专业工具比较危险哦！

图20



在打开的 `扇区复制` 窗口中，我们点选 `源盘（或镜像文件）` 一项右侧的文件图标。

图21



然后选择 `vfat.img` 镜像文件，这个就是引导镜像。

图22



接着我们点选 `目标（或镜像文件）` 一项右侧的磁盘图标。

图23



选择未格式化的第一个空白分区（此处是 `E` 盘）。

图24



最后确认源镜像文件与目标盘是否选择正确，确认无误后点击 `复制` 按钮开始覆盖。

图25

图26



同样的操作，选择 `userdata.img` 镜像文件，将其覆盖到未格式化的第二个空白分区。

图27



两个分区都覆盖操作完成后，`DG` 可能会提示分区错误。

这其实是指引导镜像原分区大小与现分区大小不一致的问题，实际上没有什么影响，我们直接点击 `取消` 忽略错误即可。

图28



### 修改引导配置

如果我们制作的是U盘，那么由于U盘是一个独立的磁盘，因此在制作过程中系统会自动写入相应的分区信息。

但是现在情况有所不同了，我们是在现在有的硬盘上划分分区来制作的 `Batocera` ，所以我们还有一项工作要做，就是修改分区信息，让系统引导正确识别数据分区。

具体这么做。



在 `DG` 中，我们找到用户数据分区（就是 `Batocera` 第二个分区）的参数界面，记下这个分区的 `GUID` ，也就是它的身份证号（形如：xxxxxxx-xxxx-xxxx-xxxxxxxxxxxx）。

图29



然后我们用记事本或其他什么文本编辑器打开 `Batocera` 引导分区（就是第一个分区）中一个叫 `batocera-boot.conf` 的配置文件。

将参数 `sharedevice` 修改成刚才我们记下的数据分区的 `GUID` 。

```
# 默认设置
sharedevice=INTERAL

# 我们修改的设置
sharedevice=xxxxxxx-xxxx-xxxx-xxxxxxxxxxxx

```

图30



### 修正系统引导功能

我们要使用第二个工具 `SysLinux` 了。

将下载下来的压缩包打开，按照不同系统找到文件 `syslinux(64).exe` 所在的相应目录。

* `64` 位系统找 `\bios\win64\` 目录
* `32` 位系统找 `\bios\win32\` 目录



通常我们使用的 `Win10` 是 `64` 位的，因此我们找到 `\bios\win64\syslinux64.exe` 。

图31



然后怎么办呢？

将 `syslinux64.exe` 复制到 `Batocera` 的第一个分区（即引导分区）的 `\boot\syslinux` 目录中。

图32



OK，接下来我们打开命令提示符窗口，输入几条命令，将引导文件修正。

```
# X是指在Windows下Batocera的引导分区的盘符，本例中是E盘。
# /boot/syslinux是指引导分区的引导文件所在
X:
CD boot/syslinux
syslinux64.exe -f -d /boot/syslinux/ X:
```

图33



接下来我们要用到第三个工具 `BOOTICE` ，用它来修正 `UEFI` 启动。

打开 `BOOTICE` ，找到 `UEFI` 选项卡，点击 `修改启动序列(B)` 。

图34



在出现的窗口中点击 `添加` 按钮，我们来添加一个 `Batocera` 可用的启动项。

图35



定位 `Batocera` 引导分区（本例为 `E` 盘），并进入目录 `\EFI\BOOT` ，找到文件 `bootx64.efi` 。

图36



程序提示添加成功，引导项就这样添加好了。

图37



不过还没完，光是这样还不能用，我们还需要修正菜单标题以及启动分区。

菜单标题你可以随意取名，我这儿写的是 `Batocera` 。

启动分区需要小心了，必须选择 `Batocera` 真正的引导分区，注意它是 `FAT32` 格式的哦，别搞错了！

最后点击 `保存当前启动项设置(S)` 完成退出。

图38



一切OK，我们可以直接重启电脑，也可以继续利用 `BOOTICE` 重启时进入 `UEFI BIOS` 设置界面。

图39



像我在虚拟机上，就可以进入 `UEFI BOIS` 来调整各个系统的启动顺序。

图40

图41



当然你完全不用刻意去调整这些，在开机时按下启动选择快捷键就行了。

然后再选择是进入 `Windows` 还是进入 `Batocera` ，非常方便啊！

不同的机器它的快捷按键也不尽相同，我在网上扒了一些，看看有没有合适你的。

| 组装机主板   | 启动键     | 笔记本品牌     | 启动键          | 台式机电脑     | 启动键 |
| ------------ | ---------- | -------------- | --------------- | -------------- | ------ |
| 华硕主板     | F8         | 联想笔记本     | F12             | 联想台式机     | F12    |
| 技嘉主板     | F12        | 宏基笔记本     | F12             | 惠普台式机     | F12    |
| 微星主板     | F11        | 华硕笔记本     | ESC             | 宏基台式机     | F12    |
| 映泰主板     | F9         | 惠普笔记本     | F9              | 戴尔台式机     | ESC    |
| 梅捷主板     | ESC或F12   | 联想 Thinkpad  | F12             | 神舟台式机     | F12    |
| 七彩虹主板   | ESC或F11   | 戴尔笔记本     | F12             | 华硕台式机     | F8     |
| 华擎主板     | F11        | 神舟笔记本     | F12             | 方正台式机     | F12    |
| 斯巴达克主板 | ESC        | 东芝笔记本     | F12             | 清华同方台式机 | F12    |
| 昂达主板     | F11        | 三星笔记本     | F12             | 海尔台式机     | F12    |
| 双敏主板     | ESC        | IBM笔记本      | F12             | 明基台式机     | F8     |
| 翔升主板     | F10        | 富士通笔记本   | F12             |                |        |
| 精英主板     | ESC 或 F11 | 海尔笔记本     | F12             |                |        |
| 冠盟主板     | F11 或 F12 | 方正笔记本     | F12             |                |        |
| 富士康主板   | ESC 或 F12 | 清华同方笔记本 | F12             |                |        |
| 顶星主板     | F11 或 F12 | 微星笔记本     | F11             |                |        |
| 铭瑄主板     | ESC 或 F11 | 明基笔记本     | F9              |                |        |
| 盈通主板     | F8         | 技嘉笔记本     | F12             |                |        |
| 捷波主板     | ESC        | Gateway笔记本  | F12             |                |        |
| Intel主板    | F12        | eMachines      | F12             |                |        |
| 杰微主板     | ESC或F8    | 索尼笔记本     | ESC             |                |        |
| 致铭主板     | F12        | 苹果笔记本     | 长按 “option”键 |                |        |
| 磐英主板     | ESC        |                |                 |                |        |
| 磐正主板     | ESC        |                |                 |                |        |
| 冠铭主板     | F9         |                |                 |                |        |



这里需要多啰嗦一句，现在大部分的电脑，特别是较新的电脑都是支持 `UEFI` 引导方式的，因此前面关于 `syslinux` 的修正部分有时可以跳过不做。

如果你的电脑比较陈旧，那么就要注意引导修正了。





### 进入 `Batocera`

现在我们可以来尝试 `Windows` 和 `Batocera` 双启动系统了。

简单演示如下。

图42.GIF





在进入 `Batocera` 后，我们按下 `F1` 键可调出文件管理器程序。

当我们进入 `/media/SHARE` 目录（也就是前面据说的用户分区 `userdata` ）后，我们可以看到很多不同的子目录。

分别有放置作弊文件的 `cheats` 目录、放置游戏的 `roms` 目录、保存游戏进度的 `saves` 目录，以及存放封面主题的 `themes` 目录等等。

图43



至于怎么用，那就看你的自由发挥啦！

比如 `roms` 目录中，寻找你喜欢的游戏，将它们放到对应模拟器的子目录中。

图44



另外除了这些子目录外，`Batocera` 还自带了不少的应用程序。

花样还是不少的，具体怎么玩还是留给小伙伴们自己研究吧！

图45



### 写在最后

虽说我写的比较啰嗦，但这个教程并没有太多的技术含量，其中比较难的是解决系统引导的问题。

不过如今日益普及的 `UEFI` 引导方式完全可以使我们很方便地修改和加载新系统。

小伙伴们，你们学废了吗？



自从将 `Batocera` 安装到电脑上后，老刘在空闲时可以随时随地开启游戏征程玩一把了，直呼太爽，非常欢乐！

用电脑玩 `Batocera` 这性能效果啥的真的比装在盒子上强多了啊喂！

在对我无比感激之余他语重心长地拉着我说，是我又为他节省了购买U盘的费用开支，当即改口称我为男神！

虽说没几个小钱，不过他让我放心请客啥的肯定是有的哈！

说完随即魔术般地从口袋中掏出一大把某饭店面额五元的优惠券，脸上笑嘻嘻地不由分说拖着我就往外走......



**扫码关注@网管小贾，个人微信：sysadmcc**

网管小贾的博客 / www.sysadm.cc