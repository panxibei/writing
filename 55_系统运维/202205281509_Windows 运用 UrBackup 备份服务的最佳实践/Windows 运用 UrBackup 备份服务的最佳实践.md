Windows 运用 UrBackup 备份服务的最佳实践

副标题：

英文：

关键字：





### 动态磁盘的概念

`Windows` 在我们平时使用时磁盘都是以基本磁盘的形态为主而存在。

基本磁盘就是传统的磁盘使用方式，有两种分区方式，一种是 `MBR` ，另一种是 `GPT` 。

`MBR` 最多四个主分区，也可以是三个主分区加一个扩展分区，然后扩展分区里再划分更多个逻辑分区。

`GPT` 最多可创建128个主分区，现在这些分区也可以被称为卷，现在的电脑基本都使用 `GPT` 了，分区数量也够用。

虽然 `GPT` 比 `MBR` 先进，也挺好用，但是它解决不了一个问题。

什么问题？

磁盘组队问题。



不管是分区也好，还是整个磁盘也好，无论 `MBR` 还是 `GPT` 都无法解决前两者的组队问题。

比如，我想把第一块磁盘的一个分区与第二块磁盘的一个分区组成一个大分区用于存放更多的数据。

又比如，我想把第二块磁盘和第三块磁盘组成冗余热备盘。

解决不了这些问题怎么办？

动态磁盘这时候就可以粉墨登场了！



动态磁盘对应并有别于基本磁盘，专门用来解决前面提到的一些更高级的硬盘使用问题。

动态磁盘划分的分区都被称为动态卷，而这些动态卷就可以用来灵活地应对磁盘组队问题。

动态卷有这么几种：简单卷、跨区卷、带区卷和镜像卷。

它们的区别大概如下所述。



* 简单卷：类似于基本磁盘的普通分区，简单卷是动态磁盘下的称呼。动态卷通常是用来组队的，而动态磁盘只有一块而暂时无法组队的时候，那么划分分区时唯一只能是简单卷。



* 跨区卷：用于将多个动态磁盘的不同卷组队在一起，最终形成随时可扩展容量的一个大的逻辑卷。



* 带区卷：两块或两块以上动态磁盘组成，读写数据时分散于各动态磁盘之间，为提高文件访问效率及降低CPU负荷，可以简单地理解为类似于 `RAID0` 。



* 镜像卷：两块动态磁盘组成互为镜像，用于数据容错冗余，可以简单地理解为类似于 `RAID1` 。



`UrBackup` 建议我们使用硬件 `RAID` 或是 `Windows` 动态卷来作为备份文件夹的理想存放目标。

硬件 `RAID` 好处和用法在此不必多说，我们就以前面刚刚解释过的动态卷来作为演示向大家说明其具体做法。



我们在原有 `Windows` 系统基础上添加两块相同容量的磁盘，并将这两个磁盘做成镜像卷。

首先，在初始化之后，磁盘是以基本磁盘形态存在的，我们想要将这两块磁盘做成镜像卷可以有两种方法。

一种是先将它们转换成动态磁盘，然后再组成镜像卷。

另一种是直接做成镜像卷，系统会自动帮我们将它们处理成动态磁盘。



我们就直接点，右键任意一块未分配磁盘，在右键菜单中选择 `新建镜像卷(R)...` 。

图b01



出现新建镜像卷向导，点击下一步。

图b02



将两块未分配磁盘都添加到已选框内，点击下一步。

图b03

图b04



分配驱动器号，点击下一步。

图b05



格式化镜像卷，可以在此设定卷标，标识备份盘。

注意，文件系统必须为 `NTFS` 。

图b06



向导收集信息，确认无误后点击 `完成` 开始生成镜像卷。

图b07



最终动态镜像卷新建成功。

可以看到两块磁盘上都标识为相同的 `D` 盘，它们互为镜像，实现冗余镜像的作用。

图b08

图b09



镜像卷可以粗暴地理解为 `Windows` 中的软 `RAID1` ，那么一旦出现磁盘损坏，我们怎么恢复它呢？

在这里顺带简单地说一说吧。

比如镜像卷中的第二块磁盘损坏需要更换一块新的，那么我们将新磁盘（注意容量一致）接入并启动系统后，可以在磁盘管理器中看到如下的样子。

图c01



这时镜像卷的第一块磁盘是完好的，因此我们右键点击它，并选择菜单中的 `添加镜像(A)...` 。

图c02



点选新接入的新磁盘，然后点击 `添加镜像(A)` 按钮。

图c03



在出现的警告提示窗口中点击 `是(Y)` 继续。

图c04



稍等一会儿，系统会识别新磁盘并重新同步镜像卷。

图c05



等到同步完成后，镜像卷就又重新恢复到良好状态了。





### 禁用 `8.3` 名称生成



```
fsutil behavior set disable8dot3 1
```







### 专用备份分区（盘）



格式化备份分区（盘）。

```
# 格式化命令语法
# /V:Label 分区卷标
# /Q 快速格式化
# /FS:NTFS 文件系统NTFS
# /L:enable 强制使用较大的文件记录，可简写为 /L
Format <Drive:> /V:Label /Q /FS:NTFS /L:enable
```



以当前为例，格式化 `D` 盘。

```
Format D: /V:UrBackup /Q /FS:NTFS /L
```

