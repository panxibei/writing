记一次 XigmaNAS 跳电故障的修复过程

副标题：记一次 XigmaNAS 跳电故障的修复过程

英文：troubleshooting-xigmanas-boot-error-and-failure-after-sudden-power-down

关键字：xigmanas,nas,网盘,power down,掉电,跳电



我问你，刮阵风就能把电脑给搞坏，你信不？

你说不信，你肯定会说，那要是天天刮风这电脑还不得都坏了，信你个鬼啊！

我想说的是，凡事没有绝对的，这个问题嘛就要看这风到底有多大，比如说台风。



当然了，不是说风大了能把电脑刮上天，而是说台风引起的大面积供电电路故障，从而导致了电脑设备损坏。

这不今年秋台风特别多，刚好赶上个叫“梅花”的台风，就把不少电脑设备啥的给搞坏了。

据说前几年有个台风也叫“梅花”，估计是一个猴子窝里捅出来的，那威力也是相当厉害。

我们暂且不提这台风，单单说这损坏的电脑设备中就有我今天想和大家伙分享的一个故障案例主角，一台 `XigmaNAS` 网盘设备。



这是一台用于某业务系统备份的设备，常年奔跑、辛勤工作，因此还特地给它配了个拍档：`UPS` 。

奈何这个拍档关键时刻不给力，也兴许是台风太给力，当天晚上电压波动得跟玩似的，低压不到 `180` ，高压直奔 `250` 。

总之经历了这么一个惊心动魄的夜晚后，各路英雄豪杰纷纷倒下，几无幸免，其中就有我们今天的主人公 `XigmaNAS` 。



### 故障现象

最后什么情况呢，等我拿到手时，尚有一口气在，能点亮，但是噼里啪啦跳出一堆错误。

比如你看，阵列被降级，居然有两块硬盘掉了，啧啧！

图01



还有开机不断各种花式警告报错，最惨的是到了最后，说什么 `/conf/config.xml` 文件没找到，结果控制菜单都看不到了。

图02



### 故障分析解决

这...这...这叫我如何是好？

在确认设备本身是否完好无损，并更换相应损坏的硬盘之后，我就在想，这么多的错误，难道要我一个一个地修复吗？

哎，有了，我们可以利用 `XigmaNAS` 安装盘的升级功能来修复损坏的文件啊！

于是我马上到网上下载最新版 `XigmaNAS` 镜像，然后选择升级安装，想着应该可以更新损坏的文件。

图03



选择通过安装介质升级当前系统。

```
Upgrade 'Embedded' OS from LiveCD/LiveUSB
```

或者

```
Upgrade 'Full' OS from LiveCD/LiveUSB
```

图04



确认升级安装。

图05



确认原系统安装位置。

图06



确认安装介质。

图07



升级安装整个过程非常丝滑，很快就结束了。

图08

图09



### 修复控制台菜单

的确升级过程很顺利，损坏的文件也正常被修复，并且配置文件 `config.xml` 也被成功保留并迁移到新版本上了。

但是，嘿嘿，就怕这个但是，结果一路开机顺利到最后，它它喵地还是提示我控制菜单不可用！

图10



这可怎么整？

后来我想起来了，为了避免有长相丑陋的不法之徒直接操作我的 `XigmaNAS` 控制台， `XigmaNAS` 的确有一项设定是可以关闭控制台菜单操作的。

那这个设定会不会保存在配置文件 `config.xml` 中呢？

结果我这么一查还真是，如下图，在配置文件中的确有一项叫作 `disableconsolemenu` ，就是禁用 `disable` 、控制台 `console` 以及菜单 `menu` 这几个单词合起来写。

同时这个值是布尔类型 `bool` ，也就是它要么是真要么是假，现在看它是 `1` 也就说明值是真，控制菜单被禁用了。

```
<disableconsolemenu type="bool">1</disableconsolemenu>
```

图11



OK，问题很清楚了，我们将它改成 `0` 不就可以了？

在控制菜单禁用的画面下同时按下 `Ctrl+Alt+F2` 开启一个新的终端 `Shell` ，找到 `config.xml` 修改吧。

结果令我意外的是我并没有在 `/conf` 目录中找到它的身影。



`config.xml` 消失了？还是说被藏到哪去了？

后来折腾了一会儿，这才发现新版的 `config.xml` 实际已经被移动到了 `/cf/conf/` 目录中。

好吧，改改看，结果它居然是只读的，好么，又是一个坑！

```
Read-only file system
```

图12



我仔细一看，得，不是文件只读，而是整个文件系统成了只读。

我可是堂堂正正的管理员 `admin` 啊，我都只读还能不能愉快地玩下去了？

干脆求助网络，发现可以通过重新挂载来让挂载点更新为可写。

具体这样做，并不复杂。



首先确认挂载点名称。

```
mount
```

就这么一个命令不带参数，它会列出当前系统所有的挂载点及其文件系统格式和是否只读情况。

从图中我们可以看出，挂载点 `/cf` 是只读的。

图13



对了，这个 `/cf` 不就是新版 `XigmaNAS` 放 `config.xml` 的那个 `conf` 目录的父目录嘛！

好，接下来就将它更新为可写吧！

```
// mount -uo rw [挂载点名称]
mount -uo rw /cf
```

只要最后写对挂载点即可，注意这个和 `Linux` 命令有一些区别。

好了，最后我们就可以修改 `config.xml` 的文件内容了！

下图是我用 `vi` 直接修改的情况，瞧，可以做到保存文件啦！

图14



最后重启系统，久违的控制菜单终于回归了！

图15



### 写在最后

对于电脑设备来说，断电跳电是最大的杀手没有之一。

就算直接按电源开关都没那么可怕，不信你可以每次关机时直接拔电源试试，哈哈！

因此最好的保护是为重要的设备加装 `UPS` ，可以在一定范围内有效保护设备。

当然 `UPS` 也不是万能的，比如像本文前面所述，`UPS` 自身难保，遇到台风这种极端天气也只能算自己倒霉。

在允许的情况下，还是尽可能关闭电源，完全切断断电跳电的可能性，这样才能最大化地保护设备安全。



另外我想补充的是，如果我们对像 `XigmaNAS` 这样的备份设备长期在线要求比较高的情况下，当出现类似的故障时最好更换新的零部件或直接换新。

跳电不但容易引起设备故障，而且有些故障也有一定的潜伏期，也不能100%地保证现在的零部件是完好无损的，以后就不会出问题。

好了，今天的分享就到这里了，希望今后少一些台风惊魂夜，祝大家的电脑设备安全无虞！

关注我，别失联！



**将技术融入生活，打造有趣之故事。**

网管小贾 / sysadm.cc