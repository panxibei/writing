从 2012R2 到 2016 共享文件夹的迁移过程

副标题：



文件服务器需要迁移。

虽然平时精于管理，但是共享文件夹仍然存在结构层次复杂，人员权限交错叠加的问题。

如果原本复制照搬到新服务器上，势必要重新配置权限、设定配额及过滤器等，费心费力。

毛主席教导我们，世上最怕认真二字，于是我又去翻阅了大量资料，找到了传说中的神奇工具 `Windows Server 迁移工具` 。

恕我孤陋寡闻了，这件神器最在 `Windows 2008` 时代就已经存在了，它基于 `PowerShell` 平台，再具体的说明我也说不太清楚，总之它可以帮我们迁移服务器各种功能，其中就包括共享文件服务。



网上可查到的资料基本都是碎片化的，参考任何一篇都很可能掉进不知何时会出现的坑中。

现在我将详细说明整个共享文件的迁移过程，其中当然也包括那些坑，最后我也会来个总结，帮助小伙伴们最终理清思路。



> 旧服务器：Windows Server 2012 R2
>
> 新服务器：Windows Server 2016
>
> 共享文件夹：D:\sysadm.cc



### 一、安装 `Windows Server` 迁移工具

安装非常简单，在 `服务器管理器` 中 `添加角色和功能` ，然后选中 `Windows Server 迁移工具` 安装即可。

图1



我在新旧两台服务器上都按这个方法安装了迁移工具，不过请小伙伴们注意，这里其实有个坑，具体后面会说。



### 二、打开防火墙端口

迁移工具在两台服务器之间传输通讯肯定要通过某些端口连接，根据官网的介绍，是需要分别打开源服务器与目的服务器的 `7000` 端口。

不过经过我测试，似乎目标服务器需要开通 `7000` 和 `7001` 两个端口，也可能是不需要 `7001` ，总之保险一点我开通了两个。



