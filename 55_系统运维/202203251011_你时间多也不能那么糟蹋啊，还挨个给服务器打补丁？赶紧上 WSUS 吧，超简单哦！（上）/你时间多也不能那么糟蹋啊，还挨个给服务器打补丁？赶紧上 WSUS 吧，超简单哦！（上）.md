你时间多也不能那么糟蹋啊，还挨个给服务器打补丁？赶紧上 WSUS 吧，超简单哦！（上）

副标题：批量给服务器上更新，你必须用用看 WSUS ！

英文：you-cant-waste-so-much-time-and-still-patching-servers-one-by-one-hurry-up-to-try-wsus-its-very-simple-1

关键字：windows,wsus,update,upgrade,更新,补丁,patch,服务器



连续好几个周末，说好的哥几个都一块儿去钓鱼散心，却每次都被小M放了鸽子。

这咋回事，这小M背着哥几个玩什么猫腻，就想知道小M最近搞啥飞机呢？

终于大伙儿一块儿商量着，决定一起开个“视频会议”，来“揭秘”小M不为人知的秘密！



话说这天到了周末，好不容易等到了小M上线，原本哥几个还期待着小M是不是在哪个风色场所出现，让人意想不到的是他居然人在机房。

屏幕中的小M一副苦瓜脸，刚一上来就向大家伙哭诉着最近被迫996的痛苦经历，每到周末还要给服务器打补丁。

原先没几台服务器，小M寻思着也就挨个手动安装操作了。

如今不知不觉有了数十台服务器，安装更新所花费时间也就越来越久，最终导致周末无休，放假无望。



听完小M的哭诉，我长叹了一声，语重心长地安慰他说：“你特么上个 `WSUS` 能si啊？！”

很明显，小M被我的话感动到了，他激动地结巴起来：“那...那什么...怎么搞啊？”

看他挺可怜的，于是我就告诉他，`WSUS` 是 `Windows Server Update Services` 的简称，翻译过来就是 `Windows` 服务器更新服务，专门用来分发更新补丁的。

这 `WSUS` 是 `Windows` 服务器版本系统就有的，它的好处可多了，大概有以下几个。

* 可自动批量分发更新补丁到服务器和客户端计算机
* 可批量处理不同系统版本的更新
* 可审批或拒绝特定的更新，避免某些更新造成系统不稳定甚至崩溃
* 及时、有效、全面地应用更新，不用自己到处找更新程序
* 不需要域环境支持，直接上就行



看到这么多好处，小M立马流下了悔恨的口水。

没想到还能这么干啊，他求我赶紧教他具体的方法。

大家都知道，我是一位心地善良、乐于助人的好心人，这点小事对我来说是举手之劳。

我安慰他，说别着急，你先擦干口水振作一点，我先出去买米，等我做了饭请你来咱们一边吃饭一边好好聊聊！

我刚说完，小M立马转我一个大红包，示意我见外了，让我现在赶紧救急。

我一边安慰他，一边点开大红包，藐视地瞪了他一眼：“啥也甭说了！走着！”



### 如何添加 `Windows Server 更新服务`

`服务器管理器` 中点击 `管理` 菜单，选择 `添加角色和功能` 。

图01



一些说明，没啥可看的，直接下一步吧。

图02



默认直接下一步。

图03



默认是在当前服务器上添加角色和功能，下一步。

图04



找到 `Windows Server 更新服务` ，打上勾。

图05



安装 `Windows Server 更新服务` 是需要 `Web 服务器(IIS)` 支持的，所以它也会一并被安装。

我们点击 `添加功能` ，它会自动勾选。

图06

图07



不需要选择任何功能，直接下一步。

图08



还是一些说明，直接下一步没得说。

图09



保留默认的角色服务选择，下一步。

第三项需要 `SQL Server` 支持，简单运用我们无需选择它。

图10



更新服务器需要下载大量的更新补丁，因此我们必须为它指定一个可保存更新补丁的文件夹，名字可随意，尽量预留大一些的容量空间。

图11



确认默认安装的 `Web 服务器角色(IIS)` 信息，不用刻意调整，直接下一步即可。

图12

图13



最后安装准备，点击 `安装` 开始更新服务的安装进程。

图14

图15

图16



### 初始化 `Windows Server 更新服务` 

安装完成后，我们点击 `服务器管理器` 界面上的通知信息（小旗子），然后再点击 `启动安装后任务` 。

图17

图18

图19



待安装任务完成后，我们点击 `工具` 菜单中的 `Windows Server 更新服务` ，开始初始化部署。

图20



配置向导开启，点击下一步。

图21



将下方提交给官方报告的提示选项去除。

图22



选择上游服务器，有两种方式，一是直接通过官方服务器更新，这是默认选项。

另一种是指向已有服务器，只要指定这个服务器的名称或IP地址即可。

图23



选择代理服务器，如果内部是通过代理服务器连接更新服务的，那么就在此指定代理。

图24



作为服务的初始化，接下来我们需要点击 `开始连接(S)` 来连接上一级更新服务。

注意注意，这是必须步骤，如果你在此不小心点击取消，那么在之后的更新列表中有可能找不到 `Windows 10` 等比较新的更新版本了。

图25



这一步骤需要花费较多的时间，需要耐心等待，我这儿就干等了小半个钟头。

图26



耐心等待完成连接后，我们就可以点击下一步了。

图27



选择更新所属语言，通常我们选择 `中文(简体)` ，或是根据你实际需要再选择其他语言。

图28



接下来选择更新产品，也就是我们实际需要哪些补丁，比如针对 `Windows 10` 的，还是针对 `Windows Server` 的，又比如驱动程序或产品更新等等。

当然如果是什么 `XP` 啥的，就没有选择的必要了，那我们可以将不需要的去掉，以便减少下载负荷。

图29



再来我们还要选择更新分类，一般情况下我们选择 `安全更新程序` 和 `关键更新程序` 就足够了。

图30



然后我们定个同步时间，可以理解为检测和下载更新的时间。

这个时间你可以随意设置，但建议选在夜深人静的时候，可能速度会快一些。

另外每天同步次数最好不要太多，如果因为频繁地更新而导致系统卡死可就不开心了。

图31



是否开始初始同步？

我建议最好不要，因为在这儿就开始第一次同步需要等待非常长的时间。

我们完全可以等待设置完毕后再同步也不迟。

图32



一切准备OK，点击 `完成` 按钮完成设置。

图33



最后我们就可以看到更新服务的界面，在这个界面中我们就可以开始更新服务的进一步调整设置了。

图34



就像前面说的，如果你不小心取消了初始化向导设置，那么也不用担心，我们可以在更新服务界面中的选项，找到 `WSUS服务器配置向导` ，就可以再次激活初始化配置向导。

图35



### 开始使用 `Windows Server 更新服务` 

初始化配置只是做了一些前期铺垫工作，后面我们才是实际需要操作使用的步骤。

大概地，我们需要先同步更新，然后审批更新，再然后再将更新分发到目标计算机中。

我们先来看看更新服务器上应该怎么操作。



##### 同步

确认初始化设置没有问题后，我们可以点击更新服务界面中的 `立即同步` 。

图36



经过一段时间后，我们可以看到有更新被同步过来了。

当然这些更新还没有被审批，只有等待我们审批通过后，这些更新才会被应用到指定的计算机中。

图37



等到更新同步完成后，我们点击左侧导航栏的 `所有更新` ，然后将过滤条件的状态一项选择为 `任何` ，再点击 `刷新` ，就可以看到同步好后的更新列表了。

图38



##### 审批

右键点击我们需要安装的更新（可以批量多选），然后点击 `审批(A)...` 。

图39



在 `审批更新` 界面中点选相应的计算机组，然后点击 `已审批进行安装(I)` 即可将更新审批应用到指定的计算机中。

图40



##### 计算机组

计算机组可以用来划分需要安装不同更新补丁的计算机，将这些计算机放在一个组里方便应用相同的更新。

右键点击 `所有计算机` ，然后点击 `添加计算机组(A)...` 。

图41



给这个计算机组起个容易区分的名称，以后审批更新就可以直接应用到这些计算机组上了。

图42



##### 拒绝

更新有审批通过的，就有我们不需要的，然而不需要的却是大多数，因此我个人建议可以先将大部分我们不需要的更新给予拒绝处理，方便我们理清之后真正需要的更新。

比如较旧版本的更新，再比如 `ARM64` 甚至部分 `x86` 平台之类用不上的更新等等都可以排除。

右键点击需要拒绝的更新，然后点击 `拒绝(D)` 。

图43



确认无误后，点击 `是(Y)` 将当前更新拒绝。

图44



### 下一回...

由于篇幅所限，我们将在下一回继续为小伙伴们介绍关于 `WSUS` 客户端设置的内容。

大家别着急，在此之前，建议小伙伴们先将服务端设置的内容消化一下，动动小手操作操作。

当服务端稳定并完成同步后，我们就可以通过设置客户端来连接服务后更新补丁了。

好了，我们下期再见吧！



**扫码关注@网管小贾，阅读更多**

网管小贾的博客 / www.sysadm.cc





















