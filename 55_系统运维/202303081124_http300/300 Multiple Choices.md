300 Multiple Choices

副标题：

英文：

关键字：



最近加班挺猛的，又赶上个周日还得上班，这样下去不利于吾辈躺平之气节。

于是某日趁着哥几个正巧早下班，干脆凑一块儿喝个小酒，解解闷、吐吐槽。



酒过三巡，菜没几个，哥几个话就多了起来。

一阵骚乱七嘴八舌过后，大家伙一商量，要不干脆轮流说说自己的闹心事吧！

一杯小酒下肚，轮到我开个头。

得，那我就斗胆给大家说一说最近我遇到的个奇葩事吧！



其实我刚说的那事吧，就在出问题之前，我曾上了趟厕所。

就在我骄傲地站在小便池前时，突然看到距离我隔着两个位置的小便池自动冲水。

当时我就不骄傲了，看了看那个方向，没人啊！

又看了看其他VIP蹲位，也没人啊！

整个厕所就只有我一个人啊！

我咽下口水，大前门拉了一半就落荒而逃……



前不久公司新添加了几台 `HP LaserJet Pro 4004` 系列的打印机。

一直工作的好好的，突然某天出了问题，于是找我处理。

我一开始也没多想，先看看设置有没有问题吧！

于是熟练地打开浏览器，输入打印机的 `IP` 地址，回车走起。

`Web` 管理页面顺利打开，并提示输入密码。

图a01



密码…密码…多少来着？

哦，想起来了，123456……

结果打脸了，提示密码错误！

图a02



这…不能啊！

一般情况下我不会留多复杂的密码啊，我这都快40大寿的人了，也记不住那么多密码啊！

又尝试了几遍，无疑都失败了！

问了问其他人，也确认没有修改过密码。

再仔细回忆回忆，遥记得上周我还登录设置来着，密码绝对不会有错，这就搞笑了，到底是怎么回事？



遇到问题就要解决它，办法总比困难多，嗬，我咋想起这鸡汤话来了！

不过不解决是真不行啊，要不老板又多了个给你加班的理由了。

于是我果断打开浏览器的调试窗口，看到了如下的错误提示。

```
GET请求    https://192.168.1.123/AuthChk
返回状态    403 Forbidden
响应信息	空
```

图a03



通过图中我们可以看到，在我登录提交密码时， `GET` 请求是发送到 `/AuthChk` 路径上的。

观其字面意思，很明显是指检查认证，提交路径是没问题的。

不过接着查看，好像返回的响应不正常，啥都没有的样子啊！

图a04



看返回的状态码是 `403 Forbidden` 禁止访问，好像是密码错误登录失败，但的确我记得密码就是这个，这就很奇怪了！



然而我再反复尝试过后，发现同样是请求 `AuthChk` 返回的状态码又变成了 `300 Multiple Choices`  。

真是奇哉怪也，怪事频频！

```
GET请求    https://192.168.1.123/AuthChk
返回状态    300 Multiple Choices
响应信息	空
```

图a05



最后我总结了一下，当我打开登录页面时，它的状态是 `403` ，而当我提交密码时，它的状态又变成了 `300` ，总之是无法成功登录。

这一不正常现象让我一度怀疑我的电脑出了问题。

好吧，我干脆跑到车间的电脑上，直接尝试访问打印机。

结果奇迹出现了，我去，居然可以正常登录！



吓得我赶紧在胸前划了个十字，然后打开调试窗口，仔细一瞧，请求 `AuthChk` 没错，不过这次居然正常返回了响应信息。

```
{"hasAuth": true}
```

图b01

图b02



是的，你没看错，返回了一个 `Json` 格式的字符串，我盲猜应该是可以或允许认证的意思。

虽然不是通过认证的意思，但至少发生了变化，问题解决也就有转圜的余地。

经过对比前后发生的变化以及不同之处，我这才发现，同样是访问同一台打印机，前后使用的 `IP` 地址居然是不一样的！

这是怎么回事呢？



原来啊，生产车间与办公区域通过防火墙隔离开来，两者之间通讯可能是通过路由或 `NAT` 映射的方式实现的。

因此相当于是在两个不同的局域网内访问同一台打印机，所以说使用的 `IP` 地址不是一个。

比如，办公区使用的 `IP` 地址是 `192.168.1.x` ，而生产区的 `IP` 地址是 `192.168.100.x` 。

```
办公区 --- 192.168.1.x
生产区 --- 192.168.100.x
```



说到这儿肯定会有小伙伴会说，即使 `IP` 地址不同，那不都是同一台打印机，连登录页面都打开了，会有什么问题？

是的，我一开始也是这么想的，甚至是百思不得其解。

不过经过我1个小时36分07秒的思考后，我这才发现，它们都是以 `https` 开头加 `IP` 地址的形式来访问的。

哈哈，估计又有人说了，那还不是一个样，有啥区别？

是啊，我也感叹，问题太过刁钻，人生苦短啊！

其实说白了，这个问题可能就出在 `https` 的加密认证上，要知道 `https` 访问证书通常不会以 `IP` 地址的形式申请的。

什么意思？

简单地说就是，`https` 证书决定了你最好是用域名的形式来访问网址，而不是用 `IP` 地址的形式。

有过申请 `https` 证书的小伙伴们应该有过经验，哪怕是自签名证书，证书中的信息中，`IP` 地址是不建议的，而应该填写域名。



虽然我说得有点啰嗦，但这至少是个解决问题的突破口。

想到这儿，我翻找出之前打印机的备忘记录，找到了当时登记的打印机的主机名称。

随后我尝试改用主机名称（域名）的形式来访问打印机设置页面。

```
https://hpxxxxxx/
```

这时奇迹再次出现，终于响应信息就这么来了！

图b03

图b04



小伙伴们可以看一下图中，我是用打印机域名来访问它的，而非 `IP` 地址。

再回过头看看前面的截图，很容易看出是用 `IP` 地址直接访问的。

好了，之后也就没啥稀奇了，试着输入我的万能密码，点击提交登录！

OK，这下没跑了，成功登录，哇哈哈！

图b05



不错不错，再确认一下成功登录是个啥样子。

出现了 `PwdChk` 的请求路径，并且返回了 `hasPwd: true` 这样的响应。

```
GET请求    https://192.168.1.123/PwdChk
返回状态    200 OK
响应信息	{hasPwd: true}
```



至此真相大白，打完收工！



“喂喂…打住打住……”

“谁让你说工作的事了，说点工作以外的好玩的事来听听！”

我正说得带劲，却看到在座的各位脸上泛着红晕，埋怨我老是三句话不离工作。

好吧，那我说个别的事。

其实我刚说的那事吧，就在出问题之前，我曾上了趟厕所。

就在我骄傲地站在小便池前时，突然看到距离我隔着两个位置的小便池自动冲水。

当时我就不骄傲了，看了看那个方向，没人啊！

又看了看其他VIP蹲位，也没人啊！

整个厕所就只有我一个人啊！

我咽下口水，大前门拉了一半就落荒而逃……

补充：这是真事，为了本文看上去不像走进科学，后来听人说估计是那位置靠近窗户，由于光线的原因导致小便池感应器敏感工作。



**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc