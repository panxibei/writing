SimpleRunBlocker

副标题：

英文：

关键字：





屁颠儿地打开程序，发现跳出个错误提示。

```
本次操作由于这台计算机的限制而被取消。请与你的系统管理员联系。
```

图a07



什么情况？





其中 `NoDriveTypeAutoRun` 是用来指定某些类型的设备是否禁止自动播放功能。

设备分为很多不同的类型，分别用不同的数字指代，通常如下。

* `1` - `DRIVE_UNKNOWN` 不能识别的类型
* `4` - `DRIVE_REMOVABLE` 可移动磁盘
* `8` - `DRIVE_FIXED` 硬盘
* `10` - `DRIVE_REMOTE` 网络驱动器
* `20` - `DRIVE_CDROM` 光驱
* `40` - `DRIVE_RAMDISK` `RAM` 驱动器
* `80` - 未知类型
* `FF` - 所有类型



如果我们要禁止某一类型设备自动播放，那么直接使用对应的值即可。

如果要禁止多个类型的设备，则将指代它们的数值相加即可。

比如：

* `95 = 1+4+10+80` 是指 `不能识别的类型` + `可移动磁盘` + `网络驱动器` + `未知类型`
* `91=1+10+80` 是指 `不能识别的类型`  + `网络驱动器` + `未知类型`
* `b5=1+4+10+20+80` 是指 `不能识别的类型` + `可移动磁盘` + `网络驱动器` + `光驱` + `未知类型`



当然，自动播放并不是重点，重点是下面两个。



* `NoDrives` - 隐藏磁盘
* `NoViewOnDrive` - 禁止访问磁盘



这两个小兄弟，一个管隐藏，一个管禁止，虽然名字不一样，但用法是一样的。

他们都是 `REG_DWORD` 类型的键值，和前面的`NoDriveTypeAutoRun` 一样也是用二进制的数字位数来表示磁盘驱动器位置。

具体地说，就是磁盘驱动器的盘符从高到低，也就是从 `A` 到 `Z` ，分别用二进制来表示。

相应盘符的数字是`0` 表示启用，数字是 `1` 则表示禁用。



举例，只保留开启 `C` 、 `D` 盘，则可以这样表示：

```
Z Y X W V U T S R Q P O N M L K J I H G F E D C B A
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 1
```

因此十六进制就是 `0x3FFFFF3` 。





出现了三个新的注册表项。

* `BlockRunList`
* `DisallowRun`
* `RestrictRun`

图a08



这三项是啥来头？



##### 拦截列表中的程序

图e01



对应的就是注册表键 `DisallowRun` ，只要它的值是 `1` 就起作用。

图e02



那么一旦 `DisallowRun` 起作用，以下注册表路径中的所列出的项目就会被拦截禁止。

注意，其中的注册表键名是任意的，键值才是关键哦！

```
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun
```

图e03



##### 拦截不在列表中的所有程序

这个的意思正好和前面的相反，用来禁止绝大部分程序，这种反向操作要特别小心了。

图e04



相应的注册表键就是 `RestrictRun` ，只要它的值是 `1` 就起作用。

图e05



那么一旦 `RestrictRun` 起作用，以下注册表路径中的所列出的项目就会被拦截禁止。

注意，其中的注册表键名是任意的，键值才是关键哦！

```
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\RestrictRun
```

图e06



至于 `BlockRunList` 这个注册表键，似乎应该是 `SimpleRunBlocker` 这个程序自己创建的，用来保存程序列表。



### 绕过限制的方法

既然原理已经被我们掌握，那么接下来如何绕过限制也就变得易如反掌了。

很简单，我们可以通过手动修改注册表将策略关闭。



方法一，直接关闭限制开关，将 `DisallowRun` 和 `RestrictRun` 分别设置为 `0` 。

```
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"RestrictRun"=dword:00000000
"DisallowRun"=dword:00000000
```



方法二，将限制列表中的相应程序名称重命名。

比如 `DisallowRun` 项中的程序列表，将其中你想要运行程序项的键值修改为其他名称。

图e07



又比如 `RestrictRun` 项中的程序列表，在其中添加你想要运行程序的名称。

注意，键名可以随意不一定是程序名称，但键值一定要是程序的完全文件名。

图e08



好了，手动修改注册表后，可能不会立刻生效，那么我们可以用以下命令强制刷新策略就能快速生效。

```
gpupdate /force
```



以上方法通过手动修改注册表可能略显麻烦，实际上还有一个极其简单而又变通的方法，那就是直接去重命名你想要执行的程序文件名。

哈哈，这么简单啊，我可真是个机灵鬼，因为 `Simple Run Blocker` 压根就管不了你重命名文件啊！



### 写在最后

经过前面的说明以及反复测试，可以说我们完全掌握了 `Simple Run Blocker` 的使用原理，那么我们完全也可以自己开发出这样一套简单实用的小程序。

我也正考虑能不能自己也搞一个差不多的程序，以便将这些功能整合到其他程序中。

可是好景不长，没过几天，他又再次找到我，说他这次遇到了更为棘手的麻烦！

是的，他的程序被再次锁定，而且就算是重命名文件也不好使了！



我将电脑拿过来这么一瞧，还真是，不管怎么折腾都不好使了！

哎？这是怎么回事？

难道我碰上了更难缠的对手了？

我稍作调整，准备开始新一轮的战斗。

后来究竟如何，请看下回分解！



**扫码关注@网管小贾，阅读更多**

网管小贾的博客 / www.sysadm.cc