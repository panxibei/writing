MRTG一款小白最爱的系统网络监控神器一（安装篇）

副标题：小白神器，简单实用~~



在系统运维管理中，有很多监控软件。

而在众多的监控软件中，又有很多非常专业高级的软件，比如 `zabbix` 等等。

但这些对新手小白们来说门槛太高，基本是仰望姿态。

好了，小白救星来了！

不错，请上我们今天的嘉宾--MRTG！



我们请嘉宾 `MRTG` 来个自我介绍：

> `MRTG` 是 `Multi Router Traffic Grapher` 的简称。
>
> `MRTG` 是一个监控网络链路流量负载的工具软件，通过 `snmp` 协议得到设备的流量信息，并将流量负载以包含PNG格式的图形的HTML 文档方式显示给用户，以非常直观的形式显示流量负载。
>
> `MRTG` 是用 `perl` 编写的，源代码完全开放。
>
> `MRTG` 可以运行在 `Linux` 、`Windows` 等多个操作系统平台上。

来张靓照：

图1



我们来说一说如何安装。

> 安装概览：
>
> 1、安装WEB服务
>
> 2、安装PERL
>
> 3、安装MRTG



一、安装WEB服务

既然MRTG是通过HTML文档方式显示的，那么首先就需要有一个WEB引擎，比如Apache。

其实任何能提供WEB服务的程序都可以，除Apache外还有Nginx、IIS等等。

我比较喜欢WampServer，在之前的超简单安装三步走文章中也有介绍，很快很方便地我们就能安装成功。

这里我们就不详细展开了，什么，你还没看过？

啧啧~~ 给你链接，速速看来：[《WampServer新手安装简单三步走》](https://www.sysadm.cc/index.php/webxuexi/731-wampserver-install)



二、安装PERL

这个没什么花样，下载安装包直接安装就是了。

默认安装，通常会安装在 `C:\Perl64` 。

不过非官方下载安装包可能不安全，官方下载又需要先注册才能下载太麻烦太慢。

想想就痛心，什么时候才能成为时间管理大师啊~

别慌，贴心的我还是想到要照顾一下小伙伴们的，我在官网花了快一个小时才下载到的安装包，保证妥妥滴是正品哈~

下载链接：ActivePerl-5.28.1.0000-MSWin32-x64-865dc3eb.exe

图2





三、安装MRTG

1、把官方下载的MRTG程序包解压到指定目录下，比如：`C:\MRTG` 。

同样贴心，省得你满世界去找了，下面链接就可以直接下载到最新官方程序包啦。

链接：mrtg.2.17.7.zip

图3



2、测试安装是否成功

解压完成后，在命令控制台上输入以下命令来测试 `perl` 及 `mrtg` 是否正常。

出现如图的提示参数错误还有 `mrtg` 版本信息即为安装成功。

```shell
cd c:\mrtg\bin
perl mrtg
```

图4



3、开启客户端 `snmp` 协议

我们在这里先用测试电脑本身作为客户端，来开启 `snmp` 协议。

* 依次打开 `控制面板` > `程序` > `启用或关闭Windows功能` 。

  在打开的 `Windows 功能` 列表中，勾选 `简单网络管理协议(SNMP)` 和 `WMI SNMP 提供程序` ，并点击确定。

  图5

* 依次打开 `计算机管理` > `服务和应用程序` > `服务` ，双击右侧列表中的 `SNMP Service` 服务项。

  在 `SNMP Service` 的属性界面中，添加名称为 `public` 的社区，以及添加接受 `SNMP` 数据包的主机，这里添加测试电脑自身的IP地址。

  图6
  
  图7



4、生成客户端配置文件

```shell
# 新建一个目录，用于存放配置文件
md c:\wamp64\www\mrtg_192_168_1_99

# 切换到mrtg的bin目录
cd c:\mrtg\bin

# 生成测试主机（192.168.1.99）的配置文件 mrtg_192_168_1_99.cfg
# WorkDir 生成页面和数据日志存放的路径
# output 生成的配置文件
perl cfgmaker public@192.168.1.99 --global "WorkDir: c:\wamp64\www\mrtg_192_168_1_99" --output c:\wamp64\www\mrtg_192_168_1_99\mrtg_192_168_1_99.cfg
```



5、生成客户端图表页面

用刚才生成的配置文件来生成展示的页面文件。

```shell
# 切换到mrtg的bin目录
cd c:\mrtg\bin

# 根据配置文件 mrtg_192_168_1_99.cfg 生成页面文件 mrtg_192_168_1_99.html
perl indexmaker --output=c:\wamp64\www\mrtg_192_168_1_99\mrtg_192_168_1_99.html c:\wamp64\www\mrtg_192_168_1_99\mrtg_192_168_1_99.cfg
```



6、初次抓取数据

页面文件有了，但这时还没有数据，还没有生成对应的图表内容，所以需要先手动抓取点数据来测试。

```shell
# 切换到mrtg的bin目录
cd c:\mrtg\bin

# 根据配置文件 mrtg_192_168_1_99.cfg 抓取数据生成日志文件 mrtg_192_168_1_99.log
# 需要运行多次，通常直到没有错误提示即可
perl mrtg --logging=c:\wamp64\www\mrtg_192_168_1_99\mrtg_192_168_1_99.log c:\wamp64\www\mrtg_192_168_1_99\mrtg_192_168_1_99.cfg
```



7、访问测试页面

打开浏览器，输入以下URL回车。

```shell
http://127.0.0.1/mrtg_192_168_1_99/mrtg_192_168_1_99.html
```

图8



以上只显示第一张图表是有效的，因为测试主机只有一块网卡，其他是多余的。

其实默认生成的配置文件比较傻瓜，需要手动修改，这个我们放在下一次高级篇中详细说明。

点击这张图表，可以看到更详细的图表，一般按年、月、周和日来分别显示流量。

这里需要说明的是，你现在只能手动抓取数据（即执行第6步的命令），才能看到图表流量的变化。

所以你看，我这儿只有每日图表上有那么一点点流量显示。

关于如何自动化获取流量数据，还是放在高级篇中介绍。

图9



后续可能遇到的问题：

如果你遇到如下图的错误提示，那么说明你的 `snmp` 没有正常开启，可以仔细参考第3步。

图10





到这里我们简单而快速地介绍了MRTG的安装和配置使用，小伙伴们还算好理解吧。

简单基础的安装设定没问题了，不过现在我们也只能监控一些网卡的网络流量。

在下一次高级篇中，我们将分享一些高级配置和用法，比如：

* 监控CPU、内存和硬盘
* 监控交换机、打印机等网络设备
* MRTG自动配置生成及多设备页面模板制作
* 自动化抓取流量数据

欲知详情，请看下回分解！



> WeChat: @网管小贾
>
> Blog: @www.sysadm.cc







