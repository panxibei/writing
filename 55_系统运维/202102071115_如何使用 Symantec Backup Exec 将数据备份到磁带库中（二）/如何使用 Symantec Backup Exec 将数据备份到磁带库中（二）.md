如何使用 Symantec Backup Exec 将数据备份到磁带库中（二）

副标题：做个备份演示，看看有没有坑~



前一篇我们已经把 `SBE` 备份服务的环境都搭建好了，接下来看看如何做一个备份。

前篇回顾：

> 《如何使用 Symantec Backup Exec 将数据备份到磁带库中（一）》
>
> 链接：https://





### 添加备份目标

随便找个 Windows 系统的服务器，我们假定它的名字叫 `S01` 。

我们想要备份 `S01` 的数据，那么我们就要把它添加到 `SBE` 的备份服务器列表中。

默认刚安装完 `SBE` 后，这个列表中只有备份服务器自己。

图1



要实现添加 `S01` 服务器，需要在 `S01` 上安装 `SBE` 的 `Agent for Windows` 代理程序。

这个代理程序是一个客户端程序，用来和备份服务器通讯的。

如何安装它呢？

有两个方法，一个是拿着 `SBE` 安装镜像到 `S01` 上本地安装 `Agent for Windows` ，另一个就比较高级了，就是直接在备份服务器这边远程安装。

直接本地安装没啥花样，我们还是来看看如何远程安装，毕竟有时是不方便本地安装的。



在服务器列表界面中，点击 `添加` 按钮（或右键空白处后选择添加），然后选择 `Microsoft Windows 计算机和服务器` 。

图2



勾选 `允许 Backup Exec 与服务器建立信任(A)` ，如不建立信任关系，可能每次备份时需要单独验证通讯增加时间开销。

图3



按照名称或IP地址添加服务器。

IP地址连接更快，但如果服务器有可能会变动IP地址，那么最好还是用名称来连接吧。

图4



是否升级 `Agent for Windows` 版本或是自动重启远程服务器，自行判断选择吧。

图5



接下来就可以开始安装了。

图6

图7

图8



很简单吧，安装好了吗？

不相信的话可以到 `S01` 服务器上看看，果然代理程序安装OK！

图9



再来看一下服务器列表，也已经有了 `S01` 服务器的信息，至此添加完成。

图10



添加代理程序的过程非常简单，不这里还是要说一句，`SBE` 也支持 Linux 系统的备份，但 `Agent for Linux` 则需要单独本地安装，其他的都大同小异，这里就不再赘述了。





### 设定一个备份

备份介质有了，目标对象也有了，那么我们就可以来试试看怎么备份吧。



##### 首先，在服务器列表界面中，点击 `备份` 下拉菜单，选择 `备份至磁带` 。

图11



##### 其次，选择 `基于代理的备份` 。

图12



##### 再次，有两项需要设定，一个是选择想要备份的数据（比如C盘），还有一个备份方式（完全、增量还是差异）。

图13



选择备份的数据很简单，只要勾勾选选即可。

图14



根据实际情况调整备份方式和周期。

图15



有的小伙伴要说了，我只想将数据保留1周，这里面怎么没得选啊？

其实这个叫作介质集，就是你的备份怎么放怎么保留的意思，是可以自己定义的。

如图，点击右边那个按钮来添加新的介质集。

图16



比如将数据保留1周，附加时间为6天。

图17

图18

图19



这里简单地解释一下什么是覆盖周期和附加周期。

覆盖周期就是磁带上的备份，当它写入后多久之内是不能被覆盖擦掉的。

如果覆盖周期是一周，那么这个数据在一周内是不会被擦掉，你在一周内还能把它找回来。

附加周期这个概念挺容易与上面的覆盖周期混淆的，其实它的意思就是在指定时间内可以接着往后面写备份数据。

注意，它并不是覆盖，而是接在前面的数据后面接着写（附加）。

因为通常备份介质集是一个池，它并不是指单独的某一盘磁带，备份数据的写入往往是今天写A磁带，明天写B磁带，这样分散开来的。

所以可以允许同一盘磁带多次写入（附加）数据。

拿前面的例子说，比如如果每天备份一次，那么A磁带可以每天写一次，一共最多写6次，而一周之内每次写都不会覆盖之前的数据。



想简单解释一下，结果还是啰嗦了这么多，希望小伙伴们能明白。

当然以上也只是我个人的理解，也可能有偏差，以实践为准吧。



##### 最后，设定完毕后就可以实施备份了。

可以选择立即运行备份，也可以等待计划自动执行。

图20



当我完成备份后，系统突然提示说未创建 `Simplified Disaster Recovery 磁盘` 。

是我不够好吗？这个什么磁盘又是什么鬼？





### 安装评估和部署工具包

要想弄清楚那个什么 `Simplified Disaster Recovery 磁盘` ，我们必须先搞一个 `ADK` 的工具包。

喂喂~又冒出来一个什么包，你在搞什么啊？

别着急，耐心看下去就知道了哈。



Windows 评估和部署工具包（ADK）对普通用户来说意义不大，但在通常的系统维护方面却很重要，主要是用作自定义大规模部署映像或测试系统等等场景之用。

为什么现在要提及这个东东呢，因为在下一节关于恢复备份而需要创建恢复磁盘时非常有用。

是的，没错，那个什么鬼磁盘就是所谓的恢复磁盘，当然系统挂了之后就得用上恢复磁盘了。

这个我们等会儿再说，先把 `ADK` 唠清楚。



> 官方文档链接：https://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install
>
> 安装包下载链接：https://go.microsoft.com/fwlink/?linkid=2120254

其中可以下载到最新版本的 Windows ADK 。

我用的是 Windows 2016 ，可是打开链接页面，其中只有 Windows 10、8、7 之类的版本，并没有 2016 啊？

其实直接套用 Windows 10 的就行了，但是也有很多版本啊，怎么选呢？

先看看自己的 2016 是啥版本，原来是 `1607` 啊。

图21



这就好办了，还真有 `1607` 的 Windows 10 版本，就它了。

将链接文件下载后得到 `adksetup.exe` 文件，执行它开始下载安装评估和部署工具包。

摆在我们面前的只有两条路，一条是边安装边下载，另一条是一口气全部下载下来以后安装。

为了方便分享给小伙伴们使用，我毫不犹豫地选择了第三条路--完整下载后将它分享出来。

图22



此处作为测试，我选择了不发送数据。

图23



我是从官网直接下载的，完整文件大小 3.6 G 左右，如果你连不上微软的官网或赚速度慢，可以用这儿的国内备用下载链接。

ADK（Win10/Win2016 1607 版本）备用下载

下载链接：https://

提取码：



将完整安装包复制到备份服务器上，解压缩后执行 `adksetup.exe` 。

图24



选择默认的路径，功能只要选择 `部署工具` 和 `Windows 预安装环境（Windows PE）` 两项安装即可。

图25

图26



由于我们使用的是完整安装包，安装速度那叫一个快，一会儿就搞定了。

图27

图28



ADK 的安装我们已经完成，在此过程中我们可以看到其功能选项中包含了创建PE启动环境的功能，没错，这正是接下来创建恢复磁盘所必须的。

在这里建议你最好重启一下服务器哦，然后让我们再进入下一步吧。





### 创建 Simplified Disaster Recovery 磁盘

左上角 `Backup Exec` 按钮 > `配置和设置` > `创建灾难恢复磁盘`

也可以找到以下执行文件，然后直接运行它。

````
C:\Program Files\Veritas\Backup Exec\sdr\DRPrepWizard.exe
````

图29



出现创建磁盘向导界面，我们是在本机备份服务器上操作，所以不用勾选其他服务器，直接下一步。

图30



对于如何创建恢复磁盘 `SBE` 比较智能，在最初一无所有的情况下，我们只有选择第一项来创建一个新的映像。

而其他两项则是用来参考、修改和更新以前已创建过的映像。

图31



到这一步，`SBE` 会问你要 `ADK` 部署工具包，我们前一小节已经安装好了，勾选一下就可以直接进入下一步了。

图32



如果你还没有安装好 `ADK` 或安装得不正确（比如版本不对），那么它会主动请缨、毛遂自荐地告诉你它可以自动帮你下载安装。

如果真是这样，那么这一步的界面也是不同的，像下面这个样子。

图33



这个时候如果你选择相信它，那么等待你的可能真的只有无尽的等待了！

所以听我一句劝，宝贝，听话，用完整下载版吧~



手有完整安装包，安装部署心不慌。

接着进入下一步后，它让你选择 32 位还是 64 位，以及所需语言，默认直接下一步的干活。

图34



你要给哪台服务器创建恢复磁盘，把它勾上吧。

图35



恢复磁盘在启动时是需要一些驱动程序的，不过在以前安装备份代理程序的时候 `SBE` 已经收集好了，所以这里不用担心，它已经帮你搞定了。

图36



差不多快好了，现在只要给你的恢复磁盘起个响亮的名字，再给它指定路径它就可以顺利出世了。

图37



点击 `创建映像` ，坐等恢复磁盘创建完成。

图38

图39

图40













### 





