如何使用 Symantec Backup Exec 将数据备份到磁带库中（二）

副标题：做个备份演示，看看有没有坑~



前一篇我们已经初步把 `SBE` 备份服务的环境都搭建好了。

接下来我们是不是应该看看如何做一个备份了？

万事俱备，只欠东风，这个东风要怎么借，easy 吗？

不试试怎么会知道呢，让我们赶快行动起来吧！



`SBE` 备份服务环境搭建，前篇回顾：

> 《如何使用 Symantec Backup Exec 将数据备份到磁带库中（一）》
>
> 链接：https://www.sysadm.cc/index.php/xitongyunwei/807-how-to-use-symantec-backup-exec-with-tape-library-1





### 添加备份对象

我们想要备份某个 Windows 系统的服务器，那么在这儿我们姑且假定它的名字叫 `S01` 。

作为备份对象，我们首先要把它添加到 `SBE` 的备份服务器列表中。

最初刚安装完 `SBE` 后，这个列表中默认只有备份服务器自己。

图1



要实现添加 `S01` 服务器，很简单，只要在 `S01` 上安装 `SBE` 提供的 `Agent for Windows` 代理程序。

这个代理程序实质上就是一个客户端程序，是用来和备份服务器通讯的。

那如何安装它呢？



有两个方法，一个是拿着 `SBE` 安装镜像到 `S01` 上本地安装 `Agent for Windows` ，另一个就比较高级了，就是直接在备份服务器这边通过网络远程安装。

直接本地安装没啥花样，我们还是来看看如何远程安装，毕竟有时是不方便本地安装的。



在服务器列表界面中，点击 `添加` 按钮（或列表空白处右键后选择添加），然后选择 `Microsoft Windows 计算机和服务器` 一项。

图2



勾选 `允许 Backup Exec 与服务器建立信任(A)` ，如果不建立信任关系，可能每次备份时通讯连接需要单独验证从而增加时间开销。

建立信任关系需要合理的登录帐号和密码，建议单独创建统一专用的备份用帐号。

图3



按照名称或IP地址添加服务器，你喜欢哪个就用哪个。

IP地址连接更快，但如果服务器有可能会变动IP地址，那么最好还是用名称来连接吧。

图4



是否升级 `Agent for Windows` 版本或是自动重启远程服务器，自行判断选择吧。

图5



接下来就可以开始安装了。

图6

图7

图8



很简单吧，真的安装好了吗？

不敢确信的话可以到那台 `S01` 服务器上看看，嘿，果然代理程序安装OK！

图9



再回来看一下服务器列表，也已经有了 `S01` 服务器的信息，至此备份对象服务器添加完成。

图10



添加代理程序的过程非常简单，不过这里还是要说一句，`SBE` 也支持 Linux 系统的备份，但 `Agent for Linux` 则需要单独本地安装，其他的步骤都大同小异，这里就不再赘述了。





### 设定一个备份

备份介质有了，目标对象也有了，那么我们就可以来试试看怎么备份了。



##### 首先，在服务器列表界面中，点击 `备份` 下拉菜单，选择 `备份至磁带` 。

图11



##### 其次，选择 `基于代理的备份` 。

图12



##### 再次，有两项需要设定，一个是选择想要备份的数据（比如C盘），还有一个是备份方式（完全、增量还是差异）。

图13



选择备份的数据很简单，只要勾勾选选即可。

这里作为测试，`S01` 服务器只有 C 盘，其实 D 盘、E 盘都可以备份。

图14



根据实际情况调整备份方式和周期。

图15

图16



这时有的小伙伴可能会说，我只想将数据保留1周，这里面怎么没得选啊？

其实这个叫作介质集，就是你的备份怎么放怎么保留的意思，是可以自己定义的。

如上图中，点击右边那个按钮来添加新的介质集。



比如可以设定将数据保留1周，附加时间为6天。

图17

图18

图19



这里需要简单地解释一下什么是覆盖周期和附加周期。

覆盖周期就是磁带上的备份，当它写入数据后多久之内是不能被覆盖擦掉的。

如果覆盖周期是一周，那么这个数据在一周内是不会被擦掉的，你在一周内还能把它找回来，一周后就不敢保证它还在不在了。



附加周期这个概念挺容易与上面的覆盖周期混淆的，其实它的意思就是在指定时间内可以接着往后面写备份数据。

注意，它并不是覆盖，而是接在前面的数据之后接着写（附加）。

因为通常备份介质集是一个池，它并不是指单独的某一盘磁带，备份数据的写入往往是今天写 A 磁带，明天写 B 磁带，像这样分散开来的。

所以可以允许同一盘磁带多次写入（附加）数据。

拿前面的例子说，比如如果每天备份一次，那么A磁带每天写一次，在一周的备份周期内一共最多可以写（附加）6次，而一周之内每次写都不会覆盖之前的数据。



在这儿想简单解释一下，结果还是啰嗦了这么多，希望小伙伴们能搞明白。

当然以上也只是我个人的粗浅理解，也可能有偏差之处，以实践为准吧。



##### 最后，设定完毕后就可以实施备份了。

备份设定好后，在作业列表中就有体现了。

可以选择立即运行备份，当然也可以等待计划自动执行。

图20



当首次完成完整备份后，系统突然提示说未创建 `Simplified Disaster Recovery 磁盘` 。

是我做的不够好吗？

这个什么磁盘又是什么鬼呢？





### 安装评估和部署工具包

要想弄清楚那个什么 `Simplified Disaster Recovery 磁盘` ，我们必须先搞定一个叫作 `ADK` 的工具包。

喂喂~又冒出来一个什么包，你在搞什么啊？

别着急，耐心看下去就知道了哈。



`ADK` 正是传说中的 Windows 评估和部署工具包的缩写，它对普通用户来说意义不大，但在系统维护方面却很重要，主要是用作自定义大规模部署映像或测试系统等等场景之用。

为什么现在要提及这个东东呢，因为在下一节关于恢复备份而需要创建恢复磁盘时非常有用。

是的，没错，那个什么鬼磁盘就是所谓的恢复磁盘，当然系统挂了之后就得用上恢复磁盘了。

关于恢复磁盘，我们一会儿再说，先把 `ADK` 唠清楚。



> ADK 官方文档链接：https://docs.microsoft.com/zh-cn/windows-hardware/get-started/adk-install
>
> ADK 安装包下载链接：https://go.microsoft.com/fwlink/?linkid=2120254



在 `ADK` 官方文档链接中可以下载到你想要的版本的 `Windows ADK` 。

我用的是 Windows 2016 ，可是打开链接页面，其中只有 Windows 10、8、7 之类的版本，并没有 2016 啊？

其实直接套用 Windows 10 的就行了，不过 Windows 10 好像也有很多不同的版本啊，怎么选呢？

好办，先看看自己的 2016 具体是啥版本。

我在 `itellyou` 上下载的 `VL` 版本的 2016，通过查看版本命令 `winver` ，哦，原来是 `1607` 啊！

图21



找找文档中，还真有 `1607` 的 Windows 10 版本，就它了。

将链接文件下载后得到 `adksetup.exe` 文件，执行它开始下载安装评估和部署工具包。

这时摆在我们面前的只有两条路，一条是边安装边下载，另一条是一口气全部下载下来以后再安装。

为了方便分享给小伙伴们使用，我毫不犹豫地选择了第三条路--完整下载后将它分享出来。

图22



此处作为测试，我选择了不发送数据。

图23



以上 `adksetup.exe` 中是个安装引导文件，我花了个把小时间把完整文件下载了下来，大小 3.6GB 左右，如果你连不上微软的官网或赚速度慢，可以用这儿的国内备用下载链接。



**ADK（Win10/Win2016 1607 版本）完整安装包**

下载链接：https://pan.baidu.com/s/16G1YUyl63vctOPNaOHmaUg

提取码：d740



**ADK（Win10/Win2016 2004 版本）完整安装包**

下载链接：https://pan.baidu.com/s/17VoSCE5xwSPzB2BI6_X1pA

提取码：gham



将完整安装包整个复制到备份服务器上，解压缩后执行 `adksetup.exe` 。

图24



选择默认的路径，功能只要选择 `部署工具` 和 `Windows 预安装环境（Windows PE）` 两项安装即可。

图25

图26



由于我们使用的是完整安装包，安装速度那叫一个快，一会儿就搞定了。

图27

图28



`ADK` 的安装我们已经完成，在此过程中我们可以看到其功能选项中包含了创建PE启动环境的功能，没错，这正是接下来创建恢复磁盘所必须的。

在这里建议你最好重启一下服务器哦，然后让我们再进入下一步吧。





### 创建 Simplified Disaster Recovery 磁盘

光做好了备份还远远不够，这借东风看来是不简单，小伙伴们再坚持一下，我们这就开启创建恢复盘之旅。



`SBE` 界面中，点击左上角 `Backup Exec` 按钮 > `配置和设置` > `创建灾难恢复磁盘` 。

也可以找到以下执行文件，然后直接运行它。

````
C:\Program Files\Veritas\Backup Exec\sdr\DRPrepWizard.exe
````

图29



出现创建磁盘向导界面，我们操作的就是本机备份服务器，所以不用勾选其他服务器，直接下一步。

图30



对于如何创建恢复磁盘 `SBE` 比较智能，在最初一无所有的情况下，我们只有选择第一项来创建一个新的映像。

而其他两项则是用来参考、修改和更新以前已创建过的映像。

图31



到这一步，`SBE` 会问你要 `ADK` 部署工具包，我们早已有所准备，前一小节已经安装好了，勾选一下就可以直接进入下一步了。

图32



这里我想插句嘴，如果你还没有安装好 `ADK` 或安装得不正确（比如版本不对），那么它会主动请缨、毛遂自荐地告诉你它可以自动帮你下载安装。

如果真是这样，那么这一步的界面也是不同的，像下面这个样子。

图33



这个时候如果你选择相信它，那么等待你的可能真的只有无尽的等待了！

所以听我一句劝，宝贝听话，用完整下载版吧~



手握完整安装包，部署程序心不慌。

接着进入下一步后，它让你选择 32 位还是 64 位，以及所需语言，默认直接下一步的干活。

图34



你要给哪台服务器创建恢复磁盘，把它勾上吧。

图35



恢复磁盘在启动时是需要一些驱动程序支持的，不过在以前安装备份代理程序的时候 `SBE` 已经收集好了，所以这里不用担心，它已经帮你搞定了。

图36



差不多快好了，现在只要给你的恢复磁盘起个响亮的名字，再给它指定路径它就可以顺利出世了。

图37



点击 `创建映像` ，坐等恢复磁盘创建完成。

图38

图39

图40



### 写在最后

数据备份是系统维护每天都需要认真对待完成的重要工作。

除了万事俱备的软硬件基础设定外，往往还需要借助一些其它方面的东风，比如某些组件或工具包等。

为保证备份安全有效可靠，借东风的工作还是要花时间去做好。



前面说到的 `SDR 恢复磁盘` 在创建完成后，当你所备份过的服务器出现无法启动的情况时，就可以请它出山，让它来启动引导并完成恢复备份的工作。

这个恢复磁盘很重要吧，切记将它放在一个安全的地方哦。

至于如何使用恢复磁盘来实现备份的恢复，限于篇幅以后有机会我们再来讨论吧。



**ADK（Win10/Win2016 1607 版本）完整安装包**

下载链接：https://pan.baidu.com/s/16G1YUyl63vctOPNaOHmaUg

提取码：d740


**ADK（Win10/Win2016 2004 版本）完整安装包**

下载链接：https://pan.baidu.com/s/17VoSCE5xwSPzB2BI6_X1pA

提取码：gham



WeChat@网管小贾 | www.sysadm.cc