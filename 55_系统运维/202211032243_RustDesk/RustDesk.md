RustDesk

副标题：

英文：

关键字：





- `hbbs` - `RustDesk` `ID` 注册服务器
- `hbbr` - `RustDesk` 中继服务器



开放端口：

默认情况下，`hbbs` 监听 `21115(tcp)` , `21116(tcp/udp)` ,  `21118(tcp)` ，`hbbr` 监听 `21117(tcp)` ，  `21119(tcp)` 。

务必在防火墙开启这几个端口， **注意 `21116` 同时要开启 `TCP` 和 `UDP` **。 



* `TCP/21115` - `hbbs` 用作 `NAT` 类型测试
* `UDP/21116` - `hbbs` 用作 `ID` 注册与心跳服务
* `TCP/21116` - `hbbs` 用作 `TCP` 打洞与连接服务
* `TCP/21117` - `hbbr` 用作中继服务
* ` TCP/21118/21119` - 网页客户端





> https://rustdesk.com/docs/en/self-host/install/



### Windows

不要只看官网，否则会有无数个坑等着你，比如直接运行它会报错。

虽然原因无非就是缺东西，和人一样，给到位了就好了。

问题是缺少的东西不是太好找，不过我费了点劲儿还是给找到了，老规矩文末下载。

图a10



如果你不信，那么接下来就会遭遇N多问题。

给你看张图，不管如何运行都会出错和失败，服务始终无法正常工作。

图c10



一旦搞定缺失的组件后，整个状态就会变得完全不一样了，毕竟官方为我们编译好的程序我们只要拿来用就行了，非常之爽啊！

而 `PM2` 或是 `NSSM` 也只不过是用于辅助启动的工具罢了。

当然我先声明，我对 `NodeJS` 的了解基本属于小白，只不过我有照猫画虎的小聪明罢了。

接下来我们就先给小伙伴们展示一下直接跑 `hbbs/hbbr` 的样子，之后再拿 `PM2` 来简述一下，毕竟后者是官方推荐的方法，可以很方便地管理 `hbbs/hbbr` 服务的启动。



跑 `hbbs/hbbr` 的方法简单得不能太简单了，直接一个命令不带任何参数。

```
C:\rustdesk-server-windows-x64>hbbs
```

图c01



你看，它不报错了吧，与此同时也打开了几个端口。

图c02



再来看看进程列表，稳稳地跑着呢。

图c05



在实际连接使用过程中，服务会很敬业地分析接收我们传递的连接信息，小筒子一看就很认真嘛！

图c03



OK，`hbbr` 也是同理，不过我好像只开了一个 `hbbs` 就可以用了。

那么接下来我们再试试官网推荐的 `PM2` 方法。

我的理解是，这玩意应该是 `NodeJS` 程序的软件包管理器，不管怎样照着官网走就是了。



首先，安装 `NodeJS` ，下载包在后面也给备好了，亦或者各位可以到其官网上下载 `LTS` 版本。

图a11



一路耐可斯特后安装完毕，接下来在命令提示窗口中依次输入三条命令。

```
npm install -g pm2
```

图a12



```
npm install pm2-windows-startup -g
```

图a13



```
pm2-startup install
```

图a14



一切准备就绪了，我们可以运行 `ID` 注册服务器 `hbbs` 和中继服务器 `hbbr` 了。

```
cd c:\rustdesk-server-windows-x64
pm2 start hbbs.exe -- -r hbbr运行所在主机的地址
pm2 start hbbr.exe 
pm2 save
```



看看我运行的效果，先来一张跑 `hbbs` 的截图。

图c06



很好，`online` 状态，再瞅瞅进程信息，用的是 `node.exe` 。

图c07



紧接着跑 `hbbr` 吧，兄弟俩齐上阵，效果刚刚滴。

图c08



前面跑单独命令的时候我没跑 `hbbr` ，现在顺便也看一下端口状态吧。

嗯，`21117` 和 `21119` 也都开放了。

图c09



非常完美，我们把它保存起来，下次重启后还能跟着系统自动启动多好。

```
pm2 save
```

图c11



假如你不放心，还想看看它工作的样子，可以随时将它再打印出来查看。

```
pm2 list
```







### Docker



```
sudo docker image pull rustdesk/rustdesk-server
sudo docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbs -r <relay-server-ip[:port]>
```



```
sudo docker image pull rustdesk/rustdesk-server
sudo docker run --name hbbs -p 21115:21115 -p 21116:21116 -p 21116:21116/udp -p 21118:21118 -v `pwd`:/root -td --net=host rustdesk/rustdesk-server hbbs -r 192.168.1.1
```





### 连连看

服务都跑起来了，差不多也该到连连看环节了，要不光一个服务有啥好看的呢！

来吧，打开客户端程序，我用的是 `Windows` 上的客户端，它长这样。

图d01



界面很简洁，左侧是系统自动计算给出的 `ID` 和密码，右侧则是我们需要连接到目标的操作区域。

通常，我们只要在文本框中输入目标对象的 `ID` 再点击 `连接` 就可以了。

一旦连接有了反馈，`RustDesk` 就会问我们要对方的密码。

图a03



这个密码是啥，在哪儿找？

呐，就在这儿，你把鼠标放上去就看显示明文。

不过这个密码是对方的，可以通过询问了解到。

图a04



很快连接就建立好了，速度飞快，你可以开始远程操作了。

图a01



连接完成后，控制台上也会留有连接记录，方便下次快捷操作。

图a02



好了，到这里我就问你，完美不完美？

说实话，很完美，不过这种情况下，`RustDesk` 建立连接时会去找公网上的服务器，然后会自动帮你连接你想要的目标对象。

然而你别忘了，我们前面都自建好了服务器，放着不用浪费感情你不会心痛？

行，那我们赶快连接我们自己的服务器吧！



告诉你，用自己的服务器也灰常简单，简单得不要不要的！

第一步，点开三个点菜单，选择 `ID/中继服务器` 。

图a07



第二步，将服务器的主机名或IP地址输入到窗口文本框中，其他的不理它就是了。

图a08



好了，就两步，有没有病都是走这两步。

你要是还不太自信，可以将服务器和客户端的网关去掉，确保它们上不了公网。

这样做的目的是为了让连接与被连接方都明确无误地连接我们指定的自建的服务器上。

最后，你可以像之前远程连接一样来连接目标对象了。



需要多说一嘴，使用自建服务器来建立远程连接的方式，非常适合局域网或其他有一定网段范围的私有网络，安全可靠、便捷高效。







### 其实还能玩直连

`RustDesk` 的原理，服务器只是充当了中介的身份，只要连接双方是在直接能访问到的网络中（比如局域网），它就会给安排成直连。

除非无法直连或速度不理想，否则最后连接双方其实还是直连状态，也就是说 `RustDesk` 完全可以直接玩直连。



如下图，在菜单中勾选 `允许IP直接访问` ，然后输入目标主机名或IP地址即可畅快连接。

图a09



这种情况下，中继服务器也就可以退休了，说白了，比如在局域网中，我们就可以像用其他远程连接软件一样，直接连接远程操作了。





### 写在最后







**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc

