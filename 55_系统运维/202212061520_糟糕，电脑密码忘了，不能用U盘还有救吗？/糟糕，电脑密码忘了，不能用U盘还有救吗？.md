糟糕，电脑密码忘了，不能用U盘还有救吗？

副标题：糟糕，电脑密码忘了，不能用U盘还有救吗？

英文：oh-no-i-forgot-password-is-it-possible-to-find-out-password-without-using-usb-stick

关键字：ntpwedit,ntpw,sam,windows,密码



年迈的老山姆突然晕倒不省人事，被送医院至今仍在昏迷。

他的一个儿子、一个女儿、一个侄子外加两个外甥为了老山姆可能留下的遗产发生了争执。

所有人都围着一台外观破旧而奇特的古董电脑......



此时年轻的简睿恰巧路过小镇，好奇心驱使他向聚集的人群靠拢，毕竟这个小小的镇甸平常人就不多。

人群中的杰克一眼就认出了简睿，他是这个小镇署衙的班头。

“尊敬的先生，您怎么在这儿？”

“一定是上帝的旨意让您出现在这里，您赶快帮个忙吧！”

简睿往上拉了拉厚重的口罩，心说这你也能认出来，得，看热闹不闲事多，说来就来哈！

“说说吧，怎么一回事？”



原来，这台电脑乃是老山姆心爱之物，外面包着严实的铁皮，里面藏着深深的秘密。

什么秘密？

似乎他的所有身家都在这台电脑里面了，什么股票基金、房产汽车、现金支票，说不定还有大把的国外银行存款和无数小姐姐的日常写真。



老山姆的儿子一边抹着口水，一边给电脑通上电，`Windows` 系统正常启动，可是却卡在了登录界面。

谁也不知道密码是什么，进不去系统什么都白搭！

这可怎么办？

只有登录进电脑才能决定如何处理这笔遗产，人们议论纷纷，谁也拿不出个主意。



简睿示意班头杰克，只能试试，不敢保证一定能解决。

只见屏幕上代码滚动闪烁，键盘间十指上下翻飞，一顿噼里啪啦骚操作唬得众人私下里交头接耳。

嘿，瞧见没，这人定是得了真人的传授名人的指点，妥妥是位高人啊！

约莫一盏茶的功夫，简睿嘴角微微扬起笑容：原来如此......



### 道出真相

“诸位，诸位，请听我说两句......”

“原来啊电脑的主人为了确保绝对的安全，使用特殊的铁皮将电脑封装了起来。”

“这么一来就导致了我们无法使用 `USB` 接口等外部设备，当然也无法将硬盘取出。”

“这种情况下想要解开密码似比登天，不过刚才我有个小小的发现，电脑中居然还有一个小小的备用分区。”

“我猜测这个小分区可能是原主人有意为之，万中有一还可以做为后手。”

“利用这个分区我们就可以重置或修改 `SAM` 文件中的用户密码了。”



简睿提到了两样东西：一个是 `SAM` 文件，还一个是神秘分区。

它们究竟是什么呢？



### `SAM` 文件是个啥

`SAM` 是英文 `Security Account Manager` 的缩写，翻译过来就是 `安全账号管理器` 的意思。

简单地说就是这个 `SAM` 文件专门保存了 `Windows` 系统的账号及密码信息。

它里面有用户安全标识，相当于我们的身份证号码，是唯一的，即使同名同姓的两个人也是拥有不同的安全标识。

这 `SAM` 里边还存着密码，不过肯定不是明文了，都是些哈希值，就是加密的，给你看你也只会眼晕，没法直接用。



通常情况下 `SAM` 文件会被系统锁定无法访问。

不过这么一个玩意也并非铁板一块，还是有一点点突破口的。

那怎么突然这玩意呢？

常规做法是，将当前系统挂载到其他系统中后，通过工具软件重置或修改密码。

为啥非要挂在其他系统上？

刚才说了，当前系统会锁定 `SAM` 而无法动它，你可以试一下子，反正我试过了，结果就像这样。

图01



此外我们无法得知原来的密码，因为 `SAM` 里放的是一串串加密的哈希值，这玩意算法不可逆，猜不出来明文密码是啥。

因此清除密码就成了无奈之举，但至少无伤大雅，对系统没有任何影响，完事后可以接着奏乐接着舞！



### 神秘的分区

我们了解了 `SAM` 文件，但是老山姆的铁皮电脑没法用外部设备挂载硬盘，机箱里的硬盘也拿不出来，这可怎么办呢？

这就要说到那个神秘的分区了。

我们举个例子，让大伙儿看看这个分区是怎么来的。



打开 `计算机管理` ，找到 `磁盘管理` 。

右键点击最后一个分区（比如本例只有一个 `C` 盘），在弹出的菜单中选择 `压缩卷(H)...` 。

图02



输入压缩空间量，比如 `8192` ，表示大约 `8G` 的容量。

这个分区不需要太大，数字随意但至少保持在 `4G` 以上比较合适。

图03



点击 `压缩(S)` 后，我们就获得了一个 `8G` 大小的新分区。

图04



接着，右击这个新分区，选择 `新建简单卷(I)...` 。

图05



保持默认的卷大小，以及驱动器号等参数不变。

图06

图07



不过需要注意的是，文件系统必须选择 `FAT32` 格式。

图08



OK，点击完成开始格式化，新分区就准备就绪了。

图09

图10



### 拷贝文件到新分区

很显然，老山姆电脑里的这个分区是有一些文件的，那么这些文件是从哪来的呢？

其实这些文件并没有什么特别，它们是一些启动程序或 `PE` 系统。

所谓 `PE` 系统就是为了方便测试系统而制作的最小 `Windows` 系统环境。

说到这儿，有的小伙伴肯定猜到了，没错，就是要利用这个 `PE` 系统来挂载原来的 `Windows` 系统，从而达到重置或修改密码的目的。



于是我们可以利用 `PE` 系统盘生成启动及程序文件，然后将它们直接拷贝到刚刚建立好的新分区中。

图11



具体这些文件是如何制作的，限于篇幅我就不啰嗦了。

我把文件放在这儿，小伙伴们有需要拿去用就行了，只要直接复制就能用。



**`PE` 工具及 `NTPWEdit` **

下载链接：https://pan.baidu.com/s/10CIbqlHG0CY5x7qeC5euiQ

提取码：22fn





注意，如果你拷贝的文件有隐藏属性，可以用以下命令将它们的隐藏属性去除。

```
cd E:
attrib -r -s -h ./* /s /d
```

命令的意思是，先进入新分区（比如 `E` 盘），然后用 `ATTRIB` 命令把所有文件和文件夹的只读隐藏属性清除。

**不过请放心，我提供的文件没有隐藏属性，一般来说这一步可以跳过。**





### 从新分区启动

这里需要说明一下，前面拷贝的文件仅支持 `UEFI` 启动方式（现在较新的电脑都支持）。

想要从新分区启动，需要我们眼疾手快具有一定的武功段位。

OK，注意看，是这么个操作法！



当系统正常启动时，我们看到启动画面 `LOGO` ，并且气泡正在旋转，这时我们直接按住电源按钮不放，直到关机。

过几秒我们开机，然后等到 `LOGO` 画面加气泡旋转时再次按住电源按钮不放直到关机。

好，如此这般，通常这么干两次以上，系统开机就会进入自动修复程序。

图12



别怀疑会伤电脑，这是官方操作方法。

稍等一会儿，我们就可以看到这样的画面，然后选择 `高级选项` 。

图13



接下来再选择 `使用设备` 。

图14



好，我们可以看到有好几项，我们选择 `EFI Internal Shell` 。

图15



这是加载 `EFI`  `Shell` 程序的入口。

等到 `Shell>` 提示符出现后，依次输入以下命令并回车。

```
fs1:
efi\boot\bootx64.efi
```

图16



在这儿我们需要注意两点。

一，`fs1:` 最后面有个英文冒号，别忘记。

二，`fsX:` 中的 `X` 数字通常表示第几个分区。

如果前面我们建立的 `FAT32` 分区是第二个（比如 `D` 盘），那么它就应该是 `fs1:` （第一个是 `fs0:` ，即 `C` 盘）。

如果 `FAT32` 分区是第五个（比如 `G` 盘），那么它就应该是 `fs4:` ，以此类推。



命令无误不出意外的话，它就会启动 `PE` 盘了。

图17



接下来就简单了，进入 `PE` 环境后，我们就可以利用 `NTPWEdit` 来修改或重置用户密码了。

图18



### 重置用户密码

在这儿简单说下如何重置用户密码吧。

打开 `NTPWEdit` ，然后点击 `打开` 按钮。

通常 `SAM` 文件都在系统默认 `C` 盘，因此直接打开即可。

```
C:\Windows\System32\Config\SAM
```

图19



打开后即可看到系统中的账号，找到我们平时经常用的用户账号（通常 `ID` 从 `1001` 开始），点击 `修改密码` 。

图20



如果要重置（清空）密码，那么直接点击确认就行了。

如果要设置新密码，那么就输入密码后再点击确认，灰常简单。

图21



密码重置了，心情很愉快是不是？

可别高兴得太早了，如果你不保存修改的话，那么等于什么都没做哦！

图22



顺便说一下，如果所选用户是被禁用的，那么 `解锁` 按钮会自动生效。

点击 `解锁` ，用户就被激活了，很容易理解吧？

图23



### 写在最后

破解或绕过 `Windows` 登录密码的方法有很多种，而故事中所述的方法是其中一种。

启动当前 `Windows` 系统以外的系统，然后再利用 `NTPWEdit` 之类工具重置或修改密码。

不过利用这类工具软件的前提是必须要创建一个额外的系统环境，因为 `SAM` 文件在当前系统会被锁定而无法修改。

所以说，如果像故事中那样你的电脑无法使用 `U` 盘之类的外部设备，那么要么别忘记密码，要么忘记密码前可以考虑保留一个小分区，放上工具以备不时之需。

需要强调的是，小伙伴们可以直接安装 `PE` 启动系统到当前系统中（开机时可以选择从 `PE` 启动），但本文所述示例相对来说更安全保险一些。

因为只是在最后建一个小分区，不会修改影响当然系统启动项，也不会占用硬盘太多的空间容量，并且你不想用直接将分区删除就是了，清清楚楚、干净利落。

如果你有保存着比较重要资料的电脑而又不希望忘记密码，并且也不希望有外部设备接入，这时就可以参考这种方法。

宜未雨而绸缪，毋临渴而掘井，有备无患，遇事不慌！

方法有风险，操作须谨慎，祝你好运！



**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc
