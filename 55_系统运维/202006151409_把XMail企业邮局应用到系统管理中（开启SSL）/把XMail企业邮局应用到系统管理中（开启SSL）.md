把XMail企业邮局应用到系统管理中（开启SSL）

副标题：信息安全无小事~



前面我们经过 `XMail` 的安装、配置和管理，已经能很好地使用它了。

不过呢，目前为止我们的用户和密码在传输过程中还是处于裸奔状态。

也就是说，按照基本初步地安装 `XMail` ，默认是没有开启 `SSL` 的。

嘿嘿，是不是额头冒汗，开始有点方了呢？



其实 `XMail` 骨子里是支持 `SSL` 的，而且按照我们之前的教程安装好后就已经有了使用 `SSL` 的能力。

那为什么还是裸奔状态，我读书少，你别骗我哦？

原因说出来有点扎心，你需要自己手动生成私钥和证书。

好吧，这个也不能怪它，那我们就来看看怎么生成私钥和证书。

说来也不是太难，省得你去啃官网文档，我已经总结好了，其实只要两步。

1. 先用 `OpenSSL` 生成私钥和证书。
2. 然后把私钥和证书放到 `MAIL_ROOT` 根目录下就欧了！



这个......简单得令人发指好吗？！

嗯哼，那么没病咱们来走两步！



#### 一、生成私钥和证书

正如前面所说，`XMail` 实际上是自带 `SSL` 装备的，在 `C:\MailRoot\bin` 目录下就能找到 `openssl.exe` 文件，我们直接拿来用就行了。



首先，有两点注意事项：

* 需要使用 `XMail` 提供的 `C:\MailRoot\bin\openssl.cnf` 配置文件
* `COMMON NAME` 信息必须填写服务器**主机名称**或是**IP地址**



其次，有三条命令：

```shell
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr -config openssl.cnf
openssl x509 -req -days 3650 -in server.csr -signkey server.key -out server.cert
```



实际执行命令参考图：

图1

图2

图3

图4



#### 二、移动私钥和证书到 `MAIL_ROOT` 根目录下

最后，把生成的这几个文件（`server.key` 和 `server.cert`）都移动到 `MAIL_ROOT` 根目录下，比如 `C:\MailRoot` 。

图5



好了，祝贺你，完成了！

纳尼？服务器配置文件 `server.tab` 什么的都不需要修改吗？

没错！就这些，已经全都搞定了少年！



#### 三、测试一下

可以参考之前的文章 [《把XMail企业邮局应用到系统管理中二（配置篇）》](https://www.sysadm.cc/index.php/xitongyunwei/745-xmail-config) 中的测试部分内容。

其中有些地方不同，需要注意的是启用 `SSL` 后访问的端口不同。

如图，`SMTP` 和 `POP3` 的端口分别为 `465` 和 `995` 。

图6



所以在设定邮箱时，相应的也要修改参数，如下是开启 `SSL` 后的参考设定。

图7



前面提到了，`COMMON NAME` 信息必须填写服务器**主机名称**或是**IP地址**。

如果你在设定服务器一栏中填写错误，可能会有如下提示，务必要做到与证书 `COMMON NAME` 的名称一致。

图8



邮箱设定好后就可以测试发送接收了，邮件的收发全程会被加密保护！

好吧，你别激动啊！

哦，是被感动到了啊，此时你老泪纵横，视线渐渐模糊，我也知道我想说的都说完了，我该走了！

希望你能帮忙转发分享，让更多的小伙伴受益！



> WeChat @网管小贾
>
> Blog @www.sysadm.cc

