如何安全而又不失优雅地与多人共享大文件（二）

副标题：



话说孔大力外出吃饭，约莫6点钟的样子回到了办公室。

一脸未吃尽兴的样子，边走还边抹着嘴角的油花。

回到座位上，他看了一眼桌上的草稿，心里极不情愿地詈骂道：“老板不讲武德！”

骂归骂，活儿还是得接着干啊，谁叫咱是打工人呢，时间紧迫，还得抓点紧不是。



孔大力操作着电脑，很快搭建出了一个简单的域环境。

* AD域服务：Windows2016
* 共享服务：Windows2016
* 客户端：Windows10



接下来尝试使用 `VBS` 写一些代码。

#### 首先，先来定义一些可能用到的变量。

```vbscript
strShareFolder = "\\Server\TempShare$"         ' 指定共享路径
strUserName = objNetwork.UserName              ' 获取用户名
intCharNo = 8                                  ' 指定随机8个字符
strRandomChar = RandomChar(intCharNo)          ' 获取随机字符串
intAddDate = 3                                 ' 指定3天后的日期
strDate = CalculateDate(intAddDate)            ' 指定日期以YYYYMMDD的形式
strFolderName = strUserName & "-" & strRandomChar & "-" & strDate ' 指定生成的文件夹名称
intArgNum = WScript.Arguments.Count            ' 获取命令参数数量
intMailFlag = 0                                ' 0 - 以OUTLOOK方式打开, 1 - 以IE方式打开
```



#### 其次，创建临时共享文件夹。

```vbscript
objFSO.CreateFolder(strShareFolder & "\" & strFolderName)
If Err.Number <> 0 Then
   Msgbox "An error occurred during folder creating." & vbCrLf & "ErrNo: " & Err.Number
End If
```



#### 再次，在当前用户桌面上创建可访问共享文件夹的快捷方式。

```
strShortcutPath = objWSH.SpecialFolders("Desktop")
Set objSC = objWSH.CreateShortcut(strShortcutPath & "\" & strFolderName & ".lnk")
objSC.TargetPath = strShareFolder & "\" & strFolderName
objSC.IconLocation = "\\Server\TempShareOpenIcon.ico, 0"
objSC.Save
If Err.Number <> 0 Then
   Msgbox "An error occurred during shortcut creating ." & vbCrLf & "ErrNo: " & Err.Number
End If
```



#### 再而三，复制 `TempShare` 路径到剪贴板。

```vbscript
PutInClipboardText "file:///" & strShareFolder & "\" & strFolderName & "\"
If Err.Number <> 0 Then
   Msgbox "Could not copy TempShare path to clibpoard." & vbCrLf & "ErrNo: " & Err.Number
End If
```



#### 最后，将剪贴板内容再粘贴到邮件正文。

```vbscript
' 启动OUTLOOK生成邮件，没有OUTLOOK时使用IE打开
' 注意，用IE打开会有许可确认提示窗口

Set objOL = CreateObject("Outlook.Application")
Set MailItem = objOL.CreateItem(0)
If Err.Number <> 0 Then
   intMailFlag = 1
End If

' 生成模板（OUTLOOK换行：vbCrLf，IE换行：%0D%0A）
If intMailFlag = 0 Then
   strNewLine=vbCrLf
Else
   strNewLine = "%0D%0A"
End If
strMail = " " & strNewLine & " " & strNewLine &_
          "<--------------------------------------------------------------------------------------------------------------->" & strNewLine &_
          "   AccessPATH:  file:///" & strShareFolder & "\" & strFolderName & "\" & strNewLine & " " &_
          strNewLine &_
          "  [Guidance]" & strNewLine &_
"     This is a temporary folder for transmitting files between company PCs." & strNewLine &_
"     Click the above AccessPATH, and you can download/upload files freely." & strNewLine &_
"     Attention, files will be deleted automatically after " & Mid(strDate, 5, 2) & "/" & Right(strDate, 2) & "/" &Left(strDate, 4) & "(MM/DD/YYYY)." & strNewLine &_
          "<--------------------------------------------------------------------------------------------------------------->" & strNewLine & strNewLine & strNewLine


If intMailFlag = 0 Then
  ' 通过 OUTLOOK 创建模板
   MailItem.Body = strMail
   MailItem.Display
Else
  ' 通过 IE 创建模板
   objIE.visible=false
   objIE.navigate("mailto:?body=" & strMail)
End If


If intArgNum = 0 Then
   objSH.Explore strShareFolder & "\" & strFolderName & "\"
   If Err.Number <> 0 Then
      Msgbox "Could not create template mail via Internet Explorer." & vbCrLf & "ErrNo: " & Err.Number
   End If
End If
```





以上代码另外还包括了几个调用函数，如：

```vbscript
PutInClipboardText(ByVal strString)    ' 复制文本到剪贴板
RandomChar(intCharNo)                  ' 产生指定字符和位数的随机字符串
CalculateDate(intAddDate)              ' 计算指定的天数并以 YYYYMMDD 形式返回
```



关注微信公众号，下载完整源码：





夜已深，窗外一片寂静，孔大力眯眼看了看时间，已是凌晨1点多了。

他眼中噙着泪，口中打着哈，站起身来伸了个懒腰。

“哈啊...看样子今天的班儿就加到这儿吧~”

“还有共享文件夹的权限问题和时间限定问题，明天再搞吧~”

一阵困意袭来，孔大力不禁自言自语起来。

这位苦逼的打工人强打精神，简单地收拾下自己的电脑和背包，很快就甩门离去......



> WeChat@网管小贾 | www.sysadm.cc





