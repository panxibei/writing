XigmaNAS 文件共享服务的设定方法

setting-method-of-xigmanas-file-sharing-service

副标题：XigmaNAS 简单快速设定文件共享~

关键字：cifs,smb,网上邻居



在众多开源免费的 `NAS` 解决方案中，`XigmaNAS` 应该算得上是优秀者之一。

它的前身正是大名鼎鼎的 `FreeNAS` ，当然还有其他诸如 `NAS4Free` 等分支。

为何只钟情于 `XigmaNAS` ，因为我个人感觉它比较好用一些，基于 `FreeBSD` 其稳定性比 `Linux` 平台系统也更胜一筹。

那么这次我们要聊点什么呢？

正如标题所写，我们聊一聊如何用 `XigmaNAS` 来实现文件共享服务的设定方法。



说到文件共享服务，我想大部分的小伙伴可能第一时间会想到 `Windows` 系统。

没错，通过 `Windows` 系统来实现文件共享服务，其优点往往体现在与AD域结合，从而使共享访问权限控制变得更加灵活多变。

那么 `Linux/UNIX` 系统呢，也可以实现文件共享服务吗？

要回答这个问题，首先我们应该了解文件共享服务并不是 `Windows` 系统独有的。

那么这里有几个概念需要我们先了解一下，了解过后你就能对文件共享有个大致概念了。



首先，在局域网中共享文件的一种通信协议叫作  `SMB`（Server Messages Block，信息服务块） 协议。

其次，`CIFS` （Common Internet File System）协议是基于 `SMB` 协议的新版本，并由微软使用。

最后，`SMB` 协议都可以在各大系统上跑。



怎么样，有点明白了吧？

说白了就是不管你是什么系统， `Windows/Linux/Unix` 这几大系统都可以跑 `SMB` 协议，也就是说，它们都可以实现文件共享服务。

由于 `XigmaNAS` 是一款已经集成了共享服务功能的系统，所以我们直接设定开启后就能拿来用了，感觉很方便吧！

好了，有了这些简单的概念后，我们就可以来具体聊一聊如何开启并使用 `XigmaNAS` 的文件共享服务功能。



**测试环境：**

* 服务端使用 `XigmaNAS` 最新镜像文件：

XigmaNAS-x64-LiveCD-12.2.0.4.8125.iso

* 客户端：

Windows 10



有需要 `XigmaNAS` 最新镜像文件的小伙伴可以下载我这儿的国内备用文件。

下载链接：



图1



作为测试，我安装了两块硬盘，一块是系统盘，一块是数据盘。

具体安装过程我们略过，我假定你已经成功安装了 `XigmaNAS` 。



**四个步骤的简单摘要：**

1. 设定共享所需挂载点。
2. 设定共享所需访问用户。
3. 设定并开启共享服务功能。
4. 测试文件共享服务。



OK，Let's start！



### 一、设定共享所需挂载点

要设定挂载点，我们需要将除系统盘外的某块硬盘初始化并格式化成相应的文件系统（通常为 `UFS` ）。



1、点击菜单 `硬盘` > `管理` 。

图2



2、点击右侧的 `+` 号，添加数据盘。

图3



3、按图示，选择除系统盘外的某块硬盘，并选定 `UFS` 文件格式。

图4



4、应用改动后生效，当然你也可以不选定文件格式，而是先初始化，后再格式化也是可以的。

图5



5、数据盘有了，我们点击菜单 `硬盘` > `挂载点` 来设定挂载点。

图6



6、点击右侧 `+` 号，添加挂载点。

图7



7、选择前面格式化好的数据盘，再指定挂载点名称 `sysadm.cc` （随便起个你喜欢的名字，注意这个不是共享名），最后群组选定为 `wheel` ，点击添加按钮。

图8



8、点击应用改动，使挂载点生效。

图9



这样名称为 `sysadm.cc` 的挂载点就建立好了。



### 二、设定共享所需访问用户

通常你可以将共享设定为来宾（GUEST）访问，这样任何人都可以访问你的共享，也没有什么权限限制。

不过也有需要指定某些用户才能访问共享的情况，所以我们需要先新建这些有访问权限的用户。



1、点击菜单 `访问` > `用户和群组` 。

图10



2、在用户列表最下方右侧点击 `+` 号添加新用户。

图11



3、按图示指定登录名（用户名）、全名、密码、以及主要群组为 `wheel` ，并点击添加按钮。

图12



到这里一个新用户就添加完成了！

想要多个用户访问，那么就如上操作多添加几次。



有一句话在这里不得不说上一嘴，可能有的小伙伴注意到了群组是 `wheel` 。

那么为什么不是 `guest` 或 `ftp` 或其它，而必须是 `wheel` 呢？

原因是这个群组有特殊意义，属于 `wheel` 群组的用户虽然是普通用户，但可以获得相应的管理员权限，比如读写某些目录。

如果用户不在 `wheel` 群组中，那么访问共享时可能会由于权限问题而被拒之门外。

简而言之，如果你想要实现不同权限用户访问共享，那么必须将用户加入到 `wheel` 群组中。



### 三、设定并开启共享服务功能

挂载点有了，可访问的用户也有了，接下来我们就可以开启共享服务功能了。



1、点击菜单 `服务` > `SMB` ，跳转至共享服务设定页面。

图13



2、点击 `分享区` ，再点击右侧 `+` 号添加共享项。

图14



3、共享项的设置按图示设定即可，包括共享名称、注释、挂载点路径，以及去除访客访问的勾选，最后点击添加按钮。

图15



其中需要说明的是，共享路径需要选择之前建立的挂载点。

点击路径一项右侧的浏览按钮，点选挂载点名称，再点OK即可。

图16



添加完成后，分享项就建立好了。

可以建立多个分享项，当然也可以开启任何人都可以访问的访客共享。

图17



4、启用 `SMB` 服务，点选 `设置` ，点击最下方的启用按钮。

图18



很简单吧，大部分设定都使用了默认值，一般情况下就够用了。



### 四、测试文件共享服务

一切OK，那么我们就来测试一下前面建立的文件共享服务是否好用。

找一台客户机，我的是 Windows 10 系统的。

在连接文件共享之前，我们需要注意的是，如果你也是用 Windows 10 系统，那么需要将安全证书请求设置关闭。

方法很简单，注册表中按如下修改即可。

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters]
"RequireSecuritySignature"=dword:00000000
```

图方便就直接下载我这儿的注册表文件导入即可。

下载链接：RequireSecuritySignature.reg.7z



关于这个共享安全请求证书的问题，很明显是为了提高安全性，而这个设定开启是 `Windows 10` 的默认设定。

如果你用 `Windows 10` 去访问某个共享后发生访问失败的情况，那么有可能是这个原因导致的，特别是访问的共享系统是在非 `Windows` 域环境中。



好了，相关的话题内容比较多，在此不再赘述。

按以上设定好后，我们在客户端浏览器的地址栏内敲入两个斜杠外加服务器的域名和IP，然后回车。

```
\\域名或IP
```

不出意外的话，可以正常访问并看到共享文件夹了。

图19



这里啰嗦一句，如果你的共享名称后面加上一个 `$` 符号，那么对于 `Windows` 来说它就是隐藏共享，直接打上域名或IP地址可能只看见个空白的窗口，所以可以直接将共享名称加在域名和IP后面来访问。

```
\\域名或IP\隐藏共享名称$
```



我们接着说，当我们点击共享文件夹 `sysadm.cc` 时，它弹出了网络凭据窗口。

这个很明显，就是我们前面建立的访问用户啊。

输入时注意所在域一项，即用户名输入时最好采用 `域名\用户名` 的写法，比如 `sysadm.local\user1` 。

图20



正确输入用户名和密码后，我们就可以看到共享上的文件啦！

图21



尝试一下读写传输都没有问题，速度也刚刚的。

至此，我们简单快速地建立了一个 `XigmaNAS` 系统上的文件共享服务。



### 写在最后

在前面的配置操作过程中，小伙伴们也应该可以体会到，关于共享建立的很多设定我们都采用了默认值。

在实际的应用场景中，可能还有很多需要我们精确调整的地方。

比如关于安全访问的问题，我们需要限定通讯用的 `SMB` 协议的版本，比如客户端被要求必须是 `SMBv2` 以上版本。

由于 `SMBv1` 的安全问题，早在N年前就已经不建议使用并废弃了，并且在较新的系统中也被默认禁止开启。

当然了这些都属于另外一个话题了，如果有空我会另写一篇给小伙伴们聊一聊。

好了，最后如果你们测试成功了，别忘记关注我帮我点赞分享，我就这一点点小小要求了，3Q！



**扫码关注@网管小贾，阅读更多**

**网管小贾的博客 / www.sysadm.cc**