zabbix

副标题：

英文：

关键字：







ping + 邮件报警



主要步骤：

1、fping

2、postfix

3、告警媒介

4、数据采集 > 主机

5、告警 > 媒介

6、告警 > 动作

7、消息模板

8、用户群组权限





我做了个简单的思维导图，小伙伴们凑合看哈！

```
故障发生/恢复
|
 \_ 用户群组权限（是/否？没有权限则无法触发动作）
    |
     \_ 告警>触发器动作（重点：将[触发器]和[告警媒介]关联了起来）
             |
             |\_ 数据采集>主机>监控项>触发器
             |
              \_ 告警>媒介（邮箱）>消息模板
```











邮件设置。



1. 名称

这个随便起，喜欢就行，不过也不要太随便，喜欢也得是自己记得它是什么意思才行哈！

比如我这儿起个名，`Email zabbix@xxx.local` 。



2. 类型

电子邮件，这个不多说了。



3. 邮箱提供商

没有特殊情况就选择默认的 `Generic SMTP` ，就是通常的 `SMTP` 。



4. `SMTP` 服务器

你的邮箱是哪个供应商的，一般都可以问到。

比如 `163` 的，它的 `SMTP` 服务器就是 `smtp.163.com` ，`QQ` 的就是 `smtp.qq.com` 。

我这儿用的是自己搭建的邮件服务器，就在 `zabbix` 主机上面，因此直接写上 `127.0.0.1` 。



5. `SMTP` 服务器端口

和上面说的一样，要看供应商提供的，端口号通常有 `25` 、`465` 等等，看你的邮箱是不是走的加密认证之类的连接。



6. 电子邮件

就是你的邮箱地址了，比如：`zabbix@xxx.local` 。



7. `SMTP HELO`

这个是连接邮件服务器时最初的打招呼信息，即 `HELO` 信息。

有的服务器要求不怎么严格，可以随便乱写，而有的就比较严格了，所以说最好写成和你的邮箱地址一样比较好。

比如：`zabbix@xxx.local` 。



8. 安全连接

询问邮件提供商，通常其页面中的 `SMTP` 设置中会有写。

我这儿只开放了本机发送邮件，因此不用什么安全连接。



9. 认证

`SMTP` 本身没有啥认证不认证的，根本不用输入用户名密码，这是早期协议就这么设定的。

不过为了防止垃圾，有的服务器都加了一道认证的坎，这种情况下是要输入用户名和密码才能成功连接的。

我这儿只开放了本机发送邮件，因此不用什么认证。



10. 消息格式

即邮件内容的格式，一般用的是文本，如果你有特殊要求，那么可以选择 `HTML` 格式。



最后别忘记勾选 `已启用` ，否则这个邮箱不起作用啊！



图c06









消息模板



发生故障时：

主题：

```
[发生故障] {EVENT.NAME}
```



消息：

```
XXXX故障通知

主机名：{HOST.NAME}
主机IP：{HOST.IP}
严重程度：{TRIGGER.SEVERITY}
告警时间：{EVENT.DATE} {EVENT.TIME}
故障内容：{ITEM.NAME}: {ITEM.VALUE}
现在状态：{TRIGGER.STATUS}
事件ID：{EVENT.ID}

Zabbix https://192.168.1.123/
————————————————————————
XXXX 系统部
```



恢复故障时：

主题：

```
[故障恢复] {EVENT.DURATION}: {EVENT.NAME}
```



消息：

```
XXXX故障恢复通知

主机名：{HOST.NAME}
主机IP：{HOST.IP}
严重程度：{TRIGGER.SEVERITY}
告警时间：{EVENT.DATE} {EVENT.TIME}
恢复时间：{EVENT.RECOVERY.DATE} {EVENT.RECOVERY.TIME}
持续时间：{EVENT.DURATION}
故障内容：{ITEM.NAME}: {ITEM.VALUE}
现在状态：{TRIGGER.STATUS}
事件ID：{EVENT.ID}

Zabbix https://192.168.1.123/
————————————————————————
XXXX 系统部
```





想要了解参数信息，可以参考 `zabbix` 自带的 `Email` 等媒介模板（就是前面克隆我们自己的邮件媒介）。

图e05

图e06



