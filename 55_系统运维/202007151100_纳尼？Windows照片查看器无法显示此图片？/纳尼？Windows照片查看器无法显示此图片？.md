纳尼？Windows照片查看器无法显示此图片？

副标题：这个事情有点搞~



前两天，我和流浪哥正在家门口摆龙门阵，没想到不远处同村的林妹妹正巧路过。

这种天赐良机我们怎么会放过，我赶紧掏出手机一顿狂拍。

很快林妹妹就消失在视野中，一回头只见流浪哥流着口水还在那儿呆呆地望向林妹妹消失的方向。

我拍了拍他的肩膀，他反应了过来，突然后悔没有及时“拍照留念”。

他央求我要有共享精神，是哥们照片也应该有他一份。

我说可以但要拿一顿大餐来换，他说革命友谊坚如铁，他同意了！



后来又互相闲扯了一会，把他打发走了。

火速回到卧室打开电脑，熟练地把手机照片导入到电脑中，准备用Windows照片查看器浏览欣赏一番。

>  前文：[《一招找回Win10的照片查看器》](https://www.sysadm.cc/index.php/xitongyunwei/15-win10-photo-viewer)

不幸的事情发生了，试了好久却发现照片无法用照片查看器打开，出现了如下错误提示。

图1

纳尼？内存不足？硬盘已满？亦或是照片损...损坏了？我不敢想......

搞笑的是，用Windows的画图却都能打开！

还能不能愉快地做朋友啦喂！



网上网友们也有遭遇此类问题，热心之人纷纷献计献策。

比如，追加内存（难道我的16G内存不够用？），清理硬盘（我的硬盘很空的好不？），或者干脆用第三方软件替代。

可是我就是个倔强的人儿啊，不想用第三方软件呢。

于是我果断开始踩坑和填坑之路，小伙伴们要不要和我一起上路呢？



#### 几个大坑

坑一：修改系统临时变量路径。

TMP变量路径由原来的 `%USERPROFILE%\AppData\Local\Temp` 修改为诸如 `D:\tmp` 之类的路径。

其实这就是前面提到的硬盘空间不足的梗！

结果肯定是无效了，有点被耍的感觉。



坑二：分辨率问题，开启`ClearType` 即可。

按路径 `C:\Windows\System32\cctune.exe` 打开 `ClearType` 设置。

一路下一步直到完成，结果无效。（本来就启用的，又被耍了！）

图2



坑三：颜色管理。

`控制面板（小图标）` > `颜色管理` > `高级` ，设备配置文件一项选择不同的项目。

好多啊，我选哪个？

我找了两个骰子，随机选择了好几个，包括网上说的 `Agfa` ，都不行，心好累！

图3



#### 探索真相

使用Windows照片查看器到底为什么打不开某些图片呢？

经过一番研究，大概、可能、也许、或者和图片的颜色显示有关。

JPG图片的格式规范中，有图片的扩展信息，包括 `JFIF` ，`EXIF`，`ICC` 等等。

根据文章开头说到的奇葩错误提示，猜测是系统在读取图片时，可能由于这些附加属性读取失败才导致了问题发生。

最终发现最有可能的是 `ICC` 信息导致的问题。

`ICC` 是个啥？

关于它的配置格式说明：[Embedding ICC profiles in image file formats](http://www.color.org/profile_embedding.xalter)

上面这个链接说明是英文的，看着费劲吧，其实它就是所谓的色彩同步描述文件。

这个色彩同步描述文件（有些长，有些拗口哈），应该是它有自己的一套它认为的更好的颜色显示方案。

如果这个颜色显示方案在系统中没有相配套的，那么就会显示出错啦。

看来这还真和手机拍照有关啊，现在的手机拍的照片可是高清又艳丽哦！

XX5G手机，五百二像素，照亮你的美！

图4



就像前面说的第三个坑那样，打开 `颜色管理` 的 `高级` 选项卡，可以看到 `设备配置文件` 中有很多配置名称。

图5



那是不是选择一项与图片相同配置名称的就能正确识别了呢？

用 `WinHex` 打开图片，查看一下ICC信息，这个...好像设备配置文件里没有找到啊。

图6



这下又懵B了，还好网上有大神！

帖子内容：[Windows photo viewer can't run because not enough memory?](https://superuser.com/questions/1509194/windows-photo-viewer-cant-run-because-not-enough-memory)

按照大神的指引，我找到了解决问题的方法--转换图片。



转换图片，其实就是去除图片中不必要的附加信息，比如 `EXIF` 或 `ICC` 等。

先要到 `ImageMagick` 官网上下载工具软件。

官网网址：https://imagemagick.org/script/download.php

工具下载：[ImageMagick-7.0.10-23-portable-Q16-x64.zip](https://imagemagick.org/download/binaries/ImageMagick-7.0.10-23-portable-Q16-x64.zip) （86MB）



注意，如果你是32位系统，那么应该下载32位的工具软件。

另外这个工具包比较大，为了下载快点，我去除了不必要的部分程序，重新打包了一下。

**想下载快些的，可以下载我这个简易转换程序 `convert.7z` ，程序本身还是官网的。**

**convert.7z (5M)**

下载链接：https://pan.baidu.com/s/1VdiVTPMHMANpnOTKrDC_2A

提取码：dbcl

图7



#### 实践出真知

按照以下命令格式转换图片，不算难理解吧。

###### 1、单独转换一张图片

```shell
# 去除掉所有的附加信息
# 转换前图片 BADFILE.jpg，转换后图片 GOODFILE.jpg
convert BADFILE.jpg -strip GOODFILE.jpg
```



###### 2、如果你要批量转换图片

```powershell
# 可以使用相对路径 -path OUTPUT_DIR
mogrify.exe -format jpg -verbose -path C:\OUTPUT_DIR -strip *.jpg
```



好了，大神已经告诉我们怎样转换了，接下来照搬就是了。

终于，我尝试了一下，果然转换后用Windows查看器打开成功！

这里要友情提醒一下，由于去除了图片原有的 `ICC` 信息，所以显示出来的图片颜色会与原图有所不同哦。



嘿嘿，这时我想到了流浪哥，这小子肯定在家干着急呢！

我带上转换程序，兴冲冲地一路小跑到了流浪哥家中，却只见他正乐不颠地欣赏着照片呢。

我顿时心里一惊，心想他怎么就给打开了，他先我一步搞定了？

此时我满脑子都是黑人问号！

只见他不紧不慢、不慌不忙地右击图片，选择 `照片` ，打开了Windows10最新版自带的照片查看程序。

图8

图9



一口鲜血喷涌而出，我晕啊......!!!



> WeChat @网管小贾 | www.sysadm.cc

