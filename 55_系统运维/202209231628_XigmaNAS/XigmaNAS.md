记一次 XigmaNAS 跳电故障的修复过程

副标题：记一次 XigmaNAS 跳电故障的修复过程

英文：troubleshooting-xigmanas-boot-error-and-failure-after-sudden-power-down

关键字：xigmanas,nas,网盘,power down,掉电,跳电



我问你，刮阵风就能把电脑给搞坏，你信不？

有人不信，肯定会说，那要是天天刮风这电脑还不得都坏了，信你个鬼啊！

我想说的是，凡事没有绝对的，这个问题嘛就要看风到底有多大，比如说台风。



当然了，不是说风大了能把电脑刮上天，而是说台风引起的大面积供电电路故障，从而导致了电脑设备损坏。

这不今年秋台风特别多，刚好赶上个叫“梅花”的台风，就把不少电脑设备啥的给搞坏了。

据说前几年有个台风也叫“梅花”，估计一个猴子窝里出来的，那威力也是相当厉害。

我们暂且不提这台风，单单说这损坏的电脑设备中就有我今天想和大家伙分享的一个故障案例主角，一台 `XigmaNAS` 网盘设备。



这是一台用于业务系统备份的设备，常年奔跑、辛勤工作，因此还特地给它配了个拍档：`UPS` 。

奈何这个拍档工作不给力，也兴许是台风太给力，当天晚上电压波动得跟玩似的，低压不到 `180` ，高压直奔 `250` 。

总之经历了这么一个惊心动魄的夜晚后，各路英雄豪杰纷纷倒下，几无幸免，其中就有我们今天的主人公 `XigmaNAS` 。



### 故障现象

最后什么情况呢？

等我拿到手时，尚有一口气在，能点亮，但是噼里啪啦跳出一堆错误。

比如你看，阵列被降级，居然有两块硬盘掉了，啧啧！

图a03



开机不断警告报错，最惨的是到了最后，说什么 `/conf/config.xml` 文件没找到，结果控制菜单都看不到了。

图a02



### 故障分析

这...这...这叫我如何是好？

在确认设备本身是否完好无损坏，并更换相应损坏的硬盘之后，我就在想，这么多的错误，难道要我一个一个地修复吗？

哎，有了，我们可以利用 `XigmaNAS` 安装盘的升级功能来修复损坏的文件啊！

于是我马上到网上下载最新版 `XigmaNAS` 镜像，然后选择升级安装，想着应该可以更新损坏的文件。

图



的确升级过程很顺利，损坏的文件也正常被修复，并且配置文件 `config.xml` 也被成功保留并迁移到新版本上了。

但是，嘿嘿，就怕这个但是，结果一路开机顺利到最后，它它喵地还是提示我控制菜单不可用！

图b01



这怎么整？

后来我想起来了，为了避免有长相丑陋的不法之徒直接操作我的 `XigmaNAS` 控制台， `XigmaNAS` 的确有一项设定是可以关闭控制台菜单操作的。

那这个设定会不会保存在配置文件 `config.xml` 中呢？

结果我这么一查还真是，如下图，在配置文件中的确有一项叫作 `disableconsolemenu` ，就是禁用 `disable` 、控制台 `console` 以及菜单 `menu` 这几个单词合起来写。

同时这个值是布尔类型 `bool` ，也就是它要么是真要么是假，现在看它是 `1` 也就说明值是真，控制菜单被禁用了。

```
<disableconsolemenu type="bool">1</disableconsolemenu>
```

图a01



OK，问题很清楚了，我们将它改成 `0` 不就可以了？

在控制菜单禁用的画面下同时按下 `Ctrl+Alt+F2` 开启一个新的终端 `Shell` ，找到 `config.xml` 修改吧。

结果令我意外的是我并没有在 `/conf` 目录中找到它的身影。

`config.xml` 消失了？还是说被藏到哪去了？

后来折腾了一会儿，这才发现新版的 `config.xml` 实际已经被移动到了 `/cf/conf/` 目录中。

好吧，改改看，结果它居然是只读的，好么，又是一个坑！

```
Unable to write to file, read-only file system
```

图



我仔细一看，得，不是文件只读，而是整个文件系统成了只读。

求助网络，发现可以通过重新挂载来让挂载点更新为可写。

具体这样做，并不复杂。



首先确认挂载点名称。

```
mount
```

就这么一个命令不带参数，它会列出当前系统所有的挂载点及其文件系统格式和是否只读情况。

从图中我们可以看出，挂载点 `/cf` 是只读的。

图b02



对了，这个 `/cf` 不就是新版 `XigmaNAS` 放 `config.xml` 的那个目录嘛！

好，接下来就将它更新为可写吧！

```
// mount -uo rw [挂载点名称]
mount -uo rw /cf
```

只要最后写对挂载点即可，注意这个和 `Linux` 命令有一些区别。

好了，最后我们就可以修改 `config.xml` 的文件内容了！

下图是我用 `vi` 直接修改的情况，瞧，可以做到保存文件啦！

图b03



最后重启系统，久违的控制菜单终于回归了！

图b04



