别再徒手肉搏 Windows 共享文件夹了，看我早用上了躺平工具

副标题：别再徒手肉搏 Windows 共享文件夹了，看我早用上了躺平工具

英文：stop-fighting-windows-folder-sharing-setup-with-your-bare-hands-i-have-already-used-smart-tool

关键字：share,folder,共享,共享文件夹,打印机,windows,工具,guest,everyone,共享权限





月明星稀，秘密基地某间秘室之中，一面巨大的屏幕正徐徐降下。

屏幕发出了亮光，一阵雪花过后，突然跳现一张阴鸷的脸。

“司令！没想到在这儿都能见到您！”，在坐的四位年轻人唰地站了起来，我就在其中......



“就算是一条内裤，一张卫生纸，都有它的用处！诸君请坐！”屏幕中人用着极其低沉的嗓音开始了当晚的秘密会议。

“在坐诸君都是帝国的精英，也是此次秘密卧底行动计划负责人最后一轮筛选的预备人选。”

“今晚你们之中将角逐出唯一一人担负这项光荣而艰巨的使命......”



“你们，准备好了吗？！”

“准备好了！”，四人几乎异口同声，紧张而又期待着。



当工作人员将考试的题目展现出来时，我们都有点懵了：谁能够在最短时间内给一台普通电脑成功创建共享文件夹，并且能够正常访问者即为胜出。

我们几个互相看了一眼，都差点笑出了声，强忍之下心想这是不是在开玩笑吧，这么简单吗？

然而之后发生的事情却狠狠地打了我们几个的脸！



### 令人抓狂的共享设定

话说尼古拉斯方块一马当先冲在最前，这家伙自信满满却捣鼓了半天，最后总是收到这样的错误提示。

图01



亚历山大黑桃紧随其后，一番花式折腾后也跟着抓瞎了。

图02



最后这位斯丹尼斯拉夫草花更绝，要么老是提示输入用户名和密码，要么干脆提示用户被禁用，最终无奈也败下阵来。

图03

图04



呵呵，没办法，最后只有我硬着头皮上了，谁叫我是今晚最靓的仔呢！

我刚一站起来，这帮人就一阵唏嘘：“爱你孤身走暗巷，爱你不跪的模样......”

哟嗬，还跟我来这一套啊，一个个平时都挺拽的，哼哼，今天我就给你们几个上一课！



要说开个共享，有人说简单，有人说迷茫。

到底闹哪样，瞧我给大伙儿打个样！



### 共享服务工作正常吗

提供共享服务有几个前提条件，一个是 `Server` 服务正常运行，另一个是网卡设置中勾选了 `Microsoft 网络的文件和打印机共享` 。

图05

图06



一般情况下，这些都是默认启用的，因此我们不必操心，系统已经帮我们开启了。

如果怎么折腾都不行，那么最好还是检查一下服务是否正常。



### 防火墙也捣蛋

有时明明共享已经建立好了，并且服务也正常在跑了，怎么就打不开共享呢？

有一个原因可能比较扎心，就是防火墙给挡住了，记得要开放共享访问策略啊！

图07



### 两种共享方式：匿名访客与经典用户

如果你使用的是 `Windows 10` 版本以上的系统，那么共享的默认访问方式已经被默认为 `经典` 方式。

相对于匿名的 `仅来宾` 方式，`经典` 方式的意思就是要你提供用户名和密码才能正常访问共享，而前者则不需要。

一个不要密码，一个要密码，就是所谓的 `匿名访客` 和 `经典用户` 两种方式。



通常这两种方式的切换，网络上较多通过修改组策略来实现。

图08

图09



其实这种做法只是将策略优先覆盖本来设定，有点复杂了，而且关键是，系统默认早已是 `经典` 方式，一般情况下不需要修改组策略。

需要进一步说明的是，匿名访问实际上统一使用的是 `Guest` 这个帐户，而并不是不用帐户。

这个 `Guest` 帐户可以修改名字，并且可以和 `Everyone` 用户相关联。

是不是有点头晕？

其实这里比较乱，不过你没必要搞得太清楚，大概的了解就行，你只要知道存在两种共享访问方式即可。

文末有网管小贾的便捷工具，可以方便地帮我们创建相应方式的共享！



### `SMB` 协议带来的限制

玩个共享怎么还和什么 `SMB` 协议扯上关系了呢？

是的，简单地说，所谓文件夹共享等都是通过 `SMB` 协议来建立连接并传输数据的。

就像我们打开网页使用的 `http` 协议一样，总归要有一个约定好的协议事情才好办成对吧。



然而这个 `SMB` 协议吧，它到目前为止居然有好几个版本，比如 `1.0` 、 `2.0` 还有 `3.0` ，不知道还有没有 `4.0` 。

为啥有这么多不同的版本呢？

原因很简单，老的协议有漏洞，它不安全啊，就像早期有的合同一样，并不能完美覆盖一些新生问题。

因此目前还在使用的版本是 `2.0` 和 `3.0` ，作为不安全的 `1.0` 已经被弃用了。

> https://learn.microsoft.com/zh-CN/troubleshoot/windows-server/networking/guest-access-in-smb2-is-disabled-by-default



然而，又是然而，这个 `SMB 1.0` 虽然已弃用，但是它还是有点用的，至少一些老设备还是在这上面跑的，比如一些打印设备。

还有，以前对安全方面要求不严，很多人喜欢无限制（即不需要用户名和密码）的方式来访问共享，这种方式被称为 `来宾登录` ，也就是使用 `guest` 用户来登录。

这种来宾登录在使用时非常爽，一直用一直爽，想连啥就连啥，而且权限最大化，但是你懂的，危险系数也随之变大哦！

所以说，这种 `来宾登录` 方式虽然到了 `SMB 2.0` 还是支持的，但是默认情况下已经被禁用了。



请小伙伴们注意哦，这个限制是在客户端以及服务端两边都有的。

因此如果确定服务端已经开启 `来宾登录` （匿名共享）功能，那么客户端同样也要打开这个功能才能真正使用到它。

如果你默认使用自己的用户名和密码访问共享，那么就不需要开启匿名共享功能啦！



### 超麻烦的权限设定

前面我们有提到过，如果是匿名共享，那么随便谁都可以大大方方地进到共享里来。

这时的权限相当于全部放开了，因为大家都是以 `Guest` 来宾身份访问，说白了大家权限都一样，都是 `Guest` 这个用户帐户。

然而随着安全性的提高，来宾默认不让用了，那么就必须要大家使用自己的身份（帐户）来访问共享了。

就像做核酸，你得拿着自己的身份证才行，不可以代替别人，也不可以让别人来代替自己做检查。



我们可以看一下，在共享开启前，系统默认就是使用的各用各帐户、各用各密码的策略。

随便找个文件夹，点击查看其属性中的 `共享` 选项卡，在最下方可以看到一个叫作 `密码保护` 的区域。

我们点击一下那个 `网络和共享中心` 瞧瞧。

图10



它会自动跳转到 `控制面板` 的 `高级共享设置` 。

我们再点击 `所有网络` 右侧的那个下拉箭头。

图11



嗯，在 `密码保护的共享` 区域里，我们可以选择设定是否有密码来保护我们的共享。

注意了，这也是我们是否开启匿名访问共享的关键钥匙。

图12



然而，这只是第一步，因为有权限限制访问的前提下我们是不需要动这个设定的，本来就非匿名访问就是有密码的意思嘛！

那所谓权限还有什么别的花样吗？

当然有，而且还挺多、挺麻烦的。

不过请放心，到我这儿多少能给你掰扯明白一点儿。



首先我要说明的是，共享的权限分给了一对要好的兄弟管理，哥哥管共享本身的权限，弟弟呢则管理文件夹的 `NTFS` 文件系统权限。

哥哥作人比较单纯，权限设定比较简单，就负责共享访问时你是只读带是可写，比较单纯。

而弟弟精于算计，负责共享的文件夹自身文件系统上的 `NTFS` 权限，将本来简单的事儿给整得有些复杂了。

虽然弟弟做的事情比哥哥复杂，但毕竟哥哥年长，所以弟弟做事前总是要先听哥哥的意见，因此共享本身权限要优先于 `NTFS` 权限。

这两人是亲哥俩儿，感情甚好，互相协助，共同完成共享的权限管理。

简单地说，就是哥哥看大门，弟弟看屋里的房间，想要进到房子里，要先进大门，后才能进到房间里。

好，我们来看看这哥俩儿具体是怎么工作的。



还是某文件夹的共享选项卡，我们点击 `高级共享(D)...` 那个按钮。

图13



在打开的窗口中我们可以开启共享并设定共享名称，但是请注意，在下方还有一个 `权限(P)` 按钮。

没错，这儿就是那位哥哥管的地方，打开它看看吧。

图14



打开了，我去，超级简单啊，就一个 `Everyone` 用户，他的默认权限是 `读取` 。

图15



如果我们需要可写访问共享的话，那么必须先要让哥哥同意开通 `更改` 或 `完全控制` 权限，当然默认是使用 `Everyone` 用户，你也可以使用其他用户。



然后我们再来看看弟弟管理的 `NTFS` 系统权限，乖乖，这么复杂，我无处安放的小手啊！

图16



这里的权限不仅要管理不同的用户，而且还要顾及非常细化的具体权限，有时着实让人摸不着头脑。

不过请放心，文末有工具程序下载，可以大大简化这恼人的设定。



### 一键开启共享之自制工具

我猜当你设定共享时，一定遭遇过前面所提到的各种各样的麻烦事。

别慌，为此我专门做了几个小工具程序，目的就是为了减少不必要的麻烦，让小伙伴们安心做更多更有意义的事。

图17



**网管小贾共享工具集下载**

* 整合程序：网管小贾的超便捷共享文件夹生成器
* 工具集（可分开使用）：
  * 服务端：[网管小贾]一键开启匿名共享文件夹
  * 服务端：[网管小贾]一键开启匿名共享打印机
  * 客户端：[网管小贾]共享客户端工具



本工具程序可在 `Windows 10/11` 上正常运行。



下载链接：https://pan.baidu.com/s/1YSLqR4WIVc9oKSfZ9fBlQQ

提取码：2jsk



### 如何一键开启共享

##### 创建经典共享

使用工具就非常简单了，选择需要共享的文件夹，然后点击 `创建共享(C)` 按钮，成了！

图18



就是辣么简单，不过这个共享还需要添加用户才能访问。

其实也很easy，找到新建的共享，选择用户，看准权限，按下添加按钮，成功添加权限！

图19



##### 创建匿名共享

刚才挺容易的吧，就两步，创建共享和添加用户权限。

我们再来一个匿名共享的创建，只需要像前面那样多勾选一个 `匿名共享` 选项就行了，其他一样一样的。

图20



##### 创建打印机共享

选择打印机，添加共享，没有比这个更简单的了！

图21



有的小伙伴会说，添加个打印机共享还要在这儿整吗，设备管理里直接整不就行了？

当然可以了，但是没说过吗，这儿方便啊，而且这里可以做到快速匿名共享打印机。



##### 客户端工具

共享从来都不是服务端一个人的事，是需要客户端来配合的。

因此我将一些必要的客户端设置功能也整合到这里来了。

图22



客户端功能一共三样。

第一个是开启匿名访问，前文有说明过。

第二个是重启 `WorkStation` 服务，这通常是用来重置访问方式，比如你换了个用户来访问共享却被拒绝时。

第三个是专门用来对付连接共享打印机时遇到的糟心事，就像文章开头那位斯丹尼斯拉夫赵七碰到的情况。



什么？你觉得程序看着有点眼晕。

不用担心，我将它拆分出来了，比如开启匿名共享，你可以直接这么用。

图23



比如一键共享打印机，你可以这么用。

图24



客户端工具也拆出来了，单独在客户端使用更放心。

图25



### 写在最后

在早先 `9x/XP` 时代，开个共享文件夹是个超级简单的事儿，怎么现在就给整复杂了呢？

归根结底是安全方面的问题，包括臭名昭著的勒索病毒，都是利用了共享漏洞。

所以时至今日，所运用的高版本 `SMB` 协议也好，还是系统默认设定也好，都是为了保证我们能够安全可靠地使用共享服务。



此外，打印机共享也是大家常用到的服务功能，其本质和共享文件夹一样，只不过是将打印机设备共享出来。

它的权限设定相对简单一些，大部分场景下在使用过程中也不会太过计较权限的问题。

关于打印机共享的设定，也包含在了前面的网管小贾共享工具集中。

最后我想说的是，工具是用来提高效率的，做事就要讲究效率，除非你的时间特别廉价，否则不应该将时间浪费在搞半天头变大的一些烦人琐事上。



比如，有时我们连接共享打印机会遇到这种非人的待遇。

以下两套话术会反复出现，心理承受能力较弱者立马就会崩溃！

图26

图27



你们瞧瞧，这是人说的话吗？

赶紧用用我写的工具吧，立马就能让它闭嘴！



好了，如果你想问文章开头所说的比赛最后结果如何。

那还用猜吗，自然是我成功将共享创建完成，并且得到了司令的高度赞赏。

我一边哼着“不是站在光里的才算英雄......”，一边将藐视的目光瞥向那几个刚才还在嘲笑我的家伙们。

正在这时，工作人员一声“恭喜”，神秘地塞给我一张纸条。

打开这么一看，上写：

卧底目标WX街27号玛米小吃，三年内务必窃得绝美辣条之绝密配方。

军情紧急，望速动身，祝君好运，帝国万岁......





**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc