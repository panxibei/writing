如何优雅地利用共享服务与他人共享文件

副标题：







一般中小企业都有局域网共享服务，合理利用好共享可达到事半功倍的效果。

与U盘相比较，共享传输文件具有传输速度快、多人共用、可传输大文件、可直接在线编辑文件等优势。



使用临时共享的流程：

1、用户提出申请，系统管理员为其赋予共享访问权限和时间期限。

2、用户利用脚本程序自主生成共享链接，并上传文件。

3、用户把共享链接发送给对方用户，两者之间即可互相上传下载文件。





代码：



定义一些变量内容。

```vbscript
strShareFolder = "\\Server\TempShare$"         ' 指定共享路径
strUserName = objNetwork.UserName              ' 获取用户名
intCharNo = 8                                  ' 指定随机8个字符
strRandomChar = RandomChar(intCharNo)          ' 获取随机字符串
intAddDate = 3                                 ' 指定3天后的日期
strDate = CalculateDate(intAddDate)            ' 指定日期以YYYYMMDD的形式
strFolderName = strUserName & "-" & strRandomChar & "-" & strDate ' 指定生成的文件夹名称
intArgNum = WScript.Arguments.Count            ' 获取命令参数数量
intMailFlag = 0                                ' 0 - 以OUTLOOK方式打开, 1 - 以IE方式打开
```



创建临时共享文件夹。

```vbscript
objFSO.CreateFolder(strShareFolder & "\" & strFolderName)
If Err.Number <> 0 Then
   Msgbox "An error occurred during folder creating." & vbCrLf & "ErrNo: " & Err.Number
End If
```



在当前用户桌面上创建可访问共享文件夹的快捷方式。

```
strShortcutPath = objWSH.SpecialFolders("Desktop")
Set objSC = objWSH.CreateShortcut(strShortcutPath & "\" & strFolderName & ".lnk")
objSC.TargetPath = strShareFolder & "\" & strFolderName
objSC.IconLocation = "\\Server\TempShareOpenIcon.ico, 0"
objSC.Save
If Err.Number <> 0 Then
   Msgbox "An error occurred during shortcut creating ." & vbCrLf & "ErrNo: " & Err.Number
End If
```



上传拖放文件到 `TempShare`

```vbscript
If intArgNum > 0 Then
   For Each strArgPath in ArgArray
      If objFSO.FolderExists(strArgPath) Then
         objFSO.CopyFolder strArgPath, strShareFolder & "\" & strFolderName & "\"
         If Err.Number <> 0 Then
            Msgbox "An error occurred during data saving to TempShare." & vbCrLf & "Path: " & strArgPath
         End If
      End If
      If objFSO.FileExists(strArgPath) Then
         objFSO.CopyFile strArgPath, strShareFolder & "\" & strFolderName & "\"
         If Err.Number <> 0 Then
            Msgbox "An error occurred during data saving to TempShare." & vbCrLf & "Path: " & strArgPath
         End If
      End If
   Next
End If
```



复制 `TempShare` 到剪贴板

```vbscript
PutInClipboardText "file:///" & strShareFolder & "\" & strFolderName & "\"
If Err.Number <> 0 Then
   Msgbox "Could not copy TempShare path to clibpoard." & vbCrLf & "ErrNo: " & Err.Number
End If
```



将剪贴板内容再粘贴到邮件正文。

```vbscript
' 启动OUTLOOK生成邮件，没有OUTLOOK时使用IE打开
' 注意，用IE打开会有许可确认提示窗口

Set objOL = CreateObject("Outlook.Application")
Set MailItem = objOL.CreateItem(0)
If Err.Number <> 0 Then
   intMailFlag = 1
End If

' 生成模板（OUTLOOK换行：vbCrLf，IE换行：%0D%0A）
If intMailFlag = 0 Then
   strNewLine=vbCrLf
Else
   strNewLine = "%0D%0A"
End If
strMail = " " & strNewLine & " " & strNewLine &_
          "<--------------------------------------------------------------------------------------------------------------->" & strNewLine &_
          "   AccessPATH:  file:///" & strShareFolder & "\" & strFolderName & "\" & strNewLine & " " &_
          strNewLine &_
          "  [Guidance]" & strNewLine &_
"     This is a temporary folder for transmitting files between company PCs." & strNewLine &_
"     Click the above AccessPATH, and you can download/upload files freely." & strNewLine &_
"     Attention, files will be deleted automatically after " & Mid(strDate, 5, 2) & "/" & Right(strDate, 2) & "/" &Left(strDate, 4) & "(MM/DD/YYYY)." & strNewLine &_
          "<--------------------------------------------------------------------------------------------------------------->" & strNewLine & strNewLine & strNewLine


If intMailFlag = 0 Then
  ' 通过 OUTLOOK 创建模板
   MailItem.Body = strMail
   MailItem.Display
Else
  ' 通过 IE 创建模板
   objIE.visible=false
   objIE.navigate("mailto:?body=" & strMail)
End If


If intArgNum = 0 Then
   objSH.Explore strShareFolder & "\" & strFolderName & "\"
   If Err.Number <> 0 Then
      Msgbox "Could not create template mail via Internet Explorer." & vbCrLf & "ErrNo: " & Err.Number
   End If
End If
```





另外还包括几个调用函数，如：

```vbscript
PutInClipboardText(ByVal strString)    ' 复制文本到剪贴板
RandomChar(intCharNo)                  ' 产生指定字符和位数的随机字符串
CalculateDate(intAddDate)              ' 计算指定的天数并以 YYYYMMDD 形式返回
```



下载完整源码：



