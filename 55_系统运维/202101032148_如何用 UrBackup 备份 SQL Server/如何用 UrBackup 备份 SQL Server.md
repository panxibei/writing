如何用 UrBackup 备份 SQL Server

副标题：官网写得太简单，我就是来填坑的~





UrBackup 号称多平台备份系统，功能强大。

图1



官网链接：https://www.urbackup.org/backup_mssql.html



哇！写得好简单啊！

真有这么简单吗？

嘿嘿，信了你就完了，要不我怎么会出现在你的面前？

不才有个外号，人称填坑小能手，接下来就让你看看用 UrBackup 备份 SQL Server 都有哪些坑。



先罗列一下基本的步骤。

1、安装 UrBackup 服务端

2、安装 UrBackup 客户端

3、测试备份数据库

4、测试恢复数据库



OK，正式开始罗！



#### 一、安装 UrBackup 服务端

如果你是在 Windows 平台上安装服务端，那么是真心简单的。

直接下载官方的 Windows 服务端程序，双击点开按步骤下一步安装即可。

图2

图3

图4

图5



就这样安装完成了，接下来我们总要给它设定些什么，怎么设定或配置呢？

打开你喜欢的浏览器，在地址栏内输入 `http://127.0.0.1:55414` ，回车。

正常情况下 UrBackup 服务端的管理WEB页面会被打开。

不过，通常头一次打开它你可能会看到这样的错误提示。

图6



怎么还没配置就出错了？

如果你有这种想法，只能说明你是个好同学，在认真专注地学习，给你点个赞！

其实出现这个错误是正常的，原因正是你想的那样，就是它还没有配置。

是的，只要你配置好备份路径，并且保证备份路径可写，这个错误自然就消失了。

像下图那样，在 `设置 > 服务器` 选项中设定 `备份路径` 即可。

我在这儿暂时设定为 `C:\UrBackup` 。

图7



好了，回到首页再看看，是不是那个错误消失了？

一切顺利，服务端暂时搞定了。

挺简单的不是吗，但是我这儿说的是暂时搞定，别着急，你懂的，后面会有坑。



#### 二、安装 UrBackup 客户端

这个也不难，到官网下载客户端程序，一路“下一步”即可。

图8

图9

图10

图11



在安装的最后，点击 `完成` 后程序会弹出提示，询问你如何选择备份文件，就像这个样子。

图12



我们选择 `取消` ，要注意这一步很关键，因为这次我们只做备份数据库的测试，而并不包含其他诸如文件或卷的备份。



程序装好后怎么玩呢？

若要想把客户端的文件备份到服务端，那第一步当然要保证它俩能通讯，对不对？

通常可以有几种办法让它们勾搭（联系）上。



1、局域网内全自动连接

生活在一个小圈子里的人容易接触，那么就更容易勾搭上。

同理，只要是一个网段，间隔一定时间服务端与客户端会自动连接注册。

不过我做实验无法等待很长时间，所以还有另外两个办法。



2、服务端主动连接

一个服务端可以连接多个客户端，当客户端通讯不畅或其它情况下，那么它可以主动添加客户端。

图13



3、客户端主动连接

一般情况下，服务端是管理员在管理，如果不方便在服务端操作来添加连接，那么只能是客户端主动出击了。

当我们把客户端安装好了，可以看到右下角通知栏中会出现一个红色的类似磁盘的小图标。

右键点击这个小图标，在弹出的菜单中选择 `设置` 。

图14



钩选 `启用通过广域网备份` ，并且在 `广域网服务器主机名或IP地址` 中填写服务器的名称或IP地址。

如果填写的是服务器名称，要确保这个名称可以正确解析。

这种情况通常是客户端已经完成安装，却长时间无法正确建立连接。

这时主动让其连接服务端也不失为一种有效的办法。

图15



一旦双方建立的连接，那么在服务端的WEB首页上就能看到客户端的列表信息。

接下来我们就该测试备份和恢复的功能了。



#### 三、测试备份数据库

假设你已经有了 SQL Server 数据库，当然了，它应该是在安装有 UrBackup 客户端的那台机器上的。

为了实验快速进行，我这里安装了 `SQL Server Express 2014` ，在实际使用中效果都是一样的。



好，有了数据库，我们先随便新建一个数据库，我这建了一个名字叫作 `sysadm.cc` 的数据库。

那么怎么备份呢？

很简单，我们需要告诉程序，我们想要备份数据库。

右击右下角的磁盘图标，在菜单中选择 `配置需备份组件` ，就像这个样子。

图16



在出现的窗口中选择 `SqlServerWriter` 中的任意你想要备份的项目。

图17



OK，接下来你就可以坐等它自动备份到服务器上了。

你说什么？坐等？

我的天，你知不知道我的时间很宝贵的！

好吧，我懂了，为了尽快测试，那就主动备份一次看看吧。

右击那个可爱的小图标，点击 `执行文件完全备份` 。

可以看到这个图标由白色变成了黄色，说明它正在工作，这下你满意了吧？

不过很快它就又变成了白色，毕竟我们的数据库不大，它已经完成了任务。



我们到服务端看一下，果然生成了一个完全备份。

图18



既然有备份了，我们赶快测试恢复备份的功能吧。

嘿嘿，大坑等着你呢，来吧！



#### 四、测试恢复数据库

终于到了恢复备份的阶段了，我们平日里做备份，不就等的是这个时机嘛！

如果备份不成功，那也就没有任何意义，也就可以放弃它了。



和之前一样，右击小图标，这时你会发现，菜单中多了一项 `恢复组件` ，没错找的就是它。

图19



点击 `恢复组件` ，突然跳出个框框来，这是什么鬼？

图20



你要知道，我当时慌极了，像极了一只被抢食而手足无措的小猫咪。

这可怎么办？到服务端瞧瞧吧。

找到客户端的备份项，点击进去，它居然来个拒绝访问的提示！

图21



我和我的小伙伴们当时就惊呆了！

我尝试把备份路径文件夹的属性修改成非只读，然并卵，无效。

此时我深刻地意识到，我遇到了传说中的大坑！

这个“拒绝访问”以及什么“使用用户名/密码登陆”的破提示折腾了我半天时间。

要知道这可是大坑，再大就叫天坑了，那一般是搞不定的，还好被我找到了填坑方法。

在 `UrBackup` 论坛中找了这么一个回复。

图22



搞了半天，在其管理员手册中也有描述，即如果想让客户端访问或恢复服务端的备份，那么必须要指定服务端的URL路径。

它喵的不早说啊！

火速来到服务端的设置一项中，老老实实填写了服务器地址，大概这样：`http://ip:55414` 。

图23



这里插一句话，让服务端URL支持 `HTTPS` 访问，我会另外写一篇文章说明。

再回到备份界面点击备份，它就这样OK了！

好了，时间耽误地够久了，赶快回到客户端，点击 `恢复组件`，这次出现了备份项。

图24

图25



你可以选择任意项目进行恢复，但需要注意的是， **SQL Server 系统数据库**恢复时可能会失败。

在实际使用中最好多测试测试。



另外，还有一种恢复方法，即通过服务端恢复。

在服务端WEB页面的备份一项中找到相应的客户端备份，确认时间大小等信息后点击 `将文件夹万利至客户端` 按钮。

图26



此时客户端就会神奇地出现如下确认是否恢复备份的提示窗口。

图27

图28

图29



以上方法实际上也可以通过点击客户端菜单的 `访问/恢复备份` 一项来操作，效果和上面是一样的。









