Win10 更新补丁后打印机挂了，这事儿也让我碰上了！

英文：I-met-printer-error-after-applying-win10-update

副标题：微软与厂家PK，到底谁不讲武德？

关键字：printer,blue screen,win10,driver,update,type3,type4,打印,打印机



`Windows` 时常被世人所诟病的问题之一，就是每当系统更新后动不动就会发生蓝屏故障。

好在这也不是每个人都能碰上的，基本上不去安装那些补丁也就是了。

可偏偏 `Win10` 时代与以往大不相同，通过普通操作用户已经无法拒绝安装更新了。

 说巧不巧，这倒霉事儿让我也给碰上了！



历史镜头要回溯到前两天的一个早晨，那天一上班有用户打电话反映电脑不断蓝屏重启。

我过去一看，久违的蓝底白字，电脑又和我们闹别扭了。

图1



屏幕上清楚地写着：

*终止代码：APC INDEX MISMATCH*

*失效的操作：win32kfull.sys*



这是要闹哪样？

通常来说，重启后系统会自动修正错误啊！

上网搜索看看是怎么回事吧。

结果不查不要紧，一查吓一跳，这事儿还真不小！



各大网站铺天盖地都是安装了 `KB50008XX` 系列的系统更新后导致了蓝屏故障或打印机故障的新闻。

按网上众多文章的说法，这一系列的补丁与类型3（类型4不受影响）打印机驱动程序存在冲突，所以导致了系统蓝屏。

我扭头一瞧，嘿，这台故障电脑还真接着一台标签打印机。

我尝试着拨掉USB打印线，重启电脑后很长一段时间也没有出现蓝屏重启的问题。

然后再插上USB打印线，好家伙，蓝屏马上又来了！



看来网上所言不虚啊！

可是打印机总归是要用的，接下来怎么解决这个棘手的问题呢？

有三种办法，一是卸载已经安装的更新，二是想办法避免触发蓝屏重启，三是调整应用程序的兼容设置。



#### 方法一：卸载更新

按顺序找到 `控制面板` > `程序` > `程序和功能` > `已安装更新` ，右键点击相应更新，再点击卸载。

图2



卸载没难度，人人都会，不过嘛，这里会有一个问题。

就是这个更新卸载后，它要是再被自动安装上，那不就等于前功尽弃了嘛！

以前倒是有个神奇工具名曰 `wushowhide.diagcab` ，它是专门用来屏蔽指定更新的，可惜的是现在已经不提供支持了。

我也曾经尝试使用这个工具，发现并不能屏蔽 `KB80008XX` 更新补丁。

那么唯一的办法就只有 `Windows 10` 自带的暂停或推迟更新了。

图3



这显然是治标不治本的办法，我们还是再看看官方提供的其他操作吧。



#### 方法二：一顿猛操作，避免触发蓝屏重启

此方法适用于 64 位操作系统通过 32 位程序打印的情况。



##### 1、查找需要操作的打印机

打开命令提示符窗口，输入以下命令打开 `打印管理` 控制台。

```
C:\> printmanagement.msc
```



在 `打印管理` 界面左侧依次点开 `打印管理` > `打印服务器` > `主机名（本地）` > `打印机` ，在右侧列表中即呈现本机上的所有打印机。

第一列就是打印机名称，这个暂时记住，后面要用到。

最后一列为驱动程序类型，记住那些 `类型 3` 字样的打印机，后面备用。

图4



##### 2、输入命令修改打印机设置

注意，是针对驱动程序 `类型 3` 的打印机来操作。

```
# 查看打印机 Attributes 属性值
C:\> rundll32 printui, PrintUIEntry /Xg /n "打印机名称"
```

可以看到目标打印机的 `Attributes` 属性中没有 `direct` 。

如果有 `direct` 则不需要操作，如果没有 `direct` 则需要添加此属性值。

图5



```
# 添加打印机 Attributes 属性值 direct
C:\> rundll32 printui, PrintUIEntry /Xs /n "打印机名称" attributes +direct
```

再次使用前面那条命令查看属性值，`direct` 有了。

图6



以上命令务必注意字符大小写哦。

如法炮制，将所有 `类型 3` 的打印机都设置一次。

虽然这么操作很简单，但很遗憾我并没有找到为什么可以这么做的原因（或许是打印机的驱动方式？）。

姑且作为尝试吧，所有操作完成后，再看看会不会蓝屏重启了。

我这儿试过了，当天没有再重启过。



#### 方法三：通过64位系统64位程序，或者32位系统32位程序打印的情况

前面的方法如果还有问题，只能试试现在这种方法了。

那么这个方法是啥意思呢，其实说白了就是我们可能会通过各种不同的应用程序来输出打印（比如网页上直接打印），那么有可能会遇到一些问题。

这个方法会用到 `ADK` 工具包，所以仅适合系统管理员之类的专业人员来操作。



1、下载并安装 `ADK` ，安装时选择 `应用程序兼容性工具` 。

图7



2、安装完成后从开始菜单中打开 `Compatibility Adminstrator (32-bit)` （此处我们以32位应用程序举例）。

图8



3、右击 `Custom Databases` 下方的 `New Databases(1) [Untitled_1]` ，然后选择 `Create New` > `Application Fix...` 。

图9



4、`Program information` 界面中，分别输入应用程序的名称、厂商名称和兼容关联程序的所在路径。

我们这里用古老的 `IE` 举例，因为它就是 32 位程序，估计现在还有不少人在用吧。

图10



3、`Compatibility Modes` 界面保持默认直接下一步。

图11



4、`Compatibility Fixes` 界面勾选 `PrinterIsolationAware` 一项，下一步。

图12



5、`Matching Information` 界面保持默认直接下一步。

图13



6、点击 `Save` 按钮，名字和路径可任意保存，不过最好是和原程序有关联的名字。

图14



7、保存完成后右击数据定义项，然后点选 `Install` 安装。

图15



至此，当你使用相应的应用程序时，就可以有效避开驱动和更新的兼容问题了。

这种操作方法比较专业，但也更有效，适合找专业人员处理特殊的兼容问题。



#### 尾声

后续又接到几通电话，还有三台电脑也是接了类似的打印机导致了这个问题。

不过症状不一定是蓝屏重启，也有的是出现打印错误或卡纸等情况。

为了更加保险一些，如果非必要安装更新，或者特别是一开机就蓝屏的这种比较严重的情况，还是建议将其彻底卸载完事。

不过有一点点感觉奇怪，并不是所有的类型3打印机都会遭遇这种故障。

特别是通过网络连接的打印机，似乎并没有受到什么影响。

另外好像部分特定的品牌打印机问题会严重一些，不知道是不是他们与微软的合作出现了问题？

兴许将来有可能会随着打印机驱动程序的更新（类型4驱动），这一类问题会被彻底解决吧。

各位小伙伴，你们有没有遇到过这类问题呢？

如果你也有这类问题，或是有什么看法，请到评论区留下墨宝，欢迎点赞分享哦！



**PS：就在本文发表前不久，微软官方已经发布了新的修复补丁。**

以下为官方 `KB5001566` 更新的下载链接，如果你下载不了也可以问我要，祝你好运！

下载链接：https://www.catalog.update.microsoft.com/Search.aspx?q=5001566



**扫码关注@网管小贾，阅读更多**

**网管小贾的博客 / www.sysadm.cc**