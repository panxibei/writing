共享文件夹

副标题：

英文：

关键字：





月明星稀，秘密基地某间秘室中，一块巨大的屏幕正徐徐升起。

屏幕发出亮光，一阵雪花过后，突然出现了一张阴鸷的脸。

“司令！没想到在这儿都能见到您！”，在坐的四位年轻人唰地站了起来，我就在其中......



“诸君请坐！”屏幕中人用着低沉的嗓音开始了今晚的秘密会议。

“诸君都是帝国的精英，也是最后一轮数百人筛选后本次秘密卧底行动主要负责人的预备人选。”

“今晚你们将角逐出唯一的一人，其他三人将被淘汰出局。”

“你们，准备好了吗？！”

“准备好了！”，我们四人几乎异口同声，紧张而又期待着。



考试的题目很简单，谁能够在最短时间内给一台普通电脑创建共享文件夹即为胜者。

我们几个互相看了一眼，都感觉这是不是在开玩笑，这么简单吗？

然而之后的事实却狠狠地打了我们几个人的脸！





### 令人抓狂的共享设定

尼古拉斯刘波一马当先冲在最前，这家伙捣鼓了半天，却总是收到这样的错误提示。

图c01



亚历山大李明紧随其后，折腾一会儿后也抓瞎了。

图c02



最后这位斯丹尼斯拉夫赵七更绝，要么提示输入用户名和密码，要么提示用户被禁用，最终也败下阵来。

图c04

图c07



没办法，最后只有我可以上了，谁叫我是今晚最靓的仔呢！

我刚一站起来，这帮人就开始起哄：“爱你孤身走暗巷，爱你不跪的模样......”

哟呵，还跟我来这一套啊，平时都挺拽的，嘿嘿，今天我就给你们上一课哈！



### 共享服务工作正常吗

提供共享服务有几个前提条件，一个是 `Server` 服务正常运行，另一个是网卡设置中勾选了 `Microsoft 网络的文件和打印机共享` 。

图a10

图d01



一般情况下，这些都是默认启用的，因此我们不必操心，系统已经帮我们开启了。



### 防火墙也会捣鬼

有时明明共享已经建立好了，并且服务也正常在跑了，怎么就打不开共享呢？

有一个原因可能比较扎心，就是防火墙给挡住了，记得要开放共享访问啊！

图d02





### 两种共享方式：匿名访客与经典用户

如果你使用的是 `Windows 10` 版本以上的系统，那么共享的默认访问方式已经被默认为 `经典` 方式。

相对于 `仅来宾` 方式，`经典` 方式的意思就是要你提供用户名和密码才能正常访问共享，而前者则不需要。

一个不要密码，一个要密码，就是所谓的 `匿名访客` 和 `经典用户` 两种方式。



通常这两种方式的切换，网络上都是通过修改组策略来实现。

图a11

图a12



其实这种做法只是将策略优先覆盖本来设定，有点复杂了，而且关键是，系统默认早已是 `经典` 方式，一般情况下不需要修改组策略。

需要进一步说明的是，匿名访问统一使用的是 `Guest` 这个帐户，这个帐户可以修改名字，并且可以和 `Everyone` 用户相关联。

是不是有点头晕？

其实你没必要搞得太清楚，大概的了解就行，因为文末有网管小贾的便捷工具啊！



### `SMB` 协议带来的限制

玩个共享怎么还和什么 `SMB` 协议搞上关系了呢？

是的，简单地说，所谓文件夹共享等都是通过 `SMB` 协议来建立连接并传输数据的。

就像我们打开网页使用的 `http` 协议一样，总归要有一个约定好的协议事情才好办成对吧。



然而这个 `SMB` 协议吧，它到目前为止居然有好几个版本，比如 `1.0` 、 `2.0` 还有 `3.0` ，不知道还有没有 `4.0` 。

为啥有这么多不同的版本呢？

原因很简单，老的协议有漏洞，它不安全啊，就像早期有的合同一样，并不能完美覆盖一些新生问题。

因此目前还在使用的版本是 `2.0` 和 `3.0` ，作为不安全的 `1.0` 已经被弃用了。



然而，又是然而，这个 `SMB 1.0` 虽然已弃用，但是它还是有点用的，至少一些老设备还是在这上面跑的，比如一些打印设备。

还有，以前对安全概念要求不严，很多人喜欢无限制（即不需要用户名和密码）的方式来访问共享，这种方式被称为 `来宾登录` ，也就是使用 `guest` 用户来登录。

这种来宾登录在使用时非常爽，想连啥就连啥，而且权限最大化，但是你懂的，危险系数也很大哦！

所以说，这种 `来宾登录` 方式虽然到了 `SMB 2.0` 还是支持的，但是默认情况下已经被禁用了。

请小伙伴们注意哦，这个限制是在客户端以及服务端两边都有。

因此如果确定服务端已经开启 `来宾登录` 功能，那么客户端同样也要打开这个功能才能真正使用到它。









### 麻烦的权限设定

前面我们有提到过，如果是匿名共享，那么随便谁都可以大大方方进到共享里来。

这时的权限相当于全部放开了，因为大家都是以 `Guest` 来宾身份访问，说白了大家权限都一样，都是 `Guest` 这个用户帐户。

然而随着安全性的提高，来宾默认不让用了，那么就必须要大家使用自己的身份（帐户）来访问共享了。

就像做核酸，你得拿着自己的身份证才行，不可以代替别人来做检查。



我们可以看一下，在共享开启前，系统默认就是用的各用各帐户、各用各密码的策略。

随便找个文件夹，点击查看其属性中的 `共享` 选项卡，在最下方可以看到一个叫作 `密码保护` 的区域。

我们点击一下那个 `网络和共享中心` 瞧瞧。

图a01



它会自动跳转到 `控制面板` 的 `高级共享设置` 。

我们再点击 `所有网络` 右侧的那个下拉箭头。

图a02



嗯，在 `密码保护的共享` 区域里，我们可以选择设定是否有密码来保护我们的共享。

注意了，这也是我们是否开启匿名访问共享的关键钥匙。

图a03



然而，这只是第一步，因为有权限限制访问的前提下我们是不需要动这个设定的，本来就非匿名访问就是有密码的意思嘛！

那所谓权限还有什么别的花样吗？

当然有，而且还挺多、挺麻烦的。

不过请放心，到我这儿多少能给你掰扯明白一点儿。



首先我要说明的是，共享的权限分给了一对要好的兄弟管理，哥哥管共享本身的权限，弟弟呢则管理文件夹的 `NTFS` 文件系统权限。

哥哥作人比较单纯，权限设定比较简单，就负责共享访问时你是只读带是可写，比较单纯。

而弟弟精于算计，负责共享的文件夹自身文件系统上的 `NTFS` 权限，将本来简单的事儿给整得有些复杂了。

虽然弟弟做的事情比哥哥复杂，但毕竟哥哥年长，所以弟弟做事前总是要先听哥哥的意见，因此共享本身权限要优先于 `NTFS` 权限。

这两人是新哥俩儿，感情甚好，互相协助，共同完成共享的权限管理。

好，我们来看看这哥俩儿具体是怎么工作的。



还是某文件夹的共享选项卡，我们点击 `高级共享(D)...` 那个按钮。

图a04



在打开的窗口中我们可以开启共享并设定共享名称，但是请注意，在下方还有一个 `权限(P)` 按钮。

没错，这就是那位哥哥管的地方，打开它看看吧。

图a05



打开了，我去，超级简单啊，就一个 `Everyone` 用户，他的默认权限是 `读取` 。

图a06



如果我们需要可写访问共享的话，那么必须先要让哥哥同意开通 `更改` 或 `完全控制` 权限，当然默认是使用 `Everyone` 用户，你也可以使用其他用户。



然后我们再来看看弟弟管理的 `NTFS` 系统权限，乖乖，这么复杂，不太好下手的样子啊！

图a09



这里的权限不仅要管理不同的用户，而且还要顾及非常细化的具体权限，着实让人摸不着头脑。

不过请放心，文末有工具程序下载，可以大大简化这恼人的设定。





### 一键开启共享之自制工具

我猜当你设定共享时，一定遭遇过前面所提到的各种各样的麻烦事。

别慌，为此我专门做了几个小工具程序，目的就是为了减少不必要的麻烦，让小伙伴们安心做更多更有意义的事。



**网管小贾共享工具集下载**

* 整合程序：网管小贾的超便捷共享文件夹生成器
* 工具集（可分开使用）：
  * 服务端：[网管小贾]一键开启匿名共享文件夹
  * 服务端：[网管小贾]一键开启匿名共享打印机
  * 客户端：[网管小贾]共享客户端工具





https://learn.microsoft.com/zh-CN/troubleshoot/windows-server/networking/guest-access-in-smb2-is-disabled-by-default







### 写在最后

在早先 `9x/XP` 时代，开个共享文件夹是个超级简单的事儿，怎么现在就给整复杂了呢？





**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc