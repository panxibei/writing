共享文件夹

副标题：

英文：

关键字：





月明星稀，秘密基地某间秘室中，一块巨大的屏幕正徐徐升起。

屏幕发出亮光，一阵雪花过后，突然出现了一张阴鸷的脸。

“司令！没想到在这儿都能见到您！”，在坐的四位年轻人唰地站了起来，我就在其中......



“诸君请坐！”屏幕中人用着低沉的嗓音开始了今晚的秘密会议。

“诸君都是帝国的精英，也是最后一轮数百人筛选后本次秘密卧底行动主要负责人的预备人选。”

“今晚你们将角逐出唯一的一人，其他三人将被淘汰出局。”

“你们，准备好了吗？！”

“准备好了！”，我们四人几乎异口同声，紧张而又期待着。



考试的题目很简单，谁能够在最短时间内给一台普通电脑创建共享文件夹即为胜者。

我们几个互相看了一眼，都感觉这是不是在开玩笑，这么简单吗？

然而之后的事实却狠狠地打了我们几个人的脸！



### 共享服务工作正常吗

图d01



### 防火墙也会捣鬼

图d02





### 两种共享方式：匿名访客与经典用户



### 



### `SMB` 协议带来的限制

玩个共享怎么还和什么 `SMB` 协议搞上关系了呢？

是的，简单地说，所谓文件夹共享等都是通过 `SMB` 协议来建立连接并传输数据的。

就像我们打开网页使用的 `http` 协议一样，总归要有一个约定好的协议事情才好办成对吧。



然而这个 `SMB` 协议吧，它到目前为止居然有好几个版本，比如 `1.0` 、 `2.0` 还有 `3.0` ，不知道还有没有 `4.0` 。

为啥有这么多不同的版本呢？

原因很简单，老的协议有漏洞，它不安全啊，就像早期有的合同一样，并不能完美覆盖一些新生问题。

因此目前还在使用的版本是 `2.0` 和 `3.0` ，作为不安全的 `1.0` 已经被弃用了。



然而，又是然而，这个 `SMB 1.0` 虽然已弃用，但是它还是有点用的，至少一些老设备还是在这上面跑的，比如一些打印设备。

还有，以前对安全概念要求不严，很多人喜欢无限制（即不需要用户名和密码）的方式来访问共享，这种方式被称为 `来宾登录` ，也就是使用 `guest` 用户来登录。

这种来宾登录在使用时非常爽，想连啥就连啥，而且权限最大化，但是你懂的，危险系数也很大哦！

所以说，这种 `来宾登录` 方式虽然到了 `SMB 2.0` 还是支持的，但是默认情况下已经被禁用了。

请小伙伴们注意哦，这个限制是在客户端以及服务端两边都有。

因此如果确定服务端已经开启 `来宾登录` 功能，那么客户端同样也要打开这个功能才能真正使用到它。









### 麻烦的权限设定





### 一键开启共享之自制工具







http://blog.nsfocus.net/win10-2016ltsb/

《Win10网络共享故障排查表单》
http://scz.617.cn:8/windows/202110231342.txt

依次做如下检查与实验

(a) 检查445/TCP侦听中
(b) 检查Server服务启动中
(c) 检查Win10自带FW
(d) 检查”高级共享设置”
(e) 检查网络属性
(f) 检查SMB协议相关安全限制
(g) 开启共享目录
(h) 检查SMB会话
(i) 访问共享目录





https://learn.microsoft.com/zh-CN/troubleshoot/windows-server/networking/guest-access-in-smb2-is-disabled-by-default







写在最后







**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc