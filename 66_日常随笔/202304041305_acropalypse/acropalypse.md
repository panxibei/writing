acropalypse

副标题：

英文：

关键字：







比如，手头上有一个图片文件名为 `Original.png` 。

按照以下步骤复现漏洞。



1. 备份 `Original.png` 图片文件（这是个良好习惯）。
2. 使用截图工具打开 `Original.png` 图片文件。
3. 裁剪图片，使其比原始尺寸更小一些。
4. 覆盖保存图片到当前文件（可将其重命名为 `Modified.png` ），注意覆盖保存是关键。
5. 比较裁剪后保存的文件与原始文件的大小。



为重现漏洞，特意重新安装了旧版的截图工具。

我这儿有之前写的一个小工具，可用于卸载应用（文末下载）。

Windows内置应用安装卸载工具.7z



通过两个文件容量的对比，发现两者是一样大小的。

图c03



但两者的分辨率，也就是实际高度和宽度是不一样的。

图c04





我们直接来看看数据结束标记块 `IEND` ，它是用来标记图像数据到哪里为止。

标记 `PNG` 文件结束，一般用 `16` 进制表示为：

```
00 00 00 00 49 45 4E 44 AE 42 60 82
```

这个结束标记是固定的，也就是说，只要是 `png` 文件就是以这个来标记结尾的，具体的可以参考相关文档。



原始文件结尾标志在文件最后面。

图a03



而修改过的文件，它的结尾标志却在文件中间。

图a02



截图工具只是简单地将结尾标记放到了裁剪后有效内容的后面，结尾标记之后的部分却并没有删除而直接保留了下来。











命令行检测方法

`Windows` 平台这样做。

```
acropalypse_detect_64_windows.exe <文件夹/文件>
```

图b01

图c01



`Linux` 也差不多，这样做。

```
./acropalypse_detect_64_linux <文件夹/文件>
```

图c05

图c02











`Web` 版检测漏洞方法

```
https://lordofpipes.github.io/acropadetect/
```



图片文件 `Acropalypse` 漏洞检测程序

可以直接使用官方的链接，也可以使用我修正过的程序包，方便局域网内部署。

如果你是从官网下载的这个源码，可能会由于缺失部分脚本文件而无法正常工作，建议下载我提供的程序包（文末下载）。

图c06



一旦检测出问题图片就会给出警告提示。

图c07



在线恢复

```
https://acropalypse.app/
```

但是很遗憾，它并不能成功修复甚至识别有问题的图片文件。

图b02







**Windows内置应用安装卸载工具.7z(223K)**

**Acropalypse-Detection-Tool-Go单机检测工具.7z**

**acropadetect在线检测工具.7z(64.7K)**

下载链接：







**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc

