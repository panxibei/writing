走进科学系列之遭遇鬼打墙的OUTLOOK

副标题：走进科学系列之遭遇鬼打墙的OUTLOOK

英文：approaching-science-series-outlook-cannot-open-a-link

关键字：outlook,链接,邮箱,邮件,link,共享,file,kb5002427



正值春运，车站里熙熙攘攘、人头攒动。

鲍勃和约瑟夫正坐在候车室，等待检票。



“嗨！鲍勃！快来帮我看看，我的电脑出了点问题！”

“得了吧，马上就要检票上车了，你就不能歇一会儿，让我刷会儿手机？”

“我说老伙计，看在上帝的份上，就帮我瞧瞧吧！”



约瑟夫很不情愿地放下了手机，一边埋怨鲍勃一边转过脸来看着电脑屏幕。

“你瞧，老板给我发了紧急邮件，可我怎么也打不开邮件里的链接！快帮我瞧瞧！”

约瑟夫顺着鲍勃手指的方向看去，这才明白这位同伴为什么会发了疯似地喊他帮忙。



原来在OUTLOOK邮件正文中有一个共享链接，大概可能是这样的。

```
file://\\server\share\xxx
```

或者也可能干脆是这样的。

```
\\server\share\xxx
```



按照往常操作，直接点击这个共享链接就可以直接打开它。

可是这次变得不一样了，不但没有成功打开链接，反而在屏幕右下角的通知栏内弹出了警告提示。

图a01



“你确定你的电脑联网正常吗？”

鲍勃用力地点了点头：“网络当然没问题，并且我把这个链接复制下来，直接用文件管理器就能打开，偏偏在邮箱里就是不能直接打开！”

嗯？还有这种怪事！莫不是遇上鬼打墙了？！



约瑟夫就问鲍勃，早上是否吃了炸薯条，昨晚枕头是不是没放好，还是最近得罪了什么人。

鲍勃瞪了约瑟夫一眼：“我没有任何不好的地方，好吗？上帝正在看着你呢，老伙计，快动用你的聪明才智帮帮忙，我还急等着回复老板呢！”

约瑟夫耸了耸肩，将手一摊，他表示对于这种玄而又玄的诡事确实无能为力。

鲍勃叹了一口气，仰着头直言要是阿乐在就好了。

结果约瑟夫用力拍了一下鲍勃的肩膀：“中国有句古话，说曹操曹操到！”

鲍勃定睛一瞧，可不是嘛，不远处那拎着大包背着小包的正是好朋友阿乐！



这位阿乐是公司的IT工程师，他也奇怪为什么两位老外会出现在车站候车室。

打完招呼后，阿乐笑着问道：“你们……也回家过年？”

两人点头，约瑟夫则说：“我很奇怪，你们中国人为什么不知道哪一天过年。这么重要的日子，还要专门看日历，害得我差点晚买了一天的票。”

三个人说笑了一会儿，鲍勃赶紧拉住阿乐，让他帮忙解决眼前的棘手问题。

阿乐看过后，立马明白了问题所在，告诉两位外国伙计，这是由于 `OUTLOOK` 更新升级造成的。

之前有过查询确认，大概率是由于 `Outlook` 的编号为 `KB5002427` 的更新所致，影响时间很可能是从 `2023` 年 `7` 月 `11` 日开始的。

以下是官方社区参考文档的链接。



> https://support.microsoft.com/zh-cn/office/outlook-%E5%9C%A8%E5%AE%89%E8%A3%85-2023-%E5%B9%B4-7-%E6%9C%88-11-%E6%97%A5%E5%8F%91%E5%B8%83%E7%9A%84-microsoft-outlook-%E5%AE%89%E5%85%A8%E5%8A%9F%E8%83%BD%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E7%9A%84%E4%BF%9D%E6%8A%A4%E5%90%8E%E9%98%BB%E6%AD%A2%E6%89%93%E5%BC%80-fqdn-%E5%92%8C-ip-%E5%9C%B0%E5%9D%80%E8%B6%85%E9%93%BE%E6%8E%A5-4a5160b4-76d0-465b-9809-60837bbd35a8



基本上从那个时间点开始，一旦更新过后可能导致链接打不开，究其原因就是更新后系统的安全级别提升，不会像旧版时随便可以打开链接了。

系统更新是非常普遍的事，因此遇到此类问题的人很多，不过官方似乎并没有在后续的更新中将这一漏洞给补上。

然而取而代之的是官方用了一个比较山寨的办法来变相规避这个问题。

这个方法就是将链接的域名或IP简单地添加到受信任站点。



比如，通过控制面板中的 `Internet 选项` 手动添加受信任站点的方式。

按图示依次找到 `控制面板` > `网络和Internet` > `Internet 选项` 。

图b01

图b02



接着点选 `受信任的站点` ，再点击 `站点(S)` 按钮。

图b03



在 `将该网站添加到区域(D)` 下方的文本框内输入想要添加的网址或IP地址，再点击 `添加(A)` 。

网站网址只要输入域名部分就可以了，不需要把整个链接都输进去。

比如这个链接：

```
https://www.sysadm.cc/index.php/richangsuibi/909-buy-me-a-coffee-if-you-find-my-contents-helpful
```

其实只要输入前面的域名就行。

```
https://www.sysadm.cc
```

对于前面说的共享链接，也可以直接输入域名而不带前面的协议前缀部分。

```
file:///\\server
file://server
server
```



此外如果网址的前缀是 `https` 而非 `http` ，则需要勾选下面的 `对该区域中的所有站点要求服务器验证(https:)(S)` 一项。

图b04



当然输入时不仅仅是这么简单，还有很多需要注意的格式限制，特别是通配符（星号 `*` ）的使用。

虽然通配符使用起来更加灵活，但也不是那么随便的。

图b05



还有一种方法是修改 `GPO` 组策略。

组策略设定项可以按图示依次找到， `计算机配置` > `管理模板` > `Windows 组件` > `Internet Explorer` > `Internet 控制面板` > `安全页` > `站点到区域分配列表` 。

图a03



在策略设置界面中点选 `已启用` ，再点击 `显示...` 按钮。

图a04



然后在显示内容中填写需要的值。

图a05



注意哈，遗憾的是，组策略区域管理接口并不提供输入值的输入验证。

如果不符合输入格式，那么最终导致无效肯定是毋庸置疑的。



实际上 `GPO` 是通过修改注册表来实现管理可信任站点的。

如果对象是域名，则走的是以下注册表项 `Domains` 。

```
Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\contoso.com
```



如果对象是IP地址，则换成了另一个注册表项 `Ranges` 。

```
Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Ranges\Range1
```



其中域名还分根域名和子域名，有兴趣的小伙伴可以研究研究。

既要区分域名和IP地址，还要区分根域名和子域名，还要区分不同的访问协议（ `http/https/*` ），总之非常麻烦繁琐。

我根据些原理尝试做了一个可以批量添加受信任站点的小程序。

图c01



使用起来非常简单，只需在左侧框内输入需要添加信任的网址或IP地址，然后点击 `[A]添加站点` 即可。

移除站点也很方便，从右侧选择想要删除的站点（可多选），再点击 `[R]移除站点` 即可。

如果格式不正确是无法成功添加的，避免了因格式错误而导致无效的尴尬。

另外在 `Internet 选项` 中也只能是单项操作（添加/删除），这款程序权当便利工具使用。

当然，程序可能还是有 `BUG` 的，不过至少再也不用繁琐地寻找 `Internet 选项` ，再一个一个地操作了。



最后说一下效果。

在将目标域名或IP地址添加到受信任站点后，我们再点击 `Outlook` 邮件中的链接，它会弹出一个警告提示。

图a02



在旧版中是直接打开链接没有警告提示，现在虽然不报错了，但还是有一个警告提示，估计也是出于安全考虑吧。

给用户一些思考的时间，只要点击 `是(Y)` 便可继续打开链接，当然点击 `否(N)` 那就当什么事都没有发生过，也就不会有什么安全风险了。







**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc

