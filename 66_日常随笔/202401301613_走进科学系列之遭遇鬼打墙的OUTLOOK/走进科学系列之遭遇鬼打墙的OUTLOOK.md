走进科学系列之遭遇鬼打墙的OUTLOOK

副标题：走进科学系列之遭遇鬼打墙的OUTLOOK

英文：approaching-science-series-outlook-cannot-open-a-link

关键字：outlook,链接,邮箱,邮件,link,共享,file,kb5002427



正值春运，车站里熙熙攘攘、人头攒动。

鲍勃和约瑟夫正在候车室，等待检票。



“嗨！约瑟夫！快来看看，我的电脑出问题了！”

“得了吧，马上就要检票上车了，你就不能歇一会儿吗，让我好好刷会儿手机？”

“我说老伙计，看在上帝的份上，就一会儿，帮我瞧瞧吧！”



约瑟夫慢慢放下手机，一边埋怨鲍勃一边很不情愿地转过脸来。

“你瞧，老板给我发了紧急邮件，可我怎么也打不开邮件里的链接！”

约瑟夫顺着鲍勃手指的方向看去，这才明白他为什么会如此紧张而急促。



原来在 `OUTLOOK` 邮件正文中附有一个共享文件夹的链接，大概是这样的。

```
file://\\server\share\xxx
```

或者干脆前面部分没有，也可能是这样的。

```
\\server\share\xxx
```



按照往常操作，直接点击这个共享链接就可以打开它。

可是这次变得不太一样了，非但没能成功打开这个链接，反而在屏幕右下角的通知栏内弹出了警告提示。

图01



“你确定你的电脑联网正常吗？”

鲍勃用力地点了点头：“当然，网络肯定没问题，并且我把这个链接复制下来，直接用文件管理器就能打开，可偏偏在邮箱里就是不能直接点击打开！”

嗯？还有这种怪事！

莫不是遇上鬼打墙了？！



约瑟夫就问鲍勃，早上是否吃了炸薯条，昨晚枕头是不是没放好，还是最近得罪了什么人。

鲍勃瞪着约瑟夫：“我的天啊，别开玩笑了！上帝正在看着你呢，老伙计，快动用你的聪明才智帮帮我，我还急等着回复老板呢！”

约瑟夫耸了耸肩，将手一摊，表示对于这种玄而又玄的诡事确实无能为力。

鲍勃叹了一口气，仰着头直言要是阿乐在就好了。

结果约瑟夫用力拍了一下鲍勃的肩膀：“嘿，伙计，中国有句什么古话来着？说曹操曹操到！”

鲍勃定睛一瞧，可不是嘛，不远处那拎着大包背着小包的正是好友加同事阿乐！



这位阿乐正是两人所在公司的IT工程师，平日一头中分打扮，喜欢留个个性小黑胡，人年轻精神肯干、乐于助人。

平时有不少人经常找他处理电脑问题，他都是尽心全力帮忙，人缘不错。

他听有人招呼，也觉得挺神奇，为啥这么巧碰上两位老外出现在车站候车室。

见面各自打了招呼后，阿乐笑着问道：“你们……也回家过年？”

二人点头称是，约瑟夫则说：“我很奇怪，你们中国人为什么不知道哪一天过年。这么重要的日子，还要专门看日历，害得我差点晚买了一天的票。”

三个人说笑了一会儿，鲍勃赶紧拉住阿乐，让他帮忙解决刚才那棘手的问题。

阿乐看过后，立马明白了问题所在，他告诉两位外国伙计，这是由于 `OUTLOOK` 更新升级造成的。

之前有过调查确认，大概率是由于 `Outlook` 的编号为 `KB5002427` 的更新所致，影响时间很可能是从 `2023` 年 `7` 月 `11` 日开始的。

以下是有关这个问题官方社区曾讨论的参考文档链接。



> https://support.microsoft.com/zh-cn/office/outlook-%E5%9C%A8%E5%AE%89%E8%A3%85-2023-%E5%B9%B4-7-%E6%9C%88-11-%E6%97%A5%E5%8F%91%E5%B8%83%E7%9A%84-microsoft-outlook-%E5%AE%89%E5%85%A8%E5%8A%9F%E8%83%BD%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E7%9A%84%E4%BF%9D%E6%8A%A4%E5%90%8E%E9%98%BB%E6%AD%A2%E6%89%93%E5%BC%80-fqdn-%E5%92%8C-ip-%E5%9C%B0%E5%9D%80%E8%B6%85%E9%93%BE%E6%8E%A5-4a5160b4-76d0-465b-9809-60837bbd35a8



基本上从那个时间点开始，一旦更新过后可能导致链接打不开，究其原因就是更新后系统的安全级别提升，不会像旧版那样随便可以打开链接了。

系统更新是非常普遍的事，因此遇到此类问题的人很多，不过官方似乎并没有在后续的更新中将这一漏洞给补上。

然而取而代之的是官方用了一个比较山寨的办法来变相规避这个问题。

这个办法就是将链接的域名或IP简单地添加到受信任站点。



比如，通过控制面板中的 `Internet 选项` 手动添加受信任站点的方式。

按图示依次找到 `控制面板` > `网络和Internet` > `Internet 选项` 。

图02

图03



接着点选 `受信任的站点` ，再点击 `站点(S)` 按钮。

图04



在 `将该网站添加到区域(D)` 下方的文本框内输入想要添加的网址或IP地址，再点击 `添加(A)` 。

网站网址只要输入域名部分就可以了，不需要把整个链接都输进去。

比如这个链接：

```
https://www.sysadm.cc/index.php/richangsuibi/909-buy-me-a-coffee-if-you-find-my-contents-helpful
```

其实只要输入前面的域名就行。

```
https://www.sysadm.cc
```

对于前面说的共享链接，也可以直接输入域名而不带前面的协议前缀部分。

```
file:///\\server
file://server
server
```



此外如果网址的前缀是 `https` 而非 `http` ，则需要勾选下面的 `对该区域中的所有站点要求服务器验证(https:)(S)` 一项。

图05



当然输入时不仅仅是这么简单，还有很多需要注意的格式限制，特别是通配符（星号 `*` ）的使用。

虽然通配符使用起来更加灵活，但也不是那么随便的。

图06



还有一种方法是修改 `GPO` 组策略。

组策略设定项可以按图示依次找到， `计算机配置` > `管理模板` > `Windows 组件` > `Internet Explorer` > `Internet 控制面板` > `安全页` > `站点到区域分配列表` 。

图07



在策略设置界面中点选 `已启用` ，再点击 `显示...` 按钮。

图08



然后在显示内容中填写需要的值。

图09



注意哈，遗憾的是，组策略区域管理接口并不提供输入值的输入验证。

如果不符合输入格式，那么最终导致无效肯定是毋庸置疑的。



实际上 `GPO` 是通过修改注册表来实现管理可信任站点的。

如果对象是域名，则走的是以下注册表项 `Domains` 。

```
Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Domains\contoso.com
```



如果对象是IP地址，则换成了另一个注册表项 `Ranges` 。

```
Computer\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ZoneMap\Ranges\Range1
```



其中域名还分根域名和子域名，有兴趣不怕绕的小伙伴可以研究研究。

既要区分域名和IP地址，还要区分根域名和子域名，还要区分不同的访问协议（ `http/https/*` ），总之非常麻烦繁琐。

我根据此原理尝试做了一个可以批量添加受信任站点的小程序。

图10



使用起来非常简单，只需在左侧框内输入需要添加信任的网址域名或IP地址，然后点击 `[A]添加站点` 即可。

移除站点也很方便，从右侧选择想要删除的站点（可多选），再点击 `[R]移除站点` 即可。

如果格式不正确是无法成功添加的，避免了因格式错误而导致无效的尴尬。

另外在 `Internet 选项` 中也只能是单项操作（添加/删除），这款程序权当便利工具使用。

当然，程序可能还是有 `BUG` 的，不过至少再也不用繁琐地寻找 `Internet 选项` ，再一个一个地添加或删除操作了。



**网管小贾的批量添加受信任站点方便程序**

下载链接：https://www.123pan.com/s/bI7Mjv-b2AH3.html

提取码：T9PY



最后按阿乐说的，鲍勃如是操作了一番。

在将 `OUTLOOK` 邮件中的链接域名添加到受信任站点后，他再次点击链接，发现它会弹出一个警告提示。

图11



阿乐解释，在未更新前的旧版中是直接打开链接没有警告提示，而现在虽然不报错了，但还是有一个警告提示，估计也是出于安全考虑吧。

给用户一些思考的时间，只要点击 `是(Y)` 便可继续打开链接，当然点击 `否(N)` 那就当什么事都没有发生过，也就不会有什么安全风险了。

鲍勃尝试点击了 `是(Y)` ，果然链接成功打开了，老板需要的文件资料都看得到了。



“非常感谢，阿乐！”鲍勃向阿乐致谢，脸上写着一个大大的佩服。

约瑟夫却在一旁调侃道：“我说伙计，要是老板敢把你给裁了，那可真是裁到了大动脉！”

阿乐憨厚地笑了笑：“我曾经一直梦见自己是学美术专业的，然而现实却阴差阳错地从事了计算机专业的工作，我就是一个普通工程师，哪算得上什么大动脉啊！”

不知怎么，阿乐与他们告别的时候，鲍勃和约瑟夫不约而同地站起身来，默默地目送他消失在人群中……



**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc

