Putty用户手册

副标题：

英文：

关键字：



> https://the.earth.li/~sgtatham/putty/0.78/htmldoc/





# `PuTTY` 用户手册

`PuTTY` 是一款免费的（ `MIT` 许可） `Telnet` 及 `SSH` 客户端软件。

本手册记录了 `PuTTY` 及其配套实用程序 `PSCP` ， `PSFTP` ， `Plink` ， `Pageant` 和 `PuTTYgen` 的相关内容。



*`Unix`用户注意：*本手册目前主要记录了 `Windows` 版本的 `PuTTY` 实用程序，因此提到了 `Unix` 版本中没有的一些选项。

`Unix` 版本具有此处未描述的功能，并且也未描述其相关的命令行和实用程序。

目前唯一存在的特定于 `Unix` 的文档是 `man` 手册页。



本手册版权为 `1997-2022 Simon Tatham`，保留所有权利。

您可以在 `MIT` 许可下分发本文档，许可证全文见[附录D](AppendixD.html#licence)。



- 第 1 章 `PuTTY` 简介
  - 1.1 什么是 `SSH` ， `Telnet` ， `Rlogin` 和 `SUPDUP` ？
  - 1.2 `SSH` 、`Telnet` 、`Rlogin` 和 `SUPDUP` 有何不同？
- 第 2 章：`PuTTY` 入门
  - 2.1 启动一个会话
  - 2.2 验证主机密钥（仅限 `SSH` ）
  - 2.3 登录
  - 2.4 登录之后
  - 2.5 注销
- 第 3 章：使用 `PuTTY`
  - 3.1 会话期间
  - 3.2 创建会话的日志文件
  - 3.3 更改字符集配置
  - 3.4 在 `SSH` 中使用 `X11` 转发
  - 3.5 在 `SSH` 中使用端口转发
  - 3.6 连接到本地串行线路
  - 3.7 建立原生 `TCP` 连接
  - 3.8 使用 `Telnet` 协议进行连接
  - 3.9 使用 `Rlogin` 协议进行连接
  - 3.10 使用 `SUPDUP` 协议进行连接
  - 3.11 `PuTTY` 命令行
- 第 4 章：配置 `PuTTY`
  - 4.1 会话面板
  - 4.2 日志记录面板
  - 4.3 终端面板
  - 4.4 键盘面板
  - 4.5 响铃面板
  - 4.6 特性面板
  - 4.7 窗口面板
  - 4.8 外观面板
  - 4.9 行为面板
  - 4.10 转换面板
  - 4.11 选择面板
  - 4.12 复制面板
  - 4.13 颜色面板
  - 4.14 连接面板
  - 4.15 数据面板
  - 4.16 代理面板
  - 4.17 `SSH` 面板
  - 4.18 密钥面板
  - 4.19 主机密钥面板
  - 4.20 加密面板
  - 4.21 认证面板
  - 4.22 凭据面板
  - 4.23 `GSSAPI` 面板
  - 4.24 `TTY` 面板
  - 4.25 `X11` 面板
  - 4.26 通道面板
  - 4.27 查错和更多查错面板
  - 4.28 `裸ssh连接` 协议
  - 4.29 串口面板
  - 4.30 `Telnet` 面板
  - 4.31 `Rlogin` 面板
  - 4.32 `SUPDUP` 面板
  - 4.33 将配置存储在文件中
- 第 5 章：使用 PSCP 安全地传输文件
  - [5.1 启动 PSCP](Chapter5.html#pscp-starting)
  - [5.2 PSCP 的使用](Chapter5.html#pscp-usage)
- 第 6 章：使用 `PSFTP` 安全地传输文件
  - 6.1 启动 `PSFTP`
  - 6.2 运行 `PSFTP`
  - 6.3 通过 `PSFTP` 使用公钥身份验证
- 第 7 章：使用命令行连接工具 `Plink`
  - 7.1 启动 `Plink`
  - 7.2 使用 `Plink`
  - 7.3 在批处理文件和脚本中使用 `Plink`
  - 7.4 将 `CVS` 与 `Plink` 结合使用
  - 7.5 将 `Plink` 与 `WinCVS` 结合使用
- 第 8 章：使用公钥进行 `SSH` 身份验证
  - 8.1 公钥认证 - 简介
  - 8.2 使用 `PuTTYgen` - `PuTTY` 密钥生成器
  - 8.3 准备公钥认证
- 第 9 章：使用 `Pageant` 进行身份验证
  - 9.1 `Pageant` 入门
  - 9.2 `Pageant`  主窗口
  - 9.3 `Pageant`  命令行
  - 9.4 使用代理转发
  - 9.5 不解密加载密钥
  - 9.6 安全注意事项
- 第 10 章：常见错误消息
  - 10.1 未为此服务器缓存主机密钥
  - 10.2 警告 - 潜在的安全漏洞！
  - 10.3 此服务器提供了由其他证书颁发机构签名的认证主机密钥......
  - 10.4 我们的配置需要 `SSH` 协议版本 `2` ，但远程仅提供了（旧的、不安全的）`SSH-1`
  - 10.5 服务器支持的第一个密码是...低于配置的警告阈值
  - 10.6 远程端发送断开连接消息类型 `2`（协议错误）：”`root` 身份验证失败次数过多“
  - 10.7 内存不足
  - 10.8 内部错误、内部故障、断言失败
  - 10.9 无法使用密钥文件、无法加载私钥、无法加载此密钥
  - 10.10 服务器拒绝了我们的密钥、服务器拒绝了我们的公钥、密钥被拒绝
  - 10.11 “访问被拒绝、身份验证被拒绝”
  - 10.12 “没有可用的身份验证方法”
  - 10.13 “数据包上收到的MAC不正确”或“数据包上收到的 `CRC` 不正确”
  - 10.14 “传入数据包在解密时出现乱码”
  - 10.15 “`PuTTY X11` 代理：*各种错误*”
  - 10.16 “网络错误：软件导致连接中止”
  - 10.17 “网络错误：对等方重置连接”
  - 10.18 “网络错误：连接被拒绝”
  - 10.19 “网络错误：连接超时”
  - 10.20 “网络错误：无法分配请求的地址”
- 附录 A：`PuTTY` 常见问题解答
  - A.1 引言
  - A.2 `PuTTY` 支持的功能
  - A.3 移植到其他操作系统
  - A.4 在其他程序中嵌入 `PuTTY`
  - A.5 `PuTTY` 的运营细节
  - A.6 操作方法问题
  - A.7 故障排除
  - A.8 安全问题
  - A.9 行政问题
  - A.10 杂项问题
- 附录 B：反馈和错误报告
  - B.1 一般准则
  - B.2 报告错误
  - B.3 报告安全漏洞
  - B.4 请求额外功能
  - B.5 请求已请求的功能
  - B.6 支持请求
  - B.7 网络服务器管理
  - B.8 请求许可
  - B.9 镜像 `PuTTY` 网站
  - B.10 赞美和赞美
  - B.11 电子邮件地址
- 附录C：`PPK` 文件格式
  - C.1 概述
  - C.2 外层
  - C.3 私钥编码
  - C.4 密钥派生
  - C.5 旧版本的 `PPK` 格式
- 附录 D：`PUTTY` 许可证
- 附录E：`PuTTY` 黑客指南
  - E.1 跨操作系统可移植性
  - E.2 多个后端同等对待
  - E.3 某些平台上每个进程多个会话
  - E.4 `C` ，不是 `C++`
  - E.5 安全意识编码
  - E.6 特定编译器的独立性
  - E.7 小代码尺寸
  - E.8 单线程代码
  - E.9 尽可能发送到服务器的击键
  - E.10 `640×480` 配置面板的友好性
  - E.11 协议代码中的协程
  - E.12 实现特征的显式 `vtable` 结构
  - E.13 照我们说的做，而不是照我们做的做
- 附录 F：`PuTTY` 下载密钥和签名
  - F.1 公钥
  - F.2 安全细节
  - F.3 密钥翻转
- 附录 G：为 `PuTTY` 指定的 `SSH-2` 名称
  - G.1 连接协议通道请求名称
  - G.2 密钥交换方法名称
  - G.3 加密算法名称
  - G.4 代理扩展请求名称
- 附录H：`PuTTY` 认证插件协议
  - H.1 要求
  - H.2 运输和配置
  - H.3 数据格式和编组
  - H.4 协议版本控制
  - H.5 事件概述和顺序
  - H.6 消息格式
  - H.7 参考文献
- Index





# 第1章 `PuTTY` 简介

`PuTTY` 是一个免费的 `SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` 客户端，用于 `Windows` 系统。

## 1.1 什么是 `SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` ？

如果您已经知道什么是 `SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` ，则可以安全地跳到下一部分。

`SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` 是执行相同操作的四种方法：通过网络从另一台计算机登录到多用户计算机。

多用户操作系统，通常是 `Unix` 系列（如 `Linux` ，`MacOS` 和 `BSD` 系列），通常向用户提供命令行界面，非常类似于 `Windows` 中的“命令提示符”或“MS-DOS提示符”。

系统将显示一个提示，您就可以键入系统将遵循的命令。



使用这种类型的界面，您无需坐在键入命令的同一台计算机面前。

命令和响应可以通过网络传送，因此您可以坐在一台计算机上，向另一台甚至多台计算机发出命令。



`SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` 是允许您执行此操作的网络协议。

在您所在的计算机上，运行一个客户端，该客户端将与其他计算机（服务器）建立网络连接。

此网络连接会将您的铵键和命令从客户端传送到服务器，并将服务器的响应传输回给您。



这些协议还可用于其他类型的基于键盘的交互式会话。

特别是有很多公告板、交谈系统和 `MUDs`（多用户泥巴游戏）等等支持使用 `Telnet` 进行访问。

甚至有一些还支持 `SSH` 。



如下情况，您可能希望用到 `SSH` 、`Telnet` 、`Rlogin` 或 `SUPDUP` ：

- 您在 `Unix` 系统（或其他一些多用户操作系统，如 `VMS` 或 `ITS` ）上有一个帐户，您希望能够从其他地方访问该帐户。

- 您的互联网服务提供商为您提供网络服务器上的登录帐户。

  （这也可能称为 `shell` 帐户，`shell`  是指在服务器上运行并为您解释命令的程序。

- 您想通过使用 `Telnet` 来访问的公告板系统，交谈系统或 `MUD` 。



如下情况，您可能**不想**使用 `SSH` 、`Telnet` 、`Rlogin` 或 `SUPDUP` ：

- 你只使用 `Windows` ，`Windows` 计算机之间有自己的网络方式，除非您正在做一些相当不寻常的事情，否则您将不需要使用这些远程登录协议中的任何一种。



## 1.2 `SSH` 、`Telnet` 、`Rlogin` 和 `SUPDUP` 有何不同？

此列表总结了 `SSH` ，`Telnet` ，`Rlogin` 和 `SUPDUP` 之间的一些差异。

- `SSH`（代表“安全外壳” `secure shell` ）是最近设计的一个高安全性协议。

  它使用强大的加密技术来保护您的连接免受窃听、劫持和其他攻击。

  `Telnet` ，`Rlogin` 和 `SUPDUP` 均仅提供最低安全性的旧协议。

- `SSH` 和 `Rlogin` 都允许您无需键入密码即可登录到服务器。

  （ `Rlogin` 执行此操作的方法不安全，并可能允许攻击者访问您在服务器上的帐户。

  `SSH` 的方法要安全得多，通常破坏安全性需要攻击者获得对实际客户端计算机的访问权限。）

- `SSH` 允许您连接到服务器并自动发送命令，以便服务器运行该命令然后断开连接。

  因此，您可以在自动化处理中使用它。



互联网是一个充满敌意的环境，安全是每个人的责任。

如果您通过开放的互联网进行连接，那么我们建议您使用 `SSH` 。

如果要连接的服务器不支持 `SSH` ， 那么尝试说服管理员安装它可能是值得的 。

如果您的客户端和服务器都在同一个（状态良好）防火墙后面，则使用 `Telnet` 、`Rlogin` 或 `SUPDUP` 有可能是安全的，但我们仍然建议您使用 `SSH` 。





# 第 2 章：`PuTTY` 入门

本章提供了使用 `PuTTY` 最简单类型的交互式登录会话的快速指南。

## 2.1 启动会话

启动 `PuTTY` 时，您将看到一个对话框，此对话框允许您控制 `PuTTY` 可以执行的所有操作。

请参阅[第 4 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config)，了解您可以控制的所有事物的详细信息。



通常不需要更改大多数配置选项。

要启动最简单的会话，您需要做的就是输入一些基本参数。

在“***主机名称（或 `IP` 地址）***”框中，输入要连接到的服务器的因特网主机名，您的登录帐户提供商应该已经告诉您这一点。

图a01



现在，从“***连接类型***”控件中选择要使用的登录协议。

对于登录会话，您应该选择 `SSH` 、`Telnet` 、`Rlogin` 或 `SUPDUP` 。

图a02



有关这些协议之间差异的描述，以及有关使用哪一种协议的建议，请参阅[第 1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter1.html#which-one)。

原始协议不用于交互式登录会话，您通常会使用它来调试其他 `Internet` 服务（请参阅[第 3.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-rawprot)）。

串口选项用于连接到本地串口线路，其工作原理略有不同：有关此内容的更多信息，请参见第 [3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-serial)。



更改所选协议时，“***端口***”框中的数字将更改。

这是正常的：发生这种情况是因为服务器通常在不同的网络端口上提供各种登录服务。

大多数服务器将使用标准端口号，因此您无需更改端口设置。

如果您的服务器在非标准端口上提供登录服务，则系统管理员应该告诉您是哪一个。

例如，许多 `MUD` 在 `23` 端口以外的端口上运行 `Telnet` 服务。

填写“主机名称”、“连接类型”以及可能的“端口”设置后，即可进行连接。

按对话框底部的“***打开***”按钮，`PuTTY` 将开始尝试连接到服务器。



## 2.2 验证主机密钥（仅限 `SSH` ）

如果不使用 `SSH` 协议，则可以跳过此部分。

如果您是第一次使用 `SSH` 连接到服务器，您可能会看到如下所示的消息：

```
The host key is not cached for this server:
 ssh.example.com (port 22)
You have no guarantee that the server is the computer you think it is.
The server's ssh-ed25519 key fingerprint is:
 ssh-ed25519 255 SHA256:TddlQk20DVs4LRcAsIfDN9pInKpY06D+h4kSHwWAj4w
If you trust this host, press "Accept" to add the key to PuTTY's
cache and carry on connecting.
If you want to carry on connecting just once, without adding the key
to the cache, press "Connect Once".
If you do not trust this host, press "Cancel" to abandon the connection.
```



图a03



这是 `SSH` 协议的一项功能，它旨在保护您免受称为***欺骗***（ `spoofing` ）的网络攻击。

欺骗网络攻击会秘密地将您的连接重定向到另一台计算机，以便误导您将密码发送到错误的计算机。

使用此技术，攻击者将能够获取到您登录帐户的密码，之后就可以像您一样登录系统并将该帐户用于自己的非法目的。



为了防止这种攻击，每个服务器都有一个唯一的标识代码，称为***主机密钥***。

这些密钥的创建方式可防止一台服务器伪造另一台服务器的密钥。

因此，如果您连接到服务器并且它向您发送了与您期望的主机密钥不同的主机密钥，`PuTTY` 可以警告您服务器可能已被切换，并且可能正在进行欺骗攻击。





`PuTTY` 在 `Windows` 注册表中记录您连接到的每个服务器的主机密钥。

每次连接到服务器时，它都会检查服务器提供的主机密钥是否与上次连接时的主机密钥相同。

图a05



如果不是，您将看到更强烈的警告，并且您将有机会在输入任何私人信息（例如密码）之前放弃连接。（请参阅[第 10.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter10.html#errors-hostkey-wrong)以了解其外观。

图a04



但是，当您连接到以前未连接的服务器时，`PuTTY` 无法判断主机密钥是否正确。

因此，它会给出上面显示的警告，并询问您是否要信任此主机密钥。



是否信任主机密钥取决于您的选择。

如果在公司网络中进行连接，您可能会觉得所有网络用户都在同一端，并且不太可能发生欺骗攻击，因此您可以选择不检查而信任密钥。

如果您通过恶意网络（如 `Internet` ）进行连接，则应通过电话或亲自与系统管理员联系。

（验证指纹时，请注意可能相互混淆的字母和数字：比如 `0` 和 `O` 、`1` 和 `I` 和 `l` 等等。）



许多服务器具有多个主机密钥。

如果系统管理员向您发送多个指纹，则应确保 `PuTTY` 显示的指纹在列表中，但哪一个并不重要。



如果您没有任何看起来像示例的指纹（ `SHA256:` 后跟一长串字符），而是有成对的字符，用冒号分隔，例如 `a4:db:96:a7:...`，那么请尝试按“**更多信息...**”按钮，看看您是否有与“MD5指纹”匹配的指纹。

图a06



这是汇总相同基础主机密钥的较旧且安全性较低的方法。

攻击者可以使用相同的指纹创建自己的主机密钥。

因此，除非您别无选择，否则您应该避免依赖这种指纹格式。

“**更多信息...**”对话框还显示完整的主机公钥，相较而言这个比指纹更容易对比。



有关管理主机密钥的高级选项，请参见[第 4.19 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-hostkey)。



## 2.3 登录

连接并验证服务器的主机密钥后，系统将要求您登录，可能需要使用到用户名和密码。

您的系统管理员应该为您提供这些。

（相反，如果您的系统管理员要求您提供或向您提供“公钥”或“密钥文件”，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。）



`PuTTY` 将显示一个文本窗口（“终端窗口” – 除非您更改了默认值，否则它将具有黑色背景），并提示您在该窗口中输入用户名和密码。

（这些提示将包括 `PuTTY` 图标，以将它们与服务器在同一窗口中发送的任何文本区分开来。)



输入用户名和密码，服务器应授予您访问权限并开始会话。

如果您输入了错误的密码，大多数服务器会给您几次正确输入密码的机会。



当您键入密码时，您通常不会看到光标在窗口中移动，但 `PuTTY` *正在*注册您键入的内容，并在您按回车时发送它。

（它的工作原理是避免向观看屏幕的任何人透露密码的长度。）



如果您使用的是 `SSH` ，请注意不要输入错误的用户名，因为按回车键后您将没有机会更正它。

许多 `SSH` 服务器不允许您使用不同的用户名进行两次登录尝试。

如果您输入了错误的用户名，则必须关闭 `PuTTY` 并重新开始。



如果您的密码被拒绝，但您确定键入正确，请检查是否未启用字母大小写键 `Caps Lock` 。

许多登录服务器，尤其是 `Unix` 计算机，在检查密码时将大写和小写视为不同，因此，如果 `Caps Lock` 处于打开状态，您的密码可能会被拒绝。



## 2.4 登录后

登录服务器后，接下来会发生什么取决于服务器！

大多数服务器将打印某种登录消息，然后显示提示，您可以在其中键入服务器将执行的命令。

一些服务器将为您提供在线帮助，其他服务器可能不会。

如果您对下一步操作有疑问，请咨询您的系统管理员。



## 2.5 注销

完成会话后，应通过键入服务器自己的注销命令来注销。

这可能因服务器而异，如有疑问，请尝试 `logout` 或 `exit` ，或咨询手册或系统管理员。

当服务器处理注销命令时，`PuTTY` 窗口应自动关闭。



您可以使用窗口边框中的“关闭”按钮关闭 `PuTTY` 会话，但这可能会使服务器感到困惑 - 有点像在对话过程中意外挂断电话。

我们建议您不要这样做，除非服务器已停止响应您，并且您无法以任何其他方式关闭窗口。







# 第 3 章：使用 `PuTTY`

本章对 `PuTTY` 一些更高级的功能进行了一般性介绍。

如出于极端细节的参考目的，[第4章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config)可能包含更多信息。



## 3.1 会话期间

`PuTTY` 的许多复杂特性和功能都在配置面板中体现。

一旦你按照自己的方式开启了一个会话，之后的事情应该相当简单。

不过，还有一些更有用的功能可以利用。



### 3.1.1 复制和粘贴文本

通常在 `PuTTY` 会话中，您会在终端屏幕上找到要再次输入的文本。

与大多数其他终端模拟器一样，`PuTTY` 允许您复制和粘贴文本，而不必反复键入。

此外，复制和粘贴使用 `Windows` 剪贴板，以便您可以将 `URL` 粘贴（例如）到 `Web` 浏览器中，或者从文字处理器或电子表格粘贴到终端会话中。

默认情况下，`PuTTY` 的复制和粘贴完全可以通过鼠标来操作。

（对于有过使用 `Unix` 经验的人来说，这并不陌生。

为了将文本复制到剪贴板，您只需在终端窗口中单击鼠标左键，然后拖动并选择文本。

松开按键时，文本会***自动复制***到剪贴板，您并不需要按 `Ctrl-C` 或 `Ctrl-Ins` 。

事实上，如果您确实按下了 `Ctrl-C` ，`PuTTY` 会在您的会话中将一个 `Ctrl-C` 字符发送到服务器，这可能会导致进程中断。（译者按：`Ctrl-C` 通常被视作中断指令。）



粘贴操作 `PuTTY` 是使用右键完成的（或鼠标中键，如果您有三键鼠标并已设置它;请参阅[第 4.11.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-mouse)）。

（按下 `Shift-Ins` ，或按下 `Ctrl` 加右键，再单击上下文菜单中选择“粘贴”，都具有相同的效果。）

当您单击鼠标右键时，`PuTTY` 将读取 `Windows` 剪贴板中的任意内容并将其粘贴到您的会话中。

默认情况下，其行为与在键盘上键入剪贴板内容的行为*完全相同*。

因此，请注意将格式化文本粘贴到执行自动缩进的编辑器中，因为您可能会发现从剪贴板粘贴的空格，加上编辑器添加的空格，加起来太多的空格会破坏格式设置。

（某些远程应用程序可以要求 `PuTTY` 识别正在粘贴的文本，以避免此类问题，但如果应用程序不这样做，则 `PuTTY` 无法避免这种情况。）



如果双击鼠标左键，`PuTTY` 将选择整个单词。

如果双击，并按住第二次单击同时拖动鼠标，`PuTTY` 将选择整个单词序列。

（您可以精确调整 PuTTY 认为是单词一部分的内容;请参阅[第 4.12.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-charclasses)。）

（译者按：如何理解双击并拖动鼠标的操作呢？

其实与单击对比我们就可以明白，单击拖动是一个字母一个字母地选择，而双击拖动则是一个单词一个单词地选择。）

如果单击*三次*或单击三次并拖动，则 `PuTTY` 将选择整行或行序列。



点击鼠标左键并拖动效果。

图b18



双击鼠标左键并拖动效果。

图b19



三击鼠标左键效果。

图b20



如果要选择矩形区域而不是包含每行末尾的多行选择，则可以通过在进行选择时先按住 `Alt` 来执行此操作。

您还可以将矩形选择配置为默认值，然后按住 `Alt` 将改为原来正常的操作行为：有关详细信息，请参见[第 4.11.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-rectselect)。



（在某些 `Unix` 环境中，`Alt` 加拖动的操作会被窗口管理器截获。

`Shift+Alt+拖动` 也应该适用于矩形选择，所以你可以尝试一下到底哪个可用。）



如果您有鼠标中键，则可以在选择微小错误的内容后使用它来调整现有选择。

（如果已将鼠标中键配置为粘贴，则鼠标右键将执行此操作。）

在屏幕按下中键，您可以调整被选择内容的最近（左右）一侧，并将其拖动到合适正确的地方。

（译者按：这里需要再次解释一下，意思是，先用鼠标左键选取一段或一个区域的内容，如果你感觉选取的范围有误，那么可以接着按下中键再次调整。

中键按下后，距离选取内容范围的两边，较近的一侧就会先被调整。）



如果您在 `Unix` 上运行 `PuTTY` 本身（而不仅仅是使用它从 `Windows` 连接到 `Unix` 系统），默认情况下，您可能必须在其他应用程序中使用类似的鼠标操作来粘贴您从 `PuTTY` 复制的文本，并复制文本以粘贴到 `PuTTY` 中。

像 `Ctrl-C` 和 `Ctrl-V` 这样的操作可能不会按预期运行。

[第 4.11.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-clipboards)解释了为什么会这样，以及如何更改行为。

（在 `Windows` 上，只有一个与其他应用程序共享的选择，因此不会出现这种混淆。）



服务器可以请求在 `PuTTY` 窗口本身中处理鼠标单击。

如果发生这种情况，鼠标指针将变成箭头，并且仅当您按住 `Shift` 时才可以使用鼠标进行复制和粘贴。

有关此功能的详细信息以及如何配置，请参阅第 4.6.2 节和第 [4.11.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-mouseshift)。

您可以自定义大部分此类行为，例如，从键盘启用复制和粘贴;请参阅[第 4.11 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-selection)。



### 3.1.2 向后滚动屏幕

`PuTTY` 跟踪从终端顶部向上滚动的文本。

因此，如果屏幕上出现了您想要阅读的内容，但它滚动得太快，并且在您尝试查找它时它已经消失了，您可以使用窗口右侧的滚动条查看会话历史记录并再次找到它。

除了使用滚动条外，您还可以通过按 `Shift+PgUp` 和 `Shift+PgDn` 来上下翻页滚动。

您可以使用 `Ctrl+PgUp` 和 `Ctrl+PgDn` 一次滚动一行，也可以使用 `Ctrl+Shift+PgUp` 和 `Ctrl+Shift+PgDn` 滚动到回滚的顶部/底部。

如果将滚动条配置为不可见，则这些功能仍然可用。

默认情况下，保留从顶部滚动的最后 `2000` 行供您查看。

您可以使用配置框增加（或减少）此值;请参见[第 4.7.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-scrollback)。



### 3.1.3 系统菜单

如果您在 `PuTTY` 终端窗口左上角图标上单击鼠标左键，或在标题栏上点击鼠标右键，您将看到标准 `Windows` 系统菜单，其中包含最小化、移动、大小和关闭等项目。

图b01



`PuTTY` 的系统菜单除了 `Windows` 标准选项外，还包含额外的程序功能，下面将介绍这些额外的菜单命令。

（这些选项也可以在 `PuTTY` 窗口中的任意位置，通过按住 `Ctrl` 并单击鼠标右键来显示的上下文菜单中使用。）



#### 3.1.3.1 `PuTTY` 事件日志

如果从系统菜单中选择“事件日志记录” `Event Log` ，则会弹出一个小窗口，`PuTTY` 在其中记录连接期间的重要事件。

日志中的大多数事件可能会在会话启动期间发生，但少数事件可能发生在会话中的任何时间点，一两个事件发生在会话末尾。

图b02

图b03



您可以使用鼠标选择事件日志的一个或多个行，然后点击 复制 按钮将它们复制到剪贴板。

如果要报告 `bug` ，将事件日志的内容粘贴到 `bug` 报告中通常很有用。



（事件日志与创建会话日志文件的工具不同;第 [3.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-logging)对此进行了介绍。）



#### 3.1.3.2 指定命令

根据用于当前会话的协议，可能会有一个“指定命令”的子菜单。

这些是特定于协议的令牌，例如“中断” `break` 信号，除了正常数据之外，还可以通过连接发送。

图b04



它们的确切效果通常取决于服务器。

目前只有 `Telnet` 、`SSH` 和串行连接具有指定命令。

“中断” `break` 信号也可以通过按下 `Ctrl-Break` 从键盘调用。



在 `SSH` 连接中，可以使用以下指定命令：

- 忽略消息 `IGNORE message`

  将不会有任何效果。

  图b05

  

- 重复密钥交换 `Repeat key exchange`

  仅在 `SSH-2` 中可用。

  立即强制重复密钥交换（并重置关联的计时器和计数器）。

  有关重复密钥交换的更多信息，请参见[第 4.18.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-rekey)。

  图b06

  

- 缓存新的主机密钥类型 ` Cache new host key type `

  仅在 SSH-2 中可用。

  仅当服务器具有 `PuTTY` 尚未缓存的主机密钥类型（因此不用考虑）时，才会显示此子菜单。

  在此处选择一个密钥将允许 `PuTTY` 现在和将来使用该密钥：`PuTTY` 将与所选密钥进行新的密钥交换，并立即将该密钥添加到其永久缓存中（依靠连接开始时使用的主机密钥来交叉认证新密钥）。

  该密钥将用于当前会话的其余部分，它实际上可能不会用于将来的会话，具体取决于您的偏好（请参阅[第 4.19.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-hostkey-order)）。

  

  通常，`PuTTY` 将继续使用它已知的主机密钥，即使服务器提供了 `PuTTY` 本来更喜欢的密钥格式，以避免主机密钥提示。

  因此，如果您已经使用服务器几年了，由于同时服务器升级，您可能仍在使用比新用户使用的更旧的密钥。

  不幸的是，`SSH` 协议没有用于主机密钥迁移和滚动更新的整套有效的工具，但允许您手动更新。

  图b07

  

- 中断 `break`

  仅在 `SSH-2` 中可用，并且仅在会话期间可用。

  属于可选扩展，服务器可能不支持。

  `PuTTY` 会请求获取服务器的默认中断长度。

  

- 信号（信号情报、信号信号等）

  仅在 `SSH-2` 中可用，并且仅在会话期间可用。发送各种 POSIX 信号。并非所有服务器都支持。

  图b08



`Telnet` 中提供了以下指定命令：

- `Are You There` - 你在吗

- `Break` - 中断

- `Synch` - 同步

- `Erase Character` - 擦除字符

  `PuTTY` 也可以配置为在按下退格键时发送此内容;请参见[第 4.30.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-telnetkey)。

  

- `Erase Line` - 擦除行

- `Go Ahead` - 继续

- `No Operation` - 无操作

  将无任何效果。

  

- `Abort Process` - 放弃进程

- `Abort Output` - 放弃输出

- `Interrupt Process` - 中断进程

  `PuTTY` 也可以配置为在键入 `Ctrl-C` 时发送此内容;请参见[第 4.30.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-telnetkey)。

  

- `Suspend Process` - 挂起进程

  `PuTTY` 也可以配置为在键入 Ctrl-Z 时发送此内容;请参见[第 4.30.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-telnetkey)。

  

- 记录结束

  

- 文件结尾



图b11



使用串行连接时，唯一可用的指定命令是“中断” `Break` 。



#### 3.1.3.3 启动新会话

`PuTTY` 的系统菜单提供了一些启动新会话的快捷方式：

- 选择“新会话”将启动一个全新的 `PuTTY` 实例，并正常打开配置框。

- 选择“复制会话”将在新窗口中启动会话，其选项与当前窗口完全相同 - 使用相同的协议连接到同一主机，具有所有相同的终端设置和所有内容。

- 在非活动窗口中，选择“重新启动会话”将与“复制会话”执行相同的操作，但仅在当前窗口中操作。

- “保存的会话”子菜单可让您快速访问之前保存的任何存储会话详细信息集。

  有关如何创建已保存会话的详细信息，请参阅[第 4.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-saving)。

图b12



#### 3.1.3.4 更改会话设置

如果从系统菜单中选择“修改设置”，`PuTTY` 将显示其初始配置框的精简版本，这允许您调整当前会话的大多数属性。

您可以更改终端的大小、字体、以及各种按键的操作、颜色等。

图b13

图b14



主配置框中提供的某些选项未显示在缩减的“修改设置”框中。

这些选项通常是用于在会话中途更改不太敏感的选项（例如，您无法在会话中途从 `SSH` 切换到 `Telnet` ）。

您可以从此对话框中将当前设置保存到已保存的会话中以供将来使用。

有关已保存会话的更多信息，请参阅[第 4.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-saving)。



#### 3.1.3.5 全部复制到剪贴板

此系统菜单选项提供了一种方便的方式来复制终端屏幕的全部内容（直到最后一个非空行）并一次性回滚到剪贴板。

图b15



#### 3.1.3.6 清除和重置终端

系统菜单上的“清除滚动条” `Clear Scrollback` 选项告诉 `PuTTY` 丢弃从屏幕顶部滚动后保留的所有文本行。

例如，如果您显示敏感信息并希望确保没有人可以越过您的肩膀看到它，这可能很有用。

（请注意，这只能防止临时用户使用滚动条查看信息，不能保证文本不会仍在 `PuTTY` 的内存中。)



“重置终端” `Reset Terminal` 选项会导致终端仿真完全重置。

`VT` 系列终端是一个复杂的软件，很容易进入所有打印的文本都变得不可读的状态。

（例如，如果您不小心将二进制文件输出到终端，则可能会发生这种情况。)

如果发生这种情况，选择重置终端应该会解决它。

图b16



#### 3.1.3.7 全屏模式

如果您发现最大化窗口上的标题栏很丑陋或容易分散注意力，您可以选择全屏模式以尽可能地最大化 `PuTTY` 。

当您选择此选项时，`PuTTY` 将展开以填充整个屏幕，其边框、标题栏和滚动条将消失。

（如果要保留滚动条，可以将滚动条配置为在全屏模式下不消失;请参阅[第 4.7.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-scrollback)。

当您处于全屏模式时，如果您使用鼠标左键单击屏幕最左上角，您仍然可以访问系统菜单，同时可以再次点击“全屏”后退出全屏模式。

图b17



## 3.2 创建会话的日志文件

出于某些目的，您可能会发现您想要记录屏幕上显示的所有内容，您可以使用配置框中的“日志记录”面板执行此操作。

要开始会话日志，请从系统菜单中选择“修改设置”，然后转到“日志记录”面板。

图c01

图c02



输入日志文件名，然后选择日志记录模式。

（您可以记录所有会话输出，包括终端控制序列，也可以只记录可打印的文本，这取决于您想要日志的用途。）

单击“应用”，您的日志将启动。

稍后，您可以返回“日志记录”面板并选择“日志记录完全关闭”以停止日志记录，然后 `PuTTY` 将关闭日志文件，您可以安全地读取它。



有关更多详细信息和选项，请参阅[第 4.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-logging)。



## 3.3 更改字符集配置

如果您发现特殊字符（例如重音字符或画线字符）在 `PuTTY` 会话中未正确显示，则可能是 `PuTTY` 根据错误的字符集解释服务器发送的字符。

有很多不同的字符集可用，`PuTTY` 没有合适的方法知道应该使用哪个，所以这种情况完全有可能发生。



如果单击“修改设置”并查看“转换”面板，您应该会看到大量可以选择的字符集以及其他相关选项。

图c03



现在您所需要的只是找出您想要的那一个！（有关详细信息，请参阅[第 4.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-translation)。）



## 3.4 在 `SSH` 中使用 `X11` 转发

`SSH` 协议能够通过加密的 `SSH` 连接安全地转发 `X Window` 系统图形应用程序，以便您可以在 `SSH` 服务器计算机上运行应用程序，并使其窗口在本地计算机上启动，而无需明文发送任何 `X` 网络流量。



为了使用此功能，您需要一个适用于 `Windows` 机器的 `X` 显示服务器，例如 `Cygwin/X` ，`X-Win32` 或 `Exceed` 。

这些程序可能会将自己安装到本地计算机上并将显示编号设定为 `0` 。

如果不是这样，`X` 服务器的手册应该会告诉您它的具体做法。

然后，您应该在开始 `SSH` 会话之前勾选 `X11` 面板中的“启用 `X11` 转发”框（请参阅[第 4.25 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-x11)）。

图c04



默认情况下，“`X` 显示位置” `X display location` 框为空，这意味着 `PuTTY` 将尝试使用合理的默认值，比如当前已安装的 `X` 服务器程序的常用显示位置。

如果需要修改，那么请手动修改它，通常后面要加上 `:0` 。



现在，您应该可以正常登录 `SSH` 服务器了。

要检查在连接启动期间是否已成功协商 `X` 转发，可以检查 `PuTTY` 事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）。

通常它应该这么说：

```
2023-12-05 17:22:01 Requesting X11 forwarding
2023-12-05 17:22:02 X11 forwarding enabled
```



如果远程系统是 `Unix` 或类 `Unix` ，您还应该能够看到环境变量已设置为指向 `SSH` 服务器计算机本身上的显示器 `10` 或更高版本：

```
fred@unixbox:~$ echo $DISPLAY
unixbox:10.0
```



如果这有效，那么您应该能够在远程会话中运行 `X` 应用程序，并让它们在您的 `PC` 上显示其程序窗口。



有关 `X11` 转发的更多选项，请参见[第 4.25 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-x11)。



## 3.5 在 `SSH` 中使用端口转发

`SSH` 协议能够通过加密的 `SSH` 连接转发任意网络（ `TCP` ）连接，以避免以明文形式发送网络流量。

例如，您可以使用它从家庭计算机连接到远程计算机上的 `POP-3` 服务器，而网络嗅探器看不到您的 `POP-3` 密码。



要使用端口转发从本地计算机连接到远程服务器上的端口，您需要：

- 在本地计算机上选择一个端口号，`PuTTY` 应在其中侦听传入连接，`3000` 以上可能有很多未使用的端口号。

  （您也可以在此处使用本地环回地址，有关更多详细信息，请参阅下文。）

- 现在，在开始 `SSH` 连接之前，请转到“通道” `Tunnels` 面板（请参阅[第 4.26 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-portfwd)）。

  确保设置了“本地” `Local` 单选按钮。在“源端口” `Source port` 框中输入本地端口号。

  在“目标” `Destination` 框中输入目标主机名和端口号，用冒号分隔（例如，连接到 `POP-3` 服务器`popserver.example.com:110` 。）

- 现在单击“添加” `Add` 按钮。

  端口转发的详细信息应显示在列表框中。



图c05



现在开始您的会话并登录。

（在您登录之前不会启用端口转发，否则很容易执行完全匿名的网络攻击，并访问任何人的虚拟专用网络。）

要检查 `PuTTY` 是否正确设置了端口转发，您可以查看 `PuTTY` 事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）。

它应该这样说：

```
2023-12-05 17:22:10 Local port 3110 forwarding to
         popserver.example.com:110
```



现在，如果您连接到本地 `PC` 上的源端口号，您应该会发现它可以完美地给出响应，就好像它是目标计算机上运行的服务一样。

因此，在此示例中，您可以将本地 `PC` 当作 `POP-3` 服务器来配置电子邮件客户端。

（当然，当您的 `PuTTY` 会话关闭时，转发将停止发生。

```
localhost:3110 popserver.example.com:110
```



您还可以向另一个方向转发端口：安排将服务器上的特定端口号转发回您的 `PC` ，作为与 `PC` 上或附近服务的连接。

为此，只需选择“远程” `Remote` 单选按钮而不是“本地” `Local` 单选按钮。

“源端口” `Source port` 框现在将指定服务器上的端口号（请注意，大多数服务器不允许为此目的使用 `1024` 以下的端口号）。

将本地连接转发到远程主机的另一种方法是使用动态 `SOCKS` 代理。

在这种模式下，`PuTTY` 充当 `SOCKS` 服务器，`SOCKS` 感知程序可以连接到该服务器并打开到其所选目标的转发连接，因此这可以替代长列表静态转发。

要使用此模式，您需要选择“动态” `Dynamic` 单选按钮而不是“本地” `Local` ，然后您不应该在“目标” `Destination` 框中输入任何内容（将被忽略）。

然后，`PuTTY` 将侦听您指定端口上的 `SOCKS` 连接。

大多数 `Web` 浏览器都可以配置为连接到此 `SOCKS` 代理服务，此外，您可以通过设置“代理” `Proxy` 控制面板通过它转发其他 `PuTTY` 连接（有关详细信息，请参阅[第 4.16 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy)）。

图c06



转发连接的源端口通常不接受来自除 `SSH` 客户端或服务器计算机本身以外的任何计算机的连接（分别用于本地和远程转发）。

“通道” `Tunnels` 面板中有一些控件可以更改此设置：

- “本地端口接受其他主机的连接” `Local ports accept connections from other hosts` 选项允许您设置本地到远程端口转发（包括动态端口转发），以便客户端 `PC` 以外的计算机可以连接到转发的端口。

- “远程端口接受连接(仅限 `SSH-2` )” `Remote ports do the same (SSH-2 only)` 选项对远程到本地端口转发执行相同的操作（以便 `SSH` 服务器计算机以外的计算机可以连接到转发的端口）。

  请注意，此功能仅在 `SSH-2` 协议中可用，并非所有 `SSH-2` 服务器都支持此功能（例如，在 `OpenSSH` 中，它通常默认处于禁用状态）。



您还可以指定要侦听的 `IP` 地址。

通常要求是 `Windows` 计算机侦听范围内的任何单个 `IP` 地址，这些地址都是仅供本地计算机使用的环回地址。

因此，如果您转发（比如说）到远程计算机的端口，那么您应该按照如此的设定来运行 .

如果连接到转发端口的程序不允许您更改它使用的端口号，这可能很有用。

此功能适用于本地到远程转发端口，`SSH-1` 无法支持远程到本地端口，而 `SSH-2` 理论上可以支持，但服务器不一定会配合。

```
127.*.*.*
127.0.0.5:79
finger fred@127.0.0.5
```



（请注意，如果您使用的是 `Windows XP Service Pack 2` ，则可能需要从 `Microsoft` 获取修补程序才能使用类似 `127.0.0.5` 的地址 - 请参阅[问题 A.7.17](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-alternate-localhost)。



有关端口转发的更多选项，请参阅[第 4.26 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-portfwd)。



如果您通过 `SSH` 转发的连接本身是由另一个 `PuTTY` 副本建立的第二个 `SSH` 连接，您可能会发现“逻辑主机名”配置选项可用于警告 `PuTTY` 它应该需要哪个主机密钥。

有关详细信息，请参见[第 4.14.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-loghost)。



## 3.6 连接到本地串行线路

`PuTTY` 可以直接连接到本地串行线路，作为建立网络连接的替代方法。

在此模式下，在 `PuTTY` 窗口中键入的文本将直接从计算机的串行端口发送，通过该端口接收的数据将显示在 `PuTTY` 窗口中。

您可以使用此模式，例如，如果您的串行端口连接到另一台具有串行连接的计算机。



要建立此类型的连接，只需从“会话” `Session` 配置面板上的“连接类型” `Connetion type` 单选按钮中选择“串口” `Serial` （请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。

图c07



“主机名”和“端口”框将转换为“串行口” `Serial line` 和“速度” `Speed` ，允许您指定要使用的串行线路（如果您的计算机有多个串行线路）以及传输数据时使用的速度（波特率）。

有关其他配置选项（数据位、停止位、奇偶校验、流量控制），您可以使用“串口” `Serial` 配置面板（请参阅[第 4.29 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-serial)）。



在串行模式下启动 `PuTTY` 后，您可能会发现您必须迈出第一步，方法是从串行线路发送一些数据，以便通知另一端的设备有人在那里与之通信。

这可能取决于设备，如果您启动 `PuTTY` 串行会话并且窗口中没有显示任何内容，请尝试按几次回车键，看看是否有帮助。



串行线没有为连接的一端提供明确定义的方法，以通知另一端连接已完成。

因此，串行模式下的 `PuTTY` 将保持连接状态，直到您使用关闭按钮关闭窗口。



## 3.7 建立原始 `TCP` 连接

许多互联网协议由纯文本形式的命令和响应组成。

例如，`SMTP`（用于传输电子邮件的协议）、`NNTP`（用于传输 Usenet 新闻的协议）和 `HTTP`（用于提供网页的协议）都由可读纯文本格式的命令组成。



有时，通过键入协议命令并观察响应，直接连接到这些服务之一并“手动”声明协议会很有用。

在 `Unix` 机器上，您可以使用系统的命令连接到正确的端口号来执行此操作。

例如，可能使您能够直接与邮件服务器上运行的 `SMTP` 服务通信。

```
telnet mailserver.example.com 25
```



尽管 `Unix` 程序提供了此功能，但所使用的协议并不是真正的 `Telnet` 。

真的根本没有实际的协议，通过连接发送的字节与您键入的字节完全相同，屏幕上显示的字节正是服务器发送的字节。

`Unix` 将尝试检测或猜测它正在与之通信的服务是否是真正的 `Telnet` 服务， `PuTTY` 更喜欢被肯定地回复。



要与此类服务建立调试连接，只需从“会话”  `Session` 配置面板的“协议”按钮中选择第四个协议名称“Raw”。

图c08



（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)。然后，您可以输入主机名和端口号，并建立连接。



## 3.8 使用 `Telnet` 协议进行连接

`PuTTY` 可以使用 `Telnet` 协议连接到服务器。

在引入 `SSH` 之前，`Telnet` 可能是最流行的远程登录协议。

它足够通用，可供多个服务器操作系统（特别是 `Unix` 和 `VMS` ）使用，并支持许多可选的协议扩展，为特定的服务器功能提供额外的支持。

与 `SSH` 不同，`Telnet` 通过不安全的网络连接运行，因此在充满敌对的 `Internet` 上使用它是一个非常糟糕的主意（尽管截至 `2020` 年它仍然在某种程度上使用）。

图c09



## 3.9 使用 `Rlogin` 协议进行连接

`PuTTY` 可以使用 `Rlogin` 协议连接到服务器。

`Rlogin` 在概念上类似于 `Telnet` ，但更侧重于 `Unix` 机器之间的连接。

它支持无密码登录功能，基于使用“特权端口”（数字低于 `1024` 的端口，`Unix` 传统上不允许用户分配）。

最终，基于服务器信任客户端的 `IP` 地址归它声称的 `Unix` 机器所有，并且该机器将适当地保护其特权端口。

图c10



与 `Telnet` 一样，`Rlogin` 通过不安全的网络连接运行。



## 3.10 使用 `SUPDUP` 协议进行连接

`PuTTY` 可以使用 `SUPDUP` 协议连接到服务器。

`SUPDUP` 是 `1975-1990` 年期间主要由 `PDP-10` 和 `Lisp` 机器使用的登录协议。

像 `Telnet` 和 `Rlogin` 一样，它是不安全的，所以现代系统几乎从不支持它。



要建立此类型的连接，请从“会话” `Session` 面板上的“连接类型”单选按钮中选择“SUPDUP”（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。

有关进一步的配置选项（字符集、更多处理、滚动），您可以使用“SUPDUP”配置面板（请参阅[第 4.32 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-supdup)）。

图c11

图c12



在 `SUPDUP` 中，终端仿真与网络协议的集成程度高于 `SSH` 等其他协议。

因此，`SUPDUP` 协议只能与 `PuTTY` 一起使用，而不能与命令行工具 `Plink` 一起使用。



`SUPDUP` 协议不支持更改终端尺寸，因此在 `SUPDUP` 会话期间禁用了此功能。

`SUPDUP` 没有为连接的一端提供明确定义的方法，以通知另一端连接已完成，因此，`SUPDUP` 模式下的 `PuTTY` 将保持连接状态，直到您使用关闭按钮关闭窗口。



## 3.11 `PuTTY` 命令行

`PuTTY` 可以通过提供命令行参数（例如，从命令提示符窗口或 `Windows` 快捷方式）在没有用户干预的情况下执行各种操作。



### 3.11.1 从命令行启动会话

这些选项允许您绕过配置窗口并直接启动到会话中。



要启动与名为 `host` 的服务器的连接，请执行以下操作：

```
putty.exe [-ssh | -ssh-connection | -telnet | -rlogin | -supdup | -raw] [user@]host
```



如果使用此语法，则设置取自默认设置（请参阅[第 4.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-saving)），或者（如果已提供）按照设定覆盖这些设置。



此外，您可以指定一个协议，该协议将覆盖默认协议（请参阅[第 3.11.3.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-protocol)）。



对于 `telnet` 会话，支持以下替代语法（这使得 `PuTTY` 适合用作 `Web` 浏览器中 `telnet` 的 `URL` 处理程序）：

```
putty.exe telnet://host[:port]/
```



要启动与串行端口的连接，例如 `COM1` ：

```
putty.exe -serial com1
```



要启动名为 `session name` 现有已保存会话，请使用选项 `-load`（在第 [3.11.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-load)中描述）。

```
putty.exe -load "session name"
```



### 3.11.2 `-cleanup`

如果调用该选项，而不是正常运行，`PuTTY` 将从本地计算机中删除其注册表项和随机种子文件（在与用户确认后）。

它还将尝试删除存储在 `Windows 7` 及更高版本的“跳转列表”中的最近启动的会话的信息。

```
putty.exe -cleanup
```

图c13



请注意，在多用户系统上， 仅删除与当前登录用户关联的注册表项和文件。



### 3.11.3 标准命令行选项

`PuTTY` 及其相关工具支持一系列命令行选项，其中大多数选项在所有工具中都是一致的。

本节列出了所有工具中的可用选项。

特定工具选项将在有关该工具的章节中介绍。



#### 3.11.3.1 加载保存的会话： `-load`

该选项会导致 `PuTTY` 从保存的会话中加载配置详细信息。

如果这些详细信息包括主机名，则只需此选项即可使 `PuTTY` 启动会话。

```
putty.exe -load "session name"
```



如果会话名称包含空格，则需要在会话名称两边加上双引号。

如果要创建 `Windows` 快捷方式来启动 `PuTTY` 保存的会话，则应使用此选项，快捷方式应调用类似：

```
d:\path\to\putty.exe -load "my session"
```



（请注意，`PuTTY` 本身支持此选项的替代形式，以实现向后兼容性。

如果执行 `putty @sessionname`，它将具有与 `putty -load "sessionname"` 相同的效果。

对于使用 `@` 的形式，不需要双引号，并且 `@` 符号必须处于命令行上的最开头，此形式的选项已弃用。）



#### 3.11.3.2 选择协议： `-ssh` ， `-ssh-connection` ， `-telnet`， `-rlogin`  ，`-supdup` ， `-raw` ， `-serial`

若想选择要连接的协议，可以使用以下选项之一：

- `-ssh` 选择 `SSH` 协议。
- `-ssh-connection  `选择裸 `SSH` 连接协议。（这仅在特殊情况下有用，有关更多信息，请参见第 [4.28 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-psusan)。）
- `-telnet `选择 `Telnet` 协议。
- `-rlogin `选择 `Rlogin` 协议。
- `-supdup` 选择 `SUPDUP` 协议。
- `-raw` 选择原始协议。
- `-serial` 选择串行连接。



这些选项中的大多数在文件传输工具 `PSCP` 和 `PSFTP`（仅适用于 `SSH` 协议和裸 `ssh` 连接协议）中不可用。

这些选项等效于 `PuTTY` 配置框的“会话” `Session` 面板中的协议选择按钮（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。



#### 3.11.3.3 增加详细程度： `-v`

大多数 `PuTTY` 工具都可以通过提供选项 `-v` 来告诉您有关它们正在做什么的更多信息。

如果您在建立连接时遇到问题，或者您只是好奇，您可以打开此开关并希望了解有关正在发生的事情的更多信息。



#### 3.11.3.4 指定登录名： `-l`

您可以使用该选项 `-l` 指定要在远程服务器上登录的用户名。

例如：

```
plink login.example.com -l fred
```



这些选项等效于 `PuTTY` 配置框的“连接”面板中的用户名选择框（请参阅[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)）。



#### 3.11.3.5 设置端口转发：`-L` ， `-R` 和 `-D` 

除了在 `PuTTY` 配置中设置端口转发（请参阅[第 4.26 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-portfwd)）外，您还可以在命令行上设置转发。

命令行选项的工作方式与 `Unix` `ssh` 程序中的选项相同。



要将本地端口（例如 `5110`）转发到远程目标（例如 `popserver.example.com` 端口 `110` ），您可以编写如下内容之一：

```
putty -L 5110:popserver.example.com:110 -load mysession
plink mysession -L 5110:popserver.example.com:110
```



要将远程端口转发到本地目标，只需使用选项 `-R` 而不是 `-L` ：

```
putty -R 5023:mytelnetserver.myhouse.org:23 -load mysession
plink mysession -R 5023:mytelnetserver.myhouse.org:23
```



要为通道的侦听端指定 `IP` 地址，请将其附加到参数前面：

```
plink -L 127.0.0.5:23:localhost:23 myhost
```



要在本地端口上设置基于 `SOCKS` 的动态端口转发，请使用选项 `-D` 。

为此，你只需要传递端口号：

```
putty -D 4096 -load mysession
```



有关端口转发的一般信息，请参见[第 3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-port-forwarding)。

这些选项在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。



#### 3.11.3.6 从文件中读取远程命令或脚本：`-m`

选项 `-m` 执行的功能与 `PuTTY` 配置框的 `SSH` 面板中的“远程命令”框类似（请参阅[第 4.17.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-command)）。

但是，选项 `-m` 需要给定一个本地文件名，它将从该文件读取命令。



对于某些服务器（特别是 `Unix` 系统），您甚至可以在此文件中放置多行并按顺序执行多个命令或整个 `shell` 脚本。

但这可以说是一种滥用，不能指望在所有服务器上都有效。

特别是，已知不适用于某些“嵌入式”服务器，例如思科路由器。

此选项在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。



#### 3.11.3.7 指定端口号：`-P`

选项 `-P` 用于指定要连接到的端口号。

如果您的计算机的端口 `9696` 而不是端口 `23` 上运行 `Telnet` 服务器，例如：

```
putty -telnet -P 9696 host.name
plink -telnet -P 9696 host.name
```



（请注意，此选项在 `Plink` 中比在 `PuTTY` 中更有用，因为在 `PuTTY` 中，您在任何情况下都可以编写 `putty -telnet host.name 9696` 。

此选项等效于` PuTTY` 配置框的“会话” `Session` 面板中的端口号控件（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。



#### 3.11.3.8 指定密码：`-pwfile` 和 `-pw` 

自动远程登录的一种简单方法是在命令行上提供密码。



选项 `-pwfile` 将文件名作为参数，该文件中的第一行文本将用作您的密码。



选项 `-pw` 将密码本身作为参数。

如果其他人使用同一台计算机，这是**不安全**的，因为如果另一个用户列出正在运行的进程，则可能会显示整个命令行（包括密码）。

`-pw` 保留只是为了向后兼容，你应该改用 `-pwfile` 。



请注意，这些选项仅在使用 `SSH` 协议时有效。

由于 `Telnet`、`Rlogin` 和 `SUPDUP` 的基本限制，这些协议不支持自动密码身份验证。



#### 3.11.3.9 控制使用 `Pageant` 进行身份验证：`-agent` 和 `-noagent`

选项 `-agent` 使用 `Pageant` 打开 `SSH` 身份验证，并用 `-noagent` 将其关闭。

仅当您使用 `SSH` 时，这些选项才有意义。



有关 `Pageant` 的一般信息，请参阅[第 9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)。

这些选项等效于 `PuTTY` 配置框的“身份验证”面板中的代理身份验证复选框（请参阅[第 4.21.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-tryagent)）。



#### 3.11.3.10 控制代理转发：`-A` 和 `-a`

选项 `-A` 将打开 `SSH` 代理转发，并用 `-a` 将其关闭。

仅当您使用 SSH 时，这些选项才有意义。



有关 `Pageant` 的一般信息，请参阅第 [9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)，有关代理转发的信息，请参阅[第 9.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-forward)。

请注意，启用此选项存在安全风险;有关详细信息，请参阅[第 9.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-security)。



这些选项等效于 `PuTTY` 配置框的“身份验证”面板中的代理转发复选框（请参阅[第 4.21.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-agentfwd)）。

这些选项在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。



#### 3.11.3.11 控制 `X11` 转发：`-X` 和 `-x`

选项`-X`在 `SSH` 中打开 `X11` 转发，并用 `-x` 将其关闭。

仅当您使用 `SSH` 时，这些选项才有意义。



有关 `X11` 转发的信息，请参见[第 3.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-x-forwarding)。

这些选项等效于 PuTTY 配置框的 X11 面板中的 X11 转发复选框（请参阅[第 4.25 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-x11)）。



这些选项在文件传输工具 `PSCP`  和 `PSFTP` 中不可用。



#### 3.11.3.12 控制伪终端分配： `-t` 和 `-T`

选项 `-t` 可确保 `PuTTY` 尝试在服务器上分配伪终端，并用 `-T` 阻止其分配伪终端。

仅当您使用 `SSH` 时，这些选项才有意义。

这些选项等效于 `PuTTY` 配置框的 `SSH` 面板中的“不分配伪终端”复选框（请参阅[第 4.24.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-pty)）。

这些选项在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。



#### 3.11.3.13 禁止启动 `shell` 或命令： `-N`

选项 `-N` 可防止 `PuTTY` 尝试在远程服务器上启动 `shell` 或命令。

如果仅使用 `SSH` 连接进行端口转发，并且服务器上的用户帐户无法运行 `shell` ，则可能需要使用此选项。



此功能仅在 `SSH` 协议版本 `2` 中可用（因为版本 `1` 协议假定您始终希望运行 `shell` ）。

此选项等效于 `PuTTY` 配置框的 `SSH` 面板中的“根本不启动 shell 或命令”复选框（请参阅[第 4.17.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-noshell)）。

此选项在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。



#### 3.11.3.14 建立远程网络连接以代替远程 `shell` 或命令：`-nc`

选项 `-nc` 可防止 `Plink`（或 `PuTTY` ）尝试在远程服务器上启动 `shell` 或命令。

相反，它将指示远程服务器打开与您指定的主机名和端口号的网络连接，并将该网络连接视为主会话。



指定主机和端口作为选项 `-nc` 的参数，用冒号分隔主机名和端口号，如下所示：

```
plink host1.example.com -nc host2.example.com:1234
```



如果您尝试与目标主机建立连接，而目标主机只能通过代理主机的 `SSH` 转发来访问，这会很有用。

执行此操作的一种方法是通过端口转发与代理主机建立现有 `SSH` 连接，但如果您希望根据需要按需启动连接，则此方法也可以工作。



但是，这确实取决于*使用代理的程序*能够运行子进程而不是建立网络连接。

`PuTTY` 本身可以使用“本地”代理类型来做到这一点，但有一种内置的更灵活的方式使用“SSH”代理类型。

（有关两者的说明，请参见[第 4.16.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-type)。）

因此，此功能对于作为最终用户的另一个客户端程序可能最有用。



此功能仅在 `SSH` 协议版本 `2` 中可用（因为版本 `1` 协议假定您始终希望运行 `shell` ）。

它在文件传输工具 `PSCP` 和 `PSFTP` 中不可用。

它在 `PuTTY` 本身中可用，尽管它在 `Plink` 以外的任何工具中都不太可能很有用。

此外，`-nc` 使用与端口转发相同的服务器功能，因此如果服务器管理员禁用了端口转发，它将不起作用。



（该选项以 `Unix` 程序[`nc`](http://www.vulnwatch.org/netcat/)命名，是“netcat”的缩写。

命令 `plink host1 -nc host2:port` 在功能上与 `plink host1 nc host2 port` 非常相似，后者在服务器上调用 `nc` 并告诉它连接到指定的目标。

但是，`Plink` 的内置选项 `-nc` 不依赖于服务器上安装的程序。）



#### 3.11.3.15 启用压缩： `-C`

选项 `-C` 允许压缩通过网络发送的数据。

此选项仅在使用 `SSH` 时才有意义。

此选项等效于 `PuTTY` 配置框的 `SSH` 面板中的“启用压缩”复选框（请参阅[第 4.17.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-comp)）。



#### 3.11.3.16 指定 `SSH` 协议版本：`-1` 和 `-2`

选项 `-1`和 `-2`  强制 `PuTTY` 使用 `SSH` 协议的版本 `1` 或版本 `2` 。

仅当您使用 `SSH` 时，这些选项才有意义。

这些选项等效于在 `PuTTY` 配置框的 `SSH` 面板中选择 `SSH` 协议版本（请参阅[第 4.17.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-prot)）。



#### 3.11.3.17 指定互联网协议版本：`-4` 和 `-6`

选项 `-4` 和 `-6` 强制 `PuTTY` 对大多数传出连接使用较旧的互联网协议 `IPv4` 或较新的 `IPv6` 。

这些选项等效于在 `PuTTY` 配置框的“连接”面板中选择首选的互联网协议版本为“IPv4”或“IPv6”（请参阅[第 4.14.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-address-family)）。



#### 3.11.3.18 指定 `SSH` 私钥：`-i`

选项 `-i` 允许您以 `PuTTY` 将用于向服务器进行身份验证的 `*.PPK` 格式指定私钥文件的名称。

此选项仅在使用 `SSH` 时才有意义。

如果您使用的是 `Pageant` ，您还可以指定一个*公钥*文件（ `RFC 4716` 或 `OpenSSH` 格式）来标识要使用的特定密钥文件。（当然，如果您不运行 `Pageant` ，这将不起作用。）



有关公钥认证的一般信息，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。

此选项等效于 `PuTTY` 配置框的“身份验证”面板中的“用于身份验证的私钥文件”框（请参阅[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)）。



#### 3.11.3.19 指定 `SSH` 证书： `-cert`

选项 `-cert` 允许您指定包含公钥的签名版本的证书文件的名称。

如果指定此选项，`PuTTY` 将在尝试使用匹配的密钥进行身份验证时提供该证书来代替纯公钥。

（无论密钥存储在 `Pageant` 中还是由 `PuTTY` 直接从文件中加载，这都适用。）



此选项等效于 `PuTTY` 配置框的“身份验证”面板中的“与私钥一起使用的证书”框（请参阅[第 4.22.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-cert)）。



#### 3.11.3.20 如果 `SSH` 身份验证成功，则断开连接： `-no-trivial-auth`

如果服务器接受身份验证而从未要求任何类型的密码、签名或令牌，则此选项会导致 `PuTTY` 放弃 `SSH` 会话。

请参阅[第 4.21.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-notrivialauth)，了解您可能想要这样做的原因。



#### 3.11.3.21 指定逻辑主机名： `-loghost`

此选项通过告诉 `PuTTY` 您希望连接最终到达的主机名称来覆盖 `PuTTY` 的正常 `SSH` 主机密钥缓存策略（如果该名称与 `PuTTY` 认为它连接到的位置不同）。

它可以是纯主机名，也可以是后跟冒号和端口号的主机名。

有关此内容的更多详细信息，请参阅[第 4.14.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-loghost)。



#### 3.11.3.22 手动指定预期的主机密钥： `-hostkey`

此选项通过准确告诉 `PuTTY` 所需的主机密钥来覆盖 `PuTTY` 的正常 `SSH` 主机密钥缓存策略，这在注册表中的正常自动主机密钥存储不可用时非常有用。

此选项的参数应为主机密钥指纹或 `SSH-2 key blob` 。

有关更多信息，请参见[第 4.19.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-manual-hostkeys)。

如果要配置要接受的多个密钥，可以多次指定此选项。



#### 3.11.3.23 显示 `PGP` 密钥指纹： `-pgpfp`

此选项会导致 `PuTTY` 工具并不按照常规方式启动，而是显示 `PuTTY PGP` 主密钥的指纹，以帮助验证新版本。

有关详细信息，请参阅[附录 F](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixF.html#pgpkeys)。



#### 3.11.3.24 指定串行端口配置： `-sercfg`

此选项指定串行端口的配置参数（波特率、停止位等）。

其参数被解释为以逗号分隔的配置选项列表，可以如下所示：

- 从 `5` 到 `9` 的任何一位数都设置数据位数。
- `1` ， `1.5` 或 `2` 设置停止位的数量。
- 任何其他数字字符串都解释为波特率。
- 单个小写字母指定奇偶校验：`n` 表示无，`o` 表示奇数，`e` 表示偶数，`m` 示标记，`s` 表示空格。
- 单个大写字母指定流控制：`N` 表示无，`X` 表示 `XON/XOFF` ，`R` 表示 `RTS/CTS` ，`D` 表示 `DSR/DTR` 。

例如，`-sercfg 19200,8,n,1,N` 表示波特率为 `19200` 、`8` 个数据位、无奇偶校验、`1` 个停止位和无流量控制。



#### 3.11.3.25 启用会话日志记录： `-sessionlog` ， `-sshlog` ， `-sshrawlog`

这些选项会导致 `PuTTY` 网络工具输出日志文件。

它们中的每一个都需要一个文件名作为参数，例如，`-sshlog putty.log` 会导致将 `SSH` 数据包日志写入名为 `putty.log` 的文件。

三个不同的选项选择不同的日志记录模式，所有模式也可从 `GUI` 获得：

- `-sessionlog` 选择“所有会话输出”日志记录模式。
- `-sshlog ` 选择“`SSH` 数据包”日志记录模式。
- `-sshrawlog` 选择“`SSH` 数据包和原始数据”日志记录模式。



有关日志记录配置的更多信息，请参见[第 4.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-logging)。



#### 3.11.3.26 使用现有日志文件控制行为： `-logoverwrite` ， `-logappend`

如果已启用日志记录（在保存的配置中，或通过其他命令行选项），并且指定的日志文件已存在，则这些选项会告知 `PuTTY` 网络工具要执行的操作，以便它们不必询问用户。

有关详细信息，请参见[第 4.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-logfileexists)。



#### 3.11.3.27 指定本地代理命令： `-proxycmd`

此选项启用 `PuTTY` 的模式，用于在本地计算机上运行命令并将其用作网络连接的代理。

它需要一个 `shell` 命令字符串作为参数。



有关此内容和其他代理设置的更多信息，请参阅[第 4.16.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-type)。

特别要注意的是，为了能在参数字符串中理解描述的特殊序列，因此字符反斜杠必须加倍（如果命令中有 `\` ，则必须写成 `\\` ）。



#### 3.11.3.28 限制 `Windows` 进程的 `ACL` ： `-restrict-acl`

此选项（仅在 `Windows` 上）会导致 `PuTTY`（或其他 `PuTTY` 工具）尝试在其自己的进程中锁定操作系统的访问控制。

如果成功，它应该为设法在与 `PuTTY` 进程相同的用户 `ID` 下运行的恶意软件带来额外的障碍，阻止它利用调试器使用相同接口附加到 `PuTTY` ，并从内存中读取敏感信息或劫持其网络会话。



默认情况下不启用此选项，因为 `Windows` 程序之间的这种交互形式有许多合法用途，包括屏幕阅读器等辅助功能软件。

此外，在任何情况下，它都无法针对此类攻击提供完全的安全性，因为 `PuTTY` 只能在启动后锁定自己的 `ACL` ，如果恶意软件攻击启动和锁定之间的进程，它仍然可以进入。

因此，它牺牲了明显的便利性，并且提供的真实安全性低于您的预期。

但是，如果您确实想进行这种权衡，则可以使用该选项。



以 `-restrict-acl` 开头的 `PuTTY` 进程会将其传递给以重复会话、新会话等开头的任何进程。

（但是，如果您要显式调用 `PuTTY` 工具，例如作为代理命令，则需要安排自己传递选项 `-restrict-acl` （如果需要的话）。



如果 `Pageant` 是使用选项 `-restrict-acl` 启动的，并且是从系统托盘子菜单启动的 `PuTTY` 会话，则 `Pageant` 不会默认使用受限 `ACL` 启动的 `PuTTY` 子进程。

这是因为 `PuTTY` 更有可能因 `ACL` 受限而遭受功能减少（例如，屏幕阅读器软件将更需要与之交互），而 `Pageant` 存储更关键的信息（因此从额外的保护中受益更多），因此想要运行 `Pageant` 而不是具有 `ACL` 限制的 `PuTTY` 是合理的。

如果您还设置了选项 `-restrict-putty-acl` ，则可以强制 `Pageant` 使用受限 `ACL` 启动附属 `PuTTY` 进程。



#### 3.11.3.29 启动主机 `CA` 配置： `-host-ca`

如果您使用选项 `-host-ca` 启动 `PuTTY` ，它根本不会启动会话。

相反，它将仅显示主机证书颁发机构的配置对话框，如[第 4.19.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-cert)中所述。

关闭该对话框时，`PuTTY` 将终止。









# 第 4 章：配置 `PuTTY`

本章介绍 `PuTTY` 中的所有配置选项。

`PuTTY` 是使用启动会话之前出现的控制面板配置的。

某些选项也可以在会话过程中通过从窗口菜单中选择“修改设置”来更改。



## 4.1 会话面板

会话配置面板包含您需要指定的基本选项，以便完全打开会话，还允许您保存设置以便稍后重新加载。



### 4.1.1 主机名称部分

“会话”面板上的顶部框标有“指定要连接到的目的地址”，其中包含在 `PuTTY` 可以打开会话之前需要填写的详细信息。

- 在“主机名称”框中，您可以键入要连接到的服务器的名称或 `IP` 地址。

- “连接类型”控件可让您选择要建立的连接类型：`SSH` 网络连接、与本地串行线路的连接或各种其他类型的网络连接。

  - 有关网络远程登录协议 `SSH` 、`Telnet` 、`Rlogin` 和 `SUPDUP` 之间差异的摘要，请参见第 [1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter1.html#which-one)。

  - 有关使用串口线行的信息，请参见[第 3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-serial)。

  - 有关“RAW”连接的解释，请参见[第 3.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-rawprot)。

  - 有关 `Telnet` 的一些信息，请参见第 [3.8 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-telnet)。

  - 有关使用 `Rlogin` 的信息，请参见[第 3.9 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-rlogin)。

  - 有关使用 `SUPDUP` 的信息，请参见[第 3.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-supdup)。

  - “连接类型”控件中的“裸 `ssh` 连接”选项适用于不涉及网络连接的专业用途。

    有关它的一些信息，请参阅[第 4.28 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-psusan)。

- “端口”框允许您指定要连接到服务器上的端口号。

  如果您选择 `Telnet` ，`Rlogin` ，`SUPDUP` 或 `SSH` ，此框将自动填充为通常数值，并且只有在您有非标准服务端口时才需要更改它。

  如果您选择原始模式，您几乎肯定需要自行填写“端口”框。



如果从“连接类型”单选按钮中选择“串口”，则“主机名称”和“端口”框将替换为“串行口”和“速度”，有关这些内容的更多详细信息，请参见[第 4.29 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-serial)。



### 4.1.2 加载和存储保存的会话

会话配置面板的下一部分允许您保存首选的 `PuTTY` 选项，以便在您下次启动 `PuTTY` 时自动显示它们。

它还允许您创建保存的会话，其中包含一整套配置选项以及主机名和协议。

保存的会话包含 `PuTTY` 准确启动所需会话所需的所有信息。

图c14



- 要保存默认设置：首先按照您希望保存的方式配置好相应设置。

  然后返回到“会话”面板，在保存的会话列表中选择“默认设置”条目，只需单击一下，然后按“保存”按钮。

  如果要存储一个特定主机的连接，其中包含特定主机的详细信息，则应创建一个单独命名的已保存的会话，该会话将与默认设置分开。

- 要保存会话：首先浏览配置框的其余部分，设置所需的所有选项。

  然后返回到“会话”面板，在“已保存会话”输入框中输入已保存会话的名称。

  服务器名称通常是保存的会话名称的不错选择，然后按“保存”按钮。您保存的会话名称现在应显示在列表框中。

  您也可以在会话中从“修改设置”对话框中保存设置。

  自会话开始以来更改的设置将与其当前值一起保存，除了通过对话框更改的设置外，还包括窗口大小的更改、服务器发送的窗口标题更改等。

- 要重新加载已保存的会话：单击以在列表框中选择会话名称，然后按“加载”按钮。

  您保存的设置应全部显示在配置面板中。

- 要修改已保存的会话：首先如上所述加载它，然后进行所需的更改。

  返回“会话”面板，然后按“保存”按钮，新设置将保存在旧设置之上。

  要以其他名称保存新设置，您可以在“保存的会话”框中输入新名称，或单击以在列表框中选择会话名称以覆盖该会话。

  要保存“默认设置”，您必须在保存前单击名称。

- 要立即启动保存的会话：双击列表框中的会话名称。

- 要删除已保存的会话：单击以在列表框中选择会话名称，然后按“删除”按钮。



每个保存的会话都独立于默认设置配置。

如果更改首选项并更新默认设置，则还必须单独更新每个已保存的会话。



保存的会话存储在注册表中，位于该位置：

```
HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions
```

如果需要将它们存储在文件中，可以尝试第 [4.33 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-file)中描述的方法。



### 4.1.3 退出时关闭窗口

最后，在“会话”面板中，有一个标有“退出时关闭窗口”的选项。

这可以控制 `PuTTY` 终端窗口是否在其内部会话终止后立即消失。

如果您可能希望在会话终止后将文本复制并粘贴出会话，或重新启动会话，则应安排关闭此选项。

图c15



“退出时关闭窗口”有三个设置。

“总是”意味着总是在退出时关闭窗口。

“从不”表示退出时永不关闭（始终保持窗口打开，但处于非活动状态）。

第三个设置，也是默认设置，是“仅在干净退出时”。

在这种模式下，正常终止的会话将导致其窗口关闭，但因网络故障或来自服务器的混乱消息而意外中止的会话将使窗口保持打开状态。



## 4.2 日志记录面板

日志记录配置面板允许您保存 `PuTTY` 会话的日志文件，以供调试、分析或将来参考。

主要选项是一个单选按钮集，用于指定 `PuTTY` 是否会记录任何内容。

图c16



选项包括：

- “无”。这是默认选项。

  在此模式下，PuTTY 根本不会创建日志文件。

- “可打印输出”。

  在此模式下，将创建并写入日志文件，但只会将可打印的文本保存到其中。

  通常与可打印文本一起通过交互式会话发送的各种终端控制代码将被省略。

  如果您想在文本编辑器中读取日志文件并希望能够理解它，这可能是一个有用的模式。

- “所有会话输出”。

  在此模式下，将记录服务器发送到终端会话的*所有内容*。

  因此，如果您在文本编辑器中查看日志文件，您可能会发现它充满了奇怪的控制字符。

  如果您在 `PuTTY` 的终端处理中遇到问题，这是一种特别有用的模式：您可以记录进入终端的所有内容，以便其他人稍后可以慢动作重播会话并观察出了什么问题。

- “`SSH` 包”。

  在此模式下（仅由 `SSH` 连接使用），通过加密连接发送的 `SSH` 消息数据包将写入日志文件（以及事件日志条目）。

  您可能需要它来调试网络级问题，或者更有可能作为错误报告的一部分发送给 `PuTTY` 作者。

  *请注意*，如果您使用密码登录，密码可能会出现在日志文件中，请参阅[第 4.2.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-logssh)，了解可能有助于在将敏感材料发送给其他任何人之前从日志文件中删除敏感材料的选项。

- “`SSH` 包和 `RAW` 数据”。

  在此模式下，包括解密的数据包（与以前的模式一样），以及原始（加密、压缩等）数据包都会被记录。

  这对于诊断传输中的数据损坏可能很有用。（当然，与前一种模式相同的警告也适用。）



请注意，非 `SSH` 日志记录选项（“可打印输出”和“所有会话输出”）仅适用于 `PuTTY` 。

在没有终端仿真的程序（例如 `Plink` ）中，即使通过保存的设置启用，它们也不会生效。



### 4.2.1 日志文件名

在此编辑框中，输入要将会话记录到的文件的名称。

“浏览”按钮可让您浏览文件系统以找到放置文件的正确位置，或者如果您已经确切地知道要保存到哪里，则可以在编辑框中键入路径名。

图c17



此框中有一些特殊功能。

如果在文件名框中使用字符 `&` ，`PuTTY` 将在其实际打开的文件的名称中插入当前会话的详细信息。

它会做到如下精确替换：

- `&Y` 将由当前年份替换为四位数。
- `&M` 将由当前月份替换为两位数。
- `&D ` 将替换为当月的当前日期，作为两位数。
- `&T ` 将被当前时间替换为六位数 （ `HHMMSS` ），没有标点符号。
- `&H` 将替换为要连接到的主机名。
- `&P` 将替换为您在目标主机上连接到的端口号。



例如，如果您输入主机名，则最终会得到如下所示的文件 `c:\puttylogs\log-&h-&y&m&d-&t.dat` 。

```
log-server1.example.com-20010528-110859.dat
log-unixbox.somewhere.org-20010611-221001.dat
```



### 4.2.2 如果日志文件已存在该怎么办

此控件允许您指定 `PuTTY` 在尝试开始写入日志文件并发现该文件已存在时应执行的操作。

图c18



您可能希望自动销毁现有日志文件并启动具有相同名称的新日志文件。

或者，您可能希望打开现有日志文件并将其*添加到其末尾*。

最后（默认选项），您可能不希望有任何自动行为，而是在每次出现问题时询问用户。



### 4.2.3 经常刷新日志文件

此选项允许您控制将记录的数据刷新到光盘的频率。

图c19



默认情况下，`PuTTY` 将在显示数据后立即刷新数据，因此，如果您在会话仍处于打开状态时查看日志文件，它将是最新的。

如果客户端系统崩溃，则保留数据的可能性更大。

但是，这可能会导致性能损失。

如果 `PuTTY` 在启用日志记录的情况下运行缓慢，您可以尝试取消选中此选项。

请注意，日志文件可能并不总是最新的（尽管它当然会在关闭时刷新，例如在会话结束时）。



### 4.2.4 包含行首标题

此选项允许您选择是否在打开日志文件时的日期和时间中包含标题行。

图c20



如果日志文件用作不需要标头行的其他程序的实时输入，则禁用此功能可能很有用。



### 4.2.5 指定 `SSH` 包日志记录设置

仅当记录 `SSH` 数据包数据时，这些选项才适用。

以下选项允许自动将未加密数据包的特别敏感部分排除在日志文件之外。

它们只是为了阻止随意的攻击行为，攻击者甚至可以从这些混淆日志中收集大量有用的信息（例如，密码长度）。

图c21



#### 4.2.5.1 忽略已知密码域

选中后，解密的密码字段将从传输数据包的日志中删除。

（这包括用户对质询-响应身份验证方法（如“键盘交互”）的任何响应。

如果使用 `X11` 转发，则不包括 `X11` 身份验证数据。



请注意，这只会忽略 `PuTTY` *知道*是密码的数据。

但是，例如，如果您在 `PuTTY` 会话中启动另一个登录会话，则使用的任何密码都将以明文形式显示在数据包日志中。

下一个选项可用于防止这种情况。

默认情况下，此选项处于启用状态。



#### 4.2.5.2 忽略会话数据

选中后，将忽略所有解密的“会话数据”，这被定义为终端会话和转发通道（ `TCP` 、`X11` 和身份验证代理）中的数据。

这通常会大大减少生成的日志文件的大小。

默认情况下，此选项处于禁用状态。



## 4.3 终端面板

终端配置面板允许您控制 `PuTTY` 终端仿真的行为。

图c22



### 4.3.1 初始启用自动换行

自动换行模式控制在 `PuTTY` 窗口中打印的文本到达窗口右侧边缘时发生的情况。

启用自动换行模式后，如果一长行文本到达右侧边缘，它将换行到下一行，因此您仍然可以看到所有文本。

关闭自动换行模式后，光标将停留在屏幕的右侧边缘，并且所有字符将在窗口顶部打印显示为一行。



如果您正在运行全屏应用程序，并且偶尔发现屏幕在看起来不应该滚动时向上滚动，则可以尝试关闭此选项。



自动换行模式可以通过服务器发送的控制序列来打开和关闭。

此配置选项控制*默认*状态，该状态将在重置终端时恢复（请参阅[第 3.1.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#reset-terminal)）。

但是，如果您在会话中途使用“修改设置”修改此选项，它将立即生效。



### 4.3.2 初始启用 `DEC` 原始模式

`DEC` 原始模式是一个次要选项，用于控制 `PuTTY` 如何解释服务器发送的光标位置控制序列。

服务器可以发送限制显示器滚动区域的控制序列。

例如，在编辑器中，服务器可能会在屏幕顶部保留一行，在底部保留一行，并可能发送导致滚动操作仅影响其余行的控制序列。



启用 `DEC` 原始模式时，光标坐标从滚动区域的顶部开始计数。

关闭后，无论滚动区域如何，光标坐标都会从整个屏幕的顶部开始计数。



您不太可能需要更改此选项，但是如果您发现全屏应用程序在看起来像屏幕错误部分显示文本片段，则可以尝试打开 `DEC` 原始模式以查看是否有帮助。

`DEC` 原始模式可以通过服务器发送的控制序列打开和关闭。

此配置选项控制*默认*状态，该状态将在重置终端时恢复（请参阅[第 3.1.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#reset-terminal)）。

但是，如果您在会话中途使用“修改设置”修改此选项，它将立即生效。



### 4.3.3 在每个 `LF` 字符前增加 `CR` 字符

大多数服务器发送两个控制字符 `CR` 和 `LF` 来启动屏幕的新行。

`CR` 字符使光标返回到屏幕左侧。

`LF` 字符使光标向下移动一行（并可能使屏幕滚动）。



某些服务器仅发送 `LF` ，并期望终端自动将光标向左移动。

如果您遇到执行此操作的服务器，您将在屏幕上看到阶梯效果，如下所示：

```
First line of text
                  Second line
                             Third line
```



如果您遇到这种情况，请尝试启用“在每个 `LF` 字符前增加 `CR` 字符”选项，事情可能会恢复正常：

```
First line of text
Second line
Third line
```



### 4.3.4 在每个 `CR` 字符后增加 `LF` 字符

大多数服务器发送两个控制字符 `CR` 和 `LF` 来启动屏幕的新行。

`CR` 字符使光标返回到屏幕左侧。

`LF` 字符使光标向下移动一行（并可能使屏幕滚动）。



某些服务器仅发送 `CR` ，因此新写入的行将被以下行覆盖。

此选项会导致换行，以便显示所有行。



### 4.3.5 使用背景颜色清除屏幕

并非所有终端都同意在服务器发送“清除屏幕”指令时更新屏幕的颜色。

一些终端认为屏幕应始终清除为*默认*背景颜色。

其他人认为应该将屏幕清除为服务器选择作为背景颜色的任何颜色。



确实存在期望这两种行为的应用程序。

因此，可以将 `PuTTY` 配置为执行任一操作。



禁用此选项后，屏幕清除始终以默认背景颜色完成。

启用此选项后，它将以*当前*背景颜色完成。

背景色清除可以通过服务器发送的控制指令打开和关闭。

此配置选项控制*默认*状态，该状态将在重置终端时恢复（请参阅[第 3.1.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#reset-terminal)）。

但是，如果您在会话中途使用“修改设置”修改此选项，它将立即生效。



### 4.3.6 启用闪烁字文本

服务器可以要求 `PuTTY` 显示的文本可以开启和关闭闪烁效果。

这非常分散注意力，因此 `PuTTY` 允许您完全关闭闪烁的文本。



当禁用闪烁文本并且服务器尝试使某些文本闪烁时，`PuTTY` 将改为以粗体背景颜色显示文本。



闪烁文本可以通过服务器发送的控制指令打开和关闭。

此配置选项控制*默认*状态，该状态将在重置终端时恢复（请参阅[第 3.1.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#reset-terminal)）。

但是，如果您在会话中途使用“修改设置”修改此选项，它将立即生效。



### 4.3.7 `^E` 回应

此选项控制如果服务器向 `PuTTY` 发送 `^E` 查询字符，它将发送回服务器的内容。

通常它只发送字符串 `“PuTTY”` 。



如果您不小心将二进制文件的内容写入终端，您可能会发现它包含多个 `^E` 字符，因此您的下一个命令行可能会显示 `“PuTTYPuTTYPuTTY...”` 。

就好像您在键盘上多次键入应答字符串一样。

如果将应答字符串设置为空，则此问题应消失，但这样做可能会导致其他问题。



请注意，这不是 `PuTTY` 的功能，服务器通常会使用它来确定您的终端类型。

该功能是“连接”面板中的“终端类型字符串”，有关详细信息，请参见[第 4.15.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-termtype)。

您可以使用 `^C` 表示法在应答字符串中包含控制字符。（用 `^~` 获取文字 `^` 。）



### 4.3.8 本地回应

禁用本地回应后，您在 `PuTTY` 窗口中键入的字符不会被 `PuTTY` 在窗口中回显。

它们只是被发送到服务器。

（*服务器*可能会选择将它们回显给您，这无法从 `PuTTY` 控制面板进行控制。)



某些类型的会话需要本地回应，而许多不需要。

在其默认模式下，`PuTTY` 将自动尝试推断本地回应是否适合您正在使用的会话。

如果您发现它做出了错误的决定，则可以使用此配置选项覆盖其选择：您可以强制打开本地回应，或强制关闭它，而不是依靠自动检测。



### 4.3.9 本地行编辑

通常，您在 `PuTTY` 窗口中键入的每个字符都会在您键入的那一刻立即发送到服务器。



如果启用本地行编辑，则会改变。

`PuTTY` 将允许您在本地一次编辑整行，并且只有在您按 `Return` 时，该行才会发送到服务器。

如果出错，可以在按 `Return` 键之前使用 `Backspace` 键进行更正，服务器将永远不会看到该错误。



由于很难在无法看到编辑行时进行本地行编辑，因此本地行编辑主要与本地回显结合使用（[第 4.3.8 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-localecho)）。

这使其成为在原始模式下或连接到 `MUDs` 或说话者时的理想选择。

（尽管一些更高级的 `MUDs` 偶尔会打开本地行编辑并关闭本地回显，以便接受用户的密码。）



某些类型的会话需要本地行编辑，而许多不需要。

在默认模式下，`PuTTY` 将自动尝试推断本地行编辑是否适合您正在使用的会话。

如果您发现它做出了错误的决定，则可以使用此配置选项覆盖其选择：您可以强制打开本地行编辑，或强制关闭它，而不是依赖自动检测。



### 4.3.10 远程控制打印

许多兼容 `VT100` 的终端支持在远程服务器的控制下进行打印（有时称为“直通打印”）。

`PuTTY` 也支持此功能，但默认情况下处于关闭状态。



要启用远程控制打印，请从“打印发送 `ANSI` 打印机输出到”下拉列表框中选择打印机。

这应该允许您从计算机上已安装驱动程序的所有打印机中进行选择。

或者，您可以键入网络打印机的网络名称（例如 `\\printserver\printer1` ），即使您尚未在自己的计算机上安装该打印机的驱动程序。



当远程服务器尝试打印某些数据时，`PuTTY` 会将该数据发送到*原始*打印机 - 无需翻译、尝试格式化或对其执行任何其他操作。

由您来确保您的远程服务器知道它正在与哪种类型的打印机通信。



由于 `PuTTY` 将数据发送到原始打印机，因此它无法提供纵向与横向、打印质量或纸盒选择等选项。

所有这些事情都将由您的 `PC` 打印机驱动程序完成（ `PuTTY` 绕过），如果您需要完成它们，则必须找到一种方法来配置远程服务器来执行它们。



要再次禁用远程打印，请从打印机选择列表中选择“无（禁止打印）”，这是默认状态。



## 4.4 键盘面板

键盘配置面板允许您控制 `PuTTY` 中键盘的行为。

其中许多设置的正确状态取决于 `PuTTY` 连接到的服务器的期望。

对于 `Unix` 服务器，这可能取决于它使用的 `termcap` 或 `terminfo` 条目，而 `Terminal-type string` 条目又可能由“连接”面板中的“终端类型字符串”设置控制，有关详细信息，请参见[第 4.15.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-termtype)。

如果此处的设置似乎都没有帮助，您可能会发现[问题 A.7.13](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-keyboard) 很有用。

图c23



### 4.4.1 更改 `Backspace` 回退键的操作

一些终端认为退格键应该向服务器发送与 `Control-H` 相同的内容（ `ASCII` 代码 `8` ）。

其他终端认为退格键应该发送 `ASCII` 码 `127`（通常称为 `Control-?`），以便将其与 `Control-H` 区分开来。

此选项允许您选择按退格键时 `PuTTY`  生成的代码。



如果您通过 `SSH` 进行连接，`PuTTY` 默认会告诉服务器此选项的值（请参阅[第 4.24.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ttymodes)），因此您可能会发现 `Backspace` 键以任何一种方式执行正确的操作。

同样，如果您连接到 `Unix` 系统，您可能会发现 `Unix` 命令 `stty` 允许您配置服务器希望看到的内容，因此您可能不需要做出 `PuTTY` 生成的更改。

在其他系统上，服务器的期望可能是固定的，您可能别无选择，只能配置 PuTTY。



如果可以选择，我们建议您配置 `PuTTY` 以生成 `Control-?` 并将服务器配置为预期这样，因为这允许应用程序（例如`emacs`）使用 `Control-H` 寻求帮助。



（键入 `Shift-Backspace` 将导致 `PuTTY` 发送此处未配置为默认值的任何代码。）



### 4.4.2 更改 `Home` 和 `End` 键的操作

`Unix` 终端仿真器 `rxvt` 不同于世界其他地方关于应该通过 `Home` 和 `End` 键将哪些字符序列发送到服务器的观点。

`xterm`和其他终端，按 `Home` 键发送 `ESC [1` ，按 `End` 键发送 `ESC [4~` 。

`rxvt` 则按 `Home` 键发送 `ESC [H` ，按 `End` 键发送 `ESC [Ow`。



如果您发现某个应用程序的 `HOME` 和 `End` 键不起作用，您可以尝试切换此选项以查看是否有帮助。



### 4.4.3 更改 `Fn` 功能键和小键盘的操作

此选项会影响功能键（ `F1` 到 `F12` ）和数字小键盘的第一行。



- 在默认模式下，标记为 `ESC [n~` ，功能键会生成类似 `ESC [11~``ESC [12~` 的序列，依此类推。这与数字终端的一般行为相匹配。

- 在 `Linux` 模式下，`F6` 到 `F12` 的行为与默认模式类似，但 `F1` 到 `F5` 生成 `ESC [[A` 到 `ESC [[E` 。这模仿了 `Linux` 虚拟控制台。

- 在 `Xterm R6` 模式下，`F5` 到 `F12` 的行为类似于默认模式，但 `F1` 到 `F4` 生成 `ESC OP` 到 `ESC OS` ，这是由 数字终端上*键盘*顶行生成的序列。

- 在 `VT400` 模式下，所有功能键的行为都与默认模式类似，但数字小键盘的实际顶行生成 `ESC OP` 到 `ESC OS` 。

- 在 `VT100+` 模式下，功能键生成 `ESC OP` 到 `ESC O[` 。

- 在 `SCO` 模式下，功能键 `F1` 到 `F12` 生成 `ESC [M` 到 `ESC [X`。

  与 `shift` 一起，它们生成 `ESC [Y` 到 `ESC [j` 。

  与 `control` 一起，它们生成 `ESC [k` 到 `ESC [v` ，并且通过 `shift` 和 `control` 一起生成 `ESC [w` 到 `ESC [{` 。

- 在 `Xterm 216` 模式下，未按 `shift` 功能键的行为与 `Xterm R6` 模式相同。

  但是，将功能键与 `Shift` 或 `Alt` 或 `Ctrl` 一起按下会生成一个不同的序列，其中包含一个额外的数字参数，其形式为 （ `1` 表示 `Shift` ） + （ `2` 表示 `Alt` ） + （ `4` 表示 `Ctrl` ）+ 1。

  对于 `F1-F4` 来说，基本序列如 `ESC OP` 变成`ESC [1;bitmap` ，类似的对于 `F5` 及更高数字的功能键来说，`ESC [index~` 变成 `ESC[index;bitmap~` 。



如果您不知道这意味着什么，您可能不需要修改它。



### 4.4.4 更改 `Shift/Ctrl/Alt` 方向键的动作

此选项会影响方向键，如果按住任何修改键 `Shift` 、`Ctrl` 或 `Alt` 键。

- 在默认模式下，标记为 `Ctrl` 的键切换应用程序模式，`Ctrl` 键在默认方向键序列（如 `ESC[A` 和 `ESC[B` ）之间切换，数字终端在“应用程序光标键”模式下生成的序列（即 `ESC O A` 等）之间切换。`Shift` 和 `Alt` 无效。
- 在“xterm-style bitmap”模式下，`Shift` 、`Ctrl` 和 `Alt` 都会生成不同的序列，数字标识哪组修饰符处于活动状态。



如果您不知道这意味着什么，您可能不需要修改它。



### 4.4.5 控制应用程序光标键模式

应用程序光标键模式是服务器更改箭头键发送的控制序列的一种方式。

在常规模式下，箭头键将 `ESC [A` 发送到 `ESC [D` 。

在应用程序模式下，它们发送 `ESC OA` 到 `ESC OD` 。



应用程序光标键模式可以由服务器打开和关闭，具体取决于应用程序。

`PuTTY` 允许您配置初始状态。

您还可以使用“功能”配置面板完全禁用应用程序光标键模式，请参见[第 4.6.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-application)。



### 4.4.6 控制应用程序键盘模式

应用程序键盘模式是服务器更改数字键盘行为的一种方法。

在常规模式下，键盘的行为类似于普通的 `Windows` 键盘：打开 `NumLock` 时，数字键生成数字，关闭 `NumLock` 时，它们的行为类似于方向键和 `Home` ，`End` 等。



在应用程序模式下，所有键盘按键都会发送特殊的控制序列，包括 `Num Lock` 。

`Num Lock` 不再像 `Num Lock` 那样运行，而是成为另一个功能键。



根据您运行的 `Windows` 版本，您可能会发现每次按 `Num Lock` 时 `Num Lock` 指示灯仍然闪烁，即使应用程序模式处于活动状态并且 `Num Lock` 就像功能键一样，这是不可避免的。



应用程序键盘模式可由服务器打开和关闭，具体取决于应用程序。`PuTTY` 允许您配置初始状态。

您还可以使用“功能”配置面板完全禁用应用程序键盘模式，请参见[第 4.6.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-application)。



### 4.4.7 使用网络黑客键盘模式

`PuTTY` 有一个特殊的模式来玩 `NetHack` 。

您可以通过在“数字小键盘初始状态”控件中选择“NetHack”来启用它。



在此模式下，数字键盘键 `1-9` 生成 `NetHack` 移动命令 （ `hjklyubn` ）。

按键 `5` 生成命令 `.`（不执行任何操作）。



此外，使用键盘按下 `Shift` 或 `Ctrl` 会生成您期望的 `Shift` 或 `Ctrl` 键（例如，小键盘 `7` 生成 `y` ，因此按 `Shift` 加小键盘 `7` 生成 `Y` ，按 `Ctrl` 加小键盘 `7` 生成 `Ctrl-Y` ），这些命令告诉 `NetHack` 继续将您推向同一方向，直到您遇到有趣的事情。



出于某种原因，此功能仅在 `Num Lock` 打开时才能正常工作。我们不知道为什么。



### 4.4.8 启用类 `DEC` 的 `Compose` 键

`DEC` 终端具有 `Compose` 键，它提供了一种易于记忆的重音字符键入方式。

按下 `Compose` ，然后再键入两个字符。

这两个字符被“组合”以产生重音字符。

字符的选择设计为易于记忆，例如，组合“e”和“”会产生“è”字符。



如果您的键盘具有 `Windows` 应用程序键，它将充当 `PuTTY` 中的 `Compose` 键。

或者，如果启用“ `AltGr` 用作 `Compose` 键”选项，则 `AltGr` 键将成为 `Compose` 键。



### 4.4.9 `Control-Alt` 键与 `AltGr` 不同

某些旧键盘没有 `AltGr` 键，这会使键入某些字符变得困难。

`PuTTY` 可以配置为以与 `AltGr` 键相同的方式处理组合键 `Ctrl+左Alt` 。



默认情况下，此复选框处于选中状态，组合键 `Ctrl+左Alt` 执行完全不同的操作。

`PuTTY` 通常对左 `Alt` 键的处理是将 `Esc` （ `Control-[`） 字符前缀为按键其余部分将生成的任何字符序列。

例如，`Alt-A` 生成转义 `a`  ，因此，`Alt-Ctrl-A` 将后跟 `Control-A` 生成 `Escape` 。



如果取消选中此框，`Ctrl-Alt` 将成为 `AltGr` 的同义词，因此您可以使用它键入额外的图形字符（如果您的键盘有）。

（但是，无论[第 4.4.8 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-compose)中描述的“AltGr 充当 `Compose` 键”的设置如何，`Ctrl-Alt` 都不会充当 `Compose` 键。







## 4.5 响铃面板

响铃面板控制终端铃声功能：服务器能够使 `PuTTY` 向您发出哔哔声。

在默认配置中，当服务器发送带有 `ASCII` 代码 `7` （ `Control-G` ） 的字符时，`PuTTY` 将播放 `Windows` 默认蜂鸣音。

这并不总是您希望终端响铃功能执行的操作，响铃面板允许您配置替代操作。

图d01



### 4.5.1 “设置响铃类型”

此控件允许您选择要在终端响铃上发生的各种不同操作：

- 选择“无”将完全禁用响铃。

  在这种模式下，服务器可以发送任意数量的 `Control-G` 字符，并且根本不会发生任何事情。

- “使用系统默认警告声音”是默认设置。

  它会导致播放窗口“默认哔哔声”声音。

  若要更改此声音是什么，或者在似乎没有任何反应时对其进行测试，请使用 `Windows` 控制面板中的声音配置器。

- “可视响铃 (闪动窗口)”是哔哔声计算机的静音替代品。

  在此模式下，当服务器发送 `Control-G` 时，整个 `PuTTY` 窗口将闪烁白色几分之一秒。

- “使用 PC 扬声器鸣叫”是不言自明的。

- “播放指定的声音文件”允许您指定由 `PuTTY` 单独使用的特定声音文件，甚至由特定的单个 `PuTTY` 会话使用。

  这使您可以区分 `PuTTY` 蜂鸣音和系统上的任何其他蜂鸣音。

  如果选择此选项，则还需要在编辑控件“响铃时播放的声音文件”中输入声音文件的名称。



### 4.5.2 “响铃时任务栏/标题显示”

此功能控制在窗口没有输入焦点时出现铃声时，`PuTTY` 窗口在 `Windows` 任务栏中的条目会发生什么情况。

在默认状态（“禁用”）下，不会发生任何异常情况。

如果选择“反显”，则当铃声响起且窗口未聚焦时，窗口的任务栏条目及其标题栏将更改颜色，以告知 `PuTTY` 会话正在请求您的注意。

颜色的变化将持续到您选择窗口为止，因此您可以在终端中最小化几个 `PuTTY` 窗口，远离键盘，并确保在返回时不会错过任何重要的哔哔声。

“闪烁”更加引人注目：任务栏条目将持续闪烁，直到您选择窗口。



### 4.5.3 “设置重复响铃处理”

终端会话中常见的用户错误是不适当的文件类型（如可执行文件、图像文件或 `ZIP` 文件）意外运行 `Unix` 命令 `cat`（或等效命令）。

这会产生发送到终端的大量非文本字符流，其中通常包括许多响铃字符。

因此，终端通常不会停止哔哔声而持续十分钟，办公室里的其他人都会感到恼火。



为了避免这种行为或任何其他导致过度哔哔声的原因，`PuTTY` 包括响铃过载管理功能。

在默认配置中，在两秒内接收超过 `5` 个响铃字符将导致过载功能激活。

一旦重载功能处于活动状态，进一步的响铃将完全不起作用，因此二进制文件的其余部分将静音发送到屏幕。

在五秒钟内没有收到进一步的响铃后，过载功能将再次自行关闭，响铃将重新启用。



如果您希望完全禁用此功能，您可以使用“大量重复响铃时临时禁用响铃”复选框将其关闭。



或者，如果您喜欢响铃过载功能但不同意设置，则可以配置详细信息：多少响铃构成过载，它们必须到达多长时间才能实现过载，以及过载功能需要多少静默时间自行停用。

铃声过载模式始终由终端中的任何按键停用。

这意味着它可以响应大型意外数据流，但不会干扰生成哔哔声的普通命令行活动（如文件名完成）。



## 4.6 特性面板

`PuTTY` 的终端仿真功能非常强大，可以在远程服务器控制下做很多事情。

其中一些功能可能会由于错误或配置奇怪的服务器应用程序而导致问题。

功能配置面板允许您禁用 `PuTTY` 的一些更高级的终端功能，以防它们引起麻烦。

图d02



### 4.6.1 禁用应用程序键盘和光标键

应用程序键盘模式（请参阅第 4.4.6 节）和应用程序光标键模式（请参阅[第 4.4.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-appkeypad)）会更改键盘和光标键的行为。

某些应用程序启用这些模式，但随后无法正确处理已修改的按键。

无论服务器尝试执行什么操作，都可以强制永久禁用这些模式。



### 4.6.2 禁用 `xterm` 类型鼠标报告

`PuTTY` 允许服务器发送控制代码，使其接管鼠标并将其用于复制和粘贴以外的目的。

使用此功能的应用程序包括文本模式 `Web` 浏览器 `links` ，`Usenet` 新闻阅读器 `trn` 版本4和文件管理器 `mc` （ `Midnight Commander` ）。



如果您发现此功能不方便，可以使用“禁用 `xterm` 类型鼠标报告”控件禁用它。

选中此框后，鼠标将*始终*以正常方式进行复制和粘贴。



请注意，即使应用程序接管了鼠标，您仍然可以通过在选择和粘贴时按住 `Shift` 键来管理 `PuTTY` 的复制和粘贴，除非您有意关闭此功能（请参阅[第 4.11.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-mouseshift)）。



### 4.6.3 禁用改变远程控制终端大小

`PuTTY` 能够根据服务器的命令更改终端的大小和位置。

如果您发现 `PuTTY` 意外或不方便地执行此操作，您可以告诉 `PuTTY` 不要响应这些服务器命令。



### 4.6.4 禁用切换终端屏幕

包括 `PuTTY` 在内的许多终端都支持“备用屏幕”。

这与普通终端屏幕的尺寸相同，但是是分离的。

通常，基于屏幕的程序（如文本编辑器）可能会在启动之前将终端切换到备用屏幕。

然后在运行结束时，它会切换回主屏幕，您会看到屏幕内容，就像启动编辑器之前一样。



有些人宁愿这种情况不发生。

如果您希望编辑器与终端活动的其余部分在同一屏幕中运行，则可以完全禁用备用屏幕功能。



### 4.6.5 禁用改变远程控制窗口标题

`PuTTY` 能够更改窗口标题以响应来自服务器的命令。

如果您发现 `PuTTY` 意外或不方便地执行此操作，您可以告诉 `PuTTY` 不要响应这些服务器命令。



### 4.6.6 对远程窗口标题查询的响应

`PuTTY` 可以选择提供允许服务器应用程序查找本地窗口标题的 `xterm` 服务。

默认情况下，此功能处于禁用状态，但如果您确实需要，可以将其打开。



请注意，此功能存在*潜在的安全隐患*。

如果恶意应用程序可以将数据写入您的终端（例如，如果您只是服务器计算机上 `cat` 其他人拥有的文件），它可以更改您的窗口标题（除非您已按照[第 4.6.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-retitle)所述禁用此功能），然后使用此服务将新窗口标题发送回服务器，就像在键盘上键入一样。

这允许攻击者伪造按键，并可能导致您的服务器端应用程序执行您不希望的操作。

因此，此功能默认处于禁用状态，我们建议您不要将其设置为“窗口标题”，除非您*真的*知道自己在做什么。



此选项有三个设置：

- “无”

  `PuTTY` 对相关的转义序列没有任何反应。

  这可能会扰乱期望某种响应的服务器端软件。

- “空字符串”

  `PuTTY` 会做出格式正常的反映，仅将其留保持为空即可。

  因此，就能够期望服务器端软件可以保持满意的响应，而攻击者无法影响响应后的字符串。

  如果您没有更好的想法，这可能是您想要的设置。

- “窗口标题”

  `PuTTY` 使用实际的窗口标题进行响应。
  
  由于上述原因，这是危险的。



### 4.6.7 禁用远程控制清除回滚

`PuTTY` 能够清除终端的回滚缓冲区以响应来自服务器的命令。

如果您发现 `PuTTY` 意外或不方便地执行此操作，您可以告诉 `PuTTY` 不要响应该服务器命令。



### 4.6.8 禁用服务器发送 `^?` 时破坏性回退删除

通常，当 `PuTTY` 从服务器接收到字符 `127` （ `^?` ） 时，它将执行“破坏性退格”：将光标向左移动一个空格并删除其下方的字符。

这显然会导致某些应用程序出现问题，因此 `PuTTY` 提供了将字符 `127` 配置为执行正常退格键（不删除字符）的功能。



### 4.6.9 禁用远程控制字符集设置

`PuTTY` 能够更改其字符集配置以响应来自服务器的命令。

某些程序意外或不方便地发送这些命令。

特别是，`BitchX`（ `IRC` 客户端）似乎习惯于将字符集重新配置为用户预期以外的字符集。

如果您发现重音字符没有按预期方式显示，尤其是在您运行的是 `BitchX` 时，您可以尝试禁用远程字符集配置命令。



### 4.6.10 禁用修整阿拉伯文本

`PuTTY` 支持阿拉伯文本的修整，这意味着如果您的服务器发送以基本 `Unicode` 阿拉伯字母书写的文本，那么它会在将其打印到屏幕上之前将其转换为正确的显示形式。



如果您使用的是全屏软件，而该软件没有预料到会发生这种情况（特别是如果您不是阿拉伯语使用者，并且意外地发现自己在无法识别阿拉伯语的应用程序中处理阿拉伯语文本文件），您可能会发现显示内容被破坏。

通过勾选此框，您可以禁用阿拉伯文本修整，以便 `PuTTY` 精确显示它被告知要显示的字符。

您可能还会发现需要禁用双向文本显示;请参阅[第 4.6.11 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-bidi)。



### 4.6.11 禁用双向文本显示

`PuTTY` 支持双向文本显示，这意味着如果您的服务器发送以通常从右到左显示的语言（例如阿拉伯语或希伯来语）编写的文本，则 `PuTTY` 将自动将其翻转，使其在屏幕上以正确的方向显示。



如果您使用的是全屏软件，而该软件没有预料到会发生这种情况（特别是如果您不是阿拉伯语使用者，并且意外地发现自己在无法识别阿拉伯语的应用程序中处理阿拉伯语文本文件），您可能会发现显示内容被破坏。

通过勾选此框，您可以禁用双向文本显示，以便 `PuTTY` 在所有情况下从左到右显示文本。



您可能还会发现需要禁用阿拉伯文本修整;请参阅[第 4.6.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-shaping)。



## 4.7 窗口面板

窗口配置面板允许您控制 `PuTTY` 窗口的各个方面。

图d03



### 4.7.1 设置 `PuTTY` 窗口的大小

“列”和“行”框可让您将 `PuTTY` 窗口设置为精确大小。

当然，您也可以在会话运行时将窗口拖动到新大小。



### 4.7.2 调整窗口大小时该怎么办

这些选项允许您控制当用户尝试使用其窗口调整 `PuTTY` 窗口大小时发生的情况。

这里有四个选项：

- “改变行列数”：字体大小不会更改。（这是默认值。）
- “改变字体大小”：终端中的行数和列数将保持不变，字体大小将发生变化。
- “只在最大化时改变字体大小”：调整窗口大小时，行数和列数将更改，*除非*窗口最大化（或恢复）时，字体大小将更改。（在此模式下，在调整大小的同时按住 `Alt` 键也会导致字体大小更改。）
- “完全禁用窗口大小改变”：终端将拒绝调整大小。



### 4.7.3 设置窗口回滚

这些选项允许您配置 `PuTTY` 在文本滚动到屏幕顶部后保留文本的方式（请参阅[第 3.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-scrollback)）。

“回滚行数”框可让您配置 `PuTTY` 保留的文本行数。

“显示滚动条”选项允许您隐藏滚动条（尽管您仍然可以按照[第 3.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-scrollback)所述使用键盘查看回滚）。

您可以单独配置滚动条是在全屏模式下显示还是在正常模式下显示。



如果在服务器向 `PuTTY` 发送更多文本时查看部分回滚，屏幕将恢复为显示当前终端内容。

您可以通过关闭“重置显示活动时的回滚”来禁用此行为。

您还可以在按键时通过打开“按键时重置回滚”来使屏幕恢复。



### 4.7.4 “将清除的文本压入回滚”

启用此选项后，当服务器端应用程序清除屏幕时，终端屏幕的内容将被推送到回滚中，以便您的回滚将包含过去屏幕上内容的更好记录。



如果应用程序切换到备用屏幕（有关详细信息，请参阅[第 4.6.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-altscreen)），则主屏幕的内容将在回滚中可见，直到应用程序再次切换回来。

默认情况下，此选项处于启用状态。



## 4.8 外观面板

外观配置面板允许您控制 `PuTTY` 窗口外观的各个方面。

图d04



### 4.8.1 控制光标的外观

“光标显示”选项允许您将光标配置为块、下划线或垂直线。

当窗口失去焦点时，块光标变为空框，下划线或垂直线变为虚线。

“光标闪烁”选项使光标闪烁和关闭，这适用于任何光标模式。



### 4.8.2 控制终端窗口中使用的字体

此选项允许您选择 `PuTTY` 终端窗口用于显示会话中文本的字体和大小。

默认情况下，系统将提供系统上安装的所有固定宽度字体的选择，因为 `VT100` 样式的终端处理需要固定宽度的字体。

但是，如果您勾选标有“启用可变间距字体”的框，`PuTTY` 也将提供可变宽度字体：如果您选择其中一种，字体将被强制转换为固定大小的字符单元格，这可能看起来不太好（但可以与某些字体一起使用）。



### 4.8.3 “在窗口中键入时隐藏鼠标指针”

如果启用此选项，则在选择 `PuTTY` 窗口并按下某个键时，鼠标指针将消失。

这样，当您在会话中工作时，它不会遮挡窗口中的任何文本。

一旦您移动鼠标，指针就会重新出现。

默认情况下，此选项处于禁用状态，因此鼠标指针始终保持可见。



### 4.8.4 调整窗口边框

`PuTTY` 允许您在一定程度上配置窗口边框的外观。

标记为“下沉边框(细瘦外观)”的复选框将窗口边框的外观更改为更像 `DOS` 框的外观：边框的内边缘突出显示，就好像它下沉与窗口内的表面相遇一样。

这使得边框也更粗一点，很难很好地描述。

尝试一下，看看你是否喜欢它。

您还可以使用“文本与窗口边界的距离”控件在窗口中的文本和边框之间配置完全空白的间隙。

默认情况下，此值设置为一个像素。

您可以将其减少到零，也可以进一步增加。



## 4.9 行为面板

行为配置面板允许您控制 `PuTTY` 窗口行为的各个方面。

图d05



### 4.9.1 调整窗口标题外观

“窗口标题”编辑框允许您设置 `PuTTY` 窗口的标题。

默认情况下，窗口标题将包含主机名，后跟“PuTTY”，例如，`server1.example.com - PuTTY` 。

如果您想要不同的窗口标题，则可以在此处设置它。



`PuTTY` 允许服务器发送 `xterm` 控制序列，这些控制序列在会话中修改窗口的标题（除非禁用此功能 - 请参阅[第 4.6.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-retitle)）;因此，此处设置的标题字符串只是*初始*窗口标题。



除了窗口标题外，还有一个修改窗口标题图标的 `xterm` 序列。

这在窗口系统中是有意义的，其中窗口在最小化时成为图标，例如 `Windows 3.1` 或大多数 `X` 窗口系统设置;但在类似 `Windows 95` 的用户界面中，它并不适用。



默认情况下，`PuTTY` 仅使用服务器提供的窗口标题，并完全忽略图标标题。

如果出于某种原因您想同时查看两个标题，请选中标有“使用单独的客户区窗口”的框。

如果执行此操作，`PuTTY` 的窗口标题和任务栏标题将更改为服务器提供的图标标题（如果最小化 `PuTTY` 窗口），如果还原它，则更改回服务器提供的窗口标题。（如果服务器没有费心提供窗口或图标标题，则不会发生任何情况。



### 4.9.2 “关闭窗口时警告”

如果您在包含正在运行的会话的 `PuTTY` 窗口中按下“关闭”按钮，`PuTTY` 将显示一个警告窗口，询问您是否真的要关闭该窗口。

会话已终止的窗口始终可以关闭而不发出警告。

如果您希望能够快速关闭窗口，则可以禁用“关闭窗口前警告”选项。



### 4.9.3 “ALT+F4 关闭窗口”

默认情况下，按 `ALT+F4` 会导致窗口关闭（或出现警告框;请参阅[第 4.9.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-warnonclose)）。

如果禁用“窗口在 `ALT+F4` 上关闭”选项，则按 `ALT-F4` 将简单地将键序列发送到服务器。



### 4.9.4 “Alt+空格显示系统菜单”

如果启用此选项，则按 `ALT+空格键` 将弹出 `PuTTY` 窗口的菜单，就像单击窗口的左上角一样。

如果禁用，则按 `ALT+空格键` 将只发送 `ESC+SPACE` 到服务器。



某些适用于 `Windows` 的辅助功能程序可能需要此选项才能成功控制 `PuTTY` 的窗口。

例如，`Dragon NaturalPeaks` 要求它既要通过语音打开系统菜单，又要关闭，最小化，最大化和恢复窗口。



### 4.9.5 “Alt键显示系统菜单”

如果启用此选项，则按下并释放 `ALT` 将弹出 `PuTTY` 窗口的菜单，就像单击左上角一样。

如果禁用，则按下并释放 `ALT` 将不起作用。



### 4.9.6 “窗口总在最上层”

如果启用此选项，`PuTTY` 窗口将位于所有其他窗口的顶部。



### 4.9.7 “Alt+回车全屏”

如果启用此选项，则按 `Alt+Enter` 将导致 `PuTTY` 窗口变为全屏。

再次按 `Alt+Enter` 将恢复以前的窗口大小。

全屏功能也可从“系统”菜单中使用，即使已经配置了在 `Alt+Enter` 键上不可全屏。请参见[第 3.1.3.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-fullscreen)。



## 4.10 转换面板

转换配置面板允许您控制服务器理解的字符集与 `PuTTY` 理解的字符集之间的转换。

图d06



### 4.10.1 控制字符集转换

在交互式会话期间，`PuTTY` 从服务器接收 `8` 位字节流，为了在屏幕上显示它们，它需要知道要解释它们的字符集。

同样，`PuTTY` 需要知道如何将您的击键转换为服务器期望的编码。

不幸的是，`PuTTY` 和服务器没有令人满意的机制来传达此信息，因此通常必须手动配置。



有很多字符集可供选择。

“远程字符集”选项可让您选择一个字符集。



默认情况下，`PuTTY` 将使用 `Unicode` 的 `UTF-8` 编码，它几乎可以表示任何字符。

来自服务器的数据被解释为 `UTF-8` ，击键以 `UTF-8` 编码发送。

这是大多数现代 `Linux` 发行版默认所期望的。

但是，如果你的服务器出现了字符错误，则可以使用此控件选择其他字符集。



其他一些值得注意的字符集是：

- `ISO-8859` 系列都是标准字符集，包括适用于不同语言集的各种重音字符。

- `Win125x` 系列由微软定义，用于类似目的。

  特别是 `Win1252` 几乎等同于 `ISO-8859-1` ，但包含一些额外的字符，例如匹配的引号和欧元符号。

- 如果要使用块图形和线条绘制字符的旧 `IBM PC` 字符集，可以选择“CP437”。



如果需要支持下拉列表中未列出的数字代码页（如代码页 `866` ），则可以尝试在列表框中手动输入其名称（例如 `CP866` ）。

如果 `Windows` 的基础版本安装了相应的转换表，`PuTTY` 将使用它。



### 4.10.2 “将不明确字符处理为 `CJK` 中日韩字符”

有一些 `Unicode` 字符的宽度没有明确定义。

在大多数情况下，出于换行等目的，此类字符应被视为单角字符。

但是，在某些 `CJK` 上下文中，由于历史原因，它们最好被视为双倍宽度，并且某些服务器端应用程序可能希望它们以这种方式显示。

设置此选项将导致 `PuTTY` 采用双倍宽度解释。



如果您使用旧版 `CJK` 应用程序，并且发现您换行在错误的位置，或者您遇到其他显示问题，则可能需要使用此设置。

此选项仅在 `UTF-8` 模式下有效（请参阅[第 4.10.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-charset)）。



### 4.10.3 “`Caps Lock` 大小写按键用于 `Cyrillic` 切换”

如果您需要在同一文档中并排键入（例如）俄语和英语，此功能允许您使用 `Caps Lock` 键在美国/英国键盘布局和西里尔文键盘布局之间切换。

目前，如果您的本机键盘布局不是美国或英国，则此功能预计无法正常工作。



### 4.10.4 调整 `PuTTY` 如何重绘字符行

`VT100` 系列终端允许服务器发送控制序列，这些控制序列暂时转换为单独的字符集，用于绘制简单的线条和框。

但是，`PuTTY` 可以通过多种方式尝试查找合适的字符，使用正确的字符取决于本地配置的字体。

一般来说，您可能应该尝试很多选项，直到找到您的特定字体支持的选项。



- “使用 `Unicode` 统一码重绘代码”尝试使用 `Unicode` 中存在的框字符。

  对于良好的 `Unicode` 支持字体，这可能是最可靠和最实用的选择。

- “简单重绘行”假设字体*根本无法*生成线条和框字符，因此它将使用 `+` 、 `-` 和 `|` 字符来绘制框的近似值。

  如果其他选项都不起作用，则应使用此选项。

- “使用 `X Windows` 编码字体”适用于具有特殊编码的字体，其中最低的 `32` 个字符位置（低于 `ASCII` 可打印范围）包含线条绘制字符。

  任何标准 `Windows` 字体都不太可能出现这种情况;它可能仅适用于自定义构建的字体或从 `X Window` 系统自动转换的字体。

- “使用 `ANSI` 和 `OEM` 字体”尝试在两个不同的字符集中使用相同的字体，以获得更广泛的字符范围。

  这并不总是有效，某些字体声称大小不同，具体取决于您尝试使用的字符集。

- “只使用 `OEM` 字体”比这更可靠，但可能会错过主要字符集中的其他字符。



### 4.10.5 重绘字符类似 `lqqqk` 复制粘贴行

默认情况下，当您复制并粘贴包含 `VT100` 线条和框绘图字符的 `PuTTY` 屏幕片段时，`PuTTY` 会以它们在屏幕上显示的形式粘贴它们：`Unicode` 行绘制代码点或“简单”地线绘制字符 `+` 、 `-` 和 `|` 。

“将 `VT100` 线绘制字符复制并粘贴为 lqqqk”复选框禁用此功能，结果就是线绘制字符将粘贴为打印以生成它们的 `ASCII` 字符。

这通常意味着它们大多以 `q` 和 `x` 的形式出现，在拐角处有零星的 `jklmntuvw` 。

例如，如果您尝试在另一个程序中重新创建相同的框布局，这可能很有用。



请注意，此选项仅适用于使用 `VT100` *机制打印的*线绘制字符。

作为 `Unicode` 码位接收的线绘制字符将始终粘贴为 `Unicode` 代码点。



### 4.10.6 即使在 `UTF-8` 模式下也启用 `VT100` 线绘制

如果 `PuTTY` 配置为将来自服务器的数据视为 `UTF-8` 编码，则默认情况下，它会禁用较旧的 `VT100` 样式控制序列系统，该系统会导致小写字母暂时替换为线绘制字符。



其基本原理是，在 `UTF-8` 模式下，您无论如何都不需要这些控制序列，因为它们访问的所有线字符都已经作为 `Unicode` 字符提供，因此应用程序无需将终端置于特殊状态来获取它们。



此外，它消除了终端*意外*进入该状态的风险：如果您不小心将不受控制的二进制数据写入非 `UTF-8` 终端，则发现下一个 `shell` 提示符显示为一系列线绘制字符，然后您必须记住或查找如何退出该模式，这是非常普遍的。

因此，默认情况下，`UTF-8` 模式根本没有像这样令人困惑的模式，无论是*意外的还是*故意的。



但是，并非所有应用程序都会这样看。

即使是 `UTF-8` 终端用户有时仍然必须运行尝试以老式方式打印线绘制字符的软件。

因此，配置选项“即使在 `UTF-8` 模式下也能启用 `VT100` 线绘制”将 `PuTTY` 置于混合模式，在该模式下，它理解更改 `ASCII` 小写字母含义的 `VT100` 样式控制序列，并理解 `UTF-8`。



## 4.11 选择面板

“选择”面板允许您在 `PuTTY` 窗口中控制复制和粘贴的工作方式。

图d07



### 4.11.1 更改鼠标按钮的操作

`PuTTY` 的复制和粘贴机制默认以 `Unix` 应用程序 `xterm` 为模型。

`X Window` 系统使用三键鼠标，该系统中的约定是左按钮选择，右按钮扩展现有选择，中间按钮粘贴。



`Windows` 通常只有两个鼠标按钮，因此在 `Windows` 上运行时，`PuTTY` 是可配置的。

在 `PuTTY` 的默认配置（“妥协”）中，*右*键粘贴，*中间*按钮（如果有）扩展选择。



如果您有三键鼠标并且已经习惯了 `xterm` 这种排列方式，则可以使用“鼠标按钮动作”控件选择它。



或者，选择“Windows”选项后，中间按钮扩展，右键弹出一个上下文菜单（其中一个选项是“粘贴”）。

（无论此选项的设置如何，通过按住 `Ctrl` 并右键单击始终可以使用此上下文菜单。）

（当 `PuTTY` 本身在 `Unix` 上运行时，它遵循 `X Window` 系统约定。）



### 4.11.2 “`Shift` 上档键可与鼠标组合使用”

`PuTTY` 允许服务器发送控制代码，使其接管鼠标并将其用于复制和粘贴以外的目的。

使用此功能的应用程序包括文本模式 `Web` 浏览器 `links` ，`Usenet` 新闻阅读器 `trn` 版本 `4` 和文件管理器 `mc` （ `Midnight Commander` ）。



运行这些应用程序之一时，按鼠标按钮不再执行复制和粘贴。

如果确实需要复制和粘贴，如果在单击鼠标时按住 `Shift` ，仍然可以执行此操作。



但是，从理论上讲，应用程序甚至可以检测和使用 `Shift + 鼠标单击` 。

我们不知道有任何应用程序可以这样做，但如果有人编写了一个应用程序，取消选中“ `Shift` 覆盖应用程序使用鼠标”复选框将导致 `Shift + 鼠标单击` 也转到服务器（以便完全禁用鼠标驱动的复制和粘贴）。



如果要阻止应用程序完全接管鼠标，可以使用“特性”控制面板执行此操作;请参见[第 4.6.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-features-mouse)。



### 4.11.3 默认选择模式

如[第 3.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-selection)所述，`PuTTY` 有两种选择要复制到剪贴板的文本的模式。

在默认模式（“正常”）下，将鼠标从 `A` 点拖动到 `B` 点，选择到包含 `A` 的行的末尾、中间的所有行以及包含 `B` 的行的最开头。

在另一种模式（“矩形框”）中，在两点之间拖动鼠标定义一个矩形，并复制该矩形中的所有内容。



通常，您必须在拖动鼠标时按住 `Alt` 以选择矩形块。

使用“默认选择模式”控件，您可以将矩形选择设置为默认值，然后必须按住 `Alt` 才能获得*正常*行为。



### 4.11.4 将复制和粘贴操作分配给剪贴板

在这里，您可以配置通过 `PuTTY` 的各种复制和粘贴操作写入或读取的剪贴板。

大多数平台（包括 `Windows` ）都有一个系统剪贴板。

在这些平台上，`PuTTY` 提供了第二个类似剪贴板的功能，允许您粘贴您上次在此*窗口中*选择的文本，无论它当前是否也在系统剪贴板中。

默认情况下不启用此功能。



`X Window` 系统（大多数 `Unix` 图形界面的基础）提供了多个剪贴板（或“选择”），许多应用程序通过不同的用户界面机制支持多个剪贴板。

当 `PuTTY` 本身在 `Unix` 上运行时，它具有与这些选择相关的更多可配置性。



两个最常用的选择称为“PRIMARY”和“CLIPBOARD”。

在同时支持这两种操作的应用程序中，通常的行为是 `PRIMARY` 仅鼠标操作使用（选择文本会自动将其复制到 `PRIMARY` ，中键单击粘贴自 `PRIMARY` ），而 `CLIPBOARD` 由显式的“复制和粘贴”菜单项或按键（如 `Ctrl-C` 和 `Ctrl-V` ）使用。



#### 4.11.4.1 “自动复制选择的文本”

复选框“自动复制选择的文本到：系统剪贴板”控制在 `PuTTY` 终端窗口中选择文本是否自动具有将其复制到系统剪贴板，而无需单独的用户界面操作。



在 `X` 上，此选项的措辞略有更改，因此使用“剪贴板”代替“系统剪贴板”。

在终端窗口中选择的文本将始终自动放置在 `PRIMARY` 选择中，这是常规的，但是如果您勾选此框，它也将同时放置在“`CLIPBOARD` 剪贴板”中。



#### 4.11.4.2 为 `UI` 操作选择剪贴板

`PuTTY` 有三个用户界面操作，可以配置为粘贴到终端中（不包括菜单项）。

您可以单击配置为粘贴的任何鼠标按钮（如果有）（请参阅[第 4.11.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-mouse)），您可以按移入，或者您可以按 `Ctrl-Shift-V` ，尽管默认情况下不启用该操作。



您可以配置每个操作从哪些可用剪贴板粘贴（包括完全关闭粘贴操作）。

在具有单个系统剪贴板的平台（如 `Windows` ）上，可用的选项是从该剪贴板粘贴，或从 `PuTTY` 的内部内存粘贴该窗口中最后一个选定的文本。

在 `X` 上，标准选项为 `CLIPBOARD` 或 `PRIMARY` 。



( `PRIMARY` 在概念上相似，因为它也引用最后选定的文本 - 仅跨所有应用程序，而不仅仅是此窗口。)



这两个键盘选项都带有一个相应的键，可以复制到同一个剪贴板。

无论您将 `Shift-Ins` 配置为从中粘贴，`Ctrl-Ins` 都将复制到同一位置；类似地，`Ctrl-Shift-C` 将复制到 `Ctrl-Shifte-V` 粘贴的任何位置。



在 `X` 上，您还可以输入您选择的名称。

例如，有一个很少使用的标准选择叫做 `SECONDARY` ，`Emacs`（例如）如果你在拖动选择或点击粘贴时按住 `Meta` 键，则可以使用它；如果配置 `PuTTY` 键盘操作以访问此剪贴板，则可以与其他应用程序的使用进行互操作。

您可以做的另一件事是自己创建一个剪贴板名称，创建一个仅在 `PuTTY` 实例之间共享的特殊剪贴板，或者仅在以该特定方式配置的实例之间共享。



### 4.11.5 “启用粘贴含有控制字符的文本”

剪贴板可能不仅包含文本（带有换行符和制表符），还可以包含诸如 `ESC` 之类的控制字符，如果粘贴到终端会话中，可能会产生令人惊讶的效果，具体取决于服务器端正在运行的程序。

从恶作剧的网页复制文本可能会将这些字符放在剪贴板上。



默认情况下，`PuTTY` 会过滤掉更不寻常的控制字符，只允许通过更明显的文本格式字符（换行符、制表符、退格键和 `DEL` ）。



设置此选项将停止此筛选;粘贴时，剪贴板上的任何字符都会未经审查地发送到会话。

例如，如果您有意将控件字符粘贴用作简单的脚本形式，这可能很有用。



## 4.12 复制面板

复制配置面板控制与从终端窗口复制到剪贴板相关的行为。

图d08



### 4.12.1 字符类

如果您双击开始拖动，`PuTTY` 将在终端窗口中一次选择一个单词。

此部分允许您精确控制被视为单词的内容。



每个字符都有一个类，是一个小数字（通常为 `0` 、`1` 或 `2` ）。

`PuTTY` 认为单个单词是同一类中任意数量的相邻字符。

因此，通过修改对类的字符分配，可以修改逐字选择行为。



在默认配置中，字符类为：

- 类 `0` 包含空格和控制字符。
- 类 `1` 包含大多数标点符号。
- 第 `2` 类包含字母、数字和一些标点符号（双引号、减号、句点、正斜杠和下划线）。



因此，例如，如果将符号 `@` 分配给字符类 `2` ，则只需双击即可选择电子邮件地址。



为了调整这些分配，首先在列表框中选择一组字符。

然后在下面的编辑框中输入班级编号，然后按“设置”按钮。



此机制目前仅涵盖 `ASCII` 字符，因为扩展列表以涵盖整个 `Unicode` 是不可行的。



字符类定义可以通过服务器发送的控制序列进行修改。

此配置选项控制*默认*状态，该状态将在重置终端时恢复（请参阅[第 3.1.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#reset-terminal)）。

但是，如果您在会话中途使用“更改设置”修改此选项，它将立即生效。



### 4.12.2 富文本格式复制

如果您启用“粘贴 `RTF` 文本到剪贴板”，`PuTTY` 会将格式信息以及您复制的实际文本写入剪贴板。

这样做的效果是，如果您粘贴到（例如）文字处理器中，文本将以与 `PuTTY` 用于显示它的字体、颜色和样式（例如粗体、下划线）相同的字体、颜色和样式出现在文字处理器中。



此选项很容易不方便，因此默认情况下处于禁用状态。



## 4.13 颜色面板

“颜色”面板允许您控制 `PuTTY` 对颜色的使用。

图d09



### 4.13.1 “允许终端指定 `ANSI` 颜色”

默认情况下，此选项处于启用状态。

如果禁用，`PuTTY` 将忽略服务器发送的任何控制序列以请求彩色文本。



如果你有一个特别花哨的应用程序，你可能想关闭这个选项，使 `PuTTY` 只使用默认的前景色和背景色。



### 4.13.2 “启用终端使用 `xterm 256` 色模式”

默认情况下，此选项处于启用状态。

如果禁用，`PuTTY` 将忽略服务器发送的任何控制序列，这些控制序列使用最新版本 `xterm` 支持的扩展 `256` 色模式。



如果你有一个应该使用 `256` 色模式的应用程序，但它不起作用，你可能会发现你需要告诉你的服务器你的终端支持 `256` 色。

在 `Unix` 上，您可以通过确保 `TERM` 的设置描述一个支持 `256` 色的终端来执行此操作。

您可以使用以下命令进行检查，例如：`infocmp` ：

```
$ infocmp | grep colors
        colors#256, cols#80, it#8, lines#24, pairs#256,
```



如果在输出中没有看到“ `colors#256` ”，则可能需要更改终端设置。

在现代 `Linux` 机器上，您可以尝试“ `xterm-256color` ”。



### 4.13.3 “启用终端使用 `24` 位颜色”

默认情况下，此选项处于启用状态。

如果禁用，`PuTTY` 将忽略服务器发送的任何控制序列，这些控制序列使用现代终端支持的控制序列来指定任意 `24` 位 `RGB` 颜色值。



### 4.13.4 “粗体文本表现”

当服务器发送一个控制序列，指示某些文本应以粗体显示时，`PuTTY` 可以通过多种方式处理此问题。

它可以更改粗体版本的字体，也可以使用相同的字体以获得更明亮的颜色，或者它可以同时执行这两项操作（使颜色变亮*并使*字体加粗）。

此控件允许您选择哪个。



默认情况下，粗体由颜色表示，因此非粗体文本以浅灰色显示，粗体文本以亮白色显示（同样以其他颜色显示）。

如果您将设置更改为“字体”框，粗体和非粗体文本将以相同的颜色显示，而是字体将更改以指示差异。

如果选择“两者”，字体和颜色都会改变。



一些应用程序依赖于“粗体黑色”与黑色背景的区别，如果您选择“字体”，则其文本可能会变得不可见。



### 4.13.5 “尝试使用逻辑调色板”

逻辑调色板是一种机制，通过该机制，在 `8` 位彩色显示器上运行的 `Windows` 应用程序可以精确选择所需的颜色，而不是使用 `Windows` 标准默认值。

如果您在 `8` 位显示器上没有获得所需的颜色，您可以尝试启用此选项。

但是，请注意，它从来没有很好地工作过。



### 4.13.6 “使用系统颜色”

启用此选项将导致 `PuTTY` 忽略“默认背景/前景”和“光标颜色/文本”的配置颜色（请参阅[第 4.13.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-colourcfg)），而是使用系统范围的默认值。

请注意，如果启用此选项，非粗体文本和粗体文本的颜色将相同。

您可能希望通过更改字体更改为指示粗体文本（请参阅[第 4.13.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-boldcolour)）。



### 4.13.7 调整终端窗口中的颜色

主颜色控件允许您准确指定事物应以什么颜色显示。

若要修改 `PuTTY` 颜色之一，请使用列表框选择要修改的颜色。

该颜色的 `RGB` 值将显示在列表框的右侧。

现在，如果您按下“修改”按钮，您将看到一个颜色选择器，您可以在其中选择新颜色来代替旧颜色。

（如果您愿意，您也可以直接在编辑框中编辑 `RGB` 值;每个值都是 `0` 到 `255` 之间的整数。



`PuTTY` 允许您设置光标颜色、默认前景和背景以及所有 `ANSI` 可配置颜色（黑色、红色、绿色、黄色、蓝色、品红色、青色和白色）的精确阴影。

您还可以修改用于这些颜色的粗体版本的精确色调;如果您选择通过颜色指示粗体文本，则它们用于显示粗体文本（请参阅[第 4.13.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-boldcolour)），如果服务器特别要求使用它们。也可以使用它们。

（请注意，“默认粗体背景”*不是*用于粗体文本的背景颜色;仅当服务器特别要求粗体背景时才使用。）



## 4.14 连接面板

“连接”面板允许您配置适用于多种连接类型的选项。

图d10



### 4.14.1 使用激活来防止断开连接

如果您发现会话在空闲一段时间后意外关闭（通常为“由对等方重置连接”），您可能需要尝试使用此选项。

某些网络路由器和防火墙需要跟踪通过它们的所有连接。

通常，如果在一定时间间隔后没有数据在任一方向上传输，这些防火墙将假定连接已失效。

这可能会导致 `PuTTY` 会话在一段时间内未在会话中看到流量时被防火墙意外关闭。



激活选项（“空包发送时间间隔”）允许您将 `PuTTY` 配置为定期通过会话发送数据，而不会中断实际的终端会话。

如果您发现防火墙正在切断空闲连接，则可以尝试在此字段中输入非零值。

该值以秒为单位，因此，例如，如果您的防火墙在十分钟后切断连接，那么您可能需要在框中输入 `300` 秒（ `5` 分钟）。



请注意，保持连接并不总是有帮助的。

如果您的防火墙在空闲期后会断开连接，它们会有所帮助，但是，如果您和服务器之间的网络受到连接中断的影响，那么 `keepalives` 保持连接实际上会使事情变得更糟。

如果会话处于空闲状态，并且端点之间的连接暂时丢失，但连接在任何一方尝试发送任何内容之前恢复，则不会有问题 - 两个端点都不会注意到有任何问题。

但是，如果一方在空闲期间确实发送了某些内容，它将反复尝试重新发送，最终放弃连接。

然后，当连接恢复时，另一方会发现第一方不再相信已经存在的开放的连接。

`Keepalives` 保持连接可能会使这类问题变得更糟，因为它们增加了 `PuTTY` 在连接中断期间尝试发送数据的可能性。

（其他类型的定期网络活动可能会导致此行为;特别是，SSH-2 重新密钥可能会产生这种影响。请参阅[第 4.18.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-rekey)。）



因此，您可能会发现 `keepalives` 有助于连接丢失，或者您可能会发现它们会使情况变得更糟，具体取决于您和服务器之间存在*的网络问题类型*。

Keepalives仅在Telnet和SSH中受支持;Rlogin，SUPDUP和Raw协议不提供实现它们的方法。（有关替代方法，请参见[第 4.14.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-tcp-keepalives)。

请注意，如果您使用的是 `SSH-1` ，并且服务器存在使其无法处理 `SSH-1` 忽略消息的错误（请参阅[第 4.27.13 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-ignore1)），则启用激活将不起作用。



### 4.14.2 “禁用 `Nagle` 算法”

`Nagle` 的算法是 `TCP/IP` 实现的一个细节，它试图最大限度地减少通过网络连接发送的小数据包的数量。

启用 `Nagle` 算法后，`PuTTY` 的带宽使用效率会略高一些;禁用它后，您可能会发现在连接到某些类型的服务器时，您的击键响应速度更快。

默认情况下，对于交互式连接禁用 `Nagle` 算法。



### 4.14.3 “启用 `TCP` 保持活动连接”

*注意：*`TCP` 激活不应与[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)中描述的应用程序级激活混淆。

如果有疑问，您可能需要应用程序级保持连接;提供 `TCP` 保持连接是为了完整性。



`TCP` 保持连接的想法类似于应用程序级保持连接，并且相同的警告适用。主要区别是：

- `TCP` 保持连接*在所有网络连接类型*上都可用，包括 `Raw` 、`Rlogin` 和 `SUPDUP` 。
- `TCP` 保持连接之间的间隔通常要长得多，通常为两个小时;这是由操作系统设置的，无法在 `PuTTY` 中进行配置。
- 如果操作系统没有收到对保持连接的响应，它可能会快速连续发送更多响应，并在未收到响应时终止连接。



`TCP` 保持连接对于确保终止半打开的连接可能比保持连接处于活动状态更有用。

默认情况下，`TCP` 保持连接处于禁用状态。



### 4.14.4 “互联网协议版本”

此选项允许用户在新旧互联网协议和寻址方案（ `IPv4` 和 `IPv6` ）之间进行选择。

所选协议将用于大多数传出网络连接（包括与代理的连接）;但是，隧道有自己的配置，有关配置，请参见[第 4.26.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-portfwd-address-family)。



默认设置为“自动”，这意味着 `PuTTY` 将执行一些明智的操作并尝试猜测您想要的协议。

（如果指定文字 `Internet` 地址，它将使用该地址所暗示的任何协议。如果您提供主机名，它将看到该主机名存在哪种地址;如果有可用的 `IPv6` 地址，它将使用 `IPv6` ，如果没有，它将回退到 `IPv4` 。）

如果您需要强制 `PuTTY` 使用特定协议，您可以明确将其设置为“IPv4”或“IPv6”。



### 4.14.5 “远程主机的注册名字”

这允许您告诉 `PuTTY` ，它最终真正连接到的主机与它认为建立网络连接的位置不同。

例如，如果您在一个 `PuTTY` 会话中设置了一个 `SSH` 端口转发，以便将到某个任意端口（例如 `localhost` 端口 `10022` ）的连接转发到第二台计算机的 `SSH` 端口（例如 `foovax` 端口 `22` ），然后启动连接到转发端口的第二个 `PuTTY` ，则可以使用它。



在正常使用中，第二个 `PuTTY` 将访问其实际连接到的主机名和端口下的主机密钥缓存（即 `localhost` 此示例中的端口 `10022`）。

但是，使用注册主机名选项，您可以将第二个 `PuTTY` 配置为将主机密钥缓存在*已知*它*最终*会与之通信的主机名称下（这里指 `foovax` ）。



如果您希望通过许多不同的通道连接到同一实际服务器（可能是因为您的端口转发安排不断变化），这会很有用：通过一致地设置注册主机名，您可以安排 `PuTTY` 不会一直要求您重新确认其主机密钥。

相反，如果您希望使用相同的本地端口号将端口号转发到许多不同的服务器，则您可能不希望在该本地端口号下缓存任何特定服务器的主机密钥。

（对于后一种情况，您可以在相关会话中显式配置主机密钥;请参阅[第 4.19.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-manual-hostkeys)。）



如果您只为此选项输入主机名，`PuTTY` 会将 `SSH` 主机密钥缓存在该主机的默认 `SSH` 端口下，而不管您实际连接到哪个端口（因为典型场景类似于上面的例子：您连接到一个愚蠢的真实端口号，您的连接最终转发到其他机器的正常端口 `22` `SSH` 服务器）。

要覆盖此设置，可以将端口号附加到注册主机名，用冒号分隔。

例如，输入 `foovax:2200` 作为注册主机名将导致缓存主机密钥，就像您连接到 `foovax` 的端口 2200 一样。



如果使用此选项提供主机名，则该主机名也会显示在包含远程主机名的其他位置，例如默认窗口标题和默认 `SSH` 密码提示。

这反映了这样一个事实，即这是您*真正*连接到的主机，这比您碰巧用来联系该主机的单纯手段更重要。

（即使您使用的是 `SSH` 以外的协议，这也适用。）



## 4.15 “数据”面板

数据面板允许您配置各种数据片段，这些数据可以发送到服务器以影响远端的连接。

此面板上的每个选项都适用于多个协议，仅适用于一个协议的选项将显示在该协议的配置面板上。

图d11



### 4.15.1 “自动登录用户名”

所有三种 `SSH` 、`Telnet` 和 `Rlogin` 协议都允许您指定要登录的用户名，而不必每次都显式键入它。

（某些 `Telnet` 服务器不支持此功能。）

在此框中，您可以键入该用户名。



### 4.15.2 系统用户名的使用

当上一个框（[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)）留空时，默认情况下，`PuTTY` 将在您建立连接时提示输入用户名。

在某些环境中，例如实现单点登录的大型组织的网络，更明智的默认值可能是使用登录到本地操作系统的用户的名称（如果有）;这对于 `GSSAPI` 密钥交换和用户身份验证尤其有用（请参阅[第 4.23 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi)和第 [4.18.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-gssapi-kex)）。

此控件允许您更改默认行为。



为方便起见，对话框中将显示当前系统用户名。

它不会保存在配置中;如果保存的会话稍后被其他用户使用，则将使用该用户名。



### 4.15.3 “终端类型字符串”

您可能使用 `PuTTY` 连接到的大多数服务器都设计为从许多不同类型的终端连接到。

为了向每个人发送正确的控制序列，服务器需要知道它正在处理的终端类型。

因此，每个 `SSH` 、`Telnet` 和 `Rlogin` 协议都允许通过描述终端的连接发送文本字符串。

在 `Unix` 服务器上，这会从 `termcap` 或 `terminfo` 数据库中选择一个条目，该条目告诉应用程序要发送到终端的哪些控制序列，以及期望键盘生成的字符序列。



`PuTTY` 尝试模拟 `Unix` 程序 `xterm` ，默认情况下，它通过作为终端类型字符串发送 `xterm` 来反映这一点。

如果您发现这没有达到您想要的效果 - 也许远程系统报告“未知终端类型” - 您可以尝试将其设置为其他内容，例如 `vt220` 。



如果您不确定问题是否由终端类型设置引起，则可能需要查阅应用程序或服务器的手册。



### 4.15.4 “终端速度”

`Telnet` 、`Rlogin` 和 `SSH` 协议允许客户端指定服务器的终端速度。



此参数*不会影响*连接的实际速度，始终是“尽可能快”;它只是一个提示，有时被服务器软件用来修改其行为。

例如，如果指示速度较慢，服务器可能会切换到带宽消耗较少的显示模式。



该值在网络环境中通常毫无意义，但 `PuTTY` 允许您对其进行配置，以防您发现服务器对默认值反应不佳。



格式是一对用逗号分隔的数字，例如 `38400,38400` 。

第一个数字表示（来自服务器）的输出速度（*以*位/秒为单位），第二个数字是输入速度（*到*服务器）。

（Rlogin 协议中仅使用第一个。）



此选项对原始连接没有影响。



### 4.15.5 在服务器上设置环境变量

`Telnet` 协议为客户端提供了一种将环境变量传递给服务器的方法。

由于安全漏洞，许多 `Telnet` 服务器已停止支持此功能，但 `PuTTY` 仍然支持此功能，以使任何服务器受益，这些服务器已经找到了解决安全问题的其他方法，而不仅仅是禁用整个机制。



`SSH` 协议的版本 `2` 也提供了类似的机制，该机制更容易实现，没有安全漏洞。

较新的 `SSH-2` 服务器比较旧的服务器更有可能支持它。



此配置数据不用于 `SSH-1` 、`rlogin` 或原始协议。



要将环境变量添加到通过连接传输的列表中，请在“变量”框中输入变量名称，在“值”框中输入其值，然后按“添加”按钮。

要从列表中删除一个，请在列表框中选择它，然后按“删除”。



## 4.16 代理面板

代理面板允许您将 `PuTTY` 配置为使用各种类型的代理以建立网络连接。

此面板中的设置会影响形成 `PuTTY` 会话的主网络连接，以及由于 `SSH` 端口转发而建立的任何额外连接（请参阅[第 3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-port-forwarding)）。

图d12



请注意，与某些软件（例如 `Web` 浏览器）不同，`PuTTY` 不会尝试自动确定是否使用代理以及（如果是）将哪个代理用于给定目标。

如果需要使用代理，则必须始终显式配置代理。



### 4.16.1 设置代理类型

“代理类型”下拉菜单允许您配置希望 `PuTTY` 用于其网络连接的代理类型。

默认设置为“无”;在此模式下，任何连接都不使用代理。

- 选择“HTTP CONNECT”允许您通过支持 `HTTP` 的 `CONNECT` 命令的 `Web` 服务器代理连接，如 [RFC 2817](https://www.rfc-editor.org/rfc/rfc2817) 中所述。

- 选择“SOCKS 4”或“SOCKS 5”允许您通过 `SOCKS` 服务器代理您的连接。

- 许多防火墙实现不太正式的代理类型，用户可以在其中直接与防火墙计算机建立 `Telnet` 或 `TCP` 连接，并输入命令 `connect myhost.com 22`（例如连接到外部主机）。

  选择“Telnet”允许您告诉 `PuTTY` 使用这种类型的代理，并按照[第 4.16.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-command)中所述指定的精确命令。

- 有几种方法可以使用 `SSH` 服务器作为代理。

  所有这些都会导致 `PuTTY` 与代理主机（在此上下文中有时称为“跳转主机”）建立辅助 `SSH` 连接。

  “代理主机名”字段将被解释为 `PuTTY` 保存的会话的名称（如果存在）或主机名（如果不存在）。

  如果引用的已保存会话本身配置为使用 `SSH` 代理，则允许多跳跃跳转路径;它允许结合 `SSH` 和非 `SSH` 代理。

  - “SSH 到代理并使用端口转发”会导致 `PuTTY` 使用辅助 `SSH` 连接打开到最终目标主机的端口转发通道（类似于 `OpenSSH` 的 `-J` 选项）。

  - “SSH 到代理并执行命令”会导致 `PuTTY` 在代理 `SSH` 服务器上运行任意远程命令，并使用该命令的标准输入和输出流运行主连接。

    远程命令行按[第 4.16.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-command)中所述指定。

  - “SSH到代理并调用子系统”类似，但会导致 `PuTTY` 启动 `SSH` “子系统”而不是普通命令行。

    这对于专门设置的 `SSH` 代理服务器可能很有用。

- 选择“本地”允许您在本地计算机上指定任意命令以充当代理。

  启动会话时，`PuTTY` 不会创建 `TCP` 连接，而是运行命令（在第 [4.16.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-command)中指定），并使用其标准输入和输出流。

  例如，这可用于与 `PuTTY` 本身不支持的某种网络代理通信;或者你可以完全通过 `TCP/IP` 以外的其他东西隧道连接。
  
  
  
  您也可以在命令行上启用此模式;请参见[第 3.11.3.27 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-proxycmd)。
  
  

### 4.16.2 从代理中排除部分网络

通常，您只需要使用代理连接到网络的非本地部分;例如，公司内部网络外部的连接可能需要代理。

在“排除在外的地址”框中，您可以输入 `IP` 地址范围或 `DNS` 名称范围，`PuTTY` 将避免使用代理并改为建立直接连接。

“排除在外的地址”框可能包含多个排除范围，以逗号分隔。

每个范围可以是 `IP` 地址或 `DNS` 名称，并带有允许通配符的字符。例如：`*`

```
*.example.com
```

这从代理中排除了名称以 `.example.com` 结尾的任何主机。



```
192.168.88.*
```

这将从代理中排除 IP 地址以 `192.168.88` 开头的任何主机。



```
192.168.88.*,*.example.com
```

这同时排除了上述两个范围。



与本地主机的连接（主机名 `localhost` 和任何环回 `IP` 地址）永远不会代理，即使代理排除列表未显式包含它们也是如此。

此行为不太可能引起问题，但如果确实如此，您可以通过启用“考虑代理本地主机连接”来更改它。



请注意，如果您在代理上执行 `DNS`（请参阅[第 4.16.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-dns)），则应确保代理排除设置不依赖于知道主机的 `IP` 地址。

如果在 `PuTTY` 未查找的情况下将名称传递给代理，它将永远不会知道 `IP` 地址，也无法根据您的列表进行检查。



### 4.16.3 使用代理端进行 `DNS` 域名解析

如果使用代理访问专用网络，则 `DNS` 名称解析是由 `PuTTY` 本身（在客户端计算机上）执行还是由代理执行，可能会有所不同。

“在代理端进行 `DNS` 域名解析”配置选项允许您控制这一点。

如果将其设置为“否”，`PuTTY` 将始终执行自己的 `DNS` ，并始终将 `IP` 地址传递给代理。

如果将其设置为“是”，`PuTTY` 将始终将主机名直接传递给代理，而无需先尝试查找它们。



如果将此选项设置为“自动”（默认值），`PuTTY` 将执行它认为适合每种代理类型的操作。

大多数类型的代理（ `HTTP` ，`SOCK5` ，`SSH` ，`Telnet` 和本地）将直接传递主机名; `SOCK4` 代理不会。



请注意，如果您在代理上执行 `DNS` ，则应确保代理排除设置（请参阅[第 4.16.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-exclude)）不依赖于知道主机的 `IP` 地址。

如果在 `PuTTY` 未查找的情况下将名称传递给代理，它将永远不会知道 `IP` 地址，也无法根据您的列表进行检查。



原始的 `SOCKS4` 协议不支持代理端 `DNS` 。

有一个协议扩展（ `SOCKS 4A` ）支持它，但并非所有 `SOCKS4` 服务器都提供此扩展。

如果您启用代理 `DNS` 并且您的 `SOCKS4` 服务器无法处理它，这可能是原因。



如果要避免 `PuTTY` 进行与目标主机名相关的*任何*  `DNS` 查询（例如，因为本地 `DNS` 解析器在这种情况下返回否定响应的速度非常慢），则除了将此控件设置为“是”之外，您可能还需要在 `SSH` 中关闭 `GSSAPI` 身份验证和 `GSSAPI` 密钥交换（请参阅[第 4.23 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi)和第 [4.18.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-gssapi-kex) 分别）。

这是因为 `GSSAPI` 设置还涉及对目标主机名的 `DNS` 查询，并且该查询由单独的 `GSSAPI` 库执行，因此 `PuTTY` 无法覆盖或重新配置它。



### 4.16.4 用户名和密码

您可以在“用户名”和“密码”框中输入用户名和密码，如果您的代理需要身份验证，将使用用户名和密码。

请注意，如果您保存会话，代理密码将以纯文本形式保存，因此可以访问您的 `PuTTY` 配置数据的任何人都可以发现它。

如果 `PuTTY` 发现它需要代理用户名或密码，而您在此处未指定，`PuTTY` 将在终端窗口中以交互方式提示输入。



并非所有形式的代理都完全支持身份验证：

- `HTTP` 代理和 `SOCKS 5` 代理支持用户名和密码身份验证。
  
  - 对于 `SOCKS 5` ，如果代理支持身份验证，则通过 `CHAP` 进行身份验证（ `PuTTYtel` 不支持此功能）;否则，密码将以纯文本形式发送到代理。
  - 使用 `HTTP` 代理，如果可能的话，通过“HTTP Digest”（同样，`PuTTYtel` 不支持）或“HTTP Basic”进行身份验证。在后一种情况下，密码以纯文本形式发送到代理。
  
- `SOCKS 4` 可以使用“用户名”字段，但不支持密码。

- `SSH` 代理可以使用 `PuTTY` 支持的所有相同形式的 `SSH` 身份验证作为其主连接。

  如果 `SSH` 服务器请求密码身份验证，将使用任何配置的代理密码，但将首先尝试其他身份验证方法，例如公钥和 `GSSAPI` ，就像主 `SSH` 连接一样，如果它们需要密钥密码等凭据，`PuTTY` 将以交互方式提示这些凭据。

- 您可以指定在 `Telnet/Local` 代理命令中包含用户名和密码的方法（请参阅[第 4.16.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-proxy-command)）。

  如果这样做，并且未在配置中指定实际的用户名和/或密码，`PuTTY` 将以交互方式提示输入它们。



### 4.16.5 指定 `Telnet` 、`SSH` 或本地代理命令

如果使用 `Telnet` 代理类型，则防火墙的 `Telnet` 服务端所需的常用命令是 `connect` ，后跟主机名和端口号。

如果您的代理需要其他命令，您可以在“`Telnet` 命令，或者本地代理命令”框中输入替代命令。



如果使用本地代理类型，则在此处指定要运行的本地命令。

如果使用“`SSH` 代理并执行命令”类型，则在此处指定要在 `SSH` 代理服务器上运行的命令。

同样，如果使用“`SSH` 来代理和调用子系统”，则子系统名称将按此处指定的方式构造。



在此字符串中，可以使用 `\n` 表示换行符、`\r` 表示回车符、`\t` 表示制表符，`\x` 后跟两个十六进制数字来表示任何其他字符。 

`\\` 用于对字符 `\` 本身进行编码。



此外，特殊字符串 `%host` 和 `%port` 将替换为要连接到的主机名和端口号。

对于 `Telnet` 和本地代理类型，字符串 `%user` 和 `%pass将被代理用户名和密码替换（如果未在配置中指定，将提示输入）– SSH 代理类型不会发生这种情况（因为代理用户名/密码用于 `SSH` 身份验证）。` 

字符串 `%proxyhost` 和 %proxyport` ，将替换为“代理”面板上指定的主机详细信息（如果有）（这对于使用本地或远程命令的*代理*类型最有可能有用）。` 

要获取文字符号 `%` ，请输入 `%%` 。



如果 `Telnet` 代理服务器在发送命令之前提示输入用户名和密码，则可以使用如下命令：

```
%user\n%pass\nconnect %host %port\n
```



这会将您的用户名和密码作为前两行发送到代理，然后是连接到所需主机和端口的命令。

请注意，如果在 `Telnet` 命令中不包含 `%user` 或 `%pass` 令牌，则“用户名”和“密码”配置字段中指定的任何内容都将被忽略。



### 4.16.6 控制代理日志记录

通常，代理交互有自己的诊断输出;本地代理命令尤其如此。

“在终端窗口输出代理诊断信息”设置可让您控制将代理诊断信息的数量以及主会话的输出打印到主终端窗口。

默认情况下（“否”），代理诊断仅发送到事件日志;使用“是”，它们也会打印到终端，在那里它们可能会与您的主会话混淆。

“只在会话开始时”是一种折中妥协;代理消息将转到终端窗口，直到主会话被视为已启动（以依赖于协议的方式），这是它们最有可能感兴趣的时间;会话期间任何与代理相关的进一步消息将仅转到事件日志。



## 4.17 `SSH` 面板

`SSH` 面板允许您配置仅适用于 `SSH` 会话的选项。

图d13



### 4.17.1 在服务器上执行特定命令

在 `SSH` 中，您不必在服务器上运行常规的 `shell` 会话。

相反，您可以选择运行单个特定命令（例如邮件用户代理）。

如果要执行此操作，请在“远程命令”框中输入命令。



请注意，大多数服务器将在执行命令后关闭会话。



### 4.17.2 “完全不启动 `shell` 或命令”

如果勾选此框，`PuTTY` 在连接到远程服务器后将不会尝试运行 `shell` 或命令。

如果仅使用 `SSH` 连接进行端口转发，并且服务器上的用户帐户无法运行 `shell` ，则可能需要使用此选项。



此功能仅在 `SSH` 协议版本 `2` 中可用（因为版本 `1` 协议假定您始终希望运行 `shell` ）。



也可以使用命令行选项 `-N` 启用此功能;请参见[第 3.11.3.13 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-noshell)。



如果您在 `Plink` 中使用此功能，您将无法通过任何正常方式终止 `Plink` 进程;杀死它的唯一方法是按 `Control-C` 或从另一个程序发送终止信号。



### 4.17.3 “启用压缩”

这在 `SSH` 连接中启用数据压缩：服务器发送的数据在发送前被压缩，并在客户端解压缩。

同样，`PuTTY` 发送到服务器的数据首先被压缩，服务器在另一端解压缩它。

这有助于充分利用低带宽连接。



### 4.17.4 “`SSH` 协议版本”

这允许您选择是使用 `SSH` 协议版本 `2` 还是旧版本 `1` 。



通常应将其保留为默认值“ `2` ”。

除了功能较少外，较旧的 `SSH-1` 协议不再开发，具有许多已知的加密弱点，并且通常被认为是不安全的。

`PuTTY` 的协议 `1` 实现主要是为了兼容性，不再增强。



如果服务器同时提供两个版本，则首选“ `2` ”。

如果您有一些服务器或设备只能连接 `SSH-1` ，请在此处选择“ `1` ”，并且不要将生成的连接视为安全连接。



如果服务器与您在此处的选择不匹配，`PuTTY` 不会自动回退到协议的其他版本;相反，它会显示一条错误消息并中止连接。

这可以防止主动攻击者将预期的 `SSH-2` 连接降级为 `SSH-1` 。



### 4.17.5 在 `PuTTY` 工具之间共享 `SSH` 连接

此框中的控件允许您将 `PuTTY` 配置为在可能的情况下重用现有的 `SSH` 连接。

`SSH-2` 协议允许您通过同一 `SSH` 连接运行多个数据通道，因此您只需登录一次（并且只需进行一次昂贵的加密设置），然后打开多个终端窗口。

`PuTTY` 的每个实例仍只能在一个终端会话上运行，但使用此框中的控件，您可以将 `PuTTY` 配置为检查其自身的另一个实例是否已连接到目标主机，如果是，请共享该实例的 `SSH` 连接，而不是启动单独的新连接。



要启用此功能，只需勾选“共享可用的 `SSH` 连接”框。然后，每当您启动连接到特定主机的 `PuTTY` 会话时，它都会尝试重用现有的 `SSH` 连接（如果有）。

例如，从系统菜单中选择“重复会话”将在同一主机上启动另一个会话，如果启用了共享，则它将重用现有的 `SSH` 连接。



使用此模式时，连接到给定服务器的第一个 `PuTTY` 将成为“上游”，这意味着它是管理真正 `SSH` 连接的 `PuTTY` 。

所有重用连接的后续 `PuTTY` 都称为“下游”：它们根本不连接到真实服务器，而是通过本地进程间通信方法连接到上游 `PuTTY` 。

要激活此系统，`PuTTY` 的上游和下游实例*都必须*启用共享选项。

因此，上游的 `PuTTY` 在其所有下游关闭之前不能终止。

这类似于端口转发或 `X11` 转发的效果，其中终端会话已完成的 `PuTTY` 仍将保持打开状态，以便继续为转发的连接提供服务。



如果您需要更详细地配置此系统，还有两个附加复选框，允许您指定特定 `PuTTY` 是否可以充当上游或下游或两者兼而有之。

（仅当同时勾选主“共享可用的 `SSH` 连接”框时，这些框才会生效。）

默认情况下，这两个框都处于选中状态，因此从同一配置启动的多个 `PuTTY` 会将其中一个指定为上游并共享单个连接;但是，如果由于某种原因您需要特定的 `PuTTY` 配置不是上游（例如，因为您肯定需要它立即关闭）或*不是*下游（例如，因为它需要使用特殊的私钥进行自己的身份验证），那么您可以取消选中这些框中的一个或另一个。



在上面的讨论中，我提到了“ `PuTTY` ”，但所有其他建立 `SSH` 连接的 `PuTTY` 工具也可以使用这种机制。

例如，如果 `PSCP` 或 `PSFTP` 加载启用了共享的配置，则它可以充当下游并使用由 `GUI` `PuTTY` 实例设置的现有 `SSH` 连接。

一个特例是 `PSCP` 和 `PSFTP` *永远不会*充当上游。



可以使用 `Plink` 以编程方式测试是否存在实时上游。请参见[第 7.2.3.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-option-shareexists)。



## 4.18 密钥面板

密钥面板（“密钥交换”的缩写）允许您配置与 `SSH-2` 密钥交换相关的选项。

图d14



密钥交换发生在 `SSH` 连接开始时（此后偶尔发生）;它建立了一个共享密钥，用作 `SSH` 所有安全功能的基础。

因此，密钥交换的安全对于连接的安全性非常重要。



密钥交换是一个加密密集型过程;如果客户端或服务器是相对较慢的计算机，则较慢的方法可能需要几十秒才能完成。

如果连接启动太慢，或者连接定期挂起，您可能需要尝试更改这些设置。

如果您不明白其中任何含义，可以安全地保留这些设置。



整个面板仅与 `SSH` 协议版本 `2` 相关;这些设置都不会影响 `SSH-1` 。



### 4.18.1 密钥交换算法选择

`PuTTY` 支持多种 `SSH-2` 密钥交换方法，并允许您选择您喜欢使用的一种;配置类似于密码选择（请参阅[第 4.20 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-encryption)）。

`PuTTY` 目前支持以下密钥交换方法：

- “ `NTRU Prime / Curve25519 hybrid` ”：“简化的 `NTRU Prime` ”是一种基于晶格的算法，旨在抵抗量子攻击。

  在这种密钥交换方法中，它与传统的基于 `Curve25519` 的方法（“ `ECDH` ”中包含的方法之一）并行运行，其安全性不*低于*常用方法，并且希望也能抵抗一类新的攻击。

- “ `ECDH` ”：椭圆曲线 `Diffie-Hellman` 密钥交换，具有各种标准曲线和哈希算法。

- `Diffie-Hellman` 密钥交换的原始形式，具有各种众所周知的组和哈希：
  
  - “ `Group 18` ”，一个著名的 `8192` 位组，与 `SHA-512` 哈希函数一起使用。
  
  - “ `Group 17` ”，一个著名的 `6144` 位组，与 `SHA-512` 哈希函数一起使用。
  
  - “ `Group 16` ”，一个著名的 `4096` 位组，与 `SHA-512` 哈希函数一起使用。
  
  - “ `Group 15` ”，一个著名的 `3072` 位组，与 `SHA-512` 哈希函数一起使用。
  
  - “ `Group 14` ”：一个众所周知的 `2048` 位组，与 `SHA-256` 哈希函数一起使用，或者，如果服务器不支持，则与 SHA-1 一起使用。
  
  - “ `Group 1` ”：一个众所周知的 `1024` 位组，与 `SHA-1` 哈希函数一起使用。
  
    我们和当前的 `SSH` 标准都不建议再使用此方法，并且在新安装中默认不使用此方法;但是，它可能是非常旧的服务器软件支持的唯一方法。
  
- “ `Diffie-Hellman` 组交换”：使用此方法，`PuTTY` 请求服务器建议一个组用于后续的 `Diffie-Hellman` 密钥交换，而不是使用固定组;服务器可以避免已知较弱的组，并可能随着时间的推移发明新的组，而无需对 `PuTTY` 的配置进行任何更改。

  此密钥交换方法使用 `SHA-256` 哈希，或者，如果服务器不支持，则使用 `SHA-1` 。

- “基于 `RSA` 的密钥交换”：与 `Diffie-Hellman` 密钥交换相比，这需要客户端的计算工作量少得多，服务器方面的计算工作量要少得多。

- “ `GSSAPI` 密钥交换”：请参阅[第 4.18.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-gssapi-kex)。

如果 `PuTTY` 找到的第一个算法位于“下面为警告选项”行下方，则在建立连接时将看到一个警告框，类似于密码选择的警告框（请参阅[第 4.20 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-encryption)）。



#### 4.18.1.1 尝试 `GSSAPI` 的密钥交换

`PuTTY` 支持一组密钥交换方法，这些方法还包含基于`GSAPI` 的身份验证。

它们通过“尝试 `GSSAPI` 密钥交换”复选框（也显示在“ `GSSAPI` ”面板上）启用。



`PuTTY` 只能在使用 `Kerberos V5` 时执行经过 `GSSAPI` 身份验证的密钥交换方法，而不能执行其他 `GSSAPI` 机制。

如果运行 `PuTTY` 的用户具有当前的 `Kerberos V5` 凭据，则 `PuTTY` 将优先选择 `GSSAPI` 密钥交换方法，而不是首选项列表中配置的任何普通 `SSH` 密钥交换方法。

有一个基于 `GSSAPI` 的方法，相当于[第 4.18.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-order)中列出的大多数普通方法;服务器支持确定将使用哪一个。

（`PuTTY` 对 `GSAPI` 身份验证的密钥交换方法的偏好顺序是固定的，不受偏好列表的控制。）



当您使用凭据委派时，将 `GSSAPI` 身份验证作为 `SSH` 密钥交换的一部分进行的优势是显而易见的（请参阅[第 4.23.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi-delegation)）。

`SSH` 密钥交换可以在会话的后面重复，这允许您的 `Kerberos V5` 凭据（通常生存期很短）在客户端上刷新时自动重新委派给服务器。（此功能通常称为“级联凭据”。）



如果您的服务器不支持 `GSSAPI` 密钥交换，它可能仍支持 `GSSAPI` 在 `SSH` 用户身份验证阶段。

这仍允许您使用 `Kerberos` 凭据登录，但仅允许您委派在会话开始时处于活动状态的凭据;以后无法在长时间运行的会话中自动刷新它们。

请参阅[第 4.23 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi)，了解如何在 `PuTTY` 中控制 `GSSAPI` 用户身份验证。



`GSSAPI` 密钥交换的另一个效果是它取代了第 [2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)中描述的永久主机密钥的通常 `SSH` 机制。

因此，如果使用此方法，则不会询问有关是否接受服务器的主机密钥的任何交互式问题。

相反，`Kerberos` 交换将验证您连接到的主机的身份，同时验证您的身份。



### 4.18.2 重复密钥交换

如果在连接启动时协商的会话密钥使用过多或时间过长，则可能对 `SSH` 连接发起攻击。

因此，`SSH-2` 协议指定应每隔一段时间进行一次新的密钥交换;这可以由客户端或服务器启动。



在进行此重新协商时，任何数据都无法通过 `SSH` 连接，因此它可能显示为“冻结”。

（重复密钥交换的发生记录在事件日志中;请参见[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)。）

通常使用与连接开始时相同的算法，但开销相似。



这些选项控制 `PuTTY` 启动重复密钥交换（“重新生成密钥”）的频率。

您也可以随时从“特殊命令”菜单强制交换密钥（请参阅[第 3.1.3.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-specials)）。

- “重新交换最长时间(分钟，`0` 不限制)”指定在启动重新生成密钥之前允许经过的时间量。

  如果将其设置为零，`PuTTY` 将不会由于经过的时间而重新生成密钥。

  `SSH-2` 协议规范建议超时最多为 `60` 分钟。



您可能需要完全禁用基于时间的重新更新的密钥，原因与保持连接并不总是有帮助相同。

如果您预计在 `SSH` 连接过程中会遭受几个小时的网络丢失，但实际上并不打算在这些小时内通过该连接发送*数据*，那么在丢失过程中尝试重新生成密钥可能会导致连接被放弃，而如果禁用重新密钥，那么连接原则上应该仍然存在（在没有干扰防火墙的情况下）。

有关这些问题的更多讨论，请参见[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive);出于这些目的，重新密钥具有与保持连接大致相同的属性。

（除了重新密钥本身具有加密价值，因此在决定是否关闭它们时应牢记这一点。）

但请注意，SSH *服务器*仍然可以启动重新生成密钥。

- 如果您使用的是 `GSSAPI` 密钥交换，则“ `GSSAPI` 检查间隔(单位：分钟)”会指定检查 `GSSAPI` 凭据缓存的频率，以查看是否有新票证可供委派，或者当前工单是否即将过期。

  如果启用了 `GSSAPI` 凭据的转发，`PuTTY` 将根据需要尝试重新生成密钥，以防止委派凭据过期。

  建议经常检查;仅在需要时才会重新生成密钥。

- “重新交换最大数据量”指定在启动重新生成密钥之前允许向任一方向流动的数据量（以字节为单位）。

  如果将其设置为零，`PuTTY` 将不会由于传输的数据而重新生成密钥。

  `SSH-2` 协议规范建议限制为最多 1 GB。
  
  
  
  除了以字节为单位指定值外，还可以使用以下简写：
  
  - `1k` 指 `1 字节（1024 KB）` 。
  - `1M` 指 `1 兆字节（1024 KB）` 。
  - `1G` 指 `1 千兆字节（1024 MKB）` 。



完全禁用基于数据的重新密钥是一个坏主意。

`SSH-2` 协议的完整性和较小程度的机密性部分取决于在 `32` 位数据包序列号环绕之前发生的重新密钥。

与基于时间的重新生成密钥不同，当 `SSH` 连接空闲时，不会发生基于数据的重新生成密钥，因此它们不应导致相同的问题。

顺便说一下，`SSH-1` 协议的完整性保护甚至比没有重新密钥的 `SSH-2` 更弱。



## 4.19 主机密钥面板

“主机密钥”面板允许您配置与主机密钥管理相关的选项。

图d15



主机密钥用于证明服务器的身份，并向您保证服务器没有被欺骗（通过中间人攻击或在网络上完全替换它）。

有关主机密钥的基本介绍，请参见[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)。

此面板的大部分内容仅与 `SSH` 协议版本 `2` 相关; `SSH-1` 仅支持一种类型的主机密钥。



### 4.19.1 主机密钥类型选择

`PuTTY` 支持多种 `SSH-2` 主机密钥类型，并允许您选择用于标识服务器的密钥类型。

配置类似于密码选择（请参阅[第 4.20 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-encryption)）。



`PuTTY` 目前支持以下主机密钥类型：

- `Ed25519` ：使用带模量 `2^255-19` 的扭曲爱德华兹曲线的爱德华兹曲线 `DSA` 。
- `Ed448` ：另一种爱德华兹曲线 `DSA` 类型，使用更大的椭圆曲线，具有 `448` 位而不是 `255` 位模数（因此它具有比 `Ed25519` 更高的安全级别）。
- `ECDSA` ：使用 `NIST` 标准化椭圆曲线之一的椭圆曲线 `DSA` 。
- `DSA` ：使用模幂的简单 `DSA` 。
- `RSA ：普通的 `RSA` 算法。



如果 `PuTTY` 已经为服务器存储了一个或多个主机密钥，则默认情况下，它将首选使用其中一个，即使服务器的密钥类型在首选项顺序中更高。

您可以使用“特殊命令”菜单从现有会话中将此类密钥添加到 `PuTTY` 的缓存中;请参见[第 3.1.3.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-specials)。

否则，`PuTTY` 将完全根据您在配置中指定的首选项顺序选择密钥类型。



如果 `PuTTY` 找到的第一个密钥类型位于“下面为警告选项”行下方，则在建立连接时将看到一个警告框，类似于密码选择的警告框（请参阅[第 4.20 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-encryption)）。



### 4.19.2 已知主机密钥的首选算法

默认情况下，`PuTTY` 将调整 `SSH-2` 主机密钥算法的首选项顺序，以便将它已经知道的任何主机密钥移动到列表顶部。

这样，您就不必检查并确认已有主机密钥的服务器的新主机密钥（例如，因为服务器生成了 `PuTTY` 首选项顺序中更高类型的备用密钥，或者因为您更改了首选项顺序本身）。

但是，另一方面，它可能会向网络中的侦听器泄露*有关您是否已经*知道此服务器的主机密钥的信息。

因此，此策略是可配置的。

通过关闭此复选框，您可以将 `PuTTY` 重置为始终使用[第 4.19.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-hostkey-order)中所述的首选项列表中配置的主机密钥算法的确切顺序，以便侦听器不会发现您存储了哪些密钥。



### 4.19.3 手动配置连接的主机密钥

在某些情况下，如果 `PuTTY` 的自动主机密钥管理未满足您的需求，您可能需要手动配置 `PuTTY` 以接受特定主机密钥或一组特定主机密钥之一。



您可能想要执行此操作的一个原因是，`PuTTY` 连接到的主机名使用轮询 `DNS` 返回多个实际服务器之一，并且它们都具有不同的主机密钥。

在这种情况下，您可能需要将 `PuTTY` 配置为接受可能服务器的主机密钥列表中的任何密钥，同时仍拒绝该列表中未包含的任何密钥。



另一个原因是如果 `PuTTY` 的自动主机密钥管理完全不可用，例如因为 `PuTTY` （或 `Plink` 或 `PSFTP` 等）在`Windows` 环境中运行，无法访问注册表。

在这种情况下，您可能希望使用命令行选项 `-hostkey` 来配置预期的主机密钥;请参见[第 3.11.3.22 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-hostkey)。



对于 `PuTTY` 的自动主机密钥管理只是选择错误的主机名来存储密钥的情况，您可能需要考虑设置“注册主机名”;请参见[第 4.14.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-loghost)。



要通过 `GUI` 配置手动主机密钥，请在“手动配置本连接的主机密钥”的编辑框中输入一些描述主机密钥的文本，然后按“添加”按钮。

该文本将显示在“可接受的主机密钥或指纹”列表框中。

您可以使用“删除”按钮再次删除密钥。



描述主机密钥的文本可以采用以下格式之一：

- 基于 `SHA-256` 的 `PuTTY` 事件日志和主机密钥对话框中显示的表单的主机密钥指纹，比如 `SHA256:` 后跟 `43` 个区分大小写的字符。

- 基于 `MD5` 的主机密钥指纹，比如 16个 `2` 位由冒号分隔的十六进制数字，可选前缀 `MD5:`。（字符的大小写无关紧要。

- 一个 `base64` 编码的 `blob` ，以 `OpenSSH` 的单行公钥格式描述 `SSH-2` 公钥。

  获取此格式的公钥的方式取决于服务器;在 `OpenSSH` 服务器上，它通常可以在类似 `/etc/ssh/ssh_host_rsa_key.pub` 的位置找到。



如果 `PuTTY` 建立 `SSH` 连接时此框至少包含一个主机密钥或指纹，则完全绕过 `PuTTY` 的自动主机密钥管理：当且仅当服务器提供的主机密钥是此框中列出的密钥之一时，才允许连接，并且注册表中的主机密钥存储既不读取*也不写入*， 除非您明确这样做。



如果该框为空（通常为空），则 `PuTTY` 的自动主机密钥管理将正常工作。



### 4.19.4 配置 `PuTTY` 以接受主机证书

在某些环境中，许多服务器的 `SSH` 主机密钥都将由中央“证书颁发机构”（简称“CA”）轮流签名。

这简化了用户的主机密钥配置，因为如果他们将其 `SSH` 客户端配置为接受由该 `CA` 认证的主机密钥，则他们无需在首次连接到该服务器时单独确认每个主机密钥。



为此，请按“主机密钥”配置面板中的“配置主机 `CAs` ”按钮。

这将启动一个辅助配置对话框，您可以在其中配置 `PuTTY` 将接受哪些 `CA` 的签名。

图d16



**请注意，此配置对于所有已保存的会话都是通用的**。

主 `PuTTY` 配置中的所有内容都特定于一个保存的会话，您可以准备一个单独的会话，所有配置都不同。

但是主机 `CA` 配置只有一个副本，它适用于 `PuTTY` 运行的所有会话，无论是否保存。

（否则，这将毫无用处 - 为每个新主机手动配置 `CA` 并不比为每个新主机的主机密钥按“确认”按钮更方便。）



要使用此配置框设置新的 `CA` ，请执行以下操作：

首先，从文件加载 `CA` 的公钥，或将其直接粘贴到“证书颁发机构的公钥”编辑框中。

如果您的组织以这种方式签署其主机密钥，他们将发布其 `CA` 的公钥，以便 `SSH` 用户可以将其包含在他们的配置中。



接下来，在“信任此密钥进行认证的有效主机”框中，配置至少一个主机名通配符，以说明 `PuTTY` 应信任此 `CA` 的服务器。

例如，假设您为示例甲公司 （ `example.com` ） 工作，并且甲公司 `IT` 部门已公布一个对所有示例内部计算机的主机密钥进行签名的 `CA`。

然后，您可能希望信任该 `CA` 为域 `example.com` 中的计算机签署主机密钥，而不是其他任何东西。

因此，您可以在“有效主机”框中输入 `*.example.com` 。



**限制允许 `CA` 密钥签名的内容非常重要**。

不要只在那个框中输入 `*`  ！

如果您这样做，您是在说示例公司的 `IT` 部门有权为您可能决定连接*的任何内容*签署主机密钥 - 即使您从公司网络连接到其他地方的计算机，例如您自己的个人服务器。

因此，该配置将使示例 `IT` 部门能够充当 `PuTTY` 进程和服务器之间的“中间人”，并监听您的通信 - 这正是 `SSH` 应该避免的事情。

因此，如果 `CA` 是由负责 `example.com`（或其他任何操作）的系统管理员提供给您的，请确保 `PuTTY` *仅*信任域 `example.com` 中的计算机。

有关“有效主机”表达式的完整语法，请参见[第 4.19.4.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-cert-valid-expr)。



最后，为此 `CA` 选择一个标识名称;在窗口顶部的“此 `CA` 的名称”编辑框中输入该名称，然后按“保存”以在配置中记录 CA。

您选择的名称将显示在“保存”按钮左侧的已保存 `CA` 列表中。



标识名称可以是你喜欢的任何名称。

它的存在是为了，如果您存储多个证书，您可以在以后要编辑或删除它们时判断哪个是哪个。

当服务器提供由该 `CA` 签名的证书时，它还会显示在 `PuTTY` 事件日志中。

要重新加载现有 `CA` 配置，请在列表框中选择它，然后按“加载”。

然后，您可以进行更改，然后再次保存。

要从配置中完全删除 `CA`，请在列表中选择它，然后按“删除”。



#### 4.19.4.1 可以在“有效主机”中输入的表达式

您可以在“信任此密钥认证的有效主机”编辑框中输入的最简单的内容只是一个主机名通配符，例如 `*.example.com`。

这将匹配任何子域中的任何主机，因此 `ssh.example.com` 和 `login.dept.example.com` 都匹配，但 `prod.example.net` 不会。



但是，您也可以输入多个主机名通配符和端口号范围，并使用运算符 `&&` 表示“和”，`||` 表示“或”，`!` 表示“not”和括号，从中创建复杂的布尔表达式。

例如，您可以输入以下一些其他内容。

- `*.foo.example.com || *.bar.example.com` 这意味着，如果主机名与 `*.foo.example.com` 匹配*或*与 `*.bar.example.com` 匹配，则 `CA` 将受信任对连接的主机密钥进行签名。

  换句话说，`CA` 对 的两个特定子域 `example.com` 具有权限，但对像 `www.example.com` 的其他任何子域没有权限。

- `*.example.com && ! *.extrasecure.example.com` 这意味着，如果主机名与 `*.example.com` 匹配*但*不匹配 `*.extrasecure.example.com` ，则 `CA` 受信任对连接的主机密钥进行签名。

  （想象一下，如果您的公司中有一组绝密服务器，而主要的 `IT` 部门没有安全许可来管理。

- `*.example.com && port:22` 这意味着，如果主机名与 `*.example.com` 匹配*且*端口号为 `22` ，则 `CA` 可以对连接的主机密钥进行签名。

  在其他端口上运行的 `SSH` 服务器将不包括在内。

- `(*.foo.example.com || *.bar.example.com) && port:0-1023``example.com` 与以前一样，这将匹配 的两个子域*，但也将*端口号限制为 `0-1023` 的范围。



证书配置表达式由一个或多个单独的要求组成，每个要求可以是主机名通配符、单个端口号或端口号范围，并与这些布尔运算符组合在一起。

与 `C` 等其他语言不同，`&&` 和 `||` 之间没有隐含的优先级。

如果你写了 `A && B || C`（其中 `A` ， `B` 和 `C` 是一些特殊的要求），那么 `PuTTY` 将报告语法错误，因为你没有说 `&&` 和 `||` 中的哪一个严格优先。

您必须写 `(A && B) || C` ，意思是 ' `A` 和 `B` ，或者只是 `C`'，或者只是 `A && (B || C)`（' `A`，以及至少 `B` 和 `C` 其中一个'），以使其清楚。



#### 4.19.4.2 证书中的 RSA 签名类型

`RSA` 密钥可用于通过选择安全哈希函数生成签名。

通常，任何足以支持证书的 `OpenSSH` 版本也将足够新，以避免使用 `SHA-1` ，因此接受更现代的`SHA-256` 和 `SHA-512` 的默认设置应该适用于几乎所有情况。

但是，为了完整起见，您可以使用 `RSA` 密钥配置 `PuTTY` 在来自 `CA` 的证书中接受哪些类型的 `RSA` 签名。



## 4.20 加密面板

`PuTTY` 支持各种不同的加密算法，并允许您选择您喜欢使用的算法。

为此，可以在列表框中上下拖动算法（或使用“上移”和“下移”按钮移动算法）来指定首选项顺序。

当您建立 `SSH` 连接时，`PuTTY` 将从顶部向下搜索列表，直到找到服务器支持的算法，然后使用该算法。

图d17



`PuTTY` 目前支持以下算法：

- `ChaCha20-Poly1305` ，密码和 `MAC` 的组合（仅限 `SSH-2` ）
- `AES（Rijndael）` - `256` 、`192` 或 `128` 位 `SDCTR` 或 `CBC` ，或 `256` 或 `128` 位 `GCM`（仅限 `SSH-2` ）
- `Arcfour（RC4）` - `256` 或 `128` 位流密码（仅限 `SSH-2` ）
- `Blowfish` - `256` 位 `SDCTR`（仅限 `SSH-2` ）或 `128` 位 `CBC`
- `Triple-DES` - `168` 位 `SDCTR`（仅限 `SSH-2` ）或 `CBC`
- `Single-DES` - `56` 位 `CBC`（有关 `SSH-2` ，请参见下文）



如果 `PuTTY` 找到的算法位于“下面为警告选项”行下方，则在建立连接时将看到一个警告框：

```
The first cipher supported by the server
is single-DES, which is below the configured
warning threshold.
Do you want to continue with this connection?
```



这会警告您，第一个可用的加密不是非常安全的加密。

通常，您会在认为安全的加密和您认为不合格的加密之间放置“下面为警告选项”行。

默认情况下，`PuTTY` 提供优先顺序，旨在反映安全性和速度方面的合理偏好。



在 `SSH-2` 中，加密算法是针对连接的每个方向独立协商的，尽管 `PuTTY` 不支持单独配置首选项顺序。

因此，您可能会收到两个与上述类似的警告，可能使用不同的加密。



`SSH-2` 协议标准中不建议使用 `Single-DES` ，仅有一两个服务器实现支持它。

如果启用“启用 `SSH-2` 兼容使用单一 `DES` 算法”选项，`PuTTY` 可以使用单 `DES` 与这些服务器进行互操作;默认情况下，此功能处于禁用状态，`PuTTY` 将坚持使用推荐的密码。



## 4.21 认证面板

认证面板允许您配置 `SSH` 会话的身份验证选项。

图d18



### 4.21.1 “显示预身份验证提示”

`SSH-2` 服务器可以提供一条消息，供客户端在用户登录之前显示给潜在用户;这有时称为预身份验证“提示”。

通常，这用于提供有关服务器和法律声明的信息。



默认情况下，`PuTTY` 在提示输入密码或类似凭据之前显示此消息（尽管不幸的是，由于协议设计的性质，在提示输入登录名之前不会显示此消息）。

通过取消选中此选项，可以完全禁止显示提示。



### 4.21.2 “完全绕过认证”

在 `SSH-2` 中，原则上可以在不使用 `SSH` 的机制来识别或证明您是谁的情况下建立连接。

例如，`SSH` 服务器可能更喜欢在数据通道中处理身份验证，或者根本不要求任何用户身份验证。



默认情况下，`PuTTY` 假定服务器需要身份验证（我们从未听说过不需要身份验证），因此必须使用用户名启动此过程。

如果您发现收到无法回答的用户名提示，您可以尝试启用此选项。

但是，大多数 `SSH` 服务器会拒绝这一点。



如果您有用户名并且只想让 `PuTTY` 记住它，这不是您想要的选项;有关此内容，请参见[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)。

如果您尝试设置对主流 `SSH` 服务器的无密码登录，也可能不是这样;根据服务器的不同，您可能需要公钥身份验证（第 [8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)）或 `GSSAPI` 身份验证（[第 4.23 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi)）。

（这些仍然是身份验证形式，即使您不必与它们交互。）



此选项仅影响 `SSH-2` 连接。

`SSH-1` 连接始终需要身份验证步骤。



### 4.21.3 “如果身份验证成功，则断开连接”

此选项会导致 `PuTTY` 放弃 `SSH` 会话并与服务器断开连接，前提是服务器接受身份验证而从未要求输入任何类型的密码、签名或令牌。

这可以用作安全措施。

有一些针对 `SSH` 客户端用户的攻击形式，其工作方法是提前终止 `SSH` 身份验证阶段，然后在 `SSH` 会话的主要部分执行某些操作，这*看起来像*身份验证的一部分，但实际上并非如此。



例如，与其要求公钥提供签名（ `PuTTY` 会要求您提供密钥的密码），不如让受感染或恶意的服务器允许您完全不使用签名或密码登录，然后打印一条*模仿*  `PuTTY` 请求您的密码的消息，希望您输入它。（事实上，公钥的密码不应发送到任何服务器。）

`PuTTY` 对此类攻击的主要防御是“信任符号”系统：`PuTTY` 窗口中真正由 `PuTTY` 本身发起的消息显示在 `PuTTY` 图标的小副本旁边，服务器在尝试使用终端输出模仿同一消息时无法伪造。

但是，如果您认为自己无论如何都可能面临此类事情的风险（如果您没有密切关注信任符号，或者如果您认为自己有一台服务器恶意的额外风险），那么您可以启用此选项作为额外的防御。

然后，如果服务器尝试任何这些攻击，涉及让您通过身份验证阶段，`PuTTY` 将在发送后续虚假提示或其他类型的攻击之前断开与服务器的连接。



另一方面，某些服务器*合法地*让您轻松完成 `SSH` 身份验证阶段，因为它们是真正公开的，或者因为重要的身份验证步骤发生在终端会话期间。

（例如，SSH 服务器将您直接连接到旧式大型机的终端登录提示。）

因此，启用此选项可能会导致某些类型的会话停止工作。这取决于你。



### 4.21.4 “尝试使用 `Pageant` 进行身份验证”

如果启用此选项，则 `PuTTY` 将查找 `Pageant`（ `SSH` 私钥存储代理），并尝试使用 `Pageant` 当前持有的任何合适的公钥进行身份验证。

此行为几乎总是可取的，因此默认情况下处于启用状态。在极少数情况下，您可能需要将其关闭，以便通过某些非公钥方法（如密码）强制进行身份验证。

也可以使用 `-noagent` 命令行选项控制此选项。请参见[第 3.11.3.9 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-agentauth)。

有关 `Pageant` 的更多信息，请参阅[第 9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)。



### 4.21.5 “尝试 `TIS` 或 `CyptoCard` 身份验证”

`TIS` 和 `CyptoCard` 身份验证是（尽管如此命名）仅在 `SSH` 协议版本 `1` 中可用的简单质询/响应身份验证的通用形式。

例如，如果您使用的是 `S/Key` 一次性密码，或者如果您有一个生成对身份验证质询的响应的物理安全令牌，则可以使用它们。

它们甚至可用于提示输入简单密码。



启用此开关后，如果服务器愿意尝试这些形式的身份验证，`PuTTY` 将尝试它们。

您将看到一个质询字符串（每次可能不同），并且必须提供正确的响应才能登录。

如果您的服务器支持此功能，您应该与您的系统管理员讨论这些质询和响应的确切形式。



### 4.21.6 “尝试键盘交互式身份验证”

相当于 `TIS` 身份验证的 `SSH-2` 称为“键盘交互”。

它是一种灵活的身份验证方法，使用任意请求和响应序列;因此，它不仅对质询/响应机制（如 `S/Key` ）有用，而且还可用于（例如）在旧密码过期时要求用户输入新密码。



`PuTTY` 默认启用此选项，但提供一个开关来关闭它，以防您遇到问题。



### 4.21.7 “启用代理转发”

此选项允许 `SSH` 服务器打开转发的连接，返回到您的本地 `Pageant` 副本。

如果您没有运行 `Pageant` ，则此选项将不执行任何操作。



有关 `Pageant` 的一般信息，请参阅第 [9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)，有关代理转发的信息，请参阅[第 9.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-forward)。请注意，启用此选项存在安全风险;有关详细信息，请参阅[第 9.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-security)。



### 4.21.8 “启用尝试在 `SSH-2` 中修改用户名”

在 `SSH-1` 协议中，身份验证失败后无法更改用户名。

因此，如果您在 `PuTTY` “登录为：”提示符下输入了错误的用户名，则除非重新启动 `PuTTY` ，否则您将无法更改它。



`SSH-2` 协议原则上*允许*更改用户名，但并不强制要求 `SSH-2` 服务器接受它们。

特别是，`OpenSSH` 不接受更改用户名;发送一个用户名后，它将拒绝尝试以其他用户身份进行身份验证的尝试。

（根据 `OpenSSH` 的版本，它可能会悄悄返回所有登录尝试的失败，或者可能会发送错误消息。）



因此，默认情况下，如果服务器拒绝，`PuTTY` 不会多次提示您输入用户名。

如果您知道您的服务器可以处理它，您可以启用“启用尝试在 `SSH-2` 中修改用户名”选项来修改 `PuTTY` 的行为。



## 4.22 凭据面板

“认证”面板的此子窗格包含配置选项，这些选项指定要提供给服务器的实际*凭据*：密钥文件和证书。

图d19



### 4.22.1 “用于认证的私钥文件”

如果您使用的是公钥身份验证，则可以在此框中输入私钥文件的名称。

有关 `SSH` 中的公钥身份验证的信息，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。



此密钥必须采用 `PuTTY` 的本机格式 （`*.PPK`）。

如果您有要与 `PuTTY` 一起使用的其他格式的私钥，请参阅[第 8.2.15 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-conversions)。



您可以使用身份验证代理 `Pageant` ，这样您就不需要在此处显式配置密钥;见[第9章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)。



如果此处指定了私钥文件并运行 `Pageant` ，`PuTTY` 将首先尝试要求 `Pageant` 使用该密钥进行身份验证，并忽略 `Pageant` 可能拥有的任何其他密钥。

如果失败，`PuTTY` 将像往常一样要求提供密码。

在这种情况下，您还可以指定一个*公钥*文件（ `RFC 4716` 或 `OpenSSH` 格式），因为这足以识别 `Pageant` 的密钥，但当然，如果 `Pageant` 不存在，`PuTTY` 就不能回退到使用此文件本身。



### 4.22.2 “与私钥一起使用的证书”

在某些环境中，用户身份验证密钥可以由“证书颁发机构”（简称“CA”）依次签名，`SSH` 服务器上的用户帐户可以配置为自动信任由正确签名认证的任何密钥。



如果您有非常多的服务器，这可能是一个方便的设置。

更改密钥对时，可能必须单独编辑每台服务器上的文件，以使它们都接受新密钥。

但是，如果您将*所有这些服务器配置为*接受由 `CA` 签名的密钥，那么当您更改公钥时，您所要做的就是让新密钥由与以前相同的 `CA` 认证，然后您的所有服务器将自动接受它，而无需单独重新配置 `authorized_keys` 。

使用证书的一种方法是将其合并到私钥文件中。

[第 8.2.9 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-cert)解释了如何使用 `PuTTYgen` 执行此操作。



但另一种方法是告诉 `PuTTY` 本身在哪里可以找到公共证书文件，然后在使用相应的私钥进行身份验证时自动显示该证书。

为此，请在“与私钥一起使用的证书”文件选择器中输入证书文件的路径名。

配置此设置后，无论私钥是在文件中找到还是加载到 `Pageant` 中，`PuTTY` 都会遵守它。



### 4.22.3 “提供身份验证响应的插件”

`SSH` 服务器可以使用“键盘交互”协议来呈现一系列任意问题和答案。有时这用于普通密码，但有时服务器会使用相同的机制来处理更复杂的事情，例如一次性密码系统。

其中一些系统可以自动化。为此，`PuTTY` 允许您提供一个单独的程序作为“插件”，它将接管身份验证并代表您发送问题的答案。

如果您已获得此类型的插件，则可以通过在“要运行的插件命令”框中输入完整的命令行来在此处对其进行配置。

（如果要*编写*这种类型的插件，请参阅[附录 H](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixH.html#authplugin)，了解插件预期行为的完整规范。



## 4.23 `GSSAPI` 面板

“认证”面板的“GSSAPI”子面板控制 `GSSAPI` 身份验证的使用。

这是一种将身份验证交换委托给客户端计算机上其他位置的库的机制，该库原则上可以通过许多不同的方式进行身份验证，但实际上通常与 `Kerberos` 单点登录协议一起使用以实现无密码登录。

图d20



`GSSAPI` 身份验证仅在 `SSH-2` 协议中可用。

`PuTTY` 支持两种形式的基于 `GSSAPI` 的身份验证。

在其中一个，`SSH` 密钥交换以正常方式进行，`GSSAPI` 仅参与对用户进行身份验证。

标有“尝试使用 `GSSAPI` 认证”的复选框控制此表单。



在另一种方法中，基于 `GSSAPI` 的身份验证与 `SSH` 密钥交换阶段相结合。

如果此操作成功，则 `SSH` 身份验证步骤无需执行任何操作。

有关此方法的详细信息，请参见[第 4.18.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-gssapi-kex)。

标有“启用 `GSSAPI` 密钥交换”的复选框控制此表单。

（相同的复选框显示在“密钥”面板上。）



如果启用了其中一个或两个控件，则将以一种或另一种形式尝试 `GSSAPI` 身份验证，并且（通常）如果您的客户端计算机加载了有效的 `Kerberos` 凭据，则 `PuTTY` 应该能够自动向支持 `Kerberos` 登录的服务器进行身份验证。

如果这两个复选框都被禁用，`PuTTY` 根本不会尝试任何形式的 `GSSAPI` ，并且此面板的其余部分将不会被使用。



### 4.23.1 “启用 `GSSAPI` 凭据委派”

`GSSAPI` 凭据委派是一种将 `Kerberos`（或其他）身份传递给 `SSH` 服务器上会话的机制。

如果启用此选项，则 `PuTTY` 不仅能够自动登录到接受您的 `Kerberos` 凭据的服务器，而且您将能够从该服务器连接到其他支持 `Kerberos` 的服务，并自动使用相同的凭据。

（此选项是 `SSH` 代理转发的 `Kerberos` 类似物;有关此内容的一些信息，请参见[第 9.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-forward)。）



请注意，与 `SSH` 代理转发一样，使用此选项存在安全隐患：您连接到的服务器的管理员或破解了该服务器上管理员帐户的任何其他人都可能在连接到其他支持 `Kerberos` 的服务时伪造您的身份。

但是，`Kerberos` 站点通常由中央机构运行，因此一台服务器的管理员也可能已经可以访问其他服务;因此，这通常比 `SSH` 代理转发的风险更小。

如果您的连接未使用 `GSSAPI` 密钥交换，则委派可能会在会话期间过期。有关更多信息，请参见[第 4.18.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-gssapi-kex)。



### 4.23.2 `GSSAPI` 库的优先顺序

`GSSAPI` 是一种允许通过同一接口访问多种身份验证方法的机制。

因此，您的系统上可能存在多个可以使用 `GSSAPI` 访问的身份验证库。



`PuTTY` 包含对一些众所周知的此类库（包括 `Windows` 的 `SSPI` ）的本机支持，并将在您的系统上查找所有这些库，并使用它找到的任何库。

如果系统上存在多个首选项，并且您需要使用特定的首选项列表控件，则可以使用此首选项列表控件调整其搜索顺序。



首选项列表中的选项之一是使用用户指定的 `GSSAPI` 库。

如果您要使用的库在 `PuTTY` 的选项列表中未按名称提及，您可以在“用户支持的 `GSSAPI` 库路径”字段中输入其完整路径名，然后在参考列表中移动“用户提供的 `GSSAPI` 库”选项，以确保先选中该库。



在 `Windows` 上，此类库是带有扩展名 `.dll` 的文件，并且必须以与您正在运行的 `PuTTY` 可执行文件相同的方式构建。

如果您有 `32` 位 `DLL` ，则必须运行 `32` 位版本的 `PuTTY` ，与 `64` 位版本相同（请参阅[问题 A.6.10](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-32bit-64bit)）。

在 `Unix` 上，共享库通常有一个扩展 `.so` 。



## 4.24 `TTY` 面板

`TTY` 面板允许您配置远程伪终端。

图d21



### 4.24.1 “不分配伪终端”

当连接到 `Unix` 系统时，大多数交互式 `shell` 会话都在伪终端中运行，这允许 `Unix` 系统假装它正在与真实的物理*终端*设备通信，但允许 `SSH` 服务器捕获来自该假设备的所有数据并将其发送回客户端。



有时，您可能会发现需要运行*不在*伪终端中的会话。

在 `PuTTY` 中，这通常只对非常专业的目的有用;尽管在 `Plink`（见[第7章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink)）中，这是通常的工作方式。



### 4.24.2 发送终端模式

`SSH` 协议允许客户端为远程伪终端发送“终端模式”。

这些通常控制服务器对本地终端行为的期望。



如果您的服务器对这些模式没有合理的默认值，您可能会发现在此处更改它们会有所帮助，尽管服务器可以自由地忽略您的更改。

如果您不了解这些内容，可以安全地保留这些设置。

（如果未请求或分配伪终端，则这些设置都不会产生任何影响。）



您可以通过在列表中选择特定模式，选择其中一个选项并在必要时指定确切值，然后点击“设置”来更改特定模式发生的情况。

选项的效果如下：

- 如果选择“自动”选项，`PuTTY` 工具将决定是否向服务器指定该模式，如果是，将发送合理的值。

  `PuTTY` 本身将发送它有意见的模式（目前只有退格键的代码 `ERASE` ，以及字符集 `IUTF8` 是否为 `UTF-8` ）。

  `Unix` 上的 `Plink` 将从本地终端传播适当的模式（如果有的话）。

- 如果选择“无”，则在任何情况下都不会为服务器指定模式值。

- 如果指定了值，则在任何情况下都会将其发送到服务器。

  指定模式值的精确语法取决于模式。



默认情况下，所有可用模式都列为“自动”，在大多数情况下应该做正确的事情。

每个设置的确切效果（如果有）取决于服务器。

它们的名称来自 `POSIX` 和其他 `Unix` 系统，它们最有可能对此类 `stty` 系统产生有用的影响。

（这些设置通常可以在登录到此类服务器后使用该命令进行更改。）



下面描述了一些值得注意的模式;有关更全面的说明，请参阅服务器文档。

- `ERASE` 是用户键入时将删除左侧一个空格的字符。

  当设置为“自动”（默认设置）时，这将遵循 `PuTTY` 中本地退格键的设置（请参阅[第 4.4.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-backspace)）。
  
  此字符和其他特殊字符使用 `^C` 的表示法指定 `Ctrl-C`，依此类推。

  使用 `^<27>` 或 `^<0x1B>` 以数字方式指定字符，并用 `^~` 来获取文本 `^` ，其他非控制字符由它们本身表示。

  将该框完全留空表示不应为指定的函数*分配任何字符*，尽管并非所有服务器都支持此功能。

- `QUIT` 是一个特殊字符，通常强制结束服务器上的当前进程（ `SIGQUIT` ）。

  在许多服务器上，它的默认设置是 `Ctrl-反斜杠` （ `^\` ），这很容易在许多键盘上意外调用。

  如果这妨碍了您，您可能需要将其更改为另一个角色或完全关闭它。

- 布尔模式（如 `ECHO` 和 `ICANON` ）可以在 `PuTTY` 中以多种方式指定，例如 `true/false` 、`yes/no` 和 `0/1` 。（显式指定值 `no` 与根本不发送模式不同。）

- 布尔模式向服务器发出终端字符集是否为 UTF-8 的 `IUTF8` 信号，用于基本行编辑等目的。

  例如，如果设置不正确，退格键可能会擦除错误数量的文本。

  但是，仅设置此值通常不足以使服务器使用 `UTF-8` ; `POSIX` 服务器通常还需要设置区域设置（通过某些依赖于服务器的方式），尽管许多较新的安装默认为 `UTF-8` 。

  此外，由于此模式添加到 `SSH` 协议的时间比其他模式晚得多，因此许多服务器（尤其是较旧的服务器）不遵循通过 `SSH` 发送的此模式;事实上，一些写得不好的服务器反对它的存在，所以你可能会发现你需要把它设置为根本不发送。

  当设置为“自动”时，这将遵循本地配置的字符集（请参阅[第 4.10.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-charset)）。

- 终端速度在其他地方配置;请参见[第 4.15.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-termspeed)。



## 4.25 X11面板

`X11` 面板允许您配置通过 `SSH` 连接转发 `X11` 。

如果您的服务器允许您运行 `X Window System` 图形应用程序，则 `X11` 转发允许您安全地授予这些应用程序访问 `PC` 上的本地 `X` 显示器的权限。

图d22



要启用 `X11` 转发，请选中“启用 `X11` 转发”框。

如果您的 `X` 显示器位置异常，您需要在“ `X` 显示位置”框中输入其位置。

如果将其留空，`PuTTY` 将尝试在环境中查找合理的默认值，或者在失败时使用主本地显示（ `:0` ）。

有关 `X11` 转发的更多信息，请参见第 [4.11 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-x-forwarding)。



### 4.25.1 远程 `X11` 认证协议

如果您使用的是 `X11` 转发，则在 `SSH` 服务器计算机上创建的虚拟 `X` 服务器将受到授权数据的保护。

这些数据是由 `PuTTY` 创建和检查的。



通常用于此目的的授权方法称为 `MIT-MAGIC-COOKIE-1` 。

这是一个简单的密码式协议：`X` 客户端向服务器发送一些 `cookie` 数据，服务器检查它是否与真正的 `cookie` 匹配。

`Cookie` 数据通过未加密的 `X11` 连接发送;因此，如果您允许第三台计算机上的客户端访问虚拟 `X` 服务器，则 `cookie` 将以明文形式发送。



`PuTTY` 提供了替代协议 `XDM-AUTHORIZATION-1` 。

这是一个经过加密身份验证的协议：`X` 客户端每次发送的数据都不同，它取决于客户端连接端的 `IP` 地址和端口，并且还标记了当前时间。

因此，捕获字符串 `XDM-AUTHORIZATION-1` 的窃听者不能立即将其重新用于自己的 `X` 连接。



`PuTTY` 的 `XDM-AUTHORIZATION-1` 支持有点实验性，可能会遇到几个问题：

- 有些 `X` 客户端可能甚至不支持 `XDM-AUTHORIZATION-1` ，所以他们不知道如何处理 `PuTTY` 提供的数据。

- 此身份验证机制仅适用于 `SSH-2` 。

  在 `SSH-1` 中，`SSH` 服务器不会以机器可读的格式告诉客户端转发连接的源地址，因此无法验证 `XDM-AUTHORIZATION-1` 数据。

- 您可能会发现此功能会导致某些 `SSH` 服务器出现问题，这些服务器不会在会话后清理 `XDM-AUTHORIZATION-1` 数据，因此，如果您随后使用仅执行 `MIT-MAGIC-COOKIE-1` 并分配相同远程显示编号的客户端连接到同一服务器，您可能会发现过时的身份验证数据仍然存在于您的服务器上，并且您的 `X` 连接失败。



`PuTTY` 的默认值为 `MIT-MAGIC-COOKIE-1` 。

如果你改变它，你应该确保你知道你在做什么。



### 4.25.2 用于本地显示的 `X` 规范文件

如果您使用的是 `X11` 转发，则转发的连接最终定向到的本地 `X` 服务器本身可能需要授权。



某些 `Windows` `X` 服务器不需要这样做：它们通过更简单的方式进行授权，例如接受来自本地计算机的任何连接，但不接受来自其他任何地方的连接。

但是，如果您的 `X` 服务器确实需要授权，那么 `PuTTY` 需要知道需要什么授权。



提供此数据的一种方法是让 `X` 服务器将其存储在与 `Unix` `.Xauthority` 文件格式相同的文件中的某个位置。

如果这是您的 `Windows` `X` 服务器的工作方式，那么您可以通过配置此选项告诉 `PuTTY` 在哪里可以找到此文件。

默认情况下，`PuTTY` 不会尝试查找本地显示器的任何授权。



## 4.26 通道面板

“通道”面板允许您通过 `SSH` 连接配置任意连接类型的隧道。

图d23



端口转发允许您通过 `SSH` 会话通过隧道传输其他类型的网络连接。

有关端口转发及其工作原理的一般讨论，请参见[第 3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-port-forwarding)。



“通道”面板中的端口转发部分显示 `PuTTY` 在连接到服务器时将尝试设置的所有端口转发的列表。

默认情况下，不设置端口转发，因此此列表为空。



要添加端口转发：

- 设置“本地”或“远程”单选按钮之一，具体取决于是要将本地端口转发到远程目标（“本地”）还是将远程端口转发到本地目标（“远程”）。

  或者，如果您希望 `PuTTY` 在本地端口上提供本地 `SOCKS 4/4A/5` 代理，请选择“动态”（请注意，此代理仅支持 `TCP` 连接; `SSH` 协议不支持转发 `UDP` ）。

- 在“源端口”框中输入源端口号。

  对于本地转发，`PuTTY` 将侦听您 `PC` 的此端口。

  对于远程转发，`SSH` 服务器将侦听远程计算机的此端口。

  请注意，大多数服务器不允许您侦听小于 `1024` 的端口号。

- 如果您选择了“本地”或“远程”（“动态”不需要此步骤），请在“目标”框中输入主机名和端口号，以冒号分隔。

  在源端口上收到的连接将定向到此目标。

  例如，要连接到 `POP-3` 服务器，可以输入 `popserver.example.com:110` 。

  （如果需要输入文字 `IPv6` 地址，请将其括在方括号中，例如“ `[::1]:2200` ”。）

- 单击“增加”按钮。您的转发详细信息应显示在列表框中。



要删除端口转发，只需在列表框中选择其详细信息，然后单击“删除”按钮。



在“源端口”框中，您还可以选择输入要侦听的 `IP` 地址，方法是指定（例如）`127.0.0.5:79` 。

有关其工作原理及其限制的更多信息，请参阅[第 3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-port-forwarding)。



您可以输入服务名称（如果本地系统知道这些名称），而不是端口号。

例如，在“目的地”框中，您可以输入 `popserver.example.com:pop3` 。



您可以在会话中使用“更改设置”修改当前活动的端口转发集（请参阅[第 3.1.3.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-changesettings)）。

如果在会话中途删除本地或动态端口转发，`PuTTY` 将停止侦听该端口上的连接，以便其他程序可以重复使用它。

如果删除远程端口转发，请注意：

- `SSH-1` 协议不包含要求服务器停止侦听远程端口的机制。

- `SSH-2` 协议确实包含这样的机制，但并非所有 `SSH` 服务器都支持它。

  （特别是，`OpenSSH` 在 `3.9` 之前的任何版本中都不支持它。）



如果您要求删除远程端口转发，并且 `PuTTY` 无法使服务器实际停止侦听该端口，它将开始拒绝该端口上的传入连接。

因此，尽管该端口不能被其他程序重用，但您至少可以合理地确定服务器端程序无法再访问端口转发端的服务。



如果删除转发，使用该转发建立的任何现有连接将保持打开状态。

同样，对全局设置（例如“本地端口接受来自其他主机的连接”）的更改只会对新转发生效。



如果您通过 `SSH` 转发的连接本身是由另一个 `PuTTY` 副本建立的第二个 `SSH` 连接，您可能会发现“注册主机名”配置选项可用于警告 `PuTTY` 它应该需要哪个主机密钥。

有关详细信息，请参见[第 4.14.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-loghost)。



### 4.26.1 控制转发端口的可见性

转发连接的源端口通常不接受来自除 `SSH` 客户端或服务器计算机本身以外的任何计算机的连接（分别用于本地和远程转发）。

“通道”面板中有一些控件可以更改此设置：

- “本地端口接受其他主机的连接”选项允许您设置本地到远程端口转发，以便客户端计算机以外的计算机可以连接到转发的端口。（这也适用于动态 `SOCKS` 转发。）

- “远程端口接受连接”选项对远程到本地端口转发执行相同的操作（以便 `SSH` 服务器计算机以外的计算机可以连接到转发的端口）。

  请注意，此功能仅在 `SSH-2` 协议中可用，并非所有 `SSH-2` 服务器都支持它（例如，`OpenSSH 3.0` 不支持）。



### 4.26.2 为转发端口选择互联网协议版本

此交换机允许您为转发端口的本地端选择特定的互联网协议（ `IPv4` 或 `IPv6` ）。

默认情况下，它设置为“自动”，这意味着：

- 对于本地到远程端口转发，`PuTTY` 将侦听 `IPv4` 和（如果可用）`IPv6` 中的传入连接
- 对于远程到本地端口转发，`PuTTY` 将为传出连接选择合理的协议。



这将覆盖“连接”面板上的常规因特网协议版本首选项（请参阅[第 4.14.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-address-family)）。



请注意，即使您特别要求 `IPv4` ，某些操作系统也可能会侦听 `IPv6` 中的传入连接，因为它们的  `IPv4` 和 `IPv6` 协议堆栈链接在一起。

显然 `Linux` 这样做，而 `Windows` 没有。

因此，如果您在 `Windows` 上运行 `PuTTY` 并且勾选“IPv6”进行本地或动态端口转发，则*只能*通过使用 `IPv6` 连接到它来使用它。

而如果你在 `Linux` 上做同样的事情，你也可以在 `IPv4` 上使用它。

但是，勾选“自动”应始终为您提供一个可以使用任一协议连接的端口。



## 4.27 查错和更多查错面板

并非所有 `SSH` 服务器都能正常工作。

各种现有服务器中都有错误，这可能使客户端无法与它们通信，除非它知道错误并解决它。

图d24

图d26



由于大多数服务器在 `SSH` 连接开始时宣布其软件版本号，因此 `PuTTY` 将尝试检测它可能在服务器中看到的错误并自动启用解决方法。

但是，有时它会犯错误;如果服务器被故意配置为隐藏其版本号，或者如果服务器是 `PuTTY` 的错误数据库不知道的版本，那么 `PuTTY` 将不知道会发生什么错误。

“查错”和“更多查错”面板（有两个，因为我们有很多错误兼容模式）允许您手动配置 `PuTTY` 希望在服务器中看到的错误。每个 `bug` 都可以配置为三种状态：

- “关”：`PuTTY` 将假定服务器没有该错误。

- “开”：`PuTTY` 将假定服务器*确实*存在错误。

- “自动”：`PuTTY` 将使用服务器的版本号公告来尝试猜测服务器是否存在错误。

  （此选项不适用于*无法*从服务器版本中检测到的错误，例如，因为在知道服务器版本之前必须对它们执行操作。）



### 4.27.1 “阻塞 `SSH-2` 忽略消息”

忽略消息（ `SSH_MSG_IGNORE` ） 是 `SSH` 协议中的消息，可以随时从客户端发送到服务器，或从服务器发送到客户端。

任何一方在收到消息时都必须忽略该消息。

`PuTTY` 使用 `SSH-2` 中的忽略消息来混淆加密的数据流，使其更难进行加密分析。

它还使用忽略消息进行连接保持连接（请参阅[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)）。



如果它认为服务器存在此错误，`PuTTY` 将停止使用忽略消息。

如果在与正确的服务器通信时启用了此错误，则会话将成功，但保持连接将不起作用，并且会话的加密安全性可能不如应有的水平。



### 4.27.2 “严格 `SSH-2` 密钥再次验证操作”

某些 `SSH` 服务器根本无法处理重复密钥交换，并且会忽略客户端启动密钥交换的尝试。

由于 `PuTTY` 在执行重复密钥交换时暂停会话，因此这样做会导致会话在一小时后挂起（除非您以不同的方式设置了重新密钥超时;有关重新密钥的更多信息，请参阅[第 4.18.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-rekey)）。

其他非常旧的 `SSH` 服务器处理重复密钥交换的方式更加糟糕，并且在收到重复密钥交换请求时断开连接。



如果检测到此错误，`PuTTY` 将永远不会启动重复密钥交换。

如果在与正确的服务器通信时启用了此错误，则会话仍应正常运行，但安全性可能低于预期。

这是一个特定于 `SSH-2` 的错误。



### 4.27.3 “阻塞 `PuTTY` 的 `SSH-2` `winadj` 请求”

`PuTTY` 有时会在通道数据中间向 `SSH` 服务器发送特殊请求，名称为 `winadj@putty.projects.tartarus.org`（参见 [G.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixG.html#sshnames-channel)）。

此请求的目的是测量到服务器的往返时间，`PuTTY` 使用该时间来调整其流量控制。

服务器实际上不必*理解*消息;它应该发回一条 `SSH_MSG_CHANNEL_FAILURE` 消息，指示它不理解它。

（ `PuTTY` 在时序计算中所需要的只是*某种*响应。）



众所周知，某些 `SSH` 服务器会以某种方式对此消息感到困惑 - 因为它的名称很长，或者因为它们无法处理无法识别的请求名称，甚至无法发回正确的失败响应，或者因为它们明智地处理它，仅用毫无意义的垃圾邮件填充服务器的日志文件，之类的。

因此，`PuTTY` 支持这个错误兼容性标志：如果它认为服务器有这个错误，它将永远不会发送其 `winadj@putty.projects.tartarus.org` 请求，并且不会使用其计时数据。



### 4.27.4 “回复已关闭通道的请求”

`RFC 4254` 中发布的 `SSH` 协议存在歧义，如果连接的一端尝试关闭通道，而另一端同时在通道内发送请求并请求回复，则会出现歧义。

`RFC 4254` 不清楚关闭方在宣布打算关闭通道后是否应该回复通道请求。



2014 年 4 月对 `ietf-ssh` 邮件列表的讨论形成了明确的共识，即正确答案是否定的。

但是，由于规范中的歧义，某些 `SSH` 服务器已实现其他策略;例如，[OpenSSH在修复之前一直如此](https://bugzilla.mindrot.org/show_bug.cgi?id=1818)。



由于 `PuTTY` 在通道的整个生命周期内使用“want reply”标志发送通道请求（请参阅[第 4.27.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-winadj)），因此在连接到此类服务器时，它可能会在认为通道已完全关闭后收到对请求的回复，并终止并显示类似于“对于不存在的通道 `256` 已接收 `SSH2_MSG_CHANNEL_FAILURE` ”的错误。



### 4.27.5“忽略 `SSH-2` 最大包大小”

设置 `SSH-2` 通道时，每一端都会宣布它愿意为该通道接收的最大数据包大小。

一些服务器忽略 `PuTTY` 的公告并发送大于 `PuTTY` 愿意接受的数据包，导致它报告“传入数据包在解密时出现乱码”。



如果检测到此错误，`PuTTY` 永远不会允许通道的流量控制窗口变得足够大以允许服务器发送超大数据包。

如果在与正确的服务器通信时启用了此错误，则会话将正常工作，但下载性能将低于应有的水平。



### 4.27.6 “丢弃在握手前发送的数据”

只是偶尔，可以通过某些通道建立 `SSH` 连接，该通道会在连接早期意外丢弃传出数据。

这通常不被视为实际 `SSH` 服务器中的错误，但有时在涉及复杂代理过程的情况下会发生。

一个例子是 [Debian 错误 #991958](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=991958)，其中通过用户模式 `Linux` 内核控制台的连接可能会在内核完全启动之前丢失传出数据。



您可以通过手动启用此 `bug` 标志来解决此问题，这将导致 `PuTTY` 等待发送其初始 `SSH` 问候语，直到它看到来自服务器的问候语。

请注意，永远无法自动检测到此错误标志，因为自动检测依赖于服务器问候语中的版本字符串，并且 `PuTTY` 必须在看到服务器的问候语*之前*决定是否预期此错误。

因此，这只是手动解决方法。



### 4.27.7 “阻塞 `PuTTY` 的完整 `KEXINIT` ”

在 `SSH` 连接开始时，客户端和服务器交换类型为 `SSH_MSG_KEXINIT` 的长消息，其中包含它们准备使用的所有加密算法的列表。

这用于协商一组双方都可以使用的算法。



有时，编写得不好的服务器可能会在其准备接收的列表上有长度限制，并且仅仅因为 `PuTTY` 给了它太多选择而拒绝建立连接。

解决方法是启用此标志，这将使 `PuTTY` 等待发送 `KEXINIT` ，直到它从服务器收到一个标志，然后过滤自己的 `KEXINIT` 算法以省略服务器未宣布支持的任何算法。

这通常会使 `PuTTY` 的 `KEXINIT` 设定为服务器支持的大小，否则对算法协商没有影响。



此标志轻微违反了 `SSH` 协议，因为双方都应该主动发送 `KEXINIT` 。

如果*一*端不等待就发送它的 `KEXINIT` ，它仍然可以工作，但如果客户端和服务器都等待另一端先说话，则连接将死锁。

我们不知道有任何服务器这样做，但如果有一个，那么这个标志将使 `PuTTY` 根本无法与它们交谈。



### 4.27.8 “需要在 `SSH-2 RSA` 签名进行填充”

低于 `OpenSSH 3.3` 的版本要求用零字节填充 `SSH-2 RSA` 签名，长度与 `RSA` 密钥模数相同。

`SSH-2` 规范说必须接受未填充的签名，所以这是一个错误。

此问题的典型症状是 `PuTTY` 每几百次尝试一次神秘地使 `RSA` 身份验证失败，并回退到密码。



如果检测到此错误，`PuTTY` 将以 `OpenSSH` 预期的方式填充其签名。

如果在与正确的服务器通信时启用了此错误，则可能不会造成任何损害，因为正确的服务器通常仍接受填充签名，因为它们习惯于与 `OpenSSH` 通信。

这是一个特定于 `SSH-2` 的错误。



### 4.27.9 “只支持 `RFC4419` `SSH-2 DH GEX` ”

使用 `Diffie-Hellman` 组交换的 `SSH` 密钥交换方法在其原始版本之后进行了重新设计，以使用稍微复杂的设置消息。

几乎所有的 `SSH` 实现都切换到新版本。

（ `PuTTY` 是最后一个。一些旧服务器仍然只支持旧服务器。）



如果检测到此错误，并且客户端和服务器协商 `Diffie-Hellman` 组交换，则 `PuTTY` 将发送现在称为的旧消息 `SSH2_MSG_KEX_DH_GEX_REQUEST_OLD` 代替新消息 `SSH2_MSG_KEX_DH_GEX_REQUEST` 。

这是一个特定于 `SSH-2` 的错误。



### 4.27.10 “混算 `SSH-2 HMAC` 密钥”

来自 `ssh.com` 的 `SSH` 服务器软件的 `2.3.0` 及更低版本错误地计算其 `HMAC` 消息身份验证代码的密钥。

此问题的典型症状是 `PuTTY` 在会话开始时意外死掉，说“数据包上收到的 `MAC` 不正确”。

如果检测到此错误，`PuTTY` 将以与错误服务器相同的方式计算其 `HMAC` 密钥，以便仍然可以进行通信。

如果在与正确的服务器通信时启用了此错误，则通信将失败。

这是一个特定于 `SSH-2` 的错误。



### 4.27.11 “错误 `SSH-2 PK` 认证会话 `ID` ”

低于 `OpenSSH 2.3` 的版本要求 `SSH-2` 公钥身份验证略有不同：客户端要签名的数据包含以不同方式格式化的会话 `ID` 。

如果公钥身份验证神奇地不起作用，但事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）认为它已成功发送签名，则可能值得启用此错误的解决方法以查看是否有帮助。

如果检测到此错误，`PuTTY` 将以 `OpenSSH` 预期的方式对数据进行签名。

如果在与正确的服务器通信时启用了此错误，则 `SSH-2` 公钥身份验证将失败。

这是一个特定于 `SSH-2` 的错误。



### 4.27.12 “混算 `SSH-2` 加密密钥”

来自 `ssh.com` 低于 `2.0.11` 的 `SSH` 服务器软件版本计算会话加密的密钥不正确。

此问题可能会导致各种错误消息，例如“传入数据包在解密时出现乱码”，甚至可能“内存不足”。



如果检测到此错误，`PuTTY` 将以与错误服务器相同的方式计算其加密密钥，以便仍然可以进行通信。

如果在与正确的服务器通信时启用了此错误，则通信将失败。

这是一个特定于 `SSH-2` 的错误。



### 4.27.13 “阻塞 `SSH-1` 忽略消息”

忽略消息（ `SSH_MSG_IGNORE` ） 是 `SSH` 协议中的消息，可以随时从客户端发送到服务器，或从服务器发送到客户端。

任何一方在收到消息时都必须忽略该消息。

`PuTTY` 使用忽略消息将密码数据包隐藏在 `SSH-1` 中，以便侦听器无法分辨用户密码的长度;它还使用忽略消息进行连接保持连接（请参阅[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)）。



如果检测到此错误，`PuTTY` 将停止使用忽略消息。

这意味着 `keepalives` 将停止工作，`PuTTY` 将不得不回退到针对 `SSH-1` 密码长度窃听的辅助防御。

请参阅[第 4.27.14 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-plainpw1)。如果在与正确的服务器通信时启用了此错误，则会话将成功，但保持连接将不起作用，并且会话可能更容易受到窃听者的攻击。



### 4.27.14 “拒绝所有 `SSH-1` 密码伪装”

当与无法处理忽略消息的 `SSH-1` 服务器通信时（请参阅[第 4.27.13 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-ignore1)），`PuTTY` 将尝试通过在密码数据包*中*发送额外的填充来伪装用户密码的长度。

这在技术上违反了 `SSH-1` 规范，因此 `PuTTY` 只有在无法使用符合标准的忽略消息作为伪装时才这样做。

从这个意义上说，服务器拒绝接受填充的密码包并不是真正的错误，但如果服务器也无法处理忽略消息，它确实会让生活变得不方便。



如果检测到此“错误”，`PuTTY` 将假设忽略消息和填充都不可接受的，因此它别无选择，只能发送用户的密码，没有任何形式的伪装，以便窃听用户将能够轻松找到密码的确切长度。

如果在与正确的服务器通信时启用此错误，则会话将成功，但更容易受到窃听者的攻击。

这是一个特定于 `SSH-1` 的错误， `SSH-2` 可以安全地抵御此类攻击。



### 4.27.15 “阻塞 `SSH-1 RSA` 认证”

某些 `SSH-1` 服务器根本无法处理 `RSA` 身份验证消息。

如果 `Pageant` 正在运行并且包含任何 `SSH-1` 密钥，`PuTTY` 通常会在回退到密码之前自动尝试 `RSA` 身份验证，因此这些服务器在看到 `RSA` 尝试时会崩溃。



如果检测到此错误，`PuTTY` 将直接进行密码身份验证。

如果在与正确的服务器通信时启用了此错误，会话将成功，但当然 `RSA` 身份验证将是不可能的。

这是一个特定于 `SSH-1` 的错误。



## 4.28 “Bare `ssh-connection` 协议”

除了 `SSH` 本身，`PuTTY` 还支持从 `SSH` 派生的第二个协议。

它在 `PuTTY` `GUI` 中以“Bare `ssh-connection`”的名称列出。



该协议仅由 `SSH-2` 的三层中最内层组成：它省略了提供网络安全的加密层，省略了您提供用户名并证明您可以以该用户身份登录的身份验证层。

因此，它**完全不适合任何网络连接**。不要尝试通过网络使用它！



该协议的目的是用于各种专业情况，其中“连接”不是通过真实网络，而是*在同一台计算机上*运行的不同进程之间的管道或 `IPC` 通道。

在这些上下文中，操作系统已经保证两个通信进程中的每一个都归预期用户所有（因此不需要身份验证），并且通信通道不能被同一台计算机上的恶意用户窃听（因此也不需要加密）。

可能使用的示例涉及与高度分离的上下文（例如容器内部、VM 或其他网络命名空间）进行通信。



对此协议的显式支持是 `PuTTY 0.75` 中的新增功能。

截至 `2021-04` 年，唯一已知的裸协议服务器是 `Unix` 程序“ `ssh-connection` ”，它也是 `PuTTY` 工具套件 `psusan` 的一部分。



（但是，此协议也是 `PuTTY` 实例之间用于实现连接共享的相同协议：请参阅[第 4.17.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-sharing)。事实上，在 PuTTY 的 Unix 版本中，当共享上游在事件日志中记录“在 [pathname] 处共享此连接”时，可以通过在主机名框中输入其路径名并选择“Bare `ssh-connection`”作为协议，将另一个 PuTTY 实例直接连接到该 Unix 套接字！



`SSH` 面板下的许多选项也会影响此协议，尽管出于显而易见的原因，与加密和身份验证相关的选项不会。



我再说一遍，**不要尝试将此协议用于网络连接！**这不是它的用途，而且这样做一点也不安全。



## 4.29 串口面板

串口面板允许您配置仅在 `PuTTY` 连接到本地串行线路时适用的选项。

图e01



### 4.29.1 选择连接到串行线路

如果您的计算机有多个串行端口，则“连接到串行线路”框允许您选择希望 `PuTTY` 与之通信的串行线路。

在 `Windows` 上，第一个串行线路称为 `COM1` ，如果有第二个，则称为 `COM2` ，依此类推。

此配置设置在“会话”面板上也可见，如果连接类型设置为“串行”，它将替换“主机名”框（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。



### 4.29.2 选择串行线路的速度

“速度”框允许您选择与串行线路通信的速度（或“波特率”）。

典型值可能是 `9600` 、`19200` 、`38400` 或 `57600` 。

您需要哪一个将取决于串行电缆另一端的设备;如有疑问，请参阅该设备的手册。

此配置设置在“会话”面板上也可见，如果连接类型设置为“串行”，它将替换“端口”框（请参阅[第 4.1.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-hostname)）。



### 4.29.3 选择数据位数

“数据位”框允许您选择通过串行线发送或接收的每个字节中传输多少数据位。

典型值为 `7` 或 `8` 。



### 4.29.4 选择停止位数

“停止位”框允许您选择在串行线路协议中使用多少停止位。

典型值为 `1` 、`1.5` 或 `2` 。



### 4.29.5 选择串行奇偶校验方案

“奇偶校验”框允许您选择在串行线路上使用的奇偶校验类型。

这些设置包括：

- “无”：根本不发送奇偶校验位。
- “奇”：每个字节旁边发送一个额外的奇偶校验位，并排列成 `1` 位的总数是奇数。
- “偶”：每个字节旁边发送一个额外的奇偶校验位，并排列成 `1` 位的总数是偶数。
- “始终为 `1` ”：每个字节一起发送一个额外的奇偶校验位，并始终设置为 `1` 。
- “始终为 `0` ”：每个字节一起发送一个额外的奇偶校验位，并始终设置为 `0` 。

图e02



### 4.29.6 选择串行流控制方案

“流控制”框允许您选择在串行线路上使用哪种类型的流量控制检查。

这些设置包括：

- “无”：不进行流量控制。

  如果任何一方尝试发送速度超过串行线路允许的速度，则数据可能会丢失。

- “ `XON/XOFF` ”：流量控制是通过在数据流中发送 `XON` 和 `XOFF` 字符来完成的。

- “ `RTS/CTS` ”：流量控制是使用串行线路上的 `RTS` 和 `CTS` 线完成的。

- “ `DSR/DTR` ”：流量控制是使用串行线路上的 `DSR` 和 `DTR` 线完成的。

图e03



## 4.30 `Telnet` 面板

“ `Telnet` 面板”允许您配置仅适用于 `Telnet` 会话的选项。

图e04



### 4.30.1 “ `OLD_ENVIRON` 歧义的处理”

用于传递环境变量的原始 `Telnet` 机制指定得很糟糕。

在编写标准（ `RFC 1408` ）时，`BSD telnet` 实现已经支持该功能，该标准的意图是描述 `BSD` 实现已经在使用的行为。



可悲的是，标准发布时存在打字错误，并且指定了两个重要的功能代码。

`BSD` 的实现没有改变，标准也没有被纠正。

因此，您可能会找到符合 `BSD` 或 `RFC` 的实现。

此开关允许您选择 `PuTTY` 声称是哪一个。



这个问题通过发布第二个标准来解决，定义了一个名为 `NEW_ENVIRON` 的新 `Telnet` 机制，其行为与原始 `OLD_ENVIRON` 机制完全相同，但不受现有实现的阻碍。

大多数 `Telnet` 服务器现在都支持此功能，而且是明确的。

仅当您在将环境变量传递到相当旧的服务器时遇到问题时，才需要此功能。



### 4.30.2 被动和主动远程登录协商模式

在 `Telnet` 连接中，客户端和服务器之间传递的数据类型有两种类型：实际文本和关于使用哪些 `Telnet` 额外功能的*协商*。

`PuTTY` 可以使用两种不同的协商策略：

- 在*主动*模式下，`PuTTY` 在连接打开后立即开始发送协商。
- 在*被动*模式下，`PuTTY` 将等待协商，直到它看到来自服务器的协商。



被动模式的明显缺点是，如果服务器也在被动模式下运行，则协商将永远不会开始。

因此，`PuTTY` 默认为主动模式。

但是，有时需要被动模式才能成功通过某些类型的防火墙和 `Telnet` 代理服务器。

如果您对防火墙有混淆问题，您可以尝试启用被动模式以查看是否有帮助。



### 4.30.3 “键盘直接发送 `Telnet` 特殊命令”

如果选中此框，则多个键序列的正常操作将被修改：

- 键盘上的退格键将发送 `Telnet` 特殊的退格码;
- `Control-C` 将发送 `Telnet` 特殊中断进程代码;
- `Control-Z` 将发送 `Telnet` 特殊的挂起进程代码。

除非您知道自己在做什么，否则您可能不应该启用此功能。



### 4.30.4 “发送 `Telnet` 新行命令替换 `^M` 字符”

与大多数其他远程登录协议不同，`Telnet` 协议具有特殊的“换行符”代码，与 `Control-M` 或 `Control-J` 的通常行尾不同。

默认情况下，`PuTTY` 会在您按 `Return` 键时发送 `Telnet` 新行代码，而不是像在大多数其他协议中那样发送 `Control-M` 。

大多数 `Unix` 风格的 `Telnet` 服务器不介意它们是否接收 `Telnet New Line` 或 `Control-M` ;一些服务器确实需要 `New Line` ，而一些服务器更喜欢看到 `^M` 。

如果在 `Telnet` 会话中按 `Return` 时看到令人惊讶的行为，您可以尝试关闭此选项以查看是否有帮助。



## 4.31 `Rlogin` 面板

`Rlogin` 面板允许您配置仅适用于 `Rlogin` 会话的选项。

图e05



### 4.31.1 “本地用户名”

`Rlogin` 允许通过服务器上调用的文件 `.rhosts` 进行自动（无密码）形式的登录。

您在文件 `.rhosts` 中放置一行，上面写着类似 `jbloggs@pc1.example.com` ，然后当您建立 `Rlogin` 连接时，客户端会传输运行 `Rlogin` 客户端用户的用户名。

服务器根据 `.rhosts` 检查用户名和主机名，如果它们匹配，则不要求输入密码。



这之所以有效，是因为 `Unix` 系统包含阻止用户在 `Rlogin` 连接中伪装成其他用户的保护措施。

`Rlogin` 连接必须来自低于 `1024` 的端口号，`Unix` 系统禁止对非特权进程执行此操作。

因此，当服务器看到来自低编号端口的连接时，它假定连接的客户端由特权（因此受信任）进程持有，因此它相信用户是谁的声明。



`Windows` 没有此限制：*任何*用户都可以从编号较低的端口启动传出连接。

因此，`Rlogin` 机制 `.rhosts` 对于安全地区分 `Windows` 计算机上的多个不同用户是完全无用的。

如果你有一个指向 `Windows` `PC` 的条目 `.rhosts` ，你应该假设使用该PC*的任何人都可以*在 `Rlogin` 连接中欺骗你的用户名，并在服务器上访问你的帐户。



“本地用户名”控件允许您指定 `PuTTY` 应该声明您拥有的用户名，以防它与您的 `Windows` 用户名不匹配（或者如果您没有费心设置 `Windows` 用户名）。



## 4.32 `SUPDUP` 面板

`SUPDUP` 面板允许您配置仅适用于 `SUPDUP` 会话的选项。

有关 `SUPDUP` 协议的更多信息，请参见第 [3.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-supdup)。

图e06



### 4.32.1 “位置字符串”

在 `SUPDUP` 中，客户端将其选择的一段文本发送到服务器，以提供用户的位置。

这通常显示在登录用户列表中。

默认情况下，`PuTTY` 仅将其默认为“互联网”。

如果您希望您的位置显示为更具体的内容，可以在此处进行配置。



### 4.32.2 “扩展的 `ASCII` 字符集”

这声明了您的终端支持的字符集扩展类型。

如果服务器支持，它将使用该字符集发送文本。

“无”表示标准的 `95` 个可打印 `ASCII` 字符。

“`ITS`”表示在控制字符范围内使用可打印字符扩展的 `ASCII` 。

此字符集记录在 `SUPDUP` 协议定义中。

“`WAITS`”类似于“`ITS`”，但在扩展集中使用了一些替代字符：最突出的是，它将显示箭头而不是 `^` 和 `_` ，`}` 而不是 `~` 。

“`ITS`”扩展 `ASCII` 由 `ITS` 和 `Lisp` 机器使用，而“ `WAITS` ”仅由斯坦福 `AI` 实验室的 `WAITS` 操作系统使用。



### 4.32.3 “**更多**处理”

启用 **更多** 处理后，服务器会导致输出在屏幕底部暂停，直到键入空格。



### 4.32.4 “终端滚动”

这控制终端是执行滚动，然后光标进入最后一行下方，还是光标返回到第一行。



## 4.33 将配置存储在文件中

`PuTTY` 目前不支持将其配置存储在文件而是放在注册表中。

但是，您可以使用几个批处理文件解决此问题。



您将需要一个名为（例如） `PUTTY.BAT` 的文件，它将文件的内容导入注册表，然后运行 `PuTTY` ，将注册表的内容导出回文件中，并删除注册表项。

这一切都可以使用 `Regedit` 命令行选项完成，因此这一切都是自动的。

以下是 `PUTTY.BAT` 需要的内容：

```
@ECHO OFF
regedit /s putty.reg
regedit /s puttyrnd.reg
start /w putty.exe
regedit /ea new.reg HKEY_CURRENT_USER\Software\SimonTatham\PuTTY
copy new.reg putty.reg
del new.reg
regedit /s puttydel.reg
```



此批处理文件需要两个辅助文件：`PUTTYRND.REG` 为随机种子文件 `PUTTY.RND` 设置初始安全位置， `PUTTYDEL.REG`  在成功保存回文件后销毁注册表中的所有内容。



以下是 `PUTTYDEL.REG` ：

```
REGEDIT4

[-HKEY_CURRENT_USER\Software\SimonTatham\PuTTY]
```



下面是一个 `PUTTYRND.REG` 示例文件：

```
REGEDIT4

[HKEY_CURRENT_USER\Software\SimonTatham\PuTTY]
"RandSeedFile"="a:\\putty.rnd"
```



你应该替换 `a:\putty.rnd` 为你想要存储随机数数据的实际位置。

如果目的是在一个 `USB` 记忆棒上携带 `PuTTY` 及其设置，您可能希望将其存储在 `USB` 记忆棒上。









# 第 5 章：使用 `PSCP` 安全地传输文件

`PSCP` ，`PuTTY` 安全复制客户端，是一种使用 `SSH` 连接在计算机之间安全传输文件的工具。

如果您有 `SSH-2` 服务器，您可能更喜欢 `PSFTP`（请参阅[第 6 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter6.html#psftp)）进行交互使用。

但是，`PSFTP` 通常不适用于 `SSH-1` 服务器。



## 5.1 启动 `PSCP`

`PSCP` 是一个命令行应用程序。

图f01



这意味着您不能只双击其图标来运行它，而是必须打开一个控制台窗口。

对于 `Windows 95` ，`98` 和 `ME` ，这称为“MS-DOS提示符”，而在 `Windows NT` ，`2000` 和 `XP` 中，它称为“命令提示符”。

它应该可以从“开始”菜单的“程序”部分获得。



要启动 `PSCP` ，它需要位于您的 `PATH` 目录或当前目录中。

要将包含 `PSCP` 的目录添加到 `PATH` 环境变量，请在控制台窗口中键入：

```
set PATH=C:\path\to\putty\directory;%PATH%
```



这仅适用于该特定控制台窗口的生存期。

若要在 `Windows NT` 、`2000` 和 `XP` 上永久生效地设置 `PATH` ，请使用“系统控制面板”的“环境”选项卡。

在 `Windows 95` 、`98` 和 `ME` 上，您需要编辑您的 `AUTOEXEC.BAT` 以包含类似上面的 `set` 命令。



## 5.2 `PSCP` 的使用

一旦你有一个控制台窗口可以键入，你只需单独键入 `pscp` 即可显示使用消息。

这将告诉您正在使用的 `PSCP` 版本，并简要总结如何使用 `PSCP` ：

```
C:\>pscp
PuTTY Secure Copy client
Release 0.78
Usage: pscp [options] [user@]host:source target
       pscp [options] source [source...] [user@]host:target
       pscp [options] -ls [user@]host:filespec
Options:
  -V        print version information and exit
  -pgpfp    print PGP key fingerprints and exit
  -p        preserve file attributes
  -q        quiet, don't show statistics
  -r        copy directories recursively
  -v        show verbose messages
  -load sessname  Load settings from saved session
  -P port   connect to specified port
  -l user   connect with specified username
  -pwfile file   login with password read from specified file
  -1 -2     force use of particular SSH protocol version
  -ssh -ssh-connection
            force use of particular SSH protocol variant
  -4 -6     force use of IPv4 or IPv6
  -C        enable compression
  -i key    private key file for user authentication
  -noagent  disable use of Pageant
  -agent    enable use of Pageant
  -no-trivial-auth
            disconnect if SSH authentication succeeds trivially
  -hostkey keyid
            manually specify a host key (may be repeated)
  -batch    disable all interactive prompts
  -no-sanitise-stderr  don't strip control chars from standard error
  -proxycmd command
            use 'command' as local proxy
  -unsafe   allow server-side wildcards (DANGEROUS)
  -sftp     force use of SFTP protocol
  -scp      force use of SCP protocol
  -sshlog file
  -sshrawlog file
            log protocol details to a file
  -logoverwrite
  -logappend
            control what happens when a log file already exists
```

图f02



（ `PSCP` 的界面很像 `Unix` 的 `scp` 命令，如果你熟悉它的话。）



### 5.2.1 基础知识

要从远程服务器接收文件，可以使用类似如下命令格式：

```
pscp [options] [user@]host:source target
```



因此，要将文件 `/etc/hosts` 从服务器 `example.com` 以用户 `fred` 身份复制到文件 `c:\temp\example-hosts.txt` ，则需要键入：

```
pscp fred@example.com:/etc/hosts c:\temp\example-hosts.txt
```



要将文件发送到远程服务器，可以使用类似如下命令格式：

```
pscp [options] source [source...] [user@]host:target
```



因此，要将本地文件 `c:\documents\foo.txt` 以用户 `fred` 身份复制到服务器`example.com` 的 `/tmp/foo` 目录，您需要键入：

```
pscp c:\documents\foo.txt fred@example.com:/tmp/foo
```



您可以使用通配符在任一方向上传输多个文件，如下所示：

```
pscp c:\documents\*.doc fred@example.com:docfiles
pscp fred@example.com:source/*.c c:\source
```



但是，在第二种情况下（对多个远程文件使用通配符），您可能会看到一条警告，比如“警告：当我们请求名为”`*.c`“的文件时，远程主机试图写入名为 `terminal.c` 的文件。

如果这是通配符，请考虑升级到 `SSH-2` 或使用“ `-unsafe` ”选项。

已不允许重命名此文件。



这是由于旧式 `SCP` 协议中的基本不安全：客户端将通配符字符串（`*.c`）发送到服务器，服务器发回与通配符模式匹配的文件名序列。

但是，没有什么可以阻止服务器发回*不同的*模式并覆盖您的其他文件之一：如果您请求 `*.c` ，服务器可能会发回文件名 `AUTOEXEC.BAT` 并为您安装病毒。

由于通配符匹配规则由服务器决定，因此客户端无法可靠地验证发回的文件名是否与模式匹配。



`PSCP` 将尝试在可能的情况下使用较新的 `SFTP` 协议（ `SSH-2` 的一部分），该协议不会受到此安全漏洞的影响。

如果您正在与支持 `SFTP` 的 `SSH-2` 服务器通信，您将永远不会看到此警告。

（您可以强制使用 `SFTP` 协议（如果 `-sftp` 可用），请参见[第 5.2.2.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter5.html#pscp-usage-options-backend)。）



如果确实需要对 `SSH-1` 服务器使用服务器端通配符，则可以将命令行选项 `-unsafe` 与 `PSCP` 一起使用：

```
pscp -unsafe fred@example.com:source/*.c c:\source
```



这将禁止显示警告消息，并且将发生文件传输。

但是，您应该知道，通过使用此选项，您使服务器能够写入目标目录中*的任何*文件，因此仅当您相信服务器管理员不是恶意的（并且不让服务器计算机被恶意人员破解）时，才应使用此选项。

或者，在新创建的空目录中执行任何此类下载。

（即使在“ `unsafe` ”模式下，`PSCP` 仍将保护您免受服务器试图使用包含“ `..` ”的路径名离开该目录的侵害。



#### 5.2.1.1 `user`

远程服务器上的登录名。

如果省略此选项，并且 `host` 是 `PuTTY` 保存的会话，`PSCP` 将使用该保存会话指定的任何用户名。

否则，`PSCP` 将尝试使用本地 `Windows` 用户名。



#### 5.2.1.2 `host`

远程服务器的名称，或现有 `PuTTY` 保存的会话名称。

在后一种情况下，将使用会话的主机名、端口号、密码类型和用户名设置。



#### 5.2.1.3 `source`

一个或多个源文件，允许使用通配符。

通配符的语法取决于它们所应用的系统，因此如果要*从* `Windows` 系统复制到 `UNIX` 系统，则应使用 `Windows` 通配符语法（例如 `*.*` ），但如果从 `UNIX` 系统*复制到*  *`Windows` 系统，*则应使用 `UNIX shell` 允许的通配符语法（例如 `*` ）。



如果源是远程服务器，并且您没有指定完整路径名（在 `UNIX` 中，以 `/` （斜杠）字符开头的路径名），则您指定为源的内容将解释为相对于远程服务器上的主目录。



#### 5.2.1.4 `target`

要放置文件的文件名或目录。

从远程服务器复制到本地主机时，您可能希望将文件放在当前目录中。

为此，应指定目标 `.` 。例如：

```
pscp fred@example.com:/home/tom/.emacs .
```

这将在远程服务器上的 `/home/tom/.emacs` 复制到当前目录。



与参数 `source` 一样，如果目标位于远程服务器上并且不是完整路径名，则会解释为相对于远程服务器上的主目录。



### 5.2.2 选项

`PSCP` 接受 `PuTTY` 工具支持的所有常规命令行选项，但在文件传输实用程序中没有意义的选项除外。

有关这些选项的说明，请参见[第 3.11.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-general-opts)。（ `PSCP` 不支持的那些有明确的标记。）

`PSCP` 还支持一些自己的选项。

以下部分介绍 `PSCP` 的特定命令行选项。



#### 5.2.2.1 列出远程文件 `-ls`

如果给出该选项 `-ls` ，则不会传输任何文件;而是列出远程文件。

只需要提供主机名规范和可选的远程文件规范。例如：

```
pscp -ls fred@example.com:dir1
```



`SCP` 协议本身不包含列出文件的方法。

因此，如果正在使用 `SCP` ，则此选项假定服务器对命令 `ls -la` 做出适当的响应;这可能不适用于所有服务器。

如果正在使用 `SFTP` ，则此选项应适用于所有服务器。



#### 5.2.2.2 保留文件属性 `-p`

默认情况下，使用 `PSCP` 复制的文件带有复制日期和时间的时间戳。

该选项 `-p` 保留复制文件的原始时间戳。



#### 5.2.2.3 静默，不显示统计信息 `-q`

默认情况下，`PSCP` 显示一个当前传输的进度条：

```
mibs.tar          |   168 kB |  84.0 kB/s | ETA: 00:00:13 |  13%
```



此显示中的字段包括（从左到右）：文件名、到目前为止传输的文件的大小（以 `KB` 为单位）、文件的传输速度估计值（以千字节/秒为单位）、传输完成的估计时间以及到目前为止传输的文件百分比。

`PSCP` 选项 `-q` 禁止打印这些统计信息。



#### 5.2.2.4 递归复制目录 `-r`

默认情况下，`PSCP` 只会复制文件。

您指定要复制的任何目录都将被跳过，其内容也将跳过。

该选项 `-r` 告知 `PSCP` 下移到您指定的任何目录，并复制它们及其内容。

这允许您使用 `PSCP` 在计算机之间传输整个目录结构。



#### 5.2.2.5 避免交互式提示 `-batch`

如果使用该选项 `-batch` ，`PSCP` 在建立连接时永远不会提供交互式提示。

例如，如果服务器的主机密钥无效（请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)），则连接将被简单地放弃，而不是询问您下一步该怎么做。

这可能有助于 `PSCP` 在自动脚本中使用时的行为：使用 `-batch` ，如果在连接时出现问题，批处理作业将失败而不是挂起。



#### 5.2.2.6 强制使用特定的文件传输协议 `-sftp`  、 `-scp`

如[第 5.2.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter5.html#pscp-usage-basics)所述，`SSH` 使用两种不同的文件传输协议。

尽管名称如此，`PSCP`（与许多其他表面上的 `scp` 客户端一样）可以使用这些协议中的任何一种。



较旧的 `SCP` 协议没有书面规范，并且将很多细节留给了服务器平台。

通配符在服务器上展开。

简单的设计意味着可以使用服务器平台支持的任何通配符规范（例如大括号扩展），但也会导致互操作性问题，例如文件名引用（例如，文件名包含空格），以及[第 5.2.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter5.html#pscp-usage-basics)中描述的安全问题。



较新的 `SFTP` 协议（通常与 `SSH-2` 服务器相关联）以更独立于平台的方式指定，并将通配符语法等问题留给客户端。

（ `PuTTY` 的 `SFTP` 通配符语法在第 [6.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter6.html#psftp-wildcards)中描述。）

这使得它跨平台更加一致，更适合脚本和自动化，并避免通配符匹配的安全问题。



通常，`PSCP` 将尝试使用 `SFTP` 协议，并且仅在服务器上 `SFTP` 不可用时才回退到 `SCP` 协议。

该选项 `-scp` 强制 `PSCP` 使用 `SCP` 协议或退出。

该选项 `-sftp` 强制 `PSCP` 使用 `SFTP` 协议或退出。

指定此选项后，`PSCP` 会更难查找 `SFTP` 服务器，这可能允许将 `SFTP` 与 `SSH-1` 一起使用，具体取决于服务器设置。



#### 5.2.2.7 控制错误消息清理 `-no-sanitise-stderr`

该选项 `-no-sanitise-stderr` 将导致 `PSCP` 按字面意思通过服务器的标准错误流，而无需先从中剥离控制字符。

如果服务器正在发送彩色错误消息，这可能很有用，但它也使服务器能够对终端显示产生意外影响。

有关更多讨论，请参见[第 7.2.3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-option-sanitise)。



### 5.2.3 返回值

仅当文件已正确传输时，`PSCP` 才会返回 `ERRORLEVEL` 零（成功）。

您可以使用如下代码在批处理文件中对此进行测试：

```
pscp file*.* user@hostname:
if errorlevel 1 echo There was an error
```



### 5.2.4 对 `PSCP` 使用公钥身份验证

与 `PuTTY` 一样，`PSCP` 可以使用公钥而不是密码进行身份验证。

有三种方法可以做到这一点。



首先，`PSCP` 可以使用 `PuTTY` 保存的会话来代替主机名（请参阅[第 5.2.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter5.html#pscp-usage-basics-host)）。

所以你会这样做：

- 运行 `PuTTY` ，并创建一个 `PuTTY` 保存的会话（请参阅第 4.1.2 节），该会话指定您的私钥文件（请参阅[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)）。

  您可能还需要指定登录用户名（请参阅[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)）。

- 在 `PSCP` 中，您现在可以使用会话的名称而不是主机名：输入 `pscp sessionname:file localfile` ，其中 `sessionname` 替换为已保存会话的名称。



其次，您可以使用该选项 `-i` 在命令行上提供私钥文件的名称。

有关详细信息，请参见[第 3.11.3.18 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-identity)。



再次，如果 `Pageant` 正在运行，`PSCP` 将尝试使用 `Pageant` 进行身份验证（见[第 9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)）。

所以你会这样做：

- 确保 `Pageant` 正在运行，并且其中存储了您的私钥。

- 像往常一样为 `PSCP` 指定用户名和主机名。

  `PSCP` 将自动检测 `Pageant` 并尝试使用其中的密钥键值。

有关公钥身份验证的更多常规信息，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。









# 第 6 章：使用 `PSFTP` 安全地传输文件

`PSFTP` ，`PuTTY` 的 `SFTP` 客户端，是一个使用 `SSH` 连接在计算机之间安全传输文件的工具。

`PSFTP` 与 `PSCP` 的区别在于：

- `PSCP` 应该在几乎所有 `SSH` 服务器上工作。

  `PSFTP` 使用新的 `SFTP` 协议，这只是 `SSH-2` 的一项功能。

  （如果可以的话，`PSCP` 也会使用此协议，但如果不能，则可以回退到 `SSH-1` 等效项。

- `PSFTP` 允许您运行交互式文件传输会话，就像 `Windows` 的 `ftp` 程序一样。

  您可以列出目录的内容，浏览文件系统，发出多个 `get` 和 `put` 命令，并最终注销。

  相比之下，`PSCP` 旨在执行单个文件传输操作并立即终止。

图f03



## 6.1 启动 `PSFTP`

启动 `PSFTP` 的常用方法是从命令提示符处启动，与 `PSCP` 非常相似。

为此，它需要位于您的目录 `PATH` 中或当前目录中。

要将包含 `PSFTP` 的目录添加到 `PATH` 环境变量中，请在控制台窗口中键入：

```
set PATH=C:\path\to\putty\directory;%PATH%
```



但是，与 `PSCP` 不同，`PSFTP` 没有复杂的命令行语法;您只需指定主机名，也许还可以指定用户名：

```
psftp server.example.com
```

或者可能

```
psftp fred@server.example.com
```



或者，如果您只是自己键入 `psftp` （或双击 `Windows GUI` 中的 `PSFTP` 图标），您将看到 `PSFTP` 提示符，以及一条消息，告诉您 `PSFTP` 尚未连接到任何服务器：

```
C:\>psftp
psftp: no hostname specified; use "open host.name" to connect
psftp>
```

图f04



此时，您可以键入 `open server.example.com` 或 `open fred@server.example.com` 来启动会话。

`PSFTP` 接受 `PuTTY` 工具支持的所有常规命令行选项，但在文件传输实用程序中没有意义的选项除外。

有关这些选项的说明，请参见[第 3.11.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-general-opts)。（PSFTP不支持的那些有明确的标记。）

`PSFTP` 还支持一些自己的选项。

以下各节介绍 `PSFTP` 的特定命令行选项。



### 6.1.1 指定包含批处理命令的文件 `-b`

在正常操作中，`PSFTP` 是一个交互式程序，它显示命令行并接受来自键盘的命令。

如果您需要使用 `PSFTP` 执行自动化任务，您可能更愿意提前指定一组命令并自动执行它们。

该选项 `-b` 允许您执行此操作。

您可以将其与包含批处理命令的文件名一起使用。

例如，您可以创建一个名为 `myscript.scr` 包含如下行的文件：

```
cd /home/ftp/users/jeff
del jam-old.tar.gz
ren jam.tar.gz jam-old.tar.gz
put jam.tar.gz
chmod a+r jam.tar.gz
```



然后你可以通过键入如下命令来运行脚本。

```
psftp user@hostname -b myscript.scr
```



以这种方式运行批处理脚本时，如果任何命令无法成功完成，`PSFTP` 将中止该脚本。

要更改此行为，您可以添加该选项 `-be` （[第 6.1.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter6.html#psftp-option-be)）。

`PSFTP` 将在完成批处理脚本执行后终止。



### 6.1.2 在运行时显示批处理命令 `-bc`

该选项 `-bc` 更改 `PSFTP` 在处理使用 `-b` 指定的批处理脚本时显示的内容。

使用该选项 `-bc` ，`PSFTP` 将显示提示和命令，就像在键盘上键入命令一样。



所以看到可能不像这样：

```
C:\>psftp fred@hostname -b batchfile
Sent username "fred"
Remote working directory is /home/fred
Listing directory /home/fred/lib
drwxrwsr-x    4 fred     fred         1024 Sep  6 10:42 .
drwxr-sr-x   25 fred     fred         2048 Dec 14 09:36 ..
drwxrwsr-x    3 fred     fred         1024 Apr 17  2000 jed
lrwxrwxrwx    1 fred     fred           24 Apr 17  2000 timber
drwxrwsr-x    2 fred     fred         1024 Mar 13  2000 trn
```



而有可能会看到以下内容：

```
C:\>psftp fred@hostname -bc -b batchfile
Sent username "fred"
Remote working directory is /home/fred
psftp> dir lib
Listing directory /home/fred/lib
drwxrwsr-x    4 fred     fred         1024 Sep  6 10:42 .
drwxr-sr-x   25 fred     fred         2048 Dec 14 09:36 ..
drwxrwsr-x    3 fred     fred         1024 Apr 17  2000 jed
lrwxrwxrwx    1 fred     fred           24 Apr 17  2000 timber
drwxrwsr-x    2 fred     fred         1024 Mar 13  2000 trn
psftp> quit
```



### 6.1.3 出现错误时继续执行批处理 `-be`

运行批处理文件时，即使命令无法成功完成，此附加选项也会导致 `PSFTP` 继续处理。

例如，如果要删除文件并且不在乎它是否已不存在，则可能希望发生这种情况。



### 6.1.4 避免交互式提示 `-batch`

如果使用该选项 `-batch` ，`PSFTP` 在建立连接时永远不会给出交互式提示。

例如，如果服务器的主机密钥无效（请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)），则连接将被简单地放弃，而不是询问您下一步该怎么做。

这可能有助于 `PSFTP` 在自动脚本中使用时的行为：使用 `-batch` ，如果在连接时出现问题，批处理作业将失败而不是挂起。



#### 6.1.4.1 控制错误消息清理 `-no-sanitise-stderr`

该选项 `-no-sanitise-stderr` 将导致 `PSFTP` 按字面意思通过服务器的标准错误流，而无需先从中剥离控制字符。

如果服务器正在发送彩色错误消息，这可能很有用，但它也使服务器能够对终端显示产生意外影响。

有关更多讨论，请参见[第 7.2.3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-option-sanitise)。



## 6.2 运行 `PSFTP`

启动 `PSFTP` 会话后，您将看到一个 `psftp>` 提示。

现在，您可以键入命令来执行文件传输功能。

本节列出了所有可用的命令。

任何以 `#` 开头的行都将被视为注释并被忽略。



### 6.2.1 `PSFTP` 命令的一般引用规则

`PSFTP` 命令解释器将大多数 `PSFTP` 命令视为用空格分隔的单词序列。

例如 `ren oldfilename newfilename` ，命令拆分为三个单词：`ren` （命令名称）、`oldfilename`（要重命名的文件的名称）和 `newfilename`（要为文件提供的新名称）。



有时您需要指定*包含空格的*文件名。

为此，您可以用双引号将文件名括起来。

这同样适用于本地文件名和远程文件名：

```
psftp> get "spacey file name.txt" "save it under this name.txt"
```



双引号本身不会作为文件名的一部分出现;它们被 `PSFTP` 删除，它们的唯一作用是阻止它们内部的空格充当单词分隔符。

如果需要*使用*双引号（在某些类型的远程系统上，例如 `Unix` ，允许您在文件名中使用双引号），可以通过加倍来执行此操作。

这适用于双引号内部和外部。

例如，此命令

```
psftp> ren ""this"" "a file with ""quotes"" in it"
```

将获取当前名称为 `"this"`（开头和结尾带有双引号字符）的文件，并将其重命名为名称为 `a file with "quotes" in it` 。

（ `PSFTP` 引用规则的一个例外是命令 `!` ，它将其命令行直接传递给 `Windows` ，根本不将其拆分为单词。请参阅[第 6.2.19 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter6.html#psftp-cmd-pling)。）



### 6.2.2 `PSFTP` 中的通配符

`PSFTP` 中的几个命令支持“通配符”来选择多个文件。

对于本地文件规范（如 `put` 的第一个参数），使用*本地*操作系统的通配符规则。

例如，在 `Windows` 上运行的 `PSFTP` 可能需要使用 `*.*` ， `Unix` 上的 `PSFTP` 则是需要使用 `*`。

对于*远程*文件规范（例如 `get` 的第一个参数 ），`PSFTP` 使用标准的通配符语法（类似于 `POSIX` 通配符）：

- `*` 匹配任何字符序列（包括零长度序列）。

- `?` 只匹配一个字符。

- `[abc]` 只匹配一个字符，该字符可以是 `a` 、 `b` 或 `c` 。

  `[a-z]` 将范围中的任何字符与 `a` 到 `z` 匹配。

  `[^abc]`匹配*不是*  `a` 、`b` 或 `c` 的单个字符。

  特殊情况：`[-a]` 匹配文字连字符（ `-` ） 或 `a` ; `[^-a]` 匹配所有其他字符。 `[a^]` 匹配文字插入符号（ `^` ） 或 `a` 。

- `\` （反斜杠）在上述任何字符（或本身）之前删除该字符的特殊含义。



与某些 `Unix` 上下文不同，文件名上的前导句点（ `.` ） 不会被特殊处理; `get *` 将获取所有文件，无论它们是否以前导句点开头。



### 6.2.3 `open` 命令：启动会话

如果通过在 `GUI` 中双击或仅通过在命令行中键入 `psftp` 来启动 `PSFTP` ，则需要先打开与 `SFTP` 服务器的连接，然后才能发出任何其他命令（ `help` 和 `quit` 除外）。

要创建连接，请键入 `open host.name` ，或者如果还需要指定用户名，也可以键入 `open user@host.name` 。

您也可以选择指定端口：`open user@host.name 22` 。

发出此命令后，即使命令失败（例如，如果键入主机名错误或连接超时），*也无法*再次发出此命令。

因此，如果连接未成功打开，`PSFTP` 将立即终止。



### 6.2.4 `quit` 命令：结束会话

完成会话后，键入命令 `quit` 以关闭连接，终止 `PSFTP` 并返回到命令行（或者，如果从 `GUI` 启动 `PSFTP` 控制台窗口，则直接关闭它）。

您还可以使用 `bye` 和 `exit` 命令，它们具有完全相同的效果。



### 6.2.5 `close` 命令：关闭连接

如果只想关闭网络连接但保持 `PSFTP` 运行，则可以使用命令 `close` 。

然后，可以使用命令 `open` 打开新连接。



### 6.2.6 `help` 命令：获取快速在线帮助

如果键入 `help` ，`PSFTP` 将给出可用命令的简短列表。

如果使用命令名称键入 `help`（例如 `help get` ），则 `PSFTP` 将提供有关该特定命令的简短帮助。



### 6.2.7 `cd` 和 `pwd` 命令：更改远程工作目录

`PSFTP` 在服务器上维护您的“工作目录”的概念。

这是其他命令将对其执行操作的默认目录。

例如，如果您键入 `get filename.dat` ，则 `PSFTP` 将在服务器上的远程工作目录中查找 `filename.dat` 。



要更改远程工作目录，请使用命令 `cd` 。

如果您不提供参数， `cd` 将返回到服务器上的主目录（更准确地说，是连接开始时所在的远程目录）。

要显示当前的远程工作目录，请键入 `pwd` 。



### 6.2.8 `lcd` 和 `lpwd` 命令：更改本地工作目录

除了在远程服务器上有一个工作目录外，`PSFTP` 还在本地计算机上有一个工作目录（就像任何其他 `Windows` 进程一样）。

这是其他命令将对其执行操作的默认本地目录。

例如，如果键入 `get filename.dat` ，则 `PSFTP` 会将生成的文件保存为 `filename.dat` 本地工作目录中。

要更改本地工作目录，请使用命令 `lcd` 。

要显示当前的本地工作目录，请键入 `lpwd` 。



### 6.2.9 `get` 命令：从服务器获取文件

若要从服务器下载文件并将其存储在本地 `PC` 上，请使用命令 `get` 。

在最简单的形式中，您只需将其与文件名一起使用：

```
get myfile.dat
```



如果要以其他名称在本地存储文件，请在远程文件名后指定本地文件名：

```
get myfile.dat newname.dat
```



这将在名为 `myfile.dat` 的服务器上获取文件，但会将其保存到名为 `newname.dat` 的本地计算机中。

要以递归方式获取整个目录，您可以使用选项 `-r` ：

```
get -r mydir
get -r mydir newname
```



（如果要获取名称以连字符开头的文件，则可能必须使用特殊参数 `--` ，该参数将停止 `get` 将任何内容解释为后面的开关。

例如，“`get -- -silly-name-`”。



### 6.2.10 `put` 命令：向服务器发送文件

若要将文件从本地 `PC` 上载到服务器，请使用命令 `put` 。

在最简单的形式中，您只需将其与文件名一起使用：

```
put myfile.dat
```



如果要以其他名称远程存储文件，请在本地文件名后指定远程文件名：

```
put myfile.dat newname.dat
```



这将发送名为 `myfile.dat` 的本地文件，但会将其存储在名为 `newname.dat` 的服务器上。

要以递归方式发送整个目录，可以使用选项 `-r` ：

```
put -r mydir
put -r mydir newname
```



（如果要发送名称以连字符开头的文件，则可能必须使用特殊参数 `--` ，该参数将停止 `put` 将任何内容解释为后面的开关。

例如，“ `put -- -silly-name-` ”。



### 6.2.11 `mget` 和 `mput` 命令：获取或发送多个文件

`mget`工作原理几乎与 `get` 完全相同，除了它允许您指定多个文件一次获取。

您可以通过两种方式执行此操作：

- 通过提供两个或多个显式文件名 （'`mget file1.txt file2.txt`'）
- 通过使用通配符 （'`mget *.txt`'）。



`mget` 的每个参数都被视为要获取文件的名称（与 `get` 不同，它最多会解释一个这样的参数，第二个参数将被视为存储检索到的文件的替代名称），或者与多个文件匹配的通配符表达式。

`get` 中的选项 `-r` 和 `--` 也可用于 `mget`。

`mput`与 `put` 相似，但有相同的区别。



### 6.2.12 `reget` 和 `reput` 命令：恢复文件传输

如果文件传输中途失败，并且磁盘上存储了一半的文件，则可以使用 `reget` 和 `reput` 命令恢复文件传输。

这些命令的工作方式与 `get` 和 `put` 命令完全相同，但它们检查是否存在写了一半的目标文件，并从上次尝试停止的地方开始传输。



`reget` 和 `reput` 的语法与 `get` 和 `put` 的语法完全相同：

```
reget myfile.dat
reget myfile.dat newname.dat
reget -r mydir
```



这些命令主要用于恢复中断的传输。

它们假定远程文件或目录结构未以任何方式更改;如果有更改，您最终可能会得到损坏的文件。

特别是，选项 `-r` 不会选取对已完全传输的文件或目录的更改。



### 6.2.13 `dir` 命令：列出远程文件

要列出远程工作目录中的文件，只需键入 `dir` 。



您还可以通过键入 `dir` 后跟目录名称来列出其他目录的内容：

```
dir /home/fred
dir sources
```



您可以通过提供通配符来列出目录内容的子集：

```
dir /home/fred/*.txt
dir sources/*.c
```



该命令 `ls` 的工作方式与 `dir` 完全相同。



### 6.2.14 `chmod` 命令：更改远程文件的权限

`PSFTP` 允许您修改服务器上文件和目录的文件权限。

您可以使用命令 `chmod` 执行此操作，该命令的工作方式与 `Unix` 命令 `chmod` 非常相似。



基本语法是 `chmod modes file` ，其中 `modes` 表示对文件权限的修改，并且 `file` 是要修改的文件名。

您可以指定多个文件或通配符。例如：

```
chmod go-rwx,u+w privatefile
chmod a+r public*
chmod 640 groupfile1 groupfile2
```



参数 `modes` 可以是一组 `Unix` 样式的八进制数字。

（如果您不知道这意味着什么，您可能不想使用它！）

或者，它可以是权限修改的列表，用逗号分隔。

每个修改包括：

- 受修改影响的人。

  这可以是 `u`（拥有用户）、`g`（拥有组的成员）或 `o`（其他人 - “其他人”），或者这些的某种组合。它也可以是 `a`（“全部”）同时影响每个人。

- `+` 或 `-` 符号，指示是添加还是删除权限。

- 要添加或删除的实际权限。

  这些可以是 `r`（读取文件的权限）、 `w`（写入文件的权限）和 `x` （执行文件的权限，或者在目录的情况下，访问目录中文件的权限）。



所以上面的例子就可以是这样：

- 第一个示例：`go-rwx` 删除所属组成员和其他所有人的读取、写入和执行权限（因此只剩下文件所有者的权限）。 

  `u+w` 为文件所有者添加写入权限。

- 第二个示例：`a+r` 为每个人添加对所有文件和目录的读取权限，以“public”开头。



除此之外，`Unix` 系统还有一些额外的特殊情况。

在非 `Unix` 系统上，这些不太可能有用：

- 您可以指定 `u+s` 和 `u-s` 添加或删除 `Unix` 设置用户 `ID` 位。

  这通常仅适用于特殊目的;如果您不确定，请参阅您的 `Unix` 文档。

- 您可以指定 `g+s` 和 `g-s` 添加或删除 `Unix` 用户组 `ID` 位。

  在文件上，这类似于 `set-user-id` 位（再次查看您的 `Unix` 文档）;在目录中，它确保拥有该目录的组成员可以访问在该目录中创建的文件。

- 您可以指定 `+t` 和 `-t` 添加或删除 `Unix` “粘滞位”。

  当应用于目录时，这意味着该目录中文件的所有者可以删除该文件（而通常只允许*目录*的所有者这样做）。



### 6.2.15 `del` 命令：删除远程文件

要删除服务器上的文件，请键入 `del` ，然后键入一个或多个文件名：

```
del oldfile.dat
del file1.txt file2.txt
del *.o
```



即使指定了多个文件，文件也将被删除，无需进一步提示。

`del` 只会删除文件。您不能使用它来删除目录; 可以用 `rmdir` 来删除目录。

命令 `rm` 的工作方式与 `del` 完全相同。



### 6.2.16 `mkdir` 命令：创建远程目录

若要在服务器上创建目录，请键入`mkdir` ，然后键入目录名称：

```
mkdir newstuff
```



您可以一次指定要创建的多个目录：

```
mkdir dir1 dir2 dir3
```



### 6.2.17 `rmdir` 命令：删除远程目录

若要删除服务器上的目录，请键入 `rmdir` ，然后键入一个或多个目录名称：

```
rmdir oldstuff
rmdir *.old ancient
```



目录将被删除，无需进一步提示，即使指定了多个目录也是如此。

如果目录中有任何内容，大多数 `SFTP` 服务器可能会拒绝删除目录，因此您需要先删除内容。



### 6.2.18 `mv` 命令：移动和重命名远程文件

要重命名服务器上的单个文件，请键入 `mv` ，然后键入当前文件名，然后键入新文件名：

```
mv oldfile newname
```



您还可以将文件移动到其他目录并更改名称：

```
mv oldfile dir/newname
```



要将一个或多个文件移动到现有子目录中，请指定文件（如果需要，请使用通配符），然后指定目标目录：

```
mv file dir
mv file1 dir1/file2 dir2
mv *.c *.h ..
```

`rename` 和 `ren` 命令的工作方式与 `mv` 完全相同。



### 6.2.19 `!` 命令：运行本地窗口命令

您可以使用命令 `!` 运行本地 `Windows` 命令。

这是唯一不受[第 6.2.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter6.html#psftp-quoting)中给出的命令引用规则约束的 `PSFTP` 命令。

如果任何命令行以字符 `!` 开头，则该行的其余部分将直接传递到 `Windows` ，而无需进一步转换。



例如，如果要在下载更新版本之前移开文件的现有副本，则可以键入：

```
psftp> !ren myfile.dat myfile.bak
psftp> get myfile.dat
```

使用 `Windows` 命令 `ren` 重命名本地 `PC` 上的文件。



## 6.3 通过 `PSFTP` 使用公钥身份验证

与 `PuTTY` 一样，`PSFTP` 可以使用公钥而不是密码进行身份验证。

有三种方法可以做到这一点。



首先，`PSFTP` 可以使用 `PuTTY` 保存的会话来代替主机名。

所以你可以这样做：

- 运行 `PuTTY` ，并创建一个 `PuTTY` 保存的会话（请参阅第 4.1.2 节），该会话指定您的私钥文件（请参阅[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)）。

  您可能还需要指定登录用户名（请参阅[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)）。

- 在 `PSFTP` 中，您现在可以使用会话的名称而不是主机名：键入 `psftp sessionname` ，其中替换 `sessionname` 为已保存会话的名称。



其次，您可以使用选项 `-i` 在命令行上提供私钥文件的名称。

有关详细信息，请参见[第 3.11.3.18 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-identity)。



第三，如果 `Pageant` 正在运行，`PSFTP` 将尝试使用 `Pageant` 进行身份验证（见[第9章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)）。

所以你会这样做：

- 确保 `Pageant` 正在运行，并且其中存储了您的私钥。

- 像往常一样为 `PSFTP` 指定用户名和主机名。

  `PSFTP` 将自动检测 `Pageant` 并尝试使用其中的密钥键值。

有关公钥身份验证的更多常规信息，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。





# 第 7 章：使用命令行连接工具 `Plink`

`Plink` 是一个类似于`UNIX` `ssh` 的命令行连接工具。

它主要用于自动化操作，例如使 `CVS` 访问远程服务器上的存储库。

如果要在控制台窗口中运行交互式会话，则 `Plink` 可能不是您想要的。

图f05



## 7.1 启动 `Plink`

`Plink` 是一个命令行应用程序。

这意味着您不能只双击其图标来运行它，而是必须打开一个控制台窗口。

在 `Windows 95` ，`98` 和 `ME` 中，这被称为“MS-DOS提示符”，而在 `Windows NT` ，`2000` 和 `XP` 中，它被称为“命令提示符”。

它应该可以从“开始”菜单的“程序”部分获得。



为了使用 `Plink` ，该文件 `plink.exe` 需要位于您的 `PATH` 目录中或当前目录中。

要将包含 `Plink` 的目录添加到环境变量 `PATH` 中，请在控制台窗口中键入：

```
set PATH=C:\path\to\putty\directory;%PATH%
```



这仅适用于该特定控制台窗口的生存期（译者按：窗口关闭 `PATH` 设定则失效）。

若要在 `Windows NT` 、`2000` 和 `XP` 上永久生效地设置 `PATH` ，请使用“系统控制面板”的“环境”选项卡。

在 `Windows 95` 、`98` 和 `ME` 上，您需要编辑您的 `AUTOEXEC.BAT` 以包含类似上面的 `set` 命令。



## 7.2 使用 `Plink`

本节介绍如何使用 `Plink` 进行交互式登录和自动化流程的基础知识。

一旦你有一个控制台窗口可以键入，你只需单独键入 `plink` 即可显示使用消息。

这会告诉您正在使用的 `Plink` 版本，并简要总结如何使用 `Plink` ：

```
C:\>plink
Plink: command-line connection utility
Release 0.78
Usage: plink [options] [user@]host [command]
       ("host" can also be a PuTTY saved session name)
Options:
  -V        print version information and exit
  -pgpfp    print PGP key fingerprints and exit
  -v        show verbose messages
  -load sessname  Load settings from saved session
  -ssh -telnet -rlogin -raw -serial
            force use of a particular protocol
  -ssh-connection
            force use of the bare ssh-connection protocol
  -P port   connect to specified port
  -l user   connect with specified username
  -batch    disable all interactive prompts
  -proxycmd command
            use 'command' as local proxy
  -sercfg configuration-string (e.g. 19200,8,n,1,X)
            Specify the serial configuration (serial only)
The following options only apply to SSH connections:
  -pwfile file   login with password read from specified file
  -D [listen-IP:]listen-port
            Dynamic SOCKS-based port forwarding
  -L [listen-IP:]listen-port:host:port
            Forward local port to remote address
  -R [listen-IP:]listen-port:host:port
            Forward remote port to local address
  -X -x     enable / disable X11 forwarding
  -A -a     enable / disable agent forwarding
  -t -T     enable / disable pty allocation
  -1 -2     force use of particular SSH protocol version
  -4 -6     force use of IPv4 or IPv6
  -C        enable compression
  -i key    private key file for user authentication
  -noagent  disable use of Pageant
  -agent    enable use of Pageant
  -no-trivial-auth
            disconnect if SSH authentication succeeds trivially
  -noshare  disable use of connection sharing
  -share    enable use of connection sharing
  -hostkey keyid
            manually specify a host key (may be repeated)
  -sanitise-stderr, -sanitise-stdout, -no-sanitise-stderr, -no-sanitise-stdout
            do/don't strip control chars from standard output/error
  -no-antispoof   omit anti-spoofing prompt after authentication
  -m file   read remote command(s) from file
  -s        remote command is an SSH subsystem (SSH-2 only)
  -N        don't start a shell/command (SSH-2 only)
  -nc host:port
            open tunnel in place of session (SSH-2 only)
  -sshlog file
  -sshrawlog file
            log protocol details to a file
  -logoverwrite
  -logappend
            control what happens when a log file already exists
  -shareexists
            test whether a connection-sharing upstream exists
```

图f06



一旦这工作，您就可以使用 `Plink` 了。



### 7.2.1 使用 Plink 进行交互式登录

要与远程服务器建立简单的交互式连接，只需键入 `plink` ，然后键入主机名：

```
C:\>plink login.example.com

Debian GNU/Linux 2.2 flunky.example.com
flunky login:
```



然后，您应该能够正常登录并运行会话。

服务器发送的输出将直接写入命令提示符窗口，该窗口很可能不会以服务器预期的方式解释终端控制代码。

因此，例如，如果您运行任何全屏应用程序，您可能会看到窗口中出现奇怪的字符。

像这样的交互式连接不是 `Plink` 的重点。



为了使用不同的协议进行连接，您可以为命令行提供选项 `-ssh` 、`-ssh-connection` 、`-telnet` 、`-rlogin` 或 `-raw` 。

要建立 `SSH` 连接，例如：

```
C:\>plink -ssh login.example.com
login as:
```



如果您已经设置了 `PuTTY` 保存的会话，则可以提供保存的会话名称，而不是提供主机名。

这允许您使用公钥身份验证、指定用户名以及使用 `PuTTY` 的大多数其他功能：

```
C:\>plink my-ssh-session
Sent username "fred"
Authenticating with public key "fred@winbox"
Last login: Thu Dec  6 19:25:33 2001 from :0.0
fred@flunky:~$
```

（您也可以使用命令行选项 `-load` 加载已保存的会话;请参见[第 3.11.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-load)。

如果使用 `-load` ，则保存的会话存在，并且它指定了主机名，则不能同时指定 `host` 或 `user@host` 参数，它将被视为远程命令的一部分。



### 7.2.2 使用 `Plink` 进行自动连接

更典型的是，`Plink` 与 `SSH` 协议一起使用，使您能够直接与服务器上运行的程序通信。

为此，您必须确保 `Plink` *使用的是* `SSH` 协议。

您可以通过多种方式执行此操作：

- 使用[第 7.2.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-usage-interactive)中所述的选项 `-ssh` 。
- 设置一个 `PuTTY` 保存的会话，该会话描述要连接到的服务器，并将协议指定为 `SSH` 。
- 将 Windows 环境变量 `PLINK_PROTOCOL` 设置为单词 `ssh` 。



通常 `Plink` 不是由用户直接调用的，而是由另一个进程自动运行。

因此，您通常不希望 `Plink` 提示您输入用户名或密码。



接下来，您可能需要避免 `Plink` 可能产生的各种交互式提示。

系统可能会提示您验证要连接到的服务器的主机密钥、输入用户名或输入密码。



为避免在使用 `Plink` 进行自动连接时提示输入服务器主机密钥，您可以先*手动连接（*使用 `PuTTY` 或 `Plink` 之一）到同一服务器，验证主机密钥（有关更多信息，请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)），然后选择“接受”将主机密钥添加到注册表。

之后，连接到该服务器的 `Plink` 命令不应提供主机密钥提示，除非主机密钥更改。

或者，您可以在每次使用 `Plink` 的命令行时在 `Plink` 的命令行上指定适当的主机密钥;请参见[第 3.11.3.22 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-hostkey)。



要避免系统提示输入用户名，您可以：

- 使用选项 `-l` 在命令行上指定用户名。

  例如 `plink login.example.com -l fred` 。

- 设置一个 `PuTTY` 保存的会话，该会话描述您要连接到的服务器，并指定登录时使用的用户名（请参阅[第 4.15.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-username)）。



为避免系统提示输入密码，您几乎肯定应该设置公钥身份验证。

（有关公钥身份验证的一般介绍，请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。）

同样，您可以通过两种方式执行此操作：

- 设置一个 `PuTTY` 保存的会话，该会话描述您要连接到的服务器，并指定私钥文件（请参阅[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)）。

  要使其在没有提示的情况下工作，您的私钥需要没有密码。

- 将私钥存储在 `Pageant` 中。更多信息见[第9章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)。



一旦完成所有这些操作后，您应该能够在 `SSH` 服务器计算机上运行远程命令，并在没有提示的情况下自动执行它：

```
C:\>plink login.example.com -l fred echo hello, world
hello, world

C:\>
```



或者，如果您已设置包含所有连接详细信息的已保存会话：

```
C:\>plink mysession echo hello, world
hello, world

C:\>
```



然后，您可以设置其他程序来运行此 `Plink` 命令并与之通信，就好像它是服务器计算机上的进程一样。



### 7.2.3 `Plink` 命令行选项

`Plink` 接受 `PuTTY` 工具支持的所有常规命令行选项。

有关这些选项的说明，请参见[第 3.11.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-general-opts)。

`Plink` 还支持一些自己的选项。

以下部分介绍了 `Plink` 的特定命令行选项。



#### 7.2.3.1 `-batch`：禁用所有交互式提示

如果您使用选项 `-batch` ，`Plink` 在建立连接时永远不会给出交互式提示。

例如，如果服务器的主机密钥无效（请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)），则连接将被简单地放弃，而不是询问您下一步该怎么做。

这可能有助于 `Plink` 在自动脚本中使用时的行为：使用 `-batch` ，如果在连接时出现问题，批处理作业将失败而不是挂起。



#### 7.2.3.2 `-s`：远程命令是 `SSH` 子系统

如果指定选项 `-s` ，`Plink` 会将指定的命令作为 `SSH` “子系统”的名称传递，而不是普通命令行。

（此选项仅对 `SSH-2` 协议有意义。）



#### 7.2.3.3 `-share`：测试并尝试共享现有连接

此选项用于检测是否可以共享现有连接（有关 SSH 连接共享的详细信息，请参阅[第 4.17.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-sharing)）并重用该连接。

`Plink` 调用方式：

```
plink -share <session>
```



将测试当前是否有相关会话的可行“上游”，可以使用您通常与 `Plink` 一起使用的任何语法来建立实际连接（主机/端口号、原始保存的会话名称、 `-load` 等）指定该上游。

如果未找到并指定了“上游”可行会话，则  `-share`  指定的连接将成为后续连接共享尝试的“上游”连接。

（此选项仅对 `SSH-2` 协议有意义。）



#### 7.2.3.4 `-shareexists`：上游连接共享测试

此选项不会建立新连接;相反，它允许测试是否存在可以共享的现有连接。

（有关 `SSH` 连接共享的详细信息，请参见[第 4.17.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-sharing)。）



`Plink` 调用方式：

```
plink -shareexists <session>
```



将测试当前是否有相关会话的可行“上游”，可以使用您通常与 `Plink` 一起使用的任何语法来建立实际连接（主机/端口号、原始保存的会话名称、 `-load` 等）指定该上游。

如果存在可用的“上游”，则返回零退出状态，否则为非零。

（此选项仅对 SSH-2 协议有意义。）



#### 7.2.3.5 `-sanitise-stream`：控制输出清理

在某些情况下，`Plink` 会将清理传递应用于从服务器接收的输出，以去除退格键和转义字符等控制字符。

这样做的目的是防止远程进程在将 `Plink` 用作类似 `git` 或 `CVS` 的传输时通过标准错误通道发送令人困惑的转义序列。

如果服务器实际上想要发送错误消息，则可能是纯文本;如果服务器滥用该通道试图覆盖终端显示的意外部分，`Plink` 将尝试阻止它。



默认情况下，这仅适用于发送到 `Windows` 控制台设备或 `Unix` 终端设备的输出通道。

（任何流向其他地方的输出流都可能需要 `8` 位协议，并且根本不必须被篡改。）

如果您告诉 `Plink` 分配远程伪终端（请参阅[第 3.11.3.12](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-pty) 节和第 [4.24.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-pty)），它也会停止发生，因为在这种情况下，您通常*希望*来自服务器的转义序列转到您的终端。



但是，如果 `Plink` 猜错了您是否要进行此清理，您可以使用以下选项之一在任一方向上覆盖它：

- `-sanitise-stderr`

  清理写入 `Plink` 标准错误通道的服务器数据，无论终端、控制台和远程 `ptys` 。

- `-no-sanitise-stderr`

  不要清理写入 `Plink` 标准错误通道的服务器数据。

- `-sanitise-stdout`

  清理写入 `Plink` 标准输出通道的服务器数据。

- `-no-sanitise-stdout`

  不要清理写入 `Plink` 标准输出通道的服务器数据。



#### 7.2.3.6 `-no-antispoof` ：关闭身份验证欺骗保护提示

在 `SSH` 中，一些可能的服务器身份验证方法需要用户输入（例如，密码身份验证或输入私钥密码），而其他方法则不需要（例如 `Pageant` 中持有的私钥）。



如果您使用 `Plink` 运行交互式登录会话，并且 `Plink` 在不需要任何用户交互的情况下进行身份验证，并且如果服务器是恶意的或遭到入侵的，它可能会尝试通过发送*看起来像*  `Plink` 的本地提示之一来诱骗您向其提供不应进入服务器的身份验证数据（例如您的私钥密码），好像 `Plink` 还没有经过身份验证。

为了防止这种情况，`Plink` 的默认策略是完成身份验证阶段，并显示如下所示的最后一个简单提示：

```
Access granted. Press Return to begin session.
```



这样，如果您在该行*之后*看到任何看起来像身份验证提示的内容，您就会知道它不是来自 `Plink` 。

这个额外的互动步骤很不方便。

因此，`Plink` 将在尽可能多的情况下将其关闭：

- 如果 `Plink` 的标准输入不指向控制台或终端设备（例如，如果您使用 `Plink` 作为某些自动化应用程序（如版本控制）的传输），那么您无论如何*都无法*在服务器中键入密码短语。

  在这种情况下，`Plink` 不会试图保护您免受服务器试图欺骗您这样做的伤害。

- 如果 `Plink` 处于批处理模式（参见[第 7.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-usage-batch)），则它*永远不会*执行任何交互式身份验证。

  因此，任何看起来像交互式身份验证提示的东西都会被自动怀疑，因此 `Plink` 省略了反欺骗提示。



但是，如果您仍然发现保护提示不方便，并且您相信服务器不会尝试这样的技巧，则可以使用“`-no-antispoof`”选项将其关闭。



## 7.3 在批处理文件和脚本中使用 `Plink`

一旦您将 `Plink` 设置为能够在没有任何交互式提示的情况下登录到远程服务器（请参阅[第 7.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-usage-batch)），您就可以将其用于许多脚本和批处理目的。

例如，若要在远程计算机上启动备份，可以使用如下命令：

```
plink root@myserver /etc/backups/do-backup.sh
```



或者，您可能想要获取与特定 `Web` 区域相关的所有系统日志行：

```
plink mysession grep /~fred/ /var/log/httpd/access.log > fredlog
```



您可以在服务器命令行上有用地运行的任何非交互式命令，都可以使用 `Plink` 以这种方式在批处理文件中运行。



## 7.4 在 `CVS` 中使用 `Plink`

要将 `Plink` 与 `CVS` 一起使用，您需要将环境变量 `CVS_RSH` 设置为指向 Plink：

```
set CVS_RSH=\path\to\plink.exe
```



您还需要安排能够在没有任何交互式提示的情况下连接到远程主机，如[第 7.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-usage-batch)中所述。



然后，您应该能够按如下方式运行 `CVS` ：

```
cvs -d :ext:user@sessionname:/path/to/repository co module
```



如果您在保存的会话中指定了用户名，则甚至不需要指定其中的“用户”部分，只需写成：

```
cvs -d :ext:sessionname:/path/to/repository co module
```



## 7.5 将 `Plink` 与 `WinCVS` 结合使用

`Plink` 也可以与 `WinCVS` 一起使用。



首先，安排 `Plink` 能够以非交互方式连接到远程主机，如[第 7.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-usage-batch)所述。



然后，在 `WinCVS` 中，从“管理”菜单中调出“首选项”对话框，然后切换到*“*端口”选项卡。

勾选标有“检查备用 `rsh` 名称”的框，然后在右侧的文本输入字段中输入 `plinke.exe` 的完整路径。

在“首选项”对话框中选择“确定”。



接下来，从 `WinCVS` 的管理菜单中选择“命令行”，然后键入 `CVS` 命令，如[第 7.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-cvs)所示，例如：

```
cvs -d :ext:user@hostname:/path/to/repository co module
```



或（如果您使用的是已保存的会话）：

```
cvs -d :ext:user@sessionname:/path/to/repository co module
```



使用“更改文件夹”按钮选择要签出的文件夹，然后单击“确定”以签出您的模块。

一旦你签出模块，`WinCVS` 将很乐意从 `GUI` 调用 `plink` 进行 `CVS` 操作。





# 第 8 章：使用公钥进行 `SSH` 身份验证

## 8.1 公钥认证 - 简介

公钥身份验证是向登录服务器标识自己的另一种方法，而不是键入密码。

它更安全、更灵活，但更难设置。



在传统的密码身份验证中，您可以通过证明您知道正确的密码来证明您是您所声称的身份。

证明您知道密码的唯一方法是告诉服务器您认为密码是什么。

这意味着，如果服务器被黑客入侵或*欺骗*（请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)），攻击者可以了解您的密码。



公钥身份验证解决了这个问题。

你生成一个*密钥对*，由一个公钥（每个人都可以知道）和一个私钥（你保密，不给任何人）组成。

私钥能够生成*签名*。

使用您的私钥创建的签名不能由没有该密钥的任何人伪造;但是任何拥有您的公钥的人都可以验证特定签名是否真实。



因此，您在自己的计算机上生成一个密钥对，并将公钥复制到服务器。

然后，当服务器要求您证明自己的身份时，PuTTY 可以使用您的私钥生成签名。

服务器可以验证该签名（因为它具有您的公钥）并允许您登录。

现在，如果服务器被黑客入侵或欺骗，攻击者不会获得您的私钥或密码;他们只获得一个签名。

签名不能重复使用，所以他们一无所获。



这有一个问题：如果您的私钥不受保护地存储在您自己的计算机上，那么任何获得访问权限*的人都可以生成*签名，就好像他们是您一样。

因此，他们将能够在您的帐户下登录您的服务器。

因此，您的私钥存储在本地计算机上时通常会使用您选择的密码进行*加密*。

为了生成签名，`PuTTY` 必须解密密钥，因此您必须键入密码。



这会使公钥身份验证不如密码身份验证方便：每次登录服务器时，您都必须键入更长的密码短语，而不是键入短密码。

一种解决方案是使用*身份验证代理*，这是一个单独的程序，用于保存解密的私钥并根据请求生成签名。

`PuTTY` 的身份验证代理称为 `Pageant` 。

当您开始 `Windows` 会话时，您启动 `Pageant` 并将您的私钥加载到其中（键入您的密码短语一次）。

在会话的其余部分，您可以启动 `PuTTY` 任意次数，`Pageant` 将自动生成签名，而无需您执行任何操作。

当您关闭 `Windows` 会话时，`Pageant` 会关闭，而不会将解密的私钥存储在磁盘上。

许多人认为这是安全性和便利性之间的良好折衷。

有关更多详细信息，请参阅[第 9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)。



有多个公钥算法可用。最常见的是 `RSA` 和 `ECDSA` ，但也存在其他，特别是 `DSA` （也称为 `DSS` ），美国的联邦数字签名标准。

`PuTTY` 支持的密钥类型在第 [8.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-keytype)中描述。



## 8.2 使用 `PuTTYgen` ，`PuTTY` 密钥生成器

`PuTTYgen` 是一个密钥生成器。

它生成公钥和私钥对，用于 `PuTTY` 、`PSCP` 、`PSFTP` 和 `Plink` ，以及 `PuTTY` 身份验证代理 `Pageant`（见[第 9 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)）。

`PuTTYgen` 生成 `RSA` 、`DSA` 、`ECDSA` 和 `EdDSA` 密钥。

图f07



当您运行 `PuTTYgen` 时，您将看到一个窗口，您有两个主要选择：`Generate` “生成”，以生成新的公钥/私钥对，或 `Load` “加载”，以加载现有私钥。

图f08



### 8.2.1 生成新密钥

这是生成新密钥对过程的一般概述。

以下各节更详细地介绍了该过程。

- 首先，您需要选择要生成的密钥类型，并选择密钥的强度。这在第 8.2.2 节和第 [8.2.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-keytype)中有更详细的描述。
- 然后按“生成”按钮，实际生成密钥。[第 8.2.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-generate)描述了此步骤。
- 生成密钥后，选择注释字段（第 8.2.7 节）和密码短语（[第 8.2.8 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-passphrase)）。
- 现在，您已准备好将私钥保存到磁盘;按“保存私钥”按钮。（请参阅[第 8.2.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-savepriv)）。



您的密钥对现在可以使用了。

您可能还希望将公钥复制到您的服务器，方法是将其从“Public key for pasting into OpenSSH authorized_keys file ”框中复制出来（请参阅第 8.2.12 节），或使用 `Save public key` “保存公钥”按钮（[第 8.2.11 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-pastekey)）。

图f09



但是，您不需要立即执行此操作;如果需要，您可以稍后将私钥加载回 `PuTTYgen`（请参阅[第 8.2.14 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-load)），公钥将可用于再次复制和粘贴。

[第 8.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey-gettingready)描述了配置 `PuTTY` 以尝试公钥身份验证以及配置 `SSH` 服务器以接受它的典型过程。



### 8.2.2 选择密钥类型

在使用 `PuTTYgen` 生成密钥对之前，您需要选择所需的密钥类型。

当前版本的 `SSH` 协议（ `SSH-2` ）支持几种不同的密钥类型，尽管特定服务器可能不支持所有这些密钥类型。

图f10



`PuTTYgen` 可以生成：

- 用于 `SSH-2` 协议的 `RSA` 密钥。
- 用于 SSH-2 协议的 `DSA` 密钥。
- 用于 `SSH-2` 协议的 `ECDSA`（椭圆曲线 `DSA` ）密钥。
- 用于 `SSH-2` 协议的 `EdDSA` 密钥（爱德华兹曲线 `DSA` ，另一种椭圆曲线算法）。



`PuTTYgen` 还可以生成适合与旧 `SSH-1` 协议（仅支持 `RSA` ）一起使用的 `RSA` 密钥;为此，您需要选择“ `SSH-1`（ `RSA` ）”选项。

由于 `SSH-1` 协议不再被认为是安全的，因此很少需要此选项。



### 8.2.3 选择密钥键的大小（强度）

“位数”输入框允许您选择 `PuTTYgen` 将生成的密钥的强度。

- 对于 `RSA` 和 `DSA` ，`2048` 位目前应该足以满足大多数用途。

  （这些类型的较小密钥不再被视为安全密钥，如果您尝试生成它们，`PuTTYgen` 会发出警告。

- 对于 `ECDSA` ，仅支持 `256` 、`384` 和 `521` 位，对应于 `NIST` 标准化的椭圆曲线。

  （椭圆曲线密钥不需要与 `RSA` 密钥一样多的位数来实现等效的安全性，因此这些数字小于 `RSA` 建议。）

- 对于 `EdDSA` ，唯一有效的大小是 `255` 位（这些密钥也称为“Ed25519”，经常使用）和 `448` 位（“Ed448”，在撰写本文时不太常见）。

  （为了向后兼容，也接受 `256` ，但效果与 `255` 相同。）

图f11



### 8.2.4 选择质数生成方法

（这完全是可选的。除非您了解得更多，否则跳过此操作并使用默认设置是完全明智的。）

在 `key` “密钥”菜单上，您还可以选择更改生成生成的密钥中使用的质数的方法。

这仅用于 `RSA` 和 `DSA` 密钥。

（其他键类型根本不需要生成质数。）

图f12



主要生成方法不会影响兼容性：使用这些方法中的任何一个生成的密钥仍将适用于所有相同的 `SSH` 服务器。

可用的方法有：

- `Use probable primes (fast)` - 使用可能的质数（快速）
- `Use proven primes (slower)` - 使用经过验证的质数（较慢）
- `Use proven primes with even distribution (slowest)` - 使用分布均匀的经过验证的质数（最慢）



“可能的质数”方法听起来不安全，但它是最常用的质数生成策略。

从理论上讲，它可能会意外生成一个不是质数的数字，但软件会进行足够的检查，使该概率变得非常小（小于 `1/2^80` ，或 `1/10^24` ）。

因此，在实践中，没有人非常担心它。



其他方法导致 `PuTTYgen` 使用它*确定*是质数的数字，因为它生成输出数字及其质数证明。

这需要更多的努力，但它消除了概率方法中的理论风险。



在某种程度上，`PuTTYgen` 的“已证明质数”方法并不严格地优于其“可能质数”方法。

如果使用 `PuTTYgen` 在可能容易受到基于定时或缓存的侧信道攻击的计算机（如共享计算机）上生成 `RSA` 密钥，则“可能的质数”方法旨在抵御此类攻击，而“经过验证的质数”方法则不是。

 （这只是 `RSA` 密钥的问题;对于其他密钥类型， 质数要么不是秘密的，要么不涉及。）



如果您有本地安全标准要求，或者您不相信常用方法安全性的概率论证，则可以选择从可能质数切换到已证明的质数。

对于 `RSA` 密钥，“密钥”菜单上还有一个选项，可以使用“强”质数作为公钥的质因数。

“强”质数是选择具有特定结构的质数，这使得某些分解算法更难以应用，因此一些安全标准建议使用它们。

但是，最现代的因式分解算法不受影响，因此除非您有推荐它的本地标准*，否则*可能不值得启用此选项。



### 8.2.5 “生成”按钮

选择所需的密钥类型和密钥强度后，按 `Generate` “生成”按钮，`PuTTYgen` 将开始实际生成密钥的过程。

首先，将出现一个进度条，`PuTTYgen` 将要求您移动鼠标以生成随机性。

图f13



在 `PuTTYgen` 窗口中的空白区域上绕圈移动鼠标，随着 `PuTTYgen` 收集足够的随机性，进度条将逐渐填满。

你不需要以特别富有想象力的模式移动鼠标（尽管它不会伤害）; `PuTTYgen` 将从鼠标每次采样其位置时*移动多远*的精细细节中收集足够的随机性。



当进度条到达末尾时，`PuTTYgen` 将开始创建密钥。

进度条将重置为开始，并再次逐渐向上移动以跟踪密钥生成的进度。

它不会均匀移动，偶尔可能会减速停止;不幸的是，这是不可避免的，因为密钥生成是一个随机过程，不可能可靠地预测需要多长时间。

密钥生成完成后，窗口中将出现一组新的控件以显示密钥相关信息。



### 8.2.6 “密钥指纹”框

`Key fingerprint` “密钥指纹”框显示生成的密钥的指纹值。

这是从*公钥*值加密派生的，因此不需要保密;对于人类来说，它应该比公钥本身更易于管理。



指纹值旨在加密安全，从某种意义上说，某人发明具有相同指纹的第二个密钥或查找具有特定指纹的密钥在计算上是不可行的。

因此，某些实用程序，例如 `Pageant` 密钥列表框（请参阅[第9.2.1节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-mainwin-keylist)）和 `Unix` 的 `ssh-add` 实用程序，将列出密钥指纹而不是整个公钥。



默认情况下，`PuTTYgen` 将以 `SHA2` 格式显示 `SSH-256` 密钥指纹。

如果您需要查看较旧的 `MD5` 格式（看起来像 `aa:bb:cc:...` ）的指纹，您可以从“密钥”菜单中选择“将指纹显示为`MD5`”，但请记住，这在加密上不太安全;攻击者使用与您的指纹相同的指纹创建密钥可能是可行的。

图f18



### 8.2.7 为密钥设置注释

如果您有多个密钥并将它们用于不同的目的，则无需记住密钥指纹即可区分它们。

`PuTTYgen` 允许您输入密钥的注释，每当 `PuTTY` 或 `Pageant` 要求您输入密码时，都会显示该*注释*。

如果未指定默认注释格式，则包含密钥类型和生成日期，例如 `rsa-key-20011212` 。

图f15



另一种常用方法是使用您的姓名和将使用密钥的计算机名称，例如 `simon@simons-pc` 。

要更改密钥注释，只需在保存私钥之前在“密钥注释”框中输入注释文本即可。

如果以后要更改注释，可以将私钥加载回 `PuTTYgen` ，更改注释，然后再次保存。



### 8.2.8 为密钥设置密码

通过“密钥密码”和“确认密码”框，您可以为密钥选择密码。

密码短语将用于加密磁盘上的密钥，因此如果不先输入密码，您将无法使用密钥。

图f16



当您保存密钥时，`PuTTYgen` 将检查“密钥密码”和“确认密码”框是否包含完全相同的密码，否则将拒绝保存密钥。

如果将密码字段留空，则密钥将以未加密的方式保存。

您*不应该*在没有充分理由的情况下这样做;如果这样做，磁盘上的私钥文件将是攻击者访问配置为接受该密钥的任何计算机所需的全部内容。

如果您希望能够登录而不必每次都键入密码，您应该考虑使用 `Pageant`（[第9章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)），以便解密的密钥仅保存在内存中而不是磁盘上。



在特殊情况下，您可能确实*需要使用*没有密码的密钥;例如，如果需要运行需要建立 `SSH` 连接的自动批处理脚本，则无法在那里键入密码。

在这种情况下，我们建议您为每个需要的特定批处理脚本（或其他任何脚本）生成一个特殊密钥，并且在服务器端，您应该安排限制每个密钥*，以便它*只能用于该特定目的。

`SSH` 服务器的文档应解释如何执行此操作（服务器之间可能会有所不同）。



选择一个好的密码短语很困难。

正如您不应该使用字典单词作为密码一样，因为攻击者很容易运行整个字典，您也不应该使用歌词、引文或其他众所周知的句子作为密码短语。

`DiceWare` （[`www.diceware.com`](http://www.diceware.com/)） 建议使用至少五个单词，每个单词通过掷五个骰子随机生成，这给出了超过 `2^64` 个可能的密码短语，可能不是一个糟糕的方案。

如果您希望密码短语具有语法意义，这将大大减少可能性，因此您应该使用更长的密码短语。



千万不要忘记您的密码。

想恢复它几乎没门！



### 8.2.9 向密钥添加证书

在某些环境中，用户身份验证密钥可以由“证书颁发机构”（简称“CA”）依次签名，`SSH` 服务器上的用户帐户可以配置为自动信任由正确签名认证的任何密钥。



如果您有非常多的服务器，这可能是一个方便的设置。

更改密钥对时，可能必须单独编辑每台服务器上的 `authorized_keys` 文件，以使它们都接受新密钥。

但是，如果您将*所有这些服务器配置为*接受由 `CA` 签名的密钥，那么当您更改公钥时，您所要做的就是让新密钥由与以前相同的 `CA` 认证，然后您的所有服务器将自动接受它，而无需单独重新配置。



要让 `CA` 签署密钥，您可能会向 `CA` 发送新的公钥（而不是私钥一半），并取回包含证书的*公钥*的修改版本。

如果您想将证书合并到您的 `PPK` 文件中以方便起见，您可以使用 `PuTTYgen` 的“密钥”菜单中的“将证书添加到密钥”菜单选项。

这将为您提供一个包含私钥和证书的文件，这是向准备接受该证书的服务器进行身份验证所需的一切。

图f17



要再次删除证书并恢复未经认证的 `PPK` 文件，还有一个“从密钥中删除证书”选项。

图f19



（但是，您*不必*将证书合并到 `PPK` 文件中。

您可以通过 `PuTTY` 本身中的“与私钥一起使用的证书”选项单独使用它。请参阅[第 4.22.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-cert)。

这取决于你觉得哪个更方便。）



当 `PuTTYgen` 中当前加载的密钥包含证书时，大的 `Public key for pasting` “用于粘贴的公钥”编辑框（请参阅[第 8.2.12 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-pastekey)）将替换为一个按钮，该按钮会显示一个信息框，告诉您有关证书的信息，例如它证明您的密钥属于谁、何时过期（如果有的话），以及依次对其进行签名的 `CA` 密钥的指纹。



### 8.2.10 将私钥保存到磁盘文件

生成密钥、设置注释字段并设置密码短语后，即可将私钥保存到磁盘。

按“保存私钥”按钮，`PuTTYgen` 将打开一个对话框，询问您将文件保存在哪里。

选择一个目录，输入文件名，然后按“保存”。

图f20



此文件采用 `PuTTY` 的本机格式（ `*.PPK` ）;您需要告诉 `PuTTY` 用于身份验证（请参阅[第 4.22.1](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey) 节）或告诉 `Pageant` 加载（请参阅[第 9.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-mainwin-addkey)）。

（您可以选择更改已保存密钥文件的 `PPK` 格式的一些详细信息;请参见[第 8.2.13 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-save-params)。但是对于大多数目的，默认值应该没问题。）



### 8.2.11 将公钥保存到磁盘文件

`RFC 4716` 指定了在磁盘上存储 `SSH-2` 公钥的标准格式。

某些 `SSH` 服务器（例如 `ssh.com's`）需要此格式的公钥才能接受使用相应私钥进行身份验证。

（其他的，如 `OpenSSH` ，使用不同的格式;请参阅[第8.2.12节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-pastekey)。）



要以 `SSH-2` 标准格式保存您的公钥，请按 `PuTTYgen` 中的“保存公钥”按钮。

`PuTTYgen` 将打开一个对话框，询问您将文件保存在哪里。

选择一个目录，输入文件名，然后按“保存”。

图f21



然后，您可能希望将公钥文件复制到 `SSH` 服务器计算机。

有关在生成密钥后配置公钥身份验证的一般说明，请参阅[第 8.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey-gettingready)。



如果将此选项与 `SSH-1` 密钥一起使用，则 `PuTTYgen` 保存的文件将包含与“用于粘贴的公钥”框中显示的文本完全相同的文本。

这是 `SSH-1` 公钥的唯一现有标准。



### 8.2.12 用于粘贴到 `OpenSSH` `authorized_keys` 文件中的公钥

`OpenSSH` 服务器等要求在接受私钥身份验证之前以一行格式将您的公钥提供给它。（ `SSH-1`  服务器也使用此方法。）



“用于粘贴到 `OpenSSH` `authorized_keys` 文件中的公钥”以正确的一行格式提供公钥数据。

通常，您需要使用鼠标选择框的全部内容，按 `Ctrl+C` 将其复制到剪贴板，然后将数据粘贴到已连接到服务器的 `PuTTY` 会话中。



有关在生成密钥后配置公钥身份验证的一般说明，请参阅[第 8.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey-gettingready)。



### 8.2.13 保存密钥文件的参数

从“密钥”菜单中选择“用于保存密钥文件的参数...”，您可以调整存储在磁盘上的 `PPK` 格式私钥文件的某些方面。

图f22



这些选项都不会影响与 `SSH` 服务器的兼容性。

在大多数情况下，将所有这些保留为默认设置是完全明智的。



#### 8.2.13.1 `PPK` 文件版本

默认版本为 `3` ，这适用于大多数使用场景。

如果您需要私钥文件可在旧版本的 `PuTTY`（ `0.74` 及更早版本）或其他尚不支持版本 `3` 格式（于 `2021` 年推出）的工具中加载，则可能需要选择 `PPK` 版本 `2` 。



版本 `2` 格式对暴力破解的抵抗力较小，并且不支持以下任何选项来控制它。



#### 8.2.13.2 影响密码散列的选项

以下所有选项仅影响使用密码保存的密钥。

它们控制解密密钥所需的工作量（每次键入其密码时都会发生这种情况）。

这允许您权衡合法使用密钥的成本与加密密钥对密码猜测攻击的抵抗力。



这些选项仅影响 `PPK` 版本 `3` 。

- 密钥派生函数

  要使用的 `Argon2` 密钥派生函数的变体。

  如果您认为您遭受侧信道攻击的风险与正常情况不同，则可以更改此设置。

- 用于密码哈希的内存

  解密密钥所需的内存量（以 `KB` 为单位）。

- 用于密码哈希的时间

  控制尝试解密密钥所需的时间。

  您可以指定以毫秒为单位的近似时间（在此计算机上），也可以显式指定哈希传递次数（这是加密期间时间转换为的时间）。

- 密码哈希的并行性

  可用于解密密钥的可并行线程数。

  默认值 `1` 强制进程以单线程方式运行，即使在具有多个内核的计算机上也是如此。



### 8.2.14 重新加载私钥

`PuTTYgen` 允许您将现有的私钥文件加载到内存中。

如果这样做，则可以在再次保存之前更改密码和注释;您还可以制作公钥的额外副本。



要加载现有密钥，请按“加载”按钮。

`PuTTYgen` 将打开一个对话框，您可以在其中浏览文件系统并找到您的密钥文件。

图f23



选择文件后，`PuTTYgen` 将要求您输入密码（如有必要），然后以与刚刚生成密钥相同的方式显示密钥详细信息。

如果使用 `Load` 命令加载外键格式，它将起作用，但您将看到一个消息框，警告您加载的键不是 `PuTTY` 本机键。

有关导入外键格式的信息，请参见[第 8.2.15 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-conversions)。



### 8.2.15 处理其他格式的私钥

`SSH-2` 私钥没有标准格式。

`OpenSSH` 和 `ssh.com` 拥有不同的格式，`PuTTY` 的亦是不同。

因此，使用一个客户端生成的密钥不能立即与另一个客户端一起使用。



使用“转换”菜单中的“导入”命令，`PuTTYgen` 可以加载 `OpenSSH` 格式的 `SSH-2` 私钥和 `ssh.com` 格式的私钥。

图f24



加载这些密钥类型之一后，可以将其另存为 `PuTTY` 格式的密钥（ `*.PPK` ），以便可以将其与 `PuTTY` 套件一起使用。

在此过程中，密码短语将保持不变（除非您有意更改它）。

您可能希望在保存密钥之前更改密钥注释，因为某些 `OpenSSH` 密钥格式不包含注释空间，并且 `ssh.com's` 的默认注释格式又长又冗。



`PuTTYgen` 还可以导出 `OpenSSH` 格式和 `ssh.com` 格式的私钥。

为此，请从“转化”菜单中选择“导出”选项之一。

导出密钥的工作方式与保存密钥完全相同（请参阅[第 8.2.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-savepriv)）

您需要事先输入密码短语，如果您即将保存没有密码的密钥，您将收到警告。

图f25



对于 `OpenSSH` ，有两个选项。

现代 `OpenSSH` 实际上有两种用于存储私钥的格式。

“导出 `OpenSSH` 密钥”将自动选择密钥类型支持的最早格式，以实现与旧版本 `OpenSSH` 的最大向后兼容性。

对于较新的密钥类型（如 `Ed25519` ），它将使用较新的格式，因为这是唯一合法的选项。

如果您有特定的原因想要使用 `OpenSSH` 的较新格式，即使是 `RSA` ，`DSA` 或 `ECDSA` 密钥，也可以选择“导出 `OpenSSH` 密钥（强制新文件格式）”。



旧版 `SSH-1` 协议的大多数客户端使用标准格式在磁盘上存储私钥。

`PuTTY` 也使用这种格式;因此，如果您使用 `OpenSSH` 或 `ssh.com` 的客户端生成了 `SSH-1` 私钥，则可以将其与 `PuTTY` 一起使用，反之亦然。

因此，如果已生成 `SSH-1` 密钥，则导出选项不可用。



### 8.2.16 `PuTTYgen` 命令行配置

`PuTTYgen` 支持一组命令行选项来配置许多可以在 `GUI` 中选择的相同设置。

这允许您使用自己准备好的首选项启动它，如果您生成大量密钥，这可能会很有用。

（例如，您可以创建一个使用某些命令行选项运行 `PuTTYgen` 的 `Windows` 快捷方式，或者创建一个批处理文件或 `Powershell` 脚本，您可以将其分发给包含本地标准的整个组织。）



命令行支持的选项包括：

- `-t` *密钥类型*

  要生成的密钥的类型。您可以选择 `rsa` 、 `dsa` 、 `ecdsa` 、 `eddsa` 、 `ed25519` 、 `ed448` 或 `rsa1` 。请参阅[第 8.2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-keytype)。

- `-b` *位*

  要生成的密钥的大小（以位为单位）。请参见[第 8.2.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-strength)。

- `--primes` *方法*

  生成质数的方法。您可以选择 `probable` 、 `proven` 和 `proven-even` 。请参阅[第 8.2.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-primes)。

- `--strong-rsa`

  生成 `RSA` 密钥时，请确保密钥模数的质因数是“强素数”。请参阅[第 8.2.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-primes)。

- `--ppk-param` *键=值, ...*

  允许设置[第 8.2.13 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-save-params)中描述的 `PPK` 保存文件格式的所有相同详细信息。

  要更改的方面被指定为一系列用逗号分隔的*键=值*对。

  *键名*是：

  `version` - `PPK` 格式版本：`3` 或 `2` 。

  `kdf` - 要使用的 `Argon2` 变体：`argon2id` 、`argon2i` 和 `argon2d` 。

  `memory` - 解密密钥所需的内存量（以 `KB` 为单位）。

  `time` - 指定尝试解密密钥所需的时间（以毫秒为单位）。

  `passes` - 替代项 `time` ：指定尝试解密密钥所需的哈希传递次数。

  `parallelism` - 可用于解密密钥的可并行线程数。

- `-E` *fp类型*

  显示密钥指纹时使用的算法。您可以选择 `sha256` 或 `md5` 。请参见[第 8.2.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-fingerprint)。



## 8.3 准备公钥认证

使用带有 `SSH` 协议的 `PuTTY` 连接到您的 `SSH` 服务器。

连接成功后，系统将提示您输入用户名和密码以登录。

登录后，您必须将服务器配置为接受您的公钥进行身份验证：

- 如果你的服务器是 `OpenSSH` ，你应该切换到主目录下的 `.ssh` 目录，然后用你喜欢的编辑器打开 `authorized_keys` 文件。

  （如果这是您放入其中的第一个密钥，则可能需要创建此文件。然后切换到 PuTTYgen 窗口，在“Public key for pasting into OpenSSH authorized_keys file”框中选择所有文本（请参阅[第 8.2.12 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-pastekey)），并将其复制到剪贴板（ `Ctrl+C` ）。

  然后，切换回 `PuTTY` 窗口并将数据插入打开的文件中，确保它最终全部在一行上，保存文件。

  （在非常旧的 `OpenSSH` 版本中，`SSH-2` 密钥必须放在一个名为的单独文件 `authorized_keys2` 中。

  在所有当前版本中，`SSH-1` 和 `SSH-2` 密钥使用相同的文件 `authorized_keys` 。）

- 如果您的服务器是 `ssh.com` 的产品并且使用的是 `SSH-2` ，则需要从 `PuTTYgen` 保存一个*公钥*文件（请参阅[第 8.2.11 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-savepub)），并将其复制到服务器上的 `.ssh2` 目录中。

  然后，您应该进入该目录 `.ssh2` ，并编辑（或创建）一个名为 `authorization` 的文件。

  在此文件中，应放置类似 `Key mykey.pub` 的行，并替换为密钥文件 `mykey.pub` 的名称。

- 对于其他 `SSH` 服务器软件，应参考该服务器的手册。



您可能还需要确保您的主目录、`.ssh` 目录和涉及的任何其他文件（例如 `authorized_keys` 、 `authorized_keys2` 或 `authorization` ）不是组可写或全局可写的;除非这样做，否则服务器通常会忽略密钥。

通常可以使用如下命令来执行此操作：

```
chmod go-w $HOME $HOME/.ssh $HOME/.ssh/authorized_keys
```



您的服务器现在应配置为接受使用私钥进行身份验证。

现在，您需要将 `PuTTY` 配置为*尝试*使用私钥进行身份验证。

您可以通过以下三种方式之一执行此操作：

- 在 `PuTTY` 的配置中选择私钥。有关详细信息，请参见[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)。
- 使用选项 `-i` 在命令行上指定密钥文件。有关详细信息，请参阅[第 3.11.3.18 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-identity)。
- 将私钥加载到 `Pageant` 中（见[第9章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant)）。在这种情况下，如果可以，`PuTTY` 将自动尝试使用它进行身份验证。





# 第 9 章：使用 `Pageant` 进行身份验证

`Pageant `是一个 `SSH` 身份验证代理。

它将您的私钥保存在内存中，已经解码，因此您可以经常使用它们，而无需键入密码。

图g01



## 9.1 `Pageant` 入门

在运行 `Pageant` 之前，您需要有一个 `*.PPK` 格式的私钥。请参阅[第 8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)以了解如何生成和使用一个。

当您运行 `Pageant` 时，它会将一个看上去像戴帽子的计算机图标放入系统托盘中。

然后它将坐下来什么都不做，直到您将私钥加载到其中。

（您可能需要使用 `Windows` 的“显示隐藏图标”箭头才能查看 `Pageant` 图标。）



如果您用鼠标右键单击 `Pageant` 图标，您将看到一个菜单。

从此菜单中选择“查看密钥”，将出现`Pageant`主窗口。

（您也可以通过双击`Pageant`图标来调出此窗口。）

图g02

图g03



“`Pageant`”窗口包含一个列表框。

这显示了 `Pageant` 持有的私钥。

当您启动 `Pageant` 时，它没有密钥键，因此列表框将为空。

添加一个或多个密钥键后，它们将显示在列表框中。



要向 `Pageant` 添加密钥，请按“添加密钥”按钮。

`Pageant` 将弹出一个文件对话框，标记为“选择私钥文件”。

在此对话框中找到您的私钥文件，然后按“打开”。

图g04



`Pageant`现在将加载私钥。

如果密钥受密码保护，`Pageant` 会要求您输入密码。

加载密钥后，它将出现在 `Pageant` 窗口的列表中。

图g05

图g06



现在启动 `PuTTY` 并打开到接受您的密钥的站点的 `SSH` 会话。

`PuTTY` 会注意到 `Pageant` 正在运行，自动从 `Pageant` 中检索密钥，并使用它来进行身份验证。

您现在可以根据需要打开任意数量的 `PuTTY` 会话，而无需再次输入密码。



（ `PuTTY` 可以配置为不尝试使用 `Pageant` ，但默认情况下它会尝试。有关详细信息，请参阅[第 4.21.4 节和第 3.11.3.9 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-tryagent)。）



当您要关闭 `Pageant` 时，请单击系统托盘中 `Pageant` 图标上的右键，然后从菜单中选择“退出”。

关闭 `Pageant` 主窗口*不会*关闭 `Pageant` 。



如果您希望 `Pageant` 保持运行但想丢弃它获得的所有密钥键，请从系统托盘菜单中选择“删除所有键”。

图g07



## 9.2 `Pageant` 主窗口

当您左键单击 `Pageant` 系统托盘图标时，或者右键单击并从菜单中选择 `view keys` “查看键”时，就会出现 `Pageant` 主窗口。

您可以使用它来跟踪当前加载到 `Pageant` 中的密钥，并添加新密钥或删除现有密钥。

图g08



### 9.2.1 键列表框

`Pageant` 主窗口中的大列表框列出了当前加载到 `Pageant` 中的私钥。

该列表可能如下所示：

```
Ed25519    SHA256:TddlQk20DVs4LRcAsIfDN9pInKpY06D+h4kSHwWAj4w
RSA  2048  SHA256:8DFtyHm3kQihgy52nzX96qMcEVOq7/yJmmwQQhBWYFg
```



对于每个键，列表框将告诉您：

- 密钥的类型。

  目前，这可以是“RSA”（用于 `SSH-2` 协议的 `RSA` 密钥）、“DSA”（用于 `SSH-2` 协议的 `DSA` 密钥）、“NIST”（用于 `SSH-2` 协议的 `ECDSA` 密钥）、“Ed25519”（用于 `SSH-25519` 协议的 `Ed2` 密钥）、“Ed448”（用于 `SSH-448` 协议的 `Ed2` 密钥）或“SSH-1”（用于旧 `SSH-1` 协议的 `RSA` 密钥）。（如果密钥具有关联的证书，则此处会显示“ `cert` ”后缀。）

- 密钥的大小（以位为单位），适用于具有不同大小的密钥类型。（对于 `ECDSA` 的 `“NIST”密钥，这表示为“p256”或“p384”或“p521”。

- 公钥的指纹。

  这应该是 `PuTTYgen` 提供的相同指纹，并且（希望）也与远程实用程序显示的指纹相同，例如 `ssh-keygen` 应用于文件 `authorized_keys` 时。

  对于 `SSH-2` 密钥，默认情况下以“SHA256”格式显示。

  您可以使用“指纹类型”下拉菜单更改为较旧的“MD5”格式（看起来像 `aa:bb:cc:...` ），但请记住，这种格式不太安全，应尽可能避免用于比较目的。

  如果加载到 `Pageant` 中的某些密钥附加了证书，则 `Pageant` 将默认显示底层密钥的指纹。

  这样，同一密钥的认证和未认证版本将具有相同的指纹，因此您可以看到它们匹配。

  您可以改为使用“指纹类型”下拉菜单要求为认证密钥显示不同的指纹，其中包括作为指纹数据一部分的证书。

  这样，您就可以区分两个证书。

- 附加到密钥的注释。

- 延迟解密的状态（如果为此密钥启用）。请参阅[第 9.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-deferred-decryption)。



### 9.2.2 “添加密钥”按钮

要通过从本地磁盘文件中读取密钥来将密钥添加到 `Pageant` ，请按 `Pageant` 主窗口中的“添加密钥”按钮，或者右键单击系统托盘中的 `Pageant` 图标并从那里选择“添加密钥”。

图g09

图g10



`Pageant` 将弹出一个文件对话框，标记为“选择私钥文件”。

在此对话框中找到您的私钥文件，然后按“打开”。

如果要一次添加多个键，可以使用 `Shift` 并单击（选择多个相邻文件）或按住 `Ctrl` 并单击（选择不相邻的文件）选择多个文件。



`Pageant` 现在将加载私钥。

如果密钥受密码保护，`Pageant` 会要求您输入密码。

（这不是向`Pageant` 添加私钥的唯一方法。您还可以使用代理转发从远程系统添加一个;有关详细信息，请参见[第 9.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-forward)。）



### 9.2.3 “删除密钥”按钮

如果您需要从 `Pageant` 中删除某个键，请在列表框中选择该键，然后按“删除键”按钮。

`Pageant` 将从其内存中删除密钥。

图g11



您可以将此应用于使用“添加密钥”按钮添加的密钥，或使用代理转发远程添加的密钥（请参阅[第 9.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-forward)）;这没有什么区别。



## 9.3 `Pageant` 命令行

`Pageant` 可以通过在其命令行上指定指令来使其在启动时自动执行操作。

如果您从 `Windows` `GUI` 启动 `Pageant` ，则可以通过编辑启动它的 `Windows` 快捷方式的属性来安排此操作。

如果 `Pageant` 已在运行，则使用以下选项再次调用它会导致对现有实例而不是新实例执行操作。



### 9.3.1 使`Pageant`大赛在启动时自动加载密钥

如果您在 `Pageant` 命令行上提供私钥，则 `Pageant` 可以在启动时自动加载一个或多个私钥。

然后，命令行可能如下所示：

```
C:\PuTTY\pageant.exe d:\main.ppk d:\secondary.ppk
```



如果密钥是加密存储的，`Pageant` 将在启动时请求密码。

如果 `Pageant` 已在运行，则此语法会将密钥加载到现有 `Pageant` 中。

您可以指定“`--encrypted`”选项来延迟这些密钥的解密;请参阅[第 9.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter9.html#pageant-deferred-decryption)。



### 9.3.2 让 `Pageant` 运行另一个程序

您可以安排 `Pageant` 在初始化自身并加载其命令行上指定的任何键后启动另一个程序。

这个程序（也许是一个 `PuTTY` ，或者一个使用 `Plink` 的 `WinCVS` ，或者其他什么）将能够使用 `Pageant` 加载的密钥。



您可以通过指定后跟命令选项 `-c` 来执行此操作，如下所示：

```
C:\PuTTY\pageant.exe d:\main.ppk -c C:\PuTTY\putty.exe
```



### 9.3.3 与 `Windows` `OpenSSH` 集成

`Windows` 自己的 `OpenSSH` 端口使用与 `Pageant` 相同的机制与其 `SSH` 代理（ `Windows` 命名管道）通信。

这意味着 `Windows`  的 `OpenSSH` 可以直接与 `Pageant` 通信，如果它知道在哪里可以找到 `Pageant` 的命名管道。



当 `Pageant` 启动时，它可以选择写出一个包含 `OpenSSH` 配置指令的文件，告诉 `Windows`  的 `ssh.exe` 在哪里可以找到 `Pageant` 。

如果从 `Windows` 的 `SSH` 配置中包含此文件，则 `ssh.exe` 应自动使用 `Pageant` 作为其代理，以便您可以将密钥保存在一个位置，并使两个 `SSH` 客户端都能够使用它们。

该选项是 `--openssh-config` ，并在它后面加上文件名。



要从主 `OpenSSH` 配置中引用此文件，可以使用 `Include` 指令。

例如，您可以像这样运行 `Pageant`（当然，用您自己的用户名替换）：

```
pageant --openssh-config C:\Users\Simon\.ssh\pageant.conf
```



然后将这样的指令添加到您的主 `.ssh\config` 文件中（假设它位于您刚刚放置 `pageant.conf` 的同一目录中）：

```
Include pageant.conf
```



**注意**：此技术仅适用于 `Windows` 的 `OpenSSH` 端口，如果您安装了它，它保存在 `C:\Windows\System32\OpenSSH\ssh.exe` 。

（如果没有，它可以作为 `Windows` 可选功能安装，例如，通过设置>应用程序和功能>可选功能>添加功能> `OpenSSH` 客户端。



还有其他版本的 `Windows` 版 `OpenSSH` ，特别是 `Windows` 附带的 `git` 版本。

这些可能无法使用相同的配置，因为它们往往依赖于 `MinGW` 或 `MSys` 等 `Unix` 仿真层，因此它们不会说 `Windows` 本机路径名语法或理解命名管道。

上述说明仅适用于 `Windows` 自己的 `OpenSSH` 版本。



因此，如果您想将 `Windows` 版 `git` 与 `Pageant` 中持有的 `SSH` 密钥一起使用，则必须设置环境变量 `GIT_SSH` ，以指向不同的程序。

您可以在完成此设置后立即将其指向 `c:\Windows\System32\OpenSSH\ssh.exe`  ，但将其指向 `Plink` 也同样容易！



### 9.3.4 `Unix` 域套接字：与 `WSL 1` 集成

`Pageant` 可以实现在 `WinSock` 上“ `Unix` 域套接字”的监听。

它们与原始 `Windows` 子系统（现在称为 `WSL 1` ）中的 `Unix` 域套接字进行互操作。

因此，如果您要求 `Pageant` 收听其中之一，那么您的 `WSL 1` 流程可以直接与 `Pageant` 对话。



要配置此项，请使用选项 `--unix` 运行 `Pageant` ，后跟路径名。

然后，在 `WSL 1` 中，将环境变量 `SSH_AUTH_SOCK` 设置为指向该路径名的 `WSL` 转换名称。



例如，您可以运行：

```
pageant --unix C:\Users\Simon\.ssh\agent.sock
```



并在 `WSL 1` 中，设置环境变量：

```
SSH_AUTH_SOCK=/mnt/c/Users/Simon/.ssh/agent.sock
```



或者，可以在文件 `.ssh/config` 的 `WSL` 中添加一行，上面写：

```
IdentityAgent /mnt/c/Users/Simon/.ssh/agent.sock
```



尽管这样做可能意味着命令 `ssh-add` 不会找到代理，即使 `ssh` 它本身会。



**安全说明**：`Unix` 域套接字通过其包含目录上的文件保护防止其他用户访问。

因此，如果您的 `Windows` 计算机是多用户计算机，请确保在其他用户根本无法访问的目录中创建套接字。

（事实上，这是一般原则的好主意。）



**兼容性说明**：`WSL 2` 进程无法通过此机制与 `Pageant` 通信，因为 `WSL 2` 的 `Unix` 域套接字由单独的 `Linux` 内核管理，而不是由 `WinSock` 通信的同一内核管理。



### 9.3.5 从可见的密钥列表开始

启动 `Pageant`，可以选择 `--keylist` 在启动后立即显示主窗口。



### 9.3.6 限制 `Windows` 进程 `ACL`

`Pageant` 支持与其他 `PuTTY` 实用程序相同的选项 `-restrict-acl` 来锁定 `Pageant` 进程的访问控制;请参阅[第 3.11.3.28 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-restrict-acl)，了解您可能想要这样做的原因。

默认情况下，如果 `Pageant` 以 `-restrict-acl` 开头，它不会将其传递给从其系统托盘子菜单启动的任何 `PuTTY` 会话。

使用 `-restrict-putty-acl` 更改此设置。（同样，有关详细信息，请参阅[第 3.11.3.28 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-restrict-acl)。



## 9.4 使用代理转发

代理转发是一种机制，允许 `SSH` 服务器计算机上的应用程序与客户端计算机上的代理通信。



请注意，目前 `SSH-2` 中的代理转发是否可用取决于您的服务器。

`Pageant` 的协议与 `OpenSSH` 服务器兼容，但服务器 `ssh.com` 使用不同的代理协议，`PuTTY` 尚不支持该协议。



要启用代理转发，请先开始 `Pageant` ，然后设置启用了“允许代理转发”的 `PuTTY` `SSH` 会话（请参阅[第 4.21.7 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-agentfwd)）。正常打开会话就可以用了。

（或者，您可以使用命令行选项 `-A` ;有关详细信息，请参见[第 3.11.3.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cmdline-agent)。）



如果这有效，服务器上的应用程序现在应该可以访问 `Unix` 域套接字，`SSH` 服务器将转发回 `PuTTY` ，`PuTTY` 将转发到代理。

要检查这是否确实发生过，您可以在 `Unix` 服务器计算机上尝试以下命令：

```
unixbox:~$ echo $SSH_AUTH_SOCK
/tmp/ssh-XXNP18Jz/agent.28794
unixbox:~$
```



如果结果行显示为空白，则表示尚未启用代理转发。

现在，如果您在服务器上运行 `ssh` 并使用它来连接到另一台接受 `Pageant` 中密钥之一的服务器，您应该能够在没有密码的情况下登录：

```
unixbox:~$ ssh -v otherunixbox
[...]
debug: next auth method to try is publickey
debug: userauth_pubkey_agent: trying agent key my-putty-key
debug: ssh-userauth2 successful: method publickey
[...]
```



如果*同时在该 `SSH` 连接上启用代理转发（请参阅服务器端 `SSH` 客户端的手册以了解如何执行此操作），则身份验证密钥仍将在您连接到的下一台计算机上可用 - 距离实际存储密钥的两个 `SSH` 连接。

此外，如果您在其中一个SSH服务器上有私钥，则可以使用本地命令 `ssh-add` 将其一直发送回 `Pageant` ：

```
unixbox:~$ ssh-add ~/.ssh/id_rsa
Need passphrase for /home/fred/.ssh/id_rsa
Enter passphrase for /home/fred/.ssh/id_rsa:
Identity added: /home/fred/.ssh/id_rsa (/home/simon/.ssh/id_rsa)
unixbox:~$
```



然后，它可用于具有代理转发功能的每台计算机（而不仅仅是您添加代理转发的位置下游的计算机）。



## 9.5 加载密钥而不解密

您可以在*不解密的情况下将*密钥添加到 `Pageant` 。

密钥文件将保存在 `Pageant` 的内存中，仍然加密，当客户端程序首次尝试使用该密钥时，`Pageant` 将显示一个对话框，提示输入密码，以便可以解密密钥。



无论密钥是由本地运行的 `PuTTY` 实例使用，还是由通过代理转发连接到 `Pageant` 的远程客户端使用，其工作方式都相同。

要以这种加密形式向 `Pageant` 添加密钥，请按 `Pageant` 主窗口中的“添加密钥（加密）”按钮，或者右键单击系统托盘中的 `Pageant` 图标，然后从那里选择“添加密钥（加密）”。

`Pageant` 将弹出一个文件对话框，其方式与普通的“添加密钥”按钮相同。

但它不会要求密码。

相反，密钥将在主窗口中列出，后面有“（加密）”。



要首先启动 `Pageant` 并加载加密密钥，您可以使用命令行上的“`--encrypted`”选项。

例如：

```
C:\PuTTY\pageant.exe --encrypted d:\main.ppk
```



首次使用解密密钥后，它将保持解密状态，以便可以再次使用。

主窗口将列出密钥，后面带有“（重新加密）”。



您可以使用 `Pageant` 主窗口中的“重新加密”按钮将其恢复到需要密码的先前状态。

您还可以通过从系统托盘菜单中选择“重新加密所有密钥”来“重新加密”添加的所有密钥。（请注意，这*不会*丢弃以前未添加加密的明文密钥！）



**注意**：当 `Pageant` 显示解密已加载密钥的提示时，它无法为提示对话框提供键盘焦点。

据我所知，这是 `Windows` 针对恶意软件的故意防御措施。

因此，请确保在输入密码之前单击提示窗口，否则密码可能会发送到您不想信任它的地方！



## 9.6 安全注意事项

使用 `Pageant` 进行公钥身份验证，您可以方便地打开多个 SSH 会话，而无需每次都键入密码，而且还为您提供了永远不会在磁盘上存储解密私钥的安全优势。

许多人认为这是安全性和便利性之间的良好折衷。



然而，*这是一种*妥协。

在 `Pageant` 中保存解密的私钥比将它们存储在易于查找的磁盘文件中要好，但仍然不如将它们存储在任何地方的安全性。

这有两个原因：

- 不幸的是，`Windows` 无法保护内存片段不被写入系统交换文件。

  因此，如果 `Pageant` 长时间持有您的私钥，则解密的私钥数据可能会被写入系统交换文件，并且稍后获得硬盘访问权限的攻击者可能能够恢复该数据。

  （但是，如果您在磁盘文件中存储了未加密的密钥，他们*肯定*能够恢复它。）

- 尽管与大多数现代操作系统一样，`Windows` 可防止程序意外访问彼此的内存空间，但它确实允许程序出于调试等特殊目的故意访问彼此的内存空间。

  这意味着，如果您在 `Pageant` 运行时允许病毒、特洛伊木马或其他恶意程序进入您的 `Windows` 系统，它可能会访问 `Pageant` 进程的内存，提取解密的身份验证密钥，并将其发送回其主服务器。



同样，使用代理*转发*是对其他一键式身份验证方法的安全性改进，但并不完美。

在 `Windows` 盒子上的 `Pageant` 中持有密钥比在远程服务器机器本身（在代理中或只是在磁盘上未加密）持有密钥具有安全优势，因为如果服务器机器看到您的未加密私钥，那么系统管理员或任何破解机器的人都可以窃取密钥并假装是你只要他们愿意。



但是，服务器计算机的系统管理员始终可以在*该计算机上*假装是您。

因此，如果您将代理转发到服务器计算机，则该计算机的系统管理员可以访问转发的代理连接并从您的任何私钥请求签名，因此可以像您一样登录到其他计算机。

他们只能在有限的范围内做到这一点 - 当代理转发消失时，他们失去了能力 - 但使用 `Pageant` 实际上并不能*阻止*服务器上的系统管理员（或黑客）这样做。



因此，如果您不信任服务器计算机的系统管理员，则*永远不应*使用代理转发到该计算机。

（当然，您也不应该在该计算机上存储私钥，在其中键入密码短语，或以任何方式从该计算机登录其他计算机; `Pageant` 在这方面并不是独一无二的。）







# 第 10 章：常见错误消息

本章列出了 `PuTTY` 及其相关工具可能生成的一些常见错误消息，并更详细地解释了它们的含义。

我们不试图在这里列出*所有*错误消息：有许多不应该发生的错误消息，有些应该是不言自明的。

如果您收到本章中未列出的错误消息，并且您不理解，请将其作为错误报告给我们（请参阅[附录 B](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback)），我们将为其添加文档。



## 10.1 “未为此服务器缓存主机密钥”

当 `PuTTY` 连接到新的 `SSH` 服务器时，会出现此错误消息。

每个服务器都通过主机密钥标识自己;一旦 `PuTTY` 知道服务器的主机密钥，它将能够检测到恶意攻击者是否将您的连接重定向到另一台计算机。



如果您看到此消息，则表示 `PuTTY` 以前没有看到过此主机密钥，并且无法知道它是否正确。

您应该尝试通过其他方式验证主机密钥，例如询问计算机的管理员。



如果您看到此消息，并且知道您的 `PuTTY` 安装之前已连接到同一服务器，则它可能最近*已*升级到 `SSH` 协议版本 `2` 。

`SSH` 协议 `1` 和 `2` 使用单独的主机密钥，因此当您首次将 `SSH-2` 与以前仅使用 `SSH-1` 的服务器一起使用时，您将再次看到此消息。

您应该像以前一样验证密钥的正确性。

有关主机密钥的更多信息，请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)。



## 10.2 “警告 - 潜在的安全漏洞！”

此消息后跟“服务器的主机密钥与 `PuTTY` 为此服务器缓存的密钥不匹配”，表示 `PuTTY` 之前已连接到 `SSH` 服务器，知道其主机密钥*应该*是什么，但找到了不同的主机密钥。

（如果消息涉及“经认证的主机密钥”，请参阅[第 10.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter10.html#errors-cert-mismatch)。）



这可能意味着恶意攻击者已将您的服务器替换为其他服务器，或已将您的网络连接重定向到他们自己的计算机。

另一方面，这可能只是意味着服务器的管理员在升级 `SSH` 软件时意外更改了密钥;这*不应该*发生，但不幸的是这是可能的。

您应该联系服务器的管理员，看看他们是否希望主机密钥已更改。

如果是这样，请以与验证新主机密钥相同的方式验证新主机密钥。

有关主机密钥的更多信息，请参阅[第 2.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter2.html#gs-hostkey)。



## 10.3 “此服务器提供了由其他证书颁发机构签名的认证主机密钥......”

如果已将 `PuTTY` 配置为信任至少一个证书颁发机构来签署主机密钥（请参阅[第 4.19.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-cert)），则它将要求 `SSH` 服务器向其发送任何可用的认证主机密钥。

如果服务器发回由*其他*证书颁发机构签名的认证密钥，`PuTTY` 将显示主机密钥提示的此变体，前面是“警告 - 潜在的安全漏洞！



发生这种情况的一个原因是蓄意攻击。

就像普通的中间人攻击替换错误的主机密钥一样，一个特别雄心勃勃的攻击者可能会替换整个错误的证书颁发机构，并希望您无论如何都连接。



但在某些情况下，此错误也可能合法出现。

例如，如果您组织的 `IT` 部门刚刚推出了您尚未在 `PuTTY` 配置中输入的新 `CA` 密钥，或者您的 `CA` 配置涉及两个重叠的域或类似内容。

因此，不幸的是，您必须自己弄清楚该怎么做：为这种特定情况破例，或者放弃此连接并安装新的 `CA` 密钥，然后再重试（如果您真的确定您信任 `CA` ），或者以其他方式编辑您的配置，或者只是停止尝试使用此服务器。



如果您确信此特定服务器是合法的，即使 `CA` 不是您信任的 `CA` ，`PuTTY` 将允许您缓存经过认证的主机密钥，以与未经认证的主机密钥相同的方式对待它。

然后，将接受该特定证书以用于将来与此特定服务器的连接，即使由同一 `CA` 签名的其他证书仍将被拒绝。



## 10.4 “我们的配置需要 `SSH` 协议版本 `2` ，但远程仅提供（旧的、不安全的）`SSH-1` ”

默认情况下，`PuTTY` 仅支持连接到实现 `SSH` 协议版本 `2` 的 `SSH` 服务器。

如果您看到此消息，则您尝试连接的服务器仅支持较旧的 `SSH-1` 协议。



如果服务器确实只支持 `SSH-1` ，那么您需要更改“ `SSH` 协议版本”设置（请参阅[第 4.17.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-prot)），或使用命令行选项 `-1` ;在任何情况下，您都不应将生成的连接视为安全连接。



您可能会在以前没有的新版本 `PuTTY` （从 `0.68` 开始）中看到此消息，因为过去可以将 `PuTTY` 配置为自动从 `SSH-2` 回退到 `SSH-1` 。

不再支持此功能，以防止降级攻击的可能性。



## 10.5 “服务器支持的第一个密码是...低于配置的警告阈值”

当 `SSH` 服务器不提供您已配置 `PuTTY` 以认为足够强大的任何密码时，就会发生这种情况。

默认情况下，`PuTTY` 仅针对 `Blowfish` 、 `single-DES` 和 `Arcfour` 加密发出此警告。

有关此消息的更多信息，请参见第 [4.20 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-encryption)。

（对于其他加密基元，例如主机密钥算法，也有类似的消息。）



## 10.6 “远程端发送断开连接消息类型 `2`（协议错误）：`root` 身份验证失败次数过多” 

如果 `OpenSSH`（或 `Sun SSH` ）服务器收到的失败身份验证尝试数超过其允许的次数，则此消息由该服务器生成。



如果您使用的是 `Pageant` 并加载了大量密钥，则很容易发生这种情况，因为这些服务器将公钥的每个提供计为身份验证尝试。

这可以通过在 `PuTTY` 配置中指定身份验证所需的密钥来解决（请参阅[第 4.22.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-privkey)）; `PuTTY` 将忽略 `Pageant` 可能拥有的任何其他密钥，但会要求 `Pageant` 进行身份验证，这样您就不必输入密码。



在服务器上，可以通过禁用公钥身份验证或（仅适用于 `Sun SSH` ）通过增加 `sshd_config` 中的 `MaxAuthTries` 。



## 10.7 “内存不足”

当 `PuTTY` 尝试分配的内存多于系统可以提供的内存时，会发生这种情况。

*发生这种情况可能是*出于真正的原因：如果计算机确实内存不足，或者如果您在终端中配置了大量回滚行。`PuTTY` 无法从内存不足中恢复;它将在给出此错误后立即终止。



但是，当内存根本没有耗尽时，也会发生此错误，因为 `PuTTY` 接收格式错误的数据。在 `SSH-2` 和 `SFTP` 中，服务器在消息本身之前发送每条消息的长度;所以 `PuTTY` 将接收长度，尝试为消息分配空间，然后接收消息的其余部分。

如果 `PuTTY` 接收的长度是垃圾，它将尝试分配荒谬的内存量，并将以“内存不足”错误终止。



如果 `PuTTY` 和服务器未以相同的方式启用加密，则在 `SSH-2` 中可能会发生这种情况（请参阅常见问题解答中[的问题 A.7.3](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-outofmem)）。

这也可能发生在 `PSCP` 或 `PSFTP` 中，如果服务器上的登录脚本生成输出：客户端程序将期待以长度开头的 SFTP 消息，如果它从登录脚本接收一些文本，它将尝试将它们解释为消息长度。详见[问题A.7.4](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-outofmem2)。



## 10.8 “内部错误”、“内部故障”、“断言失败”

任何以“内部”一词开头的错误都*不应*发生。

如果是这样，根据定义，`PuTTY` 中存在错误;请参阅[附录B](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback)并向我们报告。

同样，任何以“断言失败”开头的错误消息都是 `PuTTY` 中的错误。

请向我们报告，并附上错误消息框中的确切文本。



## 10.9 “无法使用密钥文件”、“无法加载私钥”、“无法加载此密钥”

此错误的各种形式打印在 `PuTTY` 窗口中，或在尝试公钥身份验证时写入 `PuTTY` 事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)），或在尝试加载私钥时由 `Pageant` 给出。



如果您看到其中一条消息，通常表示您尝试将不适当类型的密钥加载到 `PuTTY` 、 `Plink` 、 `PSCP` 、 `PSFTP` 或 `Pageant` 中。

您可能尝试将“外来”格式（ `OpenSSH` 或 `ssh.com` ）的 `SSH-2` 密钥直接加载到 `PuTTY` 工具之一中，在这种情况下，您需要使用 `PuTTYgen` 将其导入 `PuTTY` 的本机格式（ ``*.PPK` ） – 请参阅[第 8.2.15 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#puttygen-conversions)。



或者，您可能指定了不适合您正在建立连接的密钥。

`SSH-2` 和旧的 `SSH-1` 协议需要不同的私钥格式，并且 `SSH-1` 密钥不能用于 `SSH-2` 连接（反之亦然）。



## 10.10 “服务器拒绝了我们的密钥”、“服务器拒绝了我们的公钥”、“密钥被拒绝”

尝试公钥身份验证时，此错误的各种形式会打印在 `PuTTY` 窗口中，或写入 `PuTTY` 事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）。



如果您看到其中一条消息，则表示 `PuTTY` 已向服务器发送公钥并提出向其进行身份验证，并且服务器拒绝接受身份验证。

这通常意味着服务器未配置为接受此密钥来对此用户进行身份验证。



这几乎可以肯定不是 `PuTTY` 的问题。

如果您看到这种类型的消息，您应该做的第一件事是仔细检查*您的服务器*配置。

常见错误包括在服务器上的公钥或用户主目录上设置了错误的权限或所有权。

另外，请阅读 `PuTTY` 事件日志;服务器可能已发送诊断消息，说明您的设置究竟存在什么问题。

[第 8.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey-gettingready)有一些关于服务器端公钥设置的提示。



## 10.11 “访问被拒绝”、“身份验证被拒绝”

在身份验证期间，此错误会打印在 `PuTTY` 窗口中，或写入 `PuTTY` 事件日志（请参阅[第 3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）。

如果您看到这些消息之一，则表示服务器已拒绝 `PuTTY` 尝试的所有身份验证形式，并且没有进一步的想法。



可能值得检查事件日志中是否有来自服务器的诊断消息，以提供更多详细信息。

此错误可能是由有缺陷的 `SSH-1` 服务器引起的，这些服务器无法应对我们用于伪装传输中密码的各种策略。

升级服务器，或使用第 4.27.13 节和可能的第 [4.27.14 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-ignore1)中描述的解决方法。



## 10.12 “没有可用的身份验证方法”

此错误表示 `PuTTY` 已用完向 `SSH` 服务器进行身份验证的方法。

这可能是因为 `PuTTY` 禁用了 `TIS` 或键盘交互式身份验证，在这种情况下，请参阅第 4.21.5 节和第 [4.21.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-tis)。



## 10.13 “数据包上收到不正确的 `MAC` ”或“数据包上收到不正确的 `CRC` ”

当 `PuTTY` 解密 `SSH` 数据包且其校验和不正确时，会发生此错误。

这可能意味着加密或解密过程中出了问题。

很难从此错误消息中判断问题是在客户端、服务器还是介于两者之间。



特别是，如果网络在 `TCP` 级别损坏数据，则可能只有 `SSH` 等加密协议才能明确，该协议明确检查传输数据的完整性，并在检查失败时大声抱怨。

没有完整性保护的协议（如 `HTTP` ）的损坏将表现为更细微的故障（例如 `Web` 浏览器中错误显示的文本或图像），这些故障可能不会被注意到。



有时，这是由服务器错误引起的。

一个例子是[第 4.27.10 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-hmac2)中描述的错误，尽管您现在不太可能遇到该错误。



在这种情况下，`MAC` 代表消息身份验证代码。

这是一个加密术语，与以太网 `MAC`（介质访问控制）地址或 `Apple` 计算机完全无关。



## 10.14 “传入数据包在解密时出现乱码”

当 `PuTTY` 解密 `SSH` 数据包并且解密的数据没有意义时，会发生此错误。

这可能意味着加密或解密过程中出了问题。

很难从此错误消息中判断问题是在客户端、服务器还是介于两者之间。



如果收到此错误，可以尝试的一件事是摆弄“错误计算 `SSH-2` 加密密钥”（请参阅第 4.27.12 节）或“忽略 `SSH-2` 最大数据包大小”（请参阅[第 4.27.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-bug-derivekey2)）面板上的设置。



## 10.15 “ `PuTTY` `X11` 代理：*各种错误*”

`PuTTY` 执行 `X` 转发时会报告这一系列错误。

它们被发送回在 `SSH` 服务器上运行的 `X` 应用程序，该应用程序通常会向用户报告错误。



当 `PuTTY` 启用 `X` 转发（参见[第 3.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-x-forwarding)）时，它会创建一个在 `SSH` 服务器上运行的虚拟 `X` 显示器。

此显示器需要身份验证才能连接到它（这就是 `PuTTY` 防止服务器计算机上的其他用户通过 `PuTTY` 代理连接到您的真实 `X` 显示器的方式）。

`PuTTY` 还会向服务器发送使客户端能够连接所需的详细信息，并且服务器应自动设置此机制，因此您的 `X` 应用程序应该可以正常工作。



人们看到其中一条消息的一个常见原因是因为他们使用 `SSH` 以一个用户身份登录（假设“fred”），然后使用 `Unix` 命令 `su` 成为另一个用户（通常是“root”）。

原始用户“fred”可以访问SSH服务器提供的 `X` 身份验证数据，并且可以运行通过 `SSH` 连接转发的 `X` 应用程序。

但是，第二个用户（“root”）不会自动将身份验证数据传递给它，因此尝试以该用户身份运行 `X `应用程序通常会失败并出现此错误。



如果发生这种情况，则*不是 `PuTTY` 的问题*。

您需要安排将 `X` 身份验证数据从您登录的用户传递到您曾经成为 `su` 的用户。

如何执行此操作取决于您的特定系统;事实上，许多现代版本的 `su` 会自动执行此操作。



## 10.16 “网络错误：软件导致连接中止”

这是 `Windows` 网络代码在由于某种原因终止已建立的连接时产生的一般错误。

例如，如果将网线从连接以太网的计算机的背面拔出，或者 `Windows` 有任何其他类似的理由认为整个网络已无法访问，则可能会发生这种情况。



如果 `Windows` 在连接的另一端放弃了响应它的机器，它也会生成此错误。

如果客户端和服务器之间的网络出现故障，并且客户端随后尝试发送一些数据，则 `Windows` 将多次尝试发送数据，然后放弃并终止连接。

特别是，即使您没有键入任何内容，如果您使用的是 `SSH-2` 并且 `PuTTY` 尝试重新交换密钥，也会发生这种情况。

（有关密钥重新交换的更多信息，请参见[第 4.18.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex-rekey)。）



（如果您在连接中使用保持连接，也会发生这种情况。

其他人报告说，`keepalives` 为他们*修复*了这个错误。

有关保持连接的优点和缺点的讨论，请参见[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)。）



我们不知道发生此错误的任何原因，该错误可能代表 `PuTTY` 中的错误。

问题在于您、您的 `Windows` 系统、您的网络和远程系统之间。



## 10.17 “网络错误：对等方重置连接”

当网络连接两端的计算机无法跟踪它们之间的连接状态时，会发生此错误。

例如，如果您的 `SSH` 服务器崩溃，并且在您下次尝试向其发送数据之前设法完全重新启动，您可能会看到它。



但是，看到此消息的最常见原因是，如果您通过防火墙或连接超时的 `NAT` 路由器进行连接。

有关更多详细信息，请参阅常见问题解答中[的问题 A.7.8](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-idleout)。

您可以通过使用保持连接来改善这种情况;有关此内容的详细信息，请参见[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)。



请注意，在某些情况下，`Windows` 可能会产生此错误，而不会看到从服务器重置的连接，例如，如果与网络的连接丢失。



## 10.18 “网络错误：连接被拒绝”

此错误表示 `PuTTY` 尝试与您的服务器建立的网络连接被服务器拒绝。

通常发生这种情况是因为服务器不提供 `PuTTY` 尝试访问的服务。



检查是否使用正确的协议（ `SSH` 、 `Telnet` 等）进行连接，并检查端口号是否正确。

如果失败，请咨询服务器管理员。



## 10.19 “网络错误：连接超时”

此错误意味着 `PuTTY` 尝试与您的服务器建立的网络连接根本没有收到来自服务器的响应。

通常发生这种情况是因为服务器计算机与网络完全隔离，或者因为它已关闭。



检查是否正确输入了服务器计算机的主机名或 `IP` 地址。

如果失败，请咨询服务器管理员。



当 `Unix` 尝试通过连接发送数据并且与服务器的联系在连接期间完全丢失时，也会生成此错误。

（在 `Unix` 放弃接收来自服务器的回复之前，有几分钟的延迟。）



如果您在网络关闭时在 `PuTTY` 中键入内容，则可能会发生这种情况，但如果 `PuTTY` 自行决定发送数据，也会发生这种情况：由于 `SSH-2` 中的重复密钥交换（请参阅第 4.18.2 节）或由于保持连接（[第 4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)）。



## 10.20 “网络错误：无法分配请求的地址”

这意味着操作系统拒绝了 `PuTTY` 尝试建立的网络连接的参数，通常没有实际尝试连接到任何东西，因为它们根本无效。

引发此错误的常见方法是意外尝试连接到端口 `0` ，该端口号不是有效的端口号。







# 附录 A：`PuTTY` 常见问题解答

此常见问题解答发布在 `PuTTY` 网站上，并作为手册的附录提供。



## A.1 引言

### A.1.1 什么是 `PuTTY` ？

`PuTTY` 是 `SSH` ， `Telnet` ， `Rlogin` 和 `SUPDUP` 网络协议的客户端程序。

这些协议都用于通过网络在计算机上运行远程会话。

`PuTTY` 是用于实现该会话的客户端程序：显示会话的一端（客户端），而不是会话运行的那一端（服务端）。



简单来说：你在 `Windows` 机器上运行 `PuTTY` ，并告诉它连接到（例如）`Unix` 机器。

`PuTTY` 打开一个窗口，然后，您在该窗口中键入的任何内容都将直接发送到 `Unix` 机器，并且 `Unix` 机器发回的所有内容都显示在窗口中。

因此，您可以在 `Unix` 机器上工作，就像坐在控制台前一样，而实际上却坐在其他地方。



## A.2 `PuTTY` 支持的功能

一般来说，如果你想知道 `PuTTY` 是否支持某个特定功能，你应该在[PuTTY网站上](https://www.chiark.greenend.org.uk/~sgtatham/putty/)寻找它。

特别地：

- 尝试[更改页面](https://www.chiark.greenend.org.uk/~sgtatham/putty/changes.html)，看看是否可以在其中找到该功能。

  如果某个功能列在那里，则表示该功能已实现。

  如果它被列为*自最新版本以来*所做的更改，则它应该在开发快照中可用，在这种情况下，测试将非常受欢迎。

- 尝试“[愿望清单”页面](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/)，看看是否可以在那里找到该功能。

  如果它在那里，而不是在“最近修复”部分中，则可能*尚未*实现。



### A.2.1 `PuTTY` 是否支持 `SSH-2` ？

是的。自 `2000` 年 `0.50` 版以来，`PuTTY` 中已提供 `SSH-2` 支持。

`SSH-2` 中的公钥认证（ `RSA` 和 `DSA` ）是 `2002` 年 `0.52` 版的新功能。



### A.2.2 `PuTTY` 是否支持读取 `OpenSSH` 或 `ssh.com` 的 `SSH-2` 私钥文件？

`PuTTY` 本身不支持此功能（请参阅[愿望清单条目](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/key-formats-natively.html)以了解原因），但从 `0.53` 开始，`PuTTYgen` 可以将 `OpenSSH` 和 `ssh.com` 私钥文件转换为 `PuTTY` 的格式。



### A.2.3 `PuTTY` 是否支持 `SSH-1` ？

是的。`SSH-1` 支持在 `PuTTY` 中始终可用。

但是，`SSH-1` 协议有许多弱点，不再被认为是安全的;如果可能的话，您应该改用 `SSH-2` 。

从 `0.68` 开始，如果服务器似乎不支持 `SSH-1` ，`PuTTY` 将不再回退到 `SSH-2` ;您必须明确要求 `SSH-1` 。



### A.2.4 `PuTTY` 是否支持本地回显？

是的。版本 `0.52` 对本地回显有适当的支持。

在版本 `0.51` 及更早版本中，本地回显无法与本地行编辑分开（在本地键入一行文本，并且在按回车之前不会将其发送到服务器，因此您有机会在服务器看到*它之前*对其进行编辑并更正错误）。



在 `0.52` 版本中的新功能，本地回显和本地线路编辑是单独的选项，默认情况下，`PuTTY` 将尝试根据您选择的协议以及服务器的提示自动确定是否启用它们。

如果您对 `PuTTY` 的默认选择有疑问，您可以根据自己的选择强制启用或禁用每个选项。

控件位于“终端”面板中标有“线规程选项”的部分。



### A.2.5 `PuTTY` 是否支持存储设置，因此我不必每次都更改它们？

是的，`PuTTY` 的所有设置都可以保存在命名会话配置文件中。

您还可以更改用于新会话的默认设置。

有关如何执行此操作，请参阅文档中的第 [4.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-saving)。



### A.2.6 `PuTTY` 是否支持将其设置存储在磁盘文件中？

目前没有，尽管文档中的第 [4.33 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-file)给出了实现相同效果的方法。



### A.2.7 `PuTTY` 是否支持全屏模式，如 `DOS` 窗口？

是的;这是在 `2002` 年的 `0.52` 版中添加的。



### A.2.8 `PuTTY` 是否能够记住我的密码，这样我就不必每次都输入密码？

不，它不能。

出于明显的安全原因，记住密码是一个糟糕的计划：任何在您离开办公桌时访问您机器的人都可以找到记住的密码，并使用它，滥用或更改它。



此外，`PuTTY` 甚至*不可能*在 `Telnet` 会话中自动发送您的密码，因为 `Telnet` 不会向客户端软件提供任何指示，指示登录过程的哪一部分是密码提示。

`PuTTY` 必须通过在会话数据中查找“密码”之类的词来猜测;如果您的登录程序是用英语以外的其他语言编写的，这将不起作用。



在 `SSH` 中，理论上可以记住您的密码，但是由于 `SSH` 支持公钥身份验证，因此似乎没有多大意义，这更灵活，更安全。

有关公钥身份验证的完整讨论，请参阅文档中的第 [8 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter8.html#pubkey)。



### A.2.9 是否有关闭烦人的主机键提示的选项？

不，没有。也不会有。

即使您自己编写并将补丁发送给我们，我们也不会接受。



那些烦人的主机键提示是 `SSH` *的重点。*

没有它们，`SSH` 用于保护会话的所有加密技术只会使攻击者的工作稍微困难一些;攻击者必须实际破坏路由器并开始来回修改数据包，而不是使用数据包嗅探器坐在您和服务器之间。

但这并不比嗅闻难得多;如果没有主机密钥检查，客户端或服务器将完全无法检测到它。



主机密钥检查是您保证在客户端对数据进行的加密与在服务器端对数据进行的加密*相同*;您可以保证它不会在途中的某个地方被移除和更换。

与数据包嗅探相比，甚至与破坏路由器相比，主机密钥检查使攻击者的工作变得*异常*困难。

攻击者现在必须对至少一个军事强度的密码执行暴力攻击，而不是应用一点情报并密切关注 `oss` 安全性。

那个微不足道的主机键提示确实有很大的不同。



如果您在主机密钥检查方面遇到特定问题 - 也许您希望自动批处理作业使用 `PSCP` 或 `Plink` ，并且交互式主机密钥提示正在挂起批处理 - 那么修复它的正确方法是提前将正确的主机密钥添加到注册表，或者如果注册表不可用， 那么使用命令行选项 `-hostkey` 。

这样，您就可以保留主机密钥检查*的重要功能：*正确的密钥将被接受，错误的密钥不会被接受。

添加一个选项来完全关闭主机密钥检查是错误的解决方案，我们不会这样做。



如果您在 `known_hosts`文件中有通用格式的主机密钥，我们有一个名为 [`kh2reg.py`](https://git.tartarus.org/?p=simon/putty.git;a=blob;f=contrib/kh2reg.py;hb=HEAD) 的脚本可以将它们转换为 `Windows` 的 `.REG` 文件，可以通过双击或使用 `REGEDIT` 提前安装。



### A.2.10 你会为 `PuTTY` 套件编写一个 `SSH` 服务器，以便与客户端一起使用吗？

没人会用。

虽然许多协议和网络代码可以在客户端和服务器之间通用，但要使*有用的*通用服务器需要各种繁琐的新代码，例如与操作系统身份验证数据库等交互。



现在可以从 `PuTTY` 源代码构建专用 `SSH` 服务器（称为 `Uppity` ），实际上它不能用作通用服务器;它主要作为测试工具存在。

如果其他人想以此为基础编写通用 `SSH` 服务器，他们当然非常欢迎;但我们没有时间，也没有动力。

如果其他人想尝试，可以使用该代码。



### A.2.11 `PSCP` 或 `PSFTP` 可以在 `ASCII` 模式下传输文件吗？

很不幸，不可以。

这是最初指定的文件传输协议的限制：`SCP` 和 `SFTP` 协议没有以二进制模式以外的任何方式传输文件的概念。（SCP仍然如此。）



`SFTP` 的当前协议规范草案提出了一种实现 `ASCII` 传输的方法。

在某个时候，`PSCP/PSFTP` 可能会实施这一提议。



## A.3 移植到其他操作系统

最终目标是让 `PuTTY` 成为一个多平台程序，至少能够在 `Windows` ，`Mac OS` 和 `Unix` 上运行。

`PuTTY` 已经获得了一个通用的移植层，在依赖于平台的代码和独立于平台的代码之间划清了界限。

总体意图是让这个移植层作为执行第一个端口的过程的一部分自然发展; `Unix` 端口现在已经发布，到目前为止，该计划似乎正在发挥作用。



### A.3.1 `PuTTY` 有哪些端口？

目前，`PuTTY` 工具的发布版本只能在 `Windows` 系统和 `Unix` 上运行。

从 `0.68` 开始，提供的 `PuTTY` 可执行文件在从 `XP` 开始的 `Windows` 版本上运行，直到 `Windows 11` 。

我们不知道为什么 `PuTTY` 不应该继续在未来版本的 `Windows` 上工作。

我们为常见的 `x86` 处理器系列提供 `32` 位和 `64` 位 `Windows` 可执行文件;有关兼容性问题的讨论，请参阅[问题 A.10.32](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-32bit-64bit)。

`32` 位可执行文件需要奔腾 `4` 或更高版本的处理器。

我们还提供适用于 `Windows on Arm` 处理器的可执行文件。



（我们曾经也为 `Alpha` 处理器提供 `Windows` 可执行文件，但由于缺乏兴趣而在 `0.58` 之后停止。）



在开发代码中，存在移植到 `Mac OS` 的部分接口（请参阅[问题 A.3.6](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-mac-port)）。

目前 `PuTTY` *不能*在 `Windows CE`上运行（参见[问题A.3.4](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-wince)）。



我们目前没有用于任何其他系统的发布质量接口。

如果有人告诉你我们有一个 `Android` 接口，或者一个 `iOS` 接口，或者 `PuTTY` 的任何其他接口，那么他们搞错了，我们没有。

有一些第三方接口可以连接到各种平台，在我们[网站的链接页面上](https://www.chiark.greenend.org.uk/~sgtatham/putty/links.html)提到。



### A.3.2 有 `Unix` 的接口吗？

大多数传统的 `PuTTY` 工具都有 `Unix` 接口，还有一个全新的应用程序。



如果您查看源代码版本，您应该找到一个 `unix` 子目录。

你需要 `cmake` 构建它;请参阅源代码分发中的文件 `README` 。

这应该可以构建：

- `PuTTY` ，`Plink` ，`PSCP` 和 `PSFTP` 的 `Unix` 接口，其工作方式与 `Windows` 版本几乎相同;
- `PuTTYgen` 和 `Pageant` 的命令行版本，其用户界面与 `Windows` `GUI` 版本完全不同;
- `pterm`- 一个支持与 `PuTTY` 相同的终端仿真 `xterm` 类程序。



如果您没有 `Gtk` ，您仍然应该能够构建命令行工具。



### A.3.3 `Unix` 移植有什么意义？`Unix` 有 `OpenSSH` 。

很多小问题。

对于那些喜欢 `PuTTY` 的终端仿真而不是 `xterm` 的终端仿真的人来说，`pterm` 是直接可用的，至少有些人是这样做的。

`Unix` `Plink` 显然在那些发现 `OpenSSL` 的复杂性使 `OpenSSH` 难以安装（并且不介意 `Plink` 没有那么多功能）的人中找到了一个利基市场。

有些用户希望在 `Unix` 上生成大量 `SSH` 密钥，然后将它们全部复制到 `PuTTY` 中，而 `Unix` `PuTTYgen` 应该允许他们自动化转换过程。



还有发展方面的优势；将 `PuTTY` 移植到 `Unix` 对于未来的其他端口来说是一项有价值的路径查找工作，也使我们能够使用优秀的 `Linux` 工具 `Valgrind` 来帮助调试，这已经提高了 `PuTTY` 在所有平台上的稳定性。



然而，如果你是 `Unix` 用户，并且你看不出有什么理由从 `OpenSSH` 切换到 `PuTTY/Plink` ，那么你可能是对的。

我们并不期望我们的 `Unix` 接口对每个人来说都是正确的。



### A.3.4 是否有 `Windows CE` 或 `PocketPC` 的接口？

我们曾经在这样一个接口上做过一些工作，但它只在早期阶段，当然还算不上有用。

它不再被积极研究推进。



### A.3.5 是否有到 `Windows 3.1` 的接口？

`PuTTY` 从一开始就是一个 `32` 位的应用程序，所以它不会作为原生的 `16` 位程序在 `Windows3.1`上运行；而且由于 `Windows 3.1` 恶劣的内存分配机制，很难将其移植到接口中。



但是，理论上可以编译现有的 `PuTTY` 源代码，使其在 `Win32s`（ `Windows 3.1` 的扩展，可让您运行 `32` 位程序）下运行。

为了做到这一点，你需要正确类型的 `C` 编译器 - `Visual C` 的现代版本至少已经停止向后兼容`Win32s` 。

另外，我们上次尝试这样做时效果不佳。



### A.3.6 `Mac` 会有接口吗？

我们希望如此！

我们在 `2005` 年左右尝试了一个，作为原生 `Cocoa` 应用程序编写，但由于某种原因，重新绘制它的窗口非常慢，我们从未深入了解。



`2015` 年，在移植 `GTK` 前端以与 `GTK 3` 配合使用之后，我们开始了另一次尝试，即对 `GTK` 代码进行小的更改，并针对 `GTK 3` 的 `OS X Quartz` 版本构建它。

这似乎不再有窗口重绘问题，所以它已经比上次的努力更进一步，但它仍然基本上没有完成。



如果任何 `OS X` 和/或 `GTK` 编程专家渴望获得此版本的完成版本，我们敦促他们帮助解决一些剩余的问题！

请参阅源代码 `unix/main-gtk-application.c` 中的待办事项列表。



### A.3.7 是否有通往 `EPOC` 的接口？

我希望如此，但鉴于*即使在开发人员已经*知道如何编程的系统上，端口的发展也不是很快，我们中的任何一个人可能需要很长时间才能学习一个新系统并为此做移植。

但是，有些工作是由其他人完成的;请参阅[我们网站的链接页面](https://www.chiark.greenend.org.uk/~sgtatham/putty/links.html)，了解各种第三方端口。



### A.3.8 `iPhone` 会有接口吗？

我们没有计划自己编写这样的接口;我们都没有 `iPhone` ，为它开发和发布应用程序看起来既笨拙又昂贵。

但是，`iPhone` 和 `iPod Touch` 有一个名为 [pTerm](http://www.instantcocoa.com/products/pTerm/) 的第三方 `SSH` 客户端，它显然是基于 `PuTTY` 的。（这与我们 名称相似的  `pterm` 无关，它是一个用于 `Unix` 系统的独立终端仿真器;请参阅[问题 A.3.2](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-unix)。）



## A.4 在其他程序中嵌入 `PuTTY`

### A.4.1 `SSH` 或 `Telnet` 代码是否可作为 `DLL` 使用？

不，不能。

这需要合理的重写才能实现，并且由于 `PuTTY` 项目本身不相信 `DLL`（它们使安装更容易出错），我们都没有花时间去做。

一般来说，大多数代码清理工作都是一件好事，所以如果有人想帮忙，我们不会拒绝。

另请参阅[愿望清单条目](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/dll-frontend.html)。



### A.4.2 `SSH` 或 `Telnet` 代码是否可用作 `Visual Basic` 组件？

不，不能。

`PuTTY` 团队都没有使用 `Visual Basic` ，我们也没有特别需要从 `Visual Basic` 应用程序建立 `SSH` 连接。

此外，首先需要将其转换为 `DLL` 的所有初步工作;此外，我们甚至不知道如何编写 `VB` 组件。

如果有人愿意为我们做一些这样的工作，我们可能会考虑，但除非发生这种情况，否则我看不到 `VB` 集成在我们优先级列表的最底部以外的任何地方。



### A.4.3 如何使用 `PuTTY` 从另一个程序内建立 `SSH` 连接？

也许最好的选择是使用命令行连接工具 `Plink` 。

如果您可以将 `Plink` 作为第二个 `Windows` 进程启动，并安排您的主进程能够将数据发送到 `Plink` 进程，并通过管道从中接收数据，那么您应该能够从您的程序建立 `SSH` 连接。

例如，像 `CVS for Windows` 就是这么做的。



## A.5 `PuTTY` 的运营细节

### A.5.1 `PuTTY` 使用什么类型的终端？

在大多数情况下，`PuTTY` 可以被认为是一个 `xterm` 终端。

`PuTTY` 还支持一些真正的 `xterm` 不支持的终端控制序列：特别是重新配置调色板的 `Linux` 控制台序列，以及 `DECterm` 使用的标题栏控制序列（与 `xterm` 不同；`PuTTY` 同时支持这两种序列）。

默认情况下，`PuTTY` 向服务器宣布其终端类型为 `xterm` 。

如果你对此有问题，你可以重新配置它，说其他的话；如果你遇到麻烦，`vt220` 可能会有所帮助。



### A.5.2 `PuTTY` 将其数据存储在哪里？

在 `Windows` 上，`PuTTY` 将其大部分数据（保存的会话，`SSH` 主机密钥）存储在注册表中。

确切的位置是

```
HKEY_CURRENT_USER\Software\SimonTatham\PuTTY
```



并且在该区域内，保存的会话存储在 `Sessions` 下，而主机密钥存储在 `SshHostKeys` 下。

`PuTTY` 还需要一个随机数种子文件，以提高 `SSH` 加密所需的随机选择数据的不可预测性。

默认情况下，它存储在一个名为 `PUTTY.RND` 的文件中；默认情况下，它存储在“应用程序数据”目录中，否则，存储在多个回退位置之一。

如果您想更改随机数种子文件的位置，可以将您选择的路径名放在注册表中，位于

```
HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\RandSeedFile
```



您可以要求 `PuTTY` 删除所有这些数据;见[问题A.8.2](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-cleanup)。

在 `Unix` 上，`PuTTY` 默认将所有这些数据存储在一个目录 `~/.putty` 中。



### A.5.3 为什么登录提示旁边会出现小的 `PuTTY` 图标？

从 `PuTTY 0.71` 开始，终端窗口中的某些文本行标有 `PuTTY` 图标的小副本（在像素允许的范围内）。



这是为了显示可信度。

当 `PuTTY` 图标出现在一行文本旁边时，表示该行文本是由 `PuTTY` 本身生成的，而不是由服务器生成并发送到 `PuTTY` 。



来自服务器的文本没有此图标，我们已经安排服务器不应该能够伪造它。

（服务器无法发送任何控制序列，这将使 `PuTTY` 绘制自己的图标，如果服务器尝试将光标移回*已有*图标的行并覆盖文本，该图标将消失。）



这使您可以区分（例如）`PuTTY` 本身要求您提供私钥密码的合法提示和服务器试图发送相同文本以诱骗您告诉*它的*私钥密码的虚假提示之间的区别。



### A.5.4 为什么 `Plink` 开始会提示“按回车开始会话”？

从 `PuTTY 0.71` 开始，如果您使用 `Plink` 进行交互式 `SSH` 会话，则在登录阶段完成后，它将显示最终的交互式提示，指出“已授予访问权限。按返回开始会话”。



这是针对服务器在会话启动后尝试模拟真实身份验证提示的另一种防御措施。

当您通过该提示时，您知道它之后的所有内容都是由服务器生成的，而不是由 `Plink` 本身生成的，因此任何对您的私钥密码的请求都应受到怀疑。



在 `Plink` 中，我们不能使用[第 A.5.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-trust-sigils)中描述的防御措施：`Plink` 在终端*中*运行，因此它可以写入终端的任何内容，服务器都可以在会话启动后以相同的方式写入。

而且我们不能只打印一个分隔线而不停顿，因为这样服务器可以简单地将光标移回它并覆盖它（可能会有短暂的闪烁，但你可能很容易错过）。

任何人想出的唯一强有力的防御措施涉及这种停顿。



如果您相信您的服务器不会滥用，则可以将其关闭。

它也不会出现在 `Plink` 可以确信没有必要的其他各种情况下。

有关详细信息，请参见[第 7.2.3.6 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter7.html#plink-option-antispoof)。



## A.6 操作方法问题

### A.6.1 我应该使用什么登录名/密码？

这不是您应该问*我们的*问题。

`PuTTY` 是一种通信工具，用于与其他计算机建立连接。

我们维护工具;*我们不会*管理您可能能够使用的任何计算机，就像制作 `Web` 浏览器的人不对您可以在其中查看的大部分内容负责一样。

我们不能帮助解决这类问题。

如果您知道要连接的计算机的名称，但不知道要使用什么登录名或密码，则应与管理该计算机的人员联系。

如果您不知道那是谁，请参阅下一个问题，了解一些可能的方法。



### A.6.2 我可以在 `PuTTY` 终端窗口中键入哪些命令？

同样，这不是您应该问*我们的*问题。

您需要阅读已*连接计算机*的手册或询问管理员。



`PuTTY` 不会处理您在其中键入的命令。

它只是一种沟通工具。

它与另一台计算机建立连接;它将您键入的命令传递给另一台计算机;它会将另一台计算机的响应传回给您。

因此，您可以使用的命令的精确范围不取决于 `PuTTY` ，而是取决于您连接到的计算机类型以及在其上运行的软件。

`PuTTY` 团队无法为您提供帮助。

（把 `PuTTY` 想象成电话。如果你打电话给某人，但你不知道该说什么语言才能让他们理解你，那么*电话公司*的工作不是为你找到答案。我们只是为您提供联系方式;让自己被理解是别人的问题。）



如果您不确定从哪里开始寻找服务器的管理员，一个好的起点可能是记住您是如何在 `PuTTY` 配置中找到主机名的。

例如，如果通过电子邮件为您提供了该主机名，则可以尝试询问向您发送该电子邮件的人。

如果您公司的 `IT` 部门为您提供了现成的 `PuTTY` 保存会话，那么该 `IT` 部门可能还会告诉您一些关于您可以在这些会话中键入哪些命令的信息。

但是 `PuTTY` 维护者团队不会管理您可能连接到的任何服务器，并且无法帮助您解决此类问题。



### A.6.3 如何使 PuTTY 启动时最大化？

创建一个 `Windows` 快捷方式以启动 `PuTTY` ，并将其设置为“运行最大化”。



### A.6.4 如何创建 `Windows` 快捷方式以直接启动特定的已保存会话？

要运行以名称“`mysession`”保存的 `PuTTY` 会话，请创建一个 `Windows` 快捷方式，该快捷方式使用类似命令行调用 `PuTTY` 如下：

```
\path\name\to\putty.exe -load "mysession"
```

（注意：在 `0.53` 之前，语法为 `@session` 。这现已弃用，可能会在某个时候被删除。）



### A.6.5 如何直接从命令行启动 `SSH` 会话？

使用命令行 `putty -ssh host.name` 。

或者，创建一个指定 `SSH` 协议的已保存会话，并启动已保存的会话，如[问题 A.6.4](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-startsess) 所示。



### A.6.6 如何在 `PuTTY` 和其他 `Windows` 应用程序之间复制和粘贴？

复制和粘贴的工作方式与 `X` 窗口系统类似。

使用鼠标左键在 `PuTTY` 窗口中选择文本。

选择操作*会自动*将文本复制到剪贴板：无需按 `Ctrl-Ins` 或 `Ctrl-C` 或其他任何键。

实际上，按 `Ctrl-C` 会将 `Ctrl-C` 字符发送到连接的另一端（就像其余时间一样），这可能会产生令人不快的效果。

要将文本复制到剪贴板，您*唯一*需要做的就是选择它。



要将剪贴板内容粘贴到 `PuTTY` 窗口中，默认情况下单击鼠标右键。

如果您有三键鼠标并且习惯了 `X` 应用程序，则可以将粘贴配置为由中间按钮完成，但这不是默认设置，因为大多数 `Windows` 用户根本没有中间按钮。

您也可以通过按 `Shift-Ins` 进行粘贴。



### A.6.7 如何在 `PSCP` 、`PSFTP` 和 `Plink` 中使用 `PuTTY` 的所有功能（公钥、代理、密码选择等）？

大多数主要功能（例如，公钥、端口转发）都可以通过命令行选项获得。请参见[第 3.11.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-general-opts)。

并非所有功能都可以从命令行访问，尽管我们想解决这个问题。

同时，如果您创建 `PuTTY` 保存的会话，然后在命令行上使用保存的会话的名称代替主机名，则可以使用 `PuTTY` 的大部分功能。

这适用于 `PSCP` ，`PSFTP` 和 `Plink`（但不要指望在文件传输应用程序中进行端口转发！）



### A.6.8 如何使用 `PSCP.EXE` ？当我双击它时，它会给我一个命令提示符窗口，然后立即关闭。

`PSCP` 是命令行应用程序，而不是 `GUI` 应用程序。

如果您在没有参数的情况下运行它，它将只打印一条帮助消息并终止。

要正确使用 `PSCP` ，请从命令提示符窗口运行它。

有关更多详细信息，请参阅文档中的第 [5 章](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter5.html#pscp)。



### A.6.9 如何使用 `PSCP` 复制名称中包含空格的文件？

如果 `PSCP` 使用的是较新的 `SFTP` 协议（大多数现代服务器通常采用），则这很简单;所有带有空格的文件名都以显而易见的方式使用一对引号指定：

```
pscp "local file" user@host:
pscp user@host:"remote file" .
```



但是，如果 `PSCP` 出于某种原因使用较旧的 `SCP` 协议，则情况会更加混乱。

如果您在本地端指定文件，则只需像往常一样使用一组引号：

```
pscp "local filename with spaces" user@host:
pscp user@host:myfile "local filename with spaces"
```



但是，如果您指定的文件名位于*远程*端，则必须使用反斜杠和两组引号：

```
pscp user@host:"\"remote filename with spaces\"" local_filename
pscp local_filename user@host:"\"remote filename with spaces\""
```



更糟糕的是，在远程到本地副本中，您必须显式指定本地文件名，否则 `PSCP` 将抱怨它们不匹配（除非您指定了选项 `-unsafe` ）。

以下命令将给出错误消息：

```
c:\>pscp user@host:"\"oo er\"" .
warning: remote host tried to write to a file called 'oo er'
         when we requested a file called '"oo er"'.
```



相反，您需要完全指定本地文件名：

```
c:\>pscp user@host:"\"oo er\"" "oo er"
```



### A.6.10 我应该运行 `32` 位还是 `64` 位版本？

如果您不确定，`32` 位版本通常是安全选项。

它将在所有处理器和 `PuTTY` 支持的所有 `Windows` 版本上运行良好。

`PuTTY` 不需要作为 `64` 位应用程序运行即可正常工作，并且在 `32` 位系统上拥有 `64` 位 `PuTTY` 不太可能给您带来任何麻烦。



`64` 位版本（首次在 `0.68` 中发布）仅在您拥有 `64` 位处理器*和*  `64` 位版本的 `Windows` 时运行（这两者都可能适用于任何最近的 `Windows PC` ）。

它会运行得更快一些（特别是加密会更快，尤其是在链接设置期间），但它会消耗更多的内存。



如果您需要使用外部 `DLL` 进行 `GSSAPI` 身份验证，则该 `DLL` 可能仅以 `32` 位或 `64` 位形式提供，这将决定您需要使用的 `PuTTY` 版本。（您可能知道是否正在执行此操作;请参阅文档中的第 [4.23.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-auth-gssapi-libraries)。）



## A.7 故障排除

### A.7.1 为什么我在 `PSCP` 中看到“致命：协议错误：预期的控制记录”？

发生这种情况是因为 `PSCP` 希望看到来自属于 `PSCP` 协议交换一部分的服务器的数据，而是看到它根本无法理解的数据。



这几乎总是发生，因为服务器计算机上帐户中的启动脚本正在生成输出。

`PSCP` 或任何其他 `SCP` 客户端无法解决此问题。

切勿使用在非交互式会话中生成输出的启动文件（ `.bashrc` 、 `.cshrc` 等）。



这实际上不是 `PuTTY` 的问题。

如果 `PSCP` 以这种方式失败，则所有其他 `SCP` 客户端可能会以完全相同的方式失败。

问题出在服务器端。



### A.7.2 我在“颜色”面板中单击了一种颜色，但该颜色在我的终端中没有变化。

这不是您应该使用“颜色”面板的方式。

在会话过程中，`PuTTY` 可能会使用“颜色”面板中列出的*所有*颜色。

这不是只使用其中一个并选择哪一个的问题; `PuTTY` 将使用*它们所有。*



“颜色”面板的目的是让您调整所有颜色的外观。

因此，例如，要更改光标的颜色，请选择“光标颜色”，按“修改”按钮，然后从出现的对话框中选择新颜色。

同样，如果您希望您的会话显示为绿色，则应选择“默认前景”并按“修改”。

单击“ANSI 绿色”不会将您的会话变为绿色;它只允许您调整服务器指示 `PuTTY` 显示绿色文本时使用的绿色*阴影*。



### A.7.3 在尝试建立 `SSH-2` 连接后，`PuTTY` 说“内存不足”并中止程序。

如果这种情况发生在连接启动时，这通常表示由于某种原因客户端和服务器未能建立会话加密密钥。

不知何故，他们执行了本应为每个密钥提供相同密钥的计算，但最终得到了不同的密钥;因此，由一个加密并由另一个解密的数据看起来像随机垃圾。



这会导致“内存不足”错误，因为 `PuTTY` 期望看到的第一个加密数据是 `SSH` 消息的长度。

通常，这将远低于 `100` 字节。

如果解密失败，`PuTTY` 将看到大约  `2GB` 的完全随机长度，并将尝试分配足够的内存来存储此不存在的消息。

这将立即导致它认为它没有足够的内存，并惊慌失措。



如果这种情况发生在您身上，它很可能仍然是一个 `PuTTY` 错误，您应该报告它（尽管它可能是您的 `SSH` 服务器中的错误）;但这并不一定意味着你实际上已经用完了内存。



### A.7.4 尝试文件传输时，`PSCP` 或 `PSFTP` 显示“内存不足”并中止程序。

这几乎总是由生成输出的服务器上的登录脚本引起的。

`PSCP` 或 `PSFTP` 将在期望看到文件传输协议的开始时接收该输出，并且他们将尝试将输出解释为文件传输协议。

这通常会导致“内存不足”错误，原因与[问题 A.7.3](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-outofmem) 中给出的原因大致相同。



这是您在服务器上的帐户中的设置问题，*而不是* `PSCP/PSFTP` 错误。

您的登录脚本*不应*在非交互式会话期间生成输出;安全文件传输并不是唯一一种在远程访问时会中断的形式。



在 `Unix` 上，一个简单的修复方法是确保登录脚本中可能生成输出的所有部分都在 `.profile` （如果使用 `Bourne shell` 派生程序）或 `.login`（如果使用 `C shell` ）中。

将它们放在 `.bashrc` 或 `.cshrc` 等更通用的文件中可能会导致问题。



### A.7.5 `PSFTP` 传输文件的速度比 `PSCP` 慢得多。

`PSFTP 0.54` 的吞吐量应该比 `0.53b` 及之前好得多;我们已将代码添加到 `SFTP` 后端，以对多个数据块进行排队，而不是等待每个数据块的确认。

（ `SCP` 后端没有遇到此性能问题，因为 `SCP` 是一个更简单的协议。）



### A.7.6 当我运行全彩色应用程序时，我看到应该有颜色的黑色区域，反之亦然。

您几乎肯定需要更改终端面板中的“使用背景颜色清除屏幕”设置。

如果黑色空间太多（常见情况），则应启用它，而如果颜色过多，则应禁用它。（请参阅[第 4.3.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-erase)。

在旧版本的 `PuTTY` 中，此功能默认处于禁用状态，并且在重置终端之前不会生效（请参阅[问题 A.7.7](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-resetterm)）。

从 `0.54` 开始，默认情况下启用，更改立即生效。



### A.7.7 当我更改某些终端设置时，没有任何反应。

某些终端选项（特别是自动换行和背景彩色屏幕擦除）实际上代表*默认设置*，而不是当前活动的设置。

服务器可以在会话中发送修改这些选项的序列，但是当终端重置时（通过服务器操作，或从系统菜单中选择“重置终端”），默认值将恢复。



在版本 `0.53b` 及更早版本中，如果在会话过程中更改这些选项之一，您会发现更改不会立即生效。只有在重置终端后，它才会生效。

在 `0.54` 版中，行为已更改 - 对这些设置的更改会立即生效。



### A.7.8 我的 `PuTTY` 会话在空闲一段时间后意外关闭。

某些类型的防火墙，以及几乎所有执行网络地址转换（ `NAT` ，也称为 `IP` 伪装）的路由器，如果连接长时间不执行任何操作，则会忘记通过它们的连接。

这将导致在恢复联系时粗暴地切断连接。



您可以尝试通过告诉 `PuTTY` 发送 *`keepalive`* 来解决这个问题：数据包对实际会话没有影响，但可以让路由器或防火墙放心网络连接仍然处于活动状态并且值得记住。

不幸的是，`Keepalives` 并不能解决所有问题;尽管它们对此类路由器具有更强的鲁棒性，但它们也可能导致对网络丢失的鲁棒性*丧失*。

有关此内容的更多讨论，请参阅文档中的第 [4.14.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-keepalive)。



### A.7.9 当网络连接暂时丢失时，`PuTTY` 的网络连接超时过快。

这是一个 `Windows` 问题，而不是 `PuTTY` 问题。

不能基于每个应用程序或每个会话设置超时值。

要全局增加 `TCP` 超时，您需要修改注册表。



在 `Windows 95` 、 `98` 或 `ME` 上，您需要创建或更改的注册表项是：

```
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\
  MSTCP\MaxDataRetries
```

（在 `Win95` 中必须为 `DWORD` 类型，在 Win98/ME 中必须为 String 类型）。（有关详细信息，请参阅 MS 知识库文章 [158474](http://support.microsoft.com/default.aspx?scid=kb;en-us;158474)。



在 `Windows NT` 、 `2000` 或 `XP` 上，要创建或更改的注册表项是：

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\
  Parameters\TcpMaxDataRetransmissions
```



并且它必须是 `DWORD` 类型。（有关详细信息，请参阅 MS 知识库文章 [120642](http://support.microsoft.com/default.aspx?scid=kb;en-us;120642) 和 [314053](http://support.microsoft.com/default.aspx?scid=kb;en-us;314053)。）

将键的值设置为 `10` 之类的值。

这将导致 `Windows` 更加努力地保持连接处于活动状态，而不是放弃它们。



### A.7.10 当我 `cat` 一个二进制文件时，我在命令行上得到了“PuTTYPuTTYPuTTY”。

那就不要那样做。

这是设计行为使然；当 `PuTTY` 从远程服务器接收到字符 `Control-E` 时，它将其解释为一个识别自己的请求，因此它发送回字符串“PuTTY”，就好像该字符串是在键盘上输入的一样。

`Control-E` 只能由准备处理响应的程序发送。

向终端写入二进制文件可能会输出许多 `Control-E` 字符，并导致这种行为。

别这么做。这是个糟糕的计划。



为了减轻影响，您可以将应答字符串配置为空（请参阅第4.3.7节）；但是，将二进制文件写入终端可能会导致其他各种不愉快的行为，因此这只是一个很小的补救措施。



### A.7.11 当我 `cat` 一个二进制文件时，我的窗口标题将变为无意义的字符串。

那就不要那样做。

`PuTTY` 应该能够根据服务器的指令调整窗口标题。

通常，执行此操作的控件序列只能由知道自己在做什么并打算在窗口标题中放置有意义的文本的程序故意发送。

将二进制文件写入终端存在意外发送相同控制序列的风险，并导致窗口标题发生意外更改。别这样做。



### A.7.12 一旦 `PuTTY` 显示密码提示，我的键盘就会停止工作。

不，它没有。

`PuTTY` 只是不显示您输入的密码，因此查看屏幕的人看不到密码是什么。



与 `Windows` 登录提示不同，`PuTTY` 也不会将密码显示为一行星号。

这样，看着您屏幕的人甚至无法判断您的密码*有多长*，这可能是有价值的信息。



### A.7.13 在服务器端应用程序中，一个或多个函数键无法实现我所期望的功能。

如果您已经尝试了 `PuTTY` 键盘面板中的所有相关选项，您可能需要向 `PuTTY` 维护人员发送邮件并询问。




仅仅告诉我们哪个应用程序、哪个服务器操作系统和哪个密钥不工作通常是没有帮助的；为了复制这个问题，我们需要拥有每个操作系统和每个应用程序的副本，这是任何人都抱怨过的。

`PuTTY` 通过向服务器发送一系列控制字符来响应功能按键。

如果函数键没有按您的期望执行，那么您的应用程序期望接收的字符序列很可能与 `PuTTY` 发送的字符序列不同。

因此，我们真正需要知道的是应用程序所期望的序列。

研究这一点的最简单方法是找到其他一些终端环境，该功能键确实在其中工作；然后调查功能键在这种情况下发送的序列。



在 `Unix` 系统上，一种相当简单的方法是键入命令 `cat` ，然后按功能键。

这可能会产生形式为 `^[[11~` 的输出。

你也可以在 `PuTTY` 中这样做，以了解函数键在其中产生的序列。

然后你可以给 `PuTTY` 维护人员发邮件，告诉我们“我想让 `F1` 键发送 `^[[11]` ，但它却在发送`^[OP` ，这能做到吗？”或类似的事情。



您仍然应该阅读 `PuTTY` 网站上的反馈页面（也作为手册中的附录 `B` 提供），并遵循其中包含的指南。



### A.7.14 为什么我看到“无法从...加载私钥”？为什么 `PuTTYgen` 可以加载我的密钥，但不能加载 `PuTTY` 的？

您可能已经使用 `PuTTYgen` 生成了 `SSH` 协议 `2` 密钥，但您正在尝试在 `SSH-1` 连接中使用它。

`SSH-1` 和 `SSH-2` 密钥具有不同的格式，并且（至少在 `0.52` 中）`PuTTY` 以错误格式报告密钥并不是最佳的。

要使用 `SSH-2` 连接到支持两个版本的服务器，您需要更改默认配置（请参阅[问题 A.2.1](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-ssh2)）。



### A.7.15 当我连接到红帽 `Linux 8.0` 系统时，某些字符无法正确显示。

一个常见的抱怨是手册页中的连字符显示为 `a-acute` 。

在 `8.0` 版中，`Red Hat` 似乎将 `UTF-8` 作为默认字符集。

像 `PuTTY` 这样的终端模拟器似乎没有办法知道这一点（据我们所知，没有发送切换到 `UTF-8` 模式的适当转义序列）。



解决方法是将到 `RH8` 系统的会话配置为使用 `UTF-8` 转换 - 请参阅文档中的第 [4.10.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-charset)。

（请注意，如果您使用“更改设置”，更改可能不会立即发生 - 请参阅[问题 A.7.7](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-resetterm)。）



如果确实要更改服务器使用的字符集，正确的位置是 `/etc/sysconfig/i18n` ，但这应该是必需的。



### A.7.16 自从我升级到 `PuTTY` `0.54` 以来，当我运行 `screen` 时，回滚已停止工作。

`PuTTY` 的终端模拟器一直有一个策略，即当使用“备用屏幕”时，不会向滚动条添加任何内容。

这是因为通常使用交替屏幕的程序都是文本编辑器，它们往往会在同一文档中来回滚动很多；因此

（a）他们会用大量无用的无序文本填充滚动条，

（b）他们包含自己的方法，让用户滚动回他们感兴趣的位置。

我们通常发现，这种策略在几乎所有情况下都是正确的。



不幸的是，屏幕是一个例外：它使用了备用屏幕，但让 `PuTTY` 的滚动条继续工作通常仍然很有帮助。

最简单的解决方案是转到功能控制面板并勾选“禁用切换到备用终端屏幕”。

（更多详细信息，请参阅第4.6.4节。）

或者，您可以告诉 `screen` 本身不要使用备用屏幕：屏幕常见问题解答建议在 `.screenrc` 文件中添加行 `termcapinfo xterm ti@：te@` 。



这在 `0.54` 中才开始成为问题的原因是，屏幕通常使用不寻常的控制序列切换到备用屏幕，而 `PuTTY` 的以前版本不支持此序列。



### A.7.17 由于我将 `Windows XP` 升级到 `Service Pack 2` ，因此我无法使用类似 `127.0.0.2` 。

一些要求 `PuTTY` 侦听本地主机地址而不是转发 `127.0.0.1` 的 `SMB` 和 `Windows` 终端服务等服务的人发现，自从升级到 `WinXP SP2` 以来，这样做不再有效。



这显然是 `MS` 知识库文章[2](http://support.microsoft.com/default.aspx?scid=kb;en-us;884020)中 `Microsoft` 承认的 `SP884020` 问题。

本文链接到您可以下载的修复程序。

(*但是*，我们被告知 `SP2` *还*修复了该错误，这意味着您首先需要使用非 `127.0.0.1` 地址来转发终端服务。



### A.7.18 `PSFTP` 命令似乎缺少目录分隔符（斜杠）。

有些人报告了以下 `PSFTP` 的错误行为：

```
psftp> pwd
Remote directory is /dir1/dir2
psftp> get filename.ext
/dir1/dir2filename.ext: no such file or directory
```



这不是 `PSFTP` 中的错误。

某些版本的可移植 `OpenSSH` 中存在导致这些症状的已知错误（[错误 697](http://bugzilla.mindrot.org/show_bug.cgi?id=697)）;它似乎是在 `3.7.x` 左右引入的。

它只在某些平台上表现出来（ `AIX` 是已经报告给我们的）。

有一个针对 `OpenSSH` 的补丁附加到该错误;它在最新版本的可移植 `OpenSSH`（从 `3.8` 左右）中也得到了修复。



### A.7.19 您听说过“软件导致连接中止”吗？

在 `PuTTY` `0.53` 和 `0.53b` 的文档中，我们提到我们希望听到此错误的任何发生情况。

然而，自从 `PuTTY` `0.54` 发布以来，我们一直确信此错误并不表示 `PuTTY` 做错了什么，我们不需要听到进一步的情况。

有关此错误的当前文档，请参阅[第 10.16 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter10.html#errors-connaborted)。



### A.7.20 我的 `SSH-2` 会话每隔一段时间就会锁定几秒钟。

最新版本的 `PuTTY` 每小时自动启动一次重复密钥交换，以提高会话安全性。

如果您的客户端或服务器计算机运行缓慢，您可能会遇到长达 `30` 秒左右的延迟。



这些延误很不方便，但它们是为了保护您。

如果它们确实给您带来了问题，您可以选择使用“Kex”配置面板关闭定期重新生成密钥（请参阅[第 4.18 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ssh-kex)），但请注意，您将为此牺牲安全性。

（回退到 `SSH-1` 也会消除延迟，但仍然会*失去更多的安全性*。我们不建议这样做。）



### A.7.21 `PuTTY` 无法启动。`Windows` 声称“应用程序配置不正确”。

这是由某些版本的 `Windows XP` 中的错误引起的，该错误由 `PuTTY 0.58` 触发。

这在 `0.59` 中得到了修复。`PuTTY` 愿望清单中的[“xp-wont-run”](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/xp-wont-run)条目有更多细节。



### A.7.22 当我将 `32` 位 `PuTTY` 安装到 `64` 位 `Windows` 系统上的 `C:\WINDOWS\SYSTEM32` 时，“重复会话”不起作用。

简单的答案是不要将 `PuTTY` 可执行文件放在那个位置。

在 `64` 位系统上，`C:\WINDOWS\SYSTEM32` 仅包含 `64` 位二进制文件；`Windows` 的 `32` 位二进制文件位于 `C:\Windows\SYSWOW64` 中。

当 `32` 位 `PuTTY` 可执行文件在 `64` 位系统上运行时，默认情况下它根本看不到“真正的 `C:\WINDOWS\SYSTEM32` ，因为文件系统重定向器会安排运行的程序在 `SYSTEM32` 中看到适当类型的二进制文件。

因此，`PuTTY` 套件中涉及其访问自己的可执行文件的操作（如“New Session”和“Duplicate Session”）将不起作用。



### A.7.23 将 `PuTTY` 升级到 `0.68` 后，我无法再连接到我的嵌入式设备或装置。

如果您的 `SSH` 服务器在您输入密码后开始意外关闭 `SSH` 连接，并且它在 `0.68` 之前工作，则您可能有一个有问题的服务器反对某些 `SSH` 协议扩展。

`SSH` 协议最近获得了一个新的“终端模式”，`IUTF8` ，`PuTTY` 默认发送;请参见[第 4.24.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter4.html#config-ttymodes)。

这是自定义 `SSH-2` 协议以来的第一个新终端模式。

虽然服务器应该忽略他们不知道的模式，但如果一些有缺陷的服务器看到任何他们不认识的东西，他们会毫不客气地关闭连接。嵌入式设备、网络设备等中的 SSH 服务器似乎不成比例地存在此错误。

如果您认为您有这样的服务器，从 0.69 开始，您可以禁用该模式 `IUTF8` 的发送：在 `SSH / TTY` 面板上，选择列表 `IUTF8` ，选择“无”，然后按“设置”。（无法在 `0.68` 中禁用此模式。）



## A.8 安全问题

### A.8.1 下载 `PuTTY` 并在公共 `PC` 上使用是否安全？

这取决于您是否信任该 `PC` 。

如果您不信任公共 `PC` ，请不要在其上使用 `PuTTY` ，也不要使用您计划在其中键入密码的任何其他软件。

它可能正在监视您的击键，或者可能会篡改您下载的 `PuTTY` 二进制文件。

*没有*足够安全的程序，您可以在主动恶意 `PC` 上运行它并逃脱在其中输入密码。



如果您确实信任 `PC` ，那么在其上使用 `PuTTY` 可能是可以的（但是如果您不信任网络，那么 `PuTTY` 下载可能会被篡改，因此最好将 `PuTTY` 随身携带在 `USB` 记忆棒上）。



### A.8.2 `PuTTY` 在系统上留下什么？之后如何清理？

`PuTTY` 将在 `PC` 上留下一些注册表项和一个随机种子文件（请参阅[问题A.5.2](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-settings)）。

`Windows 7` 及更高版本还会记住有关最近启动的“跳转列表”功能会话的一些信息。



如果您在公共 `PC` 或其他人的 `PC` 上使用 `PuTTY` ，则可能需要在离开时清理此信息。

您可以通过运行命令 `putty -cleanup` 自动执行此操作。

有关更多详细信息，请参阅文档中的第 [3.11.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-cleanup)。（请注意，这只会删除多用户系统上当前登录用户的设置。）



如果 `PuTTY` 是从安装程序包安装的，它也将显示在“添加/删除程序”中。

当前版本的安装程序不提供删除上述项目，因此如果您希望删除它们，则应在卸载之前运行 `putty -cleanup` 。



### A.8.3 为什么 `PuTTY` 现在支持 `DSA` ，而网站曾经说它有多不安全？

*如果实施不当，`DSA`*有一个主要弱点：它在很大程度上依赖于随机数生成器。

如果随机数生成器生成攻击者可以预测的数字，则会公开 `DSA` 私钥 - 这意味着攻击者可以在接受该密钥的所有系统上以您的身份登录。



`PuTTY` 政策发生了变化，因为开发人员被告知了实现DSA的方法，这些方法不会受到这个弱点的影响，而且实际上根本不需要依赖随机数。

出于这个原因，我们现在相信 `PuTTY` 的 `DSA` 实现可能是可以的。



最近添加的椭圆曲线签名方法也是 `DSA` 风格的算法，因此它们在原理上具有相同的弱点。

我们的 `ECDSA` 实现使用与 `DSA` 相同的防御，而我们的 `Ed25519` 实现使用与 `Ed25519` 规范要求的类似系统（但细节不同）。



### A.8.4 `Pageant` 不能使用 `VirtualLock()` 来阻止私钥写入磁盘吗？

非常不幸，它不能。

`Windows API` 中的函数 `VirtualLock()` 不能正常工作：它可以防止进程内存的小块在进程运行时分页到磁盘，但当进程长期处于非活动状态时，它不会阻止进程的内存作为一个整体完全交换到磁盘。

`Pageant` 大部分时间都非活动状态。



### A.8.5 `Microsoft` 商店中的 `PuTTY` 版本合法吗？

[此链接](https://apps.microsoft.com/store/detail/putty/XPFNZKSKLBP7RJ)上的免费“PuTTY”应用程序由我们发布和维护。

那里的副本是最新版本，通常在我们自己的网站上发布后的几天内更新。



商店里还有其他 `PuTTY` 的副本，有些看起来很相似，有些则收费。

这些是由其他人上传的，我们不能保证任何关于它们的信息。

我们发布到 `Microsoft Store` 的第一个版本是 `0.76`（在我们的网站上首次发布后的一段时间）。



## A.9 管理问题

### A.9.1 `putty.org` 是您的网站吗？

不，不是。 

`putty.org` 是由一个机会主义者运营的，他用它向寻找我们免费 `SSH` 的人宣传他们自己的商业 `SSH` 实现。

我们不拥有该网站，我们无法控制它，我们也不建议任何人优先使用它而不是我们自己的网站。

真正的 `PuTTY` 网站，由 `PuTTY` 团队运营，一直位于

>  [`https://www.chiark.greenend.org.uk/~sgtatham/putty/`](https://www.chiark.greenend.org.uk/~sgtatham/putty/)



### A.9.2 您希望我为您注册一个更好的域名吗？

不,谢谢。

即使你能找到一个（他们中的大多数似乎已经注册了，那些在申请之前没有问我们是否真的想要它的人），我们对 `PuTTY` 网站的位置感到满意。

这并不难找到（只需在 [google.com](http://www.google.com/) 中键入 `putty` ，我们就是返回的第一个链接），而且我们认为移动网站的管理麻烦不值得受益。

此外，如果我们*确实*想要一个自定义域名，我们会希望自己运行它，所以我们确信它会继续指向我们想要的地方，并且不会突然改变或做奇怪的事情。由我们甚至不知道的第三方为我们注册并不是实现这一目标的最佳方法。



### A.9.3 您想要 `PuTTY` 网站的免费虚拟主机吗？

我们已经有一些了，谢谢。



### A.9.4 你们会从 `PuTTY` 网站链接到我的网站吗？

仅当您的网页内容与 `PuTTY` 用户明确直接相关时。

如果您的内容与 `PuTTY` 无关或仅切向相关，那么该链接将只是为您做广告。



谷歌排名机制的一个非常好的效果是，总的来说，最受欢迎的网站获得最高的排名。

这意味着，当一个普通人进行搜索时，搜索中的顶部项目很可能是一个高质量的网站或他们真正想要的网站，而不是为其排名支付最多钱的网站。



`PuTTY` 网站受到谷歌的高度尊重，正是出于这个原因：很多人仅仅因为他们喜欢 `PuTTY` 而链接到它，而我们不必要求任何人链接到我们。

我们认为，用它来提高随机广告商网站的排名是滥用这种尊重。

如果您希望您的网站在 `Google` 上获得很高的排名，我们希望您以我们的方式实现这一目标 - 通过足够擅长您的工作，人们会仅仅因为他们喜欢您而链接到您。



特别是，我们对用链接换取金钱不感兴趣（见上文），我们*当然*对用链接换取其他链接不感兴趣（因为我们的网站上没有广告，我们的谷歌排名甚至对我们没有任何直接价值）。

如果我们不想免费链接到您，那么我们可能根本不想链接到您。



如果您有基于 `PuTTY` 的软件，或者专门设计用于与 `PuTTY` 互操作的软件，或者以 `PuTTY` 用户真正感兴趣的其他方式，那么我们可能会很乐意在我们的链接页面上添加指向您的链接。

如果您正在运行 `PuTTY` 网站的特别有价值的镜像，我们可能有兴趣从我们的镜像页面链接到您。



### A.9.5 为什么不把 `PuTTY` 移到 `SourceForge` ？

部分原因是因为我们不想移动网站位置（见[问题A.9.2](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-domain)）。

此外，安全原因。

`PuTTY` 是一种安全产品，因此保护代码和网站免受未经授权的修改尤为重要，这些修改可能会引入微妙的安全漏洞。

因此，我们更希望 `Git` 存储库、网站和 `FTP` 站点保留在原地，由我们认识和信任的系统管理员直接控制，而不是由一个由我们从未见过的人组成的大型组织运营，众所周知，他们过去曾闯入过。



没有冒犯 `SourceForge` ;我认为他们做得很好。

但它们并不适合所有人，尤其是不适合我们。



### A.9.6 为什么我不能订阅 `putty-bugs` 邮件列表？

因为你不是 `PuTTY` 核心开发团队的成员。

`putty-bugs` 邮件列表不是一个一般的类似新闻组的讨论论坛;它是核心开发人员的联系地址，也是我们之间讨论事情*的内部*邮件列表。

如果我们开放给所有人订阅，它会变成更像一个新闻组的东西，我们将完全被流量所淹没。

要跟上列表的现状已经够难的了。



### A.9.7 如果 `putty-bugs` 不是一般订阅邮件列表，那是什么？

据我们所知它不是一般订阅邮件列表。

如果其他人想为 `PuTTY` 用户建立一个邮件列表或其他论坛来帮助彼此解决常见问题，那对我们来说很好，尽管 `PuTTY` 团队几乎肯定没有时间阅读它。

为此目的，最好使用已建立的新闻组之一（请参阅[B.1.2节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-other-fora)）。



### A.9.8 我如何向 `PuTTY` 开发捐款？

拜托，*拜托*不要觉得你必须这样做。

`PuTTY` 是完全免费的软件，而不是共享软件。

我们认为每个想使用 `PuTTY` *的人都应该*能够使用，无论他们是否有钱，这一点非常重要;所以我们最不希望看到的是 `PuTTY` 用户感到内疚，因为他们没有付给我们任何钱。

如果你想保留你的钱，请保留它。

我们不会梦想要求任何东西。



说了这么多，如果你仍然*真的想*给我们钱，我们不会争论：-）我们接受捐款的最简单方法是您向 `Using PayPal` （[`www.paypal.com`](http://www.paypal.com/)） 汇款。

如果您不喜欢 `PayPal` ，请与我们联系;我们也许可以安排一些替代手段。



小额捐款（数十美元或数十欧元）可能会用于啤酒或咖喱，这有助于激励我们的志愿者团队继续为世界做这件事。

如果我们能找到任何东西（也许是新硬件或新版本的 `Windows` ），那么更多的捐款将花在真正有助于开发的东西上，但是如果我们找不到任何东西，那么我们只会在开发人员之间分配资金。

如果您想确保您的捐款用于有价值的事情，请先询问我们。

如果您不喜欢这些条款，请完全随意不捐赠。我们不介意。



### A.9.9 我是否可以获得将 `PuTTY` 放在封闭磁盘/发行版与其他软件一起分发的权限？

是的。

对于大多数事情，您无需费心明确要求我们许可;我们的许可证已经授予您许可。

有关更多详细信息，请参阅[第 B.8 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-permission)。



### A.9.10 您能否签署一份协议，赔偿我们在  `PuTTY` 的安全问题？

不！

物理安全产品（例如锁）的供应商可能愿意为未能按广告宣传表现并导致损坏（例如贵重物品被盗）的产品承担经济责任。

他们之所以能负担得起，是因为他们卖*了很多*单位，只有一小部分会失败;因此，他们可以从所有其他销售收入中支付财务责任，并且仍然有足够的剩余来获利。财务责任与出售您的产品以换取金钱有着内在的联系。



在这种情况下，`PuTTY` 不类似于物理锁有两个原因。

一个是软件产品没有随机变化：如果PuTTY存在安全漏洞（确实会发生，尽管我们会尽最大努力防止它并在发生时快速响应），*`PuTTY`*的每个副本都会有相同的漏洞，因此它可能会同时影响所有用户。

因此，即使我们的用户都向我们支付使用 `PuTTY` 的费用，我们也无法*同时*向每个受影响的用户支付超过他们最初支付给我们的金额的赔偿。它只是行不通。



第二个更重要的原因是 `PuTTY` 用户*不*付钱给我们。

`PuTTY` 团队没有收入;这是一项志愿者工作，由人们利用业余时间尝试编写有用的软件组成。

我们甚至不是一家公司或任何类型的法律认可的组织。

我们只是一群碰巧在业余时间做一些事情的人。



因此，要求我们承担经济责任就是要求我们承担不得不*自掏腰*包支付的风险：从我们购买食物和衣服并支付租金的相同预算中支付。

这比我们愿意给予的要多。

我们已经把大量的业余*时间*用于免费开发软件;如果我们也必须支付自己的钱来做这件事，我们会开始怀疑我们为什么要花费精力。



从根本上说，自由软件不是在财务保证的基础上工作的。

您对软件正常运行的保证只是您拥有源代码并且可以在使用之前对其进行检查。

如果你想确保没有任何安全漏洞，对 `PuTTY` 代码进行安全审计，或者如果你自己没有必要的技能，请聘请安全工程师：与其试图确保在发生灾难时可以获得赔偿，不如首先尝试确保没有灾难。



如果你*真的*想要财务安全，看看你是否能找到一个安全工程师，他将对他们的审查的正确性承担经济责任。

（这可能不太可能受到上面提到的所有问题的影响，因为这样的工程师可能会审查*许多不同的产品，*这些产品往往会独立失败。）

如果做不到这一点，看看你是否可以说服保险公司为你投保安全事件，如果保险公司要求它作为一个条件，那么让我们的代码由他们满意的安全工程师审查。



### A.9.11 您能否签署此表格，授予我们使用/分发 `PuTTY` 的权限？

如果您的表格包含任何类似于“以下签名的声明和认股权证”的条款，我们不会签署它。

如果它要求我们保证 `PuTTY` 是安全的，则尤其如此;有关这方面的更多讨论，请参见[问题 A.9.10](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-indemnity)。

但我们应该保证什么并不重要：即使我们已经相信这是真的，例如我们不侵犯任何第三方版权，我们也不会签署接受任何法律或财务责任的文件。

这仅仅是因为 `PuTTY` 开发项目没有收入来支付该责任，或在必要时支付法律费用。

我们不能被起诉。我们向你保证，*我们已经尽力*了;如果这对你来说还不够好，那就很难。



现有的 `PuTTY` 许可文件已经允许您以几乎任何方式使用或分发 `PuTTY` ，这不涉及假装您编写的或在出错时起诉我们。我们认为这对任何人来说都应该足够了。



另请参阅[问题A.9.13](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-permission-general)，了解我们不想做这种事情的另一个原因。



### A.9.12 您能给我们写一份正式的 `PuTTY` 许可通知吗？

原则上我们可以，但不清楚它有什么用。

如果您认为 `PuTTY` 版权所有者之一很有可能起诉您（我们没有！），您可能希望他们*所有人*签署通知;即使我们愿意，我们也无法提供，因为许多版权所有者都是过去贡献了一些代码的人，后来我们与他们失去了联系。

因此，*即使在理论上*，我们能做的最好的事情就是让核心开发团队签署文档，这并不能保证其他版权所有者可能不会起诉。

另请参阅[问题A.9.13](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq-permission-general)，了解我们不想做这种事情的另一个原因。



### A.9.13 你能为我们签署*什么吗*？

除非有一个令人难以置信的充分理由。

我们通常不愿意开创一个先例，涉及我们必须与 `PuTTY` 用户签订个人协议。

我们估计我们有*数百万*用户，我们绝对没有时间与他们中的每个人签署具体协议。

因此，如果您希望我们为您签署特定的东西，您可以停下来考虑一下是否有任何特别之处将您与其他 `999, 999` 名用户区分开来，因此我们应该愿意为您签署任何理由，而不会开创这样的先例。

如果您的公司政策要求您与您使用的任何软件的供应商签订单独的协议，那么您的公司政策根本不适合使用流行的自由软件，我们敦促您将这视为您政策中的缺陷。



### A.9.14 如果你不签署任何东西，你能给我们某种保证，你以后不会让 `PuTTY` 成为闭源吗？

是，也不是。

如果您想要的是保证您已经下载的某个*当前版本的* `PuTTY` 将保持免费，那么您已经有了这种保证：它被称为 `PuTTY` 许可证。

它授予您使用、分发和复制其适用的软件的权限;一旦我们授予了该权限（我们拥有），我们就不能只是撤销它。



另一方面，如果你想保证 `PuTTY` *的未来版本不会*是闭源的，那就更困难了。

我们原则上可以签署一份文件，声明我们永远不会发布闭源 `PuTTY` ，但这并不能*保证我们会继续*发布*开源*  `PuTTY` ：我们仍然可以选择停止开发 `PuTTY` ，这对你来说肯定比让它闭源更糟糕！

（我们几乎肯定*不想*签署一份文件，保证我们实际上会继续在 `PuTTY`上进行开发工作;我们当然不会免费签署。像这样的文件被称为雇佣合同，除非换取可观的薪水，否则通常不会签署。）



如果我们停止开发 `PuTTY` ，或者决定将所有未来的版本设为闭源版本，那么您仍然可以根据当前许可证自由复制最后一个开放版本，特别是您可以从该版本开始自己的项目分支。

如果发生这种情况，我自信地预测*有人*会这样做，并且某种免费的 `PuTTY` 将继续开发。

这种事情在自由软件中已经有先例。

当然，我们不能保证*除了您之外*的其他人会这样做;您可能必须自己做。

但我们可以向你保证，如果我们停止，就没有什么能*阻止*任何人继续自由开发。

（最后，我们也可以自信地预测，如果我们做了 `PuTTY` 闭源，有人做了开源分支，大多数人会转向后者。因此，我们尝试它会很愚蠢。）



### A.9.15 你们能否向我们提供 `PuTTY` 的出口管制信息或 `FIPS` 认证？

有些人要求我们提供 `PuTTY` 的出口管制分类号（ `ECCN` ）。

我们不知道我们是否有，作为一个位于英国的自由软件开发人员团队，我们没有时间、金钱或精力来处理美国的官僚机构来进一步调查。

我们认为 `PuTTY` 在美国商业控制清单上属于 `5D002` ，但这不应该被视为确定的。

如果您需要了解更多信息，您应该寻求专业的法律建议。

这同样适用于任何其他国家/地区的法律要求和限制。

同样，有些人要求我们提供 `PuTTY` 工具的 `FIPS` 认证。

除非其他人准备做必要的工作并支付任何费用，否则我们无法提供这一点。



### A.9.16 作为我们现有的软件供应商之一，你能为我们填写这份问卷吗？

我们定期收到这样的请求，这些组织显然已经向“软件供应商”大电子表格中列出的每个人发送了一封套用信，要求他们回答一些关于支持的操作系统版本、付费支持安排、遵守我们没有听说过的各种当地法规、联系电话号码和其他此类管理的问题。

许多问题在应用于PuTTY时显然毫无意义（我们一开始不提供任何付费支持！），其余的大部分问题都可以通过快速浏览我们的网站来回答，还有一些我们不愿意回答（我们是私人，为什么我们要把我们的家庭电话号码提供给大公司？）。



我们不习惯完整回答这些问卷，因为我们*不是软件供应商*。



软件*供应商*是您向其支付大量资金以换取某些软件的公司。

他们知道你是谁，他们知道你在付钱给他们;因此，他们有动力填写您的表格和问卷，研究您引用的任何当地法规（如果他们还不知道），并且通常会以最方便的方式提供您可能需要的每一条信息，因为他们希望继续获得报酬。



但我们是一个由自由软件开发人员组成的团队，这意味着您与我们的关系完全不是这样。如果您曾经从我们的网站下载过我们的软件，那就太好了，我们希望您发现它有用，但这并不意味着我们根本不知道您是谁，或者有任何动力做大量无偿工作来支持我们与您的“关系”。



这并不是说我们不愿意*提供信息*。为了您的方便，我们尽可能多地将其放在我们的网站上，如果您确实需要了解一些您无法在网站上找到的有关 PuTTY 的事实（并且首先并非明显不适用于自由软件），那么请询问我们，我们将尽力回答。但是我们把网站和这个FAQ放在一起，*这样我们就不必*一遍又一遍地回答同样的问题，所以我们不准备为那些没有尽最大努力在这里找到答案的人填写完全通用的格式信函问卷。



如果您为一个您认为可能犯这个错误的组织工作，我们敦促您重新组织您的软件供应商列表，以便清楚地区分了解您的付费供应商和不知道您是谁的自由软件开发人员。然后，只将这些群发邮件发送给前者。



### A.9.17 下载页面上的 `sha1sums` 或 `sha256sums` 或其他文件与二进制文件不匹配。

人们经常报告这种情况，通常原因是他们将错误的校验和文件与错误的二进制文件匹配。



`PuTTY` 下载页面包含该软件的多个版本。

有一个*最新版本*;有*开发快照*;当我们准备发布时，还有即将发布的新版本的*预发布*版本。每个都有自己的二进制文件集合，以及自己的校验和文件集合。



因此，如果您已经下载了实际程序的发布版本，则还需要校验和的发布版本，否则您将看到不匹配。

同样，开发快照二进制文件与开发快照校验和一起使用，依此类推。（我们对下载页面进行了颜色编码，以减少这种混淆。）



另一件需要注意的事情：从 `0.71` 开始，每个平台的 `putty.exe` 可执行文件都有两种风格：网站上的独立版本，每个版本都包含嵌入式帮助，以及安装程序安装的版本，它们在安装程序中使用单独的帮助文件。

我们为两者提供校验和;后者在文件名后用 `(installer version)` 表示。



如果您已经仔细检查了所有这些，但您仍然认为存在真正的不匹配，那么请向我们发送一份报告，仔细引用所有相关内容：

- 您获取二进制文件的确切网址
- 下载后二进制文件的校验和
- 您从中获取校验和文件的确切网址
- 该文件表示二进制文件应具有的校验和。



## A.10 杂项问题

### A.10.1 `PuTTY` 是 `OpenSSH` 的接口，还是基于 `OpenSSH` 或 `OpenSSL` ？

不，不是。

`PuTTY` 几乎完全由为 `PuTTY` 从头开始编写的代码组成。

我们与 `OpenSSH` 共享的唯一代码是由 `CORE SDI S.A` 编写的 `SSH-1 CRC` 补偿攻击检测器;我们不与 `OpenSSL` 共享任何代码。



### A.10.2 我在哪里可以买到 `putty` ？

您看错了网站;我们在这里唯一知道的 `PuTTY` 是一个计算机程序的名称。

如果你想要那种可以作为可执行玩具而购买的 `putty` ，`PuTTY` 团队可以亲自推荐 `Thinking Putty` ，你可以到 [`www.puttyworld.com`](http://www.puttyworld.com/) 网站的 `Crazy Aaron's Putty World` 购买。



### A.10.3 `PuTTY` 是什么意思？

这是一个流行的 `SSH` 和 `Telnet` 客户端的名称。

任何其他含义都在旁观者的眼中。

有传言说 `PuTTY` 是 `getty` 的反义词，或者它是使 `Windows` 有用的东西，或者它是一种钚电传打字机。

我们不可能对此类指控发表评论。



### A.10.4 如何发音 `PuTTY` ？

就像英语单词 `putty` 一样，我们发音为 `/ˈpʌti/` 。





# 附录 B：反馈和错误报告

这是向 `PuTTY` 开发团队提供反馈的指南。

它既作为 `PuTTY` 网站上的网页提供，也作为 `PuTTY` 手册中的附录提供。



[B.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-general)提供了向开发团队发送任何类型的电子邮件的一些一般准则。

以下各节为特定类型的电子邮件（如 `bug` 报告和功能请求）提供了更具体的准则。



## B.1 一般准则

`PuTTY` 开发团队收到*很多*邮件。

如果你可以通过阅读手册、阅读 `FAQ` 、阅读网站、询问其他用户、发布到新闻组（见[B.1.2节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-other-fora)）或其他方式来解决自己的问题，那么这将使我们的生活更加轻松。



我们收到如此多的电子邮件，以至于我们实际上没有时间回答所有电子邮件。

我们对此感到遗憾，但我们对此无能为力。

因此，如果您*可能避免*向 PuTTY 团队发送邮件，我们建议您这样做。

特别是，支持请求（[B.6节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-support)）可能最好发送给新闻组，或者如果可能的话传递给当地专家。



`PuTTY` 联系电子邮件地址是一个包含四到五个核心开发人员的私人邮件列表。

不要因为它是一个邮件列表而推迟：如果您需要发送机密数据作为错误报告的一部分，您可以相信列表中的人员会尊重这种信心。

此外，档案不公开，因此您不应该通过向我们发送邮件来让自己进入任何垃圾邮件。



请在邮件中使用有意义的主题行。我们收到很多邮件，如果它们都有“PuTTY 错误”等主题行，则很难找到我们正在寻找的邮件。



### B.1.1 发送大型附件

由于 `PuTTY` 联系地址是邮件列表，因此大于 `40Kb` 的电子邮件将被列表管理员保留以供检查，除非它们看起来确实值得其大尺寸，否则不允许通过。



如果您正在考虑将任何类型的大数据文件发送给 `PuTTY` 团队，这几乎总是一个坏主意，或者至少最好先询问我们是否真的需要该文件。

或者，您可以将文件放在网站上，然后将URL发送给我们;这样，除非我们决定真正需要它，否则我们不必下载它，并且我们只需要下载它，而不是自动将其复制到所有开发人员。

（如果文件包含机密信息，那么您可以使用我们的安全联系人密钥对其进行加密;有关详细信息，请参阅[第 F.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixF.html#pgpkeys-pubkey)。请*仅*将其用于*需要*保密的信息。）



有些人喜欢以 `MS Word` 格式发送邮件。

*请不要将*错误报告或任何其他邮件作为 `Word` 文档发送给我们。

`Word` 文档大约是用纯文本编写相同报告的五十倍。

此外，`PuTTY` 团队的大多数成员都在 `Unix` 机器上阅读他们的电子邮件，因此将文件复制到 `Windows` 框中运行 `Word` 非常不方便。

不仅如此，我们中的*一些人甚至没有* `Word` 的副本！



有些人喜欢在演示问题时向我们发送屏幕截图。

请不要在没有先与我们联系的情况下执行此操作 - 我们几乎从不需要屏幕截图中的信息。

发送错误框的屏幕截图几乎肯定是不必要的，因为您可以用纯文本告诉我们错误是什么。

（在某些版本的 `Windows` 上，在显示错误框时按 `Ctrl-C` 会将消息文本复制到剪贴板。

发送全屏快照*偶尔*会很有用，但在发送之前检查我们是否需要它可能仍然是明智的。）



如果*必须*邮寄屏幕截图，请不要将其作为 `.BMP` 文件发送。

`BMP` 没有压缩，它们比其他图像格式（如 `PNG` 、`TIFF` 和 `GIF`）大*得多*。

在发送之前，将文件转换为正确压缩的图像格式。



请不要向我们发送可执行文件。

我们的邮件服务器会阻止所有包含可执行文件的传入电子邮件，以抵御我们每天收到的大量电子邮件病毒。如果您向我们发送可执行文件，它只会退回。



如果您对 `PuTTY` 代码进行了微小的修改，请尽可能向我们发送源代码补丁，而不是向我们发送包含*完整源代码和*您的修改的 `.ZIP` 大文件。

如果您只更改了 `10` 行，我们更愿意收到 `30` 行长的邮件，而不是包含我们已拥有的数兆字节数据的邮件。



### B.1.2 其他寻求帮助的地方

有两个 `Usenet` 新闻组与 `PuTTY` 工具特别相关：

- [`comp.security.ssh`](news:comp.security.ssh)，针对使用 SSH 协议的特定问题;
- [`comp.terminals`](news:comp.terminals)，用于与终端仿真相关的问题（例如，键盘问题）。



请使用最适合您的查询的新闻组，并记住这些是一般新闻组，而不是专门针对 `PuTTY` 的。

如果您没有直接访问 `Usenet` 的权限，可以通过Google网上论坛（[`groups.google.com`](http://groups.google.com/)）访问这些新闻组。



## B.2 报告错误

如果您认为您在 `PuTTY` 中发现了错误，您的第一步应该是：

- 查看 `PuTTY` 网站上的[“愿望清单”页面](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/)，看看我们是否已经知道这个问题。

  如果我们这样做，几乎可以肯定没有必要向我们发送有关它的邮件，除非您认为您有额外的信息可能有助于我们修复它。

  （当然，如果我们确实*需要*有关特定错误的特定额外信息，愿望清单页面会这样说。）

- 查看 `PuTTY` 网站上的[更改日志](https://www.chiark.greenend.org.uk/~sgtatham/putty/changes.html)，看看我们是否已经修复了开发快照中的错误。

- 查看 `PuTTY` 网站上的[常见问题解答](https://www.chiark.greenend.org.uk/~sgtatham/putty/faq.html)（也作为手册中的[附录 A](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixA.html#faq) 提供），看看它是否回答了您的问题。

  `FAQ` 列出了人们认为是错误但不是错误的最常见事情。

- 下载最新的开发快照，看看问题是否仍然存在。这确实值得一试。

  作为一般规则，我们对出现在发布版本中但不出现在开发版本中的错误不太感兴趣，因为这通常意味着它们是我们已经*修复*的错误。

  另一方面，如果你能在开发版本中找到一个没有出现在发行版中的错误，那很可能是我们自发布以来引入的新错误，我们肯定对此感兴趣。



如果这些选项都不能解决您的问题，并且您仍然需要向我们报告错误，那么包含一些常规信息会很有用：

- 告诉我们您运行的是哪个版本的 `PuTTY` 。

  要找出答案，请使用“系统”菜单中的“关于 `PuTTY` ”选项。

  *请不要只*告诉我们“我正在运行最新版本”;电子邮件可能会延迟，并且在您发送邮件时哪个版本是最新版本可能并不明显。

- `PuTTY` 是一个多平台应用程序;告诉我们您运行 `PuTTY` 的操作系统版本。

  （如果你在 `Unix` 或 `Windows for Arm` 上运行，请告诉我们，否则我们会假设你运行在 `Windows for Intel` 上，因为这种情况绝大多数是这样。）

- 告诉我们您要连接的协议：`SSH` ，`Telnet` ，`Rlogin` ，`SUPDUP` 或 `Raw` 模式，或串行连接。

- 告诉我们您要连接到哪种类型的服务器;什么操作系统，如果可能的话，什么 `SSH` 服务器（如果你使用的是SSH）。

  您可以从 `PuTTY` 事件日志中获取其中一些信息（请参阅手册中的第 [3.1.3.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/Chapter3.html#using-eventlog)）。

- 将 `PuTTY` 事件日志的内容发送给我们，除非您有特定原因不这样做（例如，如果其中包含您认为我们应该能够在不需要知道的情况下解决您的问题的机密信息）。

- 尝试向我们提供尽可能多的信息，以帮助我们自己看到问题。如果可能，请向我们提供重现故障的*精确*说明的分步顺序。

- 不要只是告诉我们 `PuTTY` “做错了事”;确切地告诉我们它做了什么，也准确地告诉我们你认为它应该做什么。

  有些人告诉我们 `PuTTY` 做错了事，事实证明它正在做正确的事，他们的期望是错误的。

  通过确切地告诉我们您认为它应该做什么以及它确实做了什么来帮助避免这个问题。

- 如果您认为可以，欢迎您尝试自己解决问题。

  修复错误的代码补丁是错误报告的绝佳补充。

  但是，补丁永远不能*替代*好的错误报告;如果您的补丁错误或不合适，并且您没有向我们提供有关实际错误的完整信息，那么我们将无法找到更好的解决方案。

- [`https://www.chiark.greenend.org.uk/~sgtatham/bugs.html`](https://www.chiark.greenend.org.uk/~sgtatham/bugs.html) 是一篇关于如何有效地报告错误的文章。

  如果您的错误报告*特别*不清楚，我们可能会要求您离开，阅读本文，然后再次报告错误。



如果您认为 `PuTTY` 文档中的错误不清楚或没有帮助，那么在 `PuTTY` 文档中报告错误是合理的。

但是，我们确实需要获得您认为文档未能告诉您*的*确切细节，或者您认为*如何*使其更清晰。

如果你的问题只是你不*理解*文档，我们建议发布到新闻组（见[B.1.2节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-other-fora)），看看是否有人会解释你需要知道的内容。

*然后*，如果您认为文档可以有效地告诉您，请向我们发送错误报告并解释您认为我们应该如何更改它。



## B.3 报告安全漏洞

如果您在 `PuTTY` 中发现安全漏洞，您可能希望使用加密的通信渠道通知我们，以避免在固定版本可用之前泄露有关该漏洞的信息。

为此，我们提供了一个适合加密的 `GPG` 密钥：安全联系人密钥。有关这方面的详细信息，请参见[第 F.1 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixF.html#pgpkeys-pubkey)。

（当然，漏洞也是错误，所以请尽可能多地包含有关它们的信息，就像处理任何其他错误报告一样。）



## B.4 请求额外功能

如果您想在 `PuTTY` 中请求新功能，您应该做的第一件事是：

- 查看 `PuTTY` 网站上的[“愿望清单”页面](https://www.chiark.greenend.org.uk/~sgtatham/putty/wishlist/)，看看您的功能是否已在列表中。如果是这样，重复请求可能不会取得太大成就。（但如果您想说服我们为您的特定功能提供更高的优先级，请参阅[第 B.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-feature-priority)。
- 查看 `PuTTY` 网站上的心愿清单和[更改日志](https://www.chiark.greenend.org.uk/~sgtatham/putty/changes.html)，看看我们是否已在开发快照中添加了您的功能。如果不清楚，请下载最新的开发快照，看看该功能是否存在。如果是，那么它也将在下一个版本中，根本不需要给我们发邮件。

如果在开发快照*或*愿望清单中找不到您的功能，则可能需要提交功能请求。由于 PuTTY 作者非常忙，如果您尝试为我们做一些工作会有所帮助：

- 尽可能多地进行设计。想想“极端情况”;考虑您的要素如何与其他现有要素进行交互。考虑用户界面;如果您不能为您的功能提供一个简单直观的界面，那么如果我们也不能，您也不应该感到惊讶。总是想象一下，是否有可能有多个或少于一个，你认为会有一个。（例如，如果您希望 PuTTY 在系统托盘而不是任务栏中放置一个图标，您应该考虑如果有多个 PuTTY 处于活动状态会发生什么;用户如何分辨哪个是哪个？）
- 如果您可以编程，那么可能值得自己编写该功能并向我们发送补丁。但是，如果您先与我们协商，可能会有所帮助;可能存在您没有想到的设计问题，或者我们可能即将对您的补丁可能与之冲突的代码进行重大更改，或者其他什么。如果你先与维护者核实，你的代码实际上更有可能被使用。另外，请阅读[附录 E](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixE.html#udp) 中列出的设计原则：如果您不符合这些原则，我们可能无法接受您的补丁。



## B.5 已请求的功能特性

如果某个功能已经列在愿望清单上，那么这通常意味着我们希望在某个时候将其添加到 `PuTTY` 中。

但是，这可能不是在不久的将来。

如果您希望*在不久的将来*看到愿望清单上的某项功能，您可以采取以下措施来尝试提高其优先级：

- 给我们发邮件并投票支持它。

  （请务必提及您已在愿望清单上看到过它，否则我们可能认为您甚至没有*阅读*过愿望清单）。

  这可能不会产生*太大*影响;如果很多人投票支持某件事，那么这可能会有所作为，但对特定功能的额外一两票不太可能立即改变我们的优先级列表。

  提供一个新的和令人信服的理由可能会有所帮助。

  另外，不要指望得到答复。

- 如果我们早点做这项工作，就给我们钱。这有时有效，但并非总是如此。

  `PuTTY` 团队都有全职工作，我们在空闲时间做所有这些工作;我们有时可能愿意放弃更多的空闲时间来换取一些钱，但如果你试图贿赂我们以获得一个*重要的*功能，我们完全有可能根本没有时间腾出时间——无论你是否付钱给我们。 

  （此外，我们不接受贿赂将*不良*功能添加到愿望清单， 因为我们为用户提供高质量软件的愿望是第一位的。）

- 主动帮助我们编写代码。

  这可能是快速实现功能*的唯一*方法，如果它是一个我们没有时间自己做的大功能。



## B.6 支持请求

如果您试图让 `PuTTY` 为您做某事并且它不起作用，但您不确定它是否是一个错误，那么*请考虑*在其他地方寻求帮助。

这是 `PuTTY` 团队收到的最常见的邮件类型之一，我们根本没有时间回答所有问题。

此类问题包括：

- 如果你想用 `PuTTY` 做一些事情，但不知道从哪里开始，并且阅读手册没有帮助，请尝试发布到新闻组（见 [B.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-other-fora)），看看是否有人可以向你解释。

- 如果您尝试使用 `PuTTY` 做某事但没有奏效，并且您不确定这是 `PuTTY` 中的错误还是 `SSH` 服务器中的错误，或者只是您做得不正确，请尝试发布到新闻组（请参阅[第 B.1.2 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixB.html#feedback-other-fora)），看看是否有人可以解决您的问题。

  或者尝试使用不同的 `SSH` 客户端做同样的事情，看看它是否适用于它。

  请不要将其报告为 `PuTTY` 错误，除非您真的*确定它是* `PuTTY` 中的错误。

- 如果其他人为您安装了 `PuTTY` ，或者您在其他人的计算机上使用 `PuTTY` ，请先尝试向他们寻求帮助。

  他们比我们更有可能了解他们是如何安装它的，以及他们希望你使用它的目的。

- 如果您已成功连接到服务器，现在需要知道在服务器的命令提示符下键入的内容，或者有关如何使用服务器端软件的其他详细信息，请与服务器的系统管理员联系。

  这不是 `PuTTY` 团队的问题。`PuTTY` 只是一个通信工具，就像电话一样;如果你不能和电话另一端的人说同一种语言，那么电话公司的工作就不是教你。



如果您绝对无法以其他方式回答支持问题，您可以尝试将其邮寄给我们，但我们不能保证有时间回答它。



## B.7 网络服务器管理

如果 `PuTTY` 网站已关闭（连接超时），请不要费心给我们发邮件告诉我们。

我们大多数人在托管网站的同一台机器上阅读我们的电子邮件，所以如果这些机器关闭了，那么我们会在阅读电子邮件*之前*注意到。

因此，没有必要告诉我们我们的服务器已关闭。



当然，如果网站有其他错误（连接被拒绝，`404` 未找到，`403` 禁止访问或其他错误），那么我们可能*没有*注意到，可能仍然值得告诉我们。



如果您想报告我们网站的问题，请检查您正在查看我们*真实的*网站而不是镜像。

真正的网站在 [`https://www.chiark.greenend.org.uk/~sgtatham/putty/`](https://www.chiark.greenend.org.uk/~sgtatham/putty/);如果这不是您正在阅读本文的地方，那么在您检查出它确实是主站点的问题之前，请不要向我们报告问题。

如果只是镜像问题，您应该先尝试联系该镜像站点的管理员，并且仅在不能解决问题时才与我们联系（以防我们需要从列表中删除镜像）。



## B.8 请求许可

`PuTTY` 根据 `MIT` 许可证分发（详见[附录D](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixD.html#licence)）。这意味着您可以使用我们的软件、源代码和文档做*您喜欢的任何事情*。

您唯一不能做的事情是删除我们的版权声明或许可文本本身，或者在出现问题时追究我们的法律责任。



因此，如果您希望将 `PuTTY` 包含在杂志封面磁盘上，或者作为 `CD` 或网站上有用软件集合的一部分，则*权限已经授予*。

您不必给我们发邮件并询问。继续做吧。我们不介意。



（如果您想将 `PuTTY` 与您自己的应用程序一起分发以用于该应用程序，或者如果您想在您自己的组织内分发 `PuTTY` ，那么我们建议您提供自己的一线技术支持，以回答有关 `PuTTY` 与您的环境交互的问题。如果您的用户直接向我们发送邮件，我们将无法告诉他们有关您的特定设置的任何有用信息。）



如果您想在另一个程序中使用部分 `PuTTY` 源代码，那么可能值得给我们发邮件讨论技术细节，但如果您只想征求许可，那么您不需要打扰。您已经拥有权限。

如果您只想链接到我们的网站，请继续。

（目前还不清楚我们*是否可以*阻止你这样做，即使我们想这样做！）



## B.9 镜像 `PuTTY` 网站

如果您想设置 `PuTTY` 网站的镜像，请继续设置一个。

在设置镜像之前，请不要费心征求我们的许可。您已经拥有权限。



如果镜像位于我们还没有大量镜像的国家/地区，我们可能愿意将其添加到[镜像页面上](https://www.chiark.greenend.org.uk/~sgtatham/putty/mirrors.html)的列表中。

阅读该页面上的指南，确保您的镜像正常工作，并将页面底部列出的信息通过电子邮件发送给我们。



请注意，我们不*承诺*列出您的镜像：我们收到很多镜像通知，而您的镜像可能不会碰巧找到列表顶部的方式。

另请注意，我们使用属性 `rel="nofollow"` 链接到所有镜像站点。

运行 `PuTTY` 镜像并不是获得搜索排名的廉价方式。



如果您对镜像过程有技术问题，那么您可能需要在设置镜像之前给我们发邮件（另请参阅[镜像页面上的指南](https://www.chiark.greenend.org.uk/~sgtatham/putty/mirrors.html#guidelines)）;但如果你只是想请求许可，你不需要。您已经拥有权限。



## B.10 赞美

维护自由软件最有价值的事情之一就是收到只是说“谢谢”的电子邮件。

我们总是很高兴收到这种类型的电子邮件。

遗憾的是，我们没有时间亲自回答这些问题。

如果您向我们发送赞美邮件但没有收到回复，*请不要*认为我们忽略了您。

我们确实收到了它，我们对此感到高兴;我们只是没有时间亲自告诉你。

对于过去和未来向我们表示赞美的每个人：*不客气*！



## B.11 电子邮件地址

要邮寄的实际地址是 ` <putty@projects.tartarus.org> ` 。







# 附录C：`PPK` 文件格式

本附录记录了 `PuTTY` 用于存储私钥的文件格式。

在本附录中，二进制数据结构使用 `SSH` 协议标准本身中使用的数据类型表示形式（如“`uint32`”，“`string`”和“`mpint`”）进行描述。

这些由 [RFC 4251 第 5 节](https://www.rfc-editor.org/rfc/rfc4251#section-5)“ `SSH` 协议中使用的数据类型表示形式”权威定义。



## C.1 概述

`PPK` 文件存储私钥和相应的公钥。两者都包含在同一个文件中。



文件格式可以完全未加密，也可以加密私钥。

在这两种情况下，*公钥*都以明文形式存储。

（这使 PuTTY 能够将公钥发送到 SSH 服务器以查看它是否会接受它，并且除非服务器说是，否则不会费心提示输入密码。）



加密密钥文件时，加密密钥派生自密码。

加密的 `PPK` 文件也使用 `MAC`（身份验证代码）进行防篡改，`MAC` 也来自相同的密码。

`MAC` 保护加密的私钥数据，但它也涵盖文件的明文部分。

因此，您无法在不使 MAC 无效并导致整个密钥文件变得无用的情况下编辑密钥的公共一半。



此 `MAC` 保护密钥文件免受主动加密攻击，其中密钥对的公共部分以受控方式修改，允许攻击者从生成的损坏签名中推断出有关私有部分的信息。

任何对 `PPK` 文件执行此操作的尝试都应被无法验证的 `MAC` 可靠地捕获。



（仅当密钥文件存储在攻击者可以修改它的位置，而无需完全访问您键入密码的进程时，此类攻击才有用。

但这并非不可能;例如，如果主目录位于网络文件服务器上，则文件服务器的管理员可以访问密钥文件，但不能访问客户端计算机上的进程。）



`MAC` 还涵盖了对密钥的*注释*。

这可以阻止攻击者相互交换密钥并编辑注释以掩盖事实。

因此，`PuTTYgen` 无法编辑密钥上的注释，除非您先使用密码解密密钥。



（*这种*攻击有用的情况甚至更加有限。

例如，不同的密钥可能会触发您连接到的服务器上的特定操作，其中一个操作对攻击者比另一个操作更有用。

但是一旦你有一个 `MAC` ，就不需要额外的努力让它尽可能多地覆盖，而且通常是明智的。）



## C.2 外层

`PPK` 文件的外层是基于文本的。

`PuTTY` 工具在写入 `PPK` 文件时将始终使用 `LF` 线路终止，但在输入时将容忍 `CR+LF` 和仅 `CR` 。



前几行将其标识为 `PPK` ，并提供有关其中存储的内容和方式的一些初始数据。

它们看起来像这样：

```
PuTTY-User-Key-File-version: algorithm-name
Encryption: encryption-type
Comment: key-comment-string
```



**version**是一个十进制数字，提供文件格式本身的版本号。当前文件格式版本为 `3` 。

**algorithm-name**是使用此密钥的公钥算法（例如 `ssh-dss` 或 `ecdsa-sha2-nistp384` ）的 SSH 协议标识符。

**encryption-type**指示此密钥是否以加密方式存储，如果是，则通过什么方法存储。目前唯一支持的加密类型是 `aes256-cbc` 和 `none` 。

**key-comment-string**是提供注释的自由文本字段。这可以包含除 `13` 和 `10`（CR 和 LF）以外的任何字节值。



文件的下一部分提供公钥。

这是未加密仅 `base64` 编码的 （[RFC 4648](https://www.rfc-editor.org/rfc/rfc4648)） 存储的，前面有一个标题行，说明显示了多少行 `base64` 数据，如下所示：

```
Public-Lines: number-of-lines
that many lines of base64 data
```



此 `blob` 中 `base64` 编码数据的格式设置方式与通过 `SSH` 协议本身中的线路发送的 `SSH` 公钥完全相同。

这也与存储在 `OpenSSH` 文件 `authorized_keys` 中的 `base64` 数据相同，只是在 `PPK` 文件中，`base64` 数据被拆分为多行。

但是，如果从本节中间删除换行符，则生成的 `base64` `blob` 格式正确，可以在 `authorized_keys` 中排在一行。



如果密钥是加密的（即加密类型不是 `none` ），那么接下来出现的是一系列行，指定如何从密码派生用于**加密**文件的密钥：

```
Key-Derivation: argon2-flavour
Argon2-Memory: decimal-integer
Argon2-Passes: decimal-integer
Argon2-Parallelism: decimal-integer
Argon2-Salt: hex-string
```



**Argon2-flavor**是标识符 `Argon2d` ，`Argon2i` 或 `Argon2id` 之一，它们都描述了 `Argon2` 密码散列函数的变体。



这三个整数值用作 `Argon2` 的参数，它允许您配置使用的内存量（以 `KB` 为单位）、要运行的算法的传递次数（以调整其运行时间）以及哈希函数所需的并行度。

盐被解码为二进制字节序列，并用作 `Argon2` 的附加输入。（它是在写入密钥文件时随机选择的，因此无法对多个密钥文件并行安装猜测攻击。）



文件的下一部分提供私钥。这是以相同的方式进行 `base64` 编码的：

```
Private-Lines: number-of-lines
that many lines of base64 data
```



此 `base64` `blob` 中表示的二进制数据可能会加密，具体取决于上面显示的密钥文件标头中的*加密类型*字段：

- 如果**加密类型**为 `none` ，则此数据以纯文本形式存储。

- 如果**加密类型**为 `aes256-cbc` ，则在 `CBC` 密码模式下使用 `AES` 加密此数据，密钥长度为 `256` 位。密钥和初始化向量派生自密码短语：请参阅[第 C.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixC.html#ppk-keys)。

  为了使用 `AES` 加密私钥数据，它必须是 `16` 字节的倍数（ `AES` 密码块长度）。

  这是通过在加密数据之前向数据追加随机填充来实现的。

  解密后解码时，可以忽略随机数据：数据的内部结构足以告诉您何时到达有意义部分的末尾。

与公钥不同，`SSH` 标准中根本没有指定私钥的二进制编码。

有关 `PuTTY` 支持的每种密钥类型的私钥格式的详细信息，请参见第 [C.3 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixC.html#ppk-privkeys)。



密钥文件中的最后一件事是 `MAC` ：

```
Private-MAC: hex-mac-data
```



**hex-mac-data** 是一个十六进制编码值，长度为 `64` 位（即 `32` 字节），使用 `HMAC-SHA-256` 算法生成，输入以下二进制数据：

- `string`：**算法名称**标头字段。

- `string`：**加密类型的**标头字段。

- `string`：**键注释字符串**标头字段。

- `string`：二进制公钥数据，从 `Public-Lines` 标头后的 `base64` 行解码。

- `string`：二进制私钥数据的明文，从 `Private-Lines`标头后的 `base64` 行解码。

  如果该数据是加密存储的，则在此 `MAC` 原像中使用其解密版本，*包括*上面提到的随机填充。

`MAC` 密钥派生自密码：请参阅[第 C.4 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixC.html#ppk-keys)。



## C.3 私钥编码

本节介绍 `PuTTY` 支持的每种密钥类型的私钥格式。

由于 `PPK` 格式还包含公钥（并且公钥和私钥都受同一 `MAC` 保护，以确保它们不会不一致），因此文件的私钥部分无需重复公钥部分中的数据。所以其中一些格式非常短。

在所有情况下，解码应用程序都可以从解密私钥数据的开头开始读取，并知道何时读取了所需的所有内容。这允许安全地忽略有意义数据之后的随机填充。



### C.3.1 `RSA`

`RSA` 密钥使用 `ssh-rsa` 的**algorithm-name**进行存储。（像这样存储的密钥也由使用 `SHA-1` 以外的哈希的更新的 `RSA` 签名方案使用。）

公钥数据已经提供了密钥模数和公共编码指数。

私有数据存储：

- `mpint`：密钥的私有解码指数。
- `mpint`：键的一个质因数 *`P`*。
- `mpint`：键的另一个质因数 *`Q`*。（以这种格式存储的 `RSA` 密钥应具有两个质因数。
- `mpint`：*`Q`* 模 `p` 的乘法*逆运算。*



### C.3.2 `DSA`

`DSA` 密钥使用 `ssh-dss 的**algorithm-name**进行存储。

公钥数据已经提供了关键参数（大素数 *`p`*、小素数  *`q`* 和组生成器 *`g`*）和公钥 *`y`*。

私钥存储：

- `mpint`：私钥 *`x`*，它是 *g* mod *p* 生成的组中 *`y`* 的离散对数。



### C.3.3 `NIST` 椭圆曲线键

`NIST` 椭圆曲线密钥使用以下**算法名称**值之一进行存储，每个值对应于不同的椭圆曲线和密钥大小：

- `ecdsa-sha2-nistp256`
- `ecdsa-sha2-nistp384`
- `ecdsa-sha2-nistp521`



公钥数据已经提供了公共椭圆曲线点。

私钥存储：

- `mpint`：私有指数，它是公共点的离散对数。



### C.3.4 `EdDSA` 椭圆曲线键（ `Ed25519` 和 `Ed448` ）

`EdDSA` 椭圆曲线密钥使用以下**算法名称**值之一进行存储，每个值对应于不同的椭圆曲线和密钥大小：

- ssh-ed25519`
- `ssh-ed448`



公钥数据已经提供了公共椭圆曲线点。

私钥存储：

- `mpint`：私有指数，它是公共点的离散对数。



## C.4 密钥派生

加密密钥文件时，需要从密码短语计算三段密钥材料：

- 用于加密私钥的对称密码的密钥
- 该密码加密的初始化向量
- `MAC` 的密钥。



如果**加密类型**为 `aes256-cbc` ，则对称密码密钥的长度为 32 字节，初始化向量为 16 字节（一个密码块）。MAC 密钥的长度也选择 32 字节。

如果**加密类型**为 `none`，则所有这三条数据的长度均为零。（MAC 仍以密钥文件格式生成和检查，但它的密钥长度为零。

如果所需的密钥材料数量不为零，则密码短语将馈送到 Argon2 密钥派生函数，无论采用密钥文件中 '' 标头中描述的任何模式，参数派生自各种“*参数*”标头。`Key-Derivation``Argon2-``:`

（如果密钥未加密，则省略所有这些标头，并且根本不运行Argon2。



除了密码和盐之外，`Argon2` 还需要两个额外的字符串输入：一个密钥和一些“关联数据”。

在 `PPK` 使用 `Argon2` 时，它们都设置为空字符串。



`Argon2` 的“标签长度”参数（即要求输出的数据量）设置为所有所需数据项的长度之和，即（密码密钥长度 + `IV` 长度 + `MAC` 密钥长度）。

输出数据被解释为密码密钥、`IV` 和 `MAC` 密钥按该顺序串联。

因此，对于 `aes256-cbc` ，标签长度将为 `32+16+32 = 80` 字节;在 `80` 字节的输出数据中，前 `32` 个字节用作 `256` 位 `AES` 密钥，接下来的 `16` 个字节用作 `CBC IV` ，最后 `32` 个字节用作 `HMAC-SHA-256` 密钥。



## C.5 旧版本的 `PPK` 格式

### C.5.1 版本 `2`

`PPK` 版本 `2` 由  `0.52` 到 `0.74`（含）版本的 `PuTTY` 使用。

在 `PPK` 版本 `2` 中，使用的 `MAC` 算法是 `HMAC-SHA-1`（因此行 `Private-MAC` 仅包含 `40` 个十六进制数字）。



`Key-Derivation:` 标头和所有 `Argon2-Parameter` 标头都不存在。

用于加密专用 `blob` 的密钥材料不是使用 `Argon2` ，而是以完全不同的方式从密码派生，如下所示。

`aes256-cbc` 的密码密钥是通过生成两个 `SHA-1` 哈希、连接它们并获取结果的前 `32` 个字节来构造的。（因此，您将获得第一个哈希输出的所有 `20` 个字节，以及第二个哈希输出的前 `12` 个字节）。

每个哈希原像如下：

- `uint32`：序列号。第一个哈希值为 `0` ，第二个哈希值为 `1` 。（这个想法是通过继续增加序列号来将此机制扩展到进一步的哈希，如果将来的更改需要更长的密钥。
- 密码短语，不带任何前缀长度字段。



在 `PPK v2` 中，`CBC` 初始化向量全为零。

`MAC` 密钥长度为 `20` 字节，是以下数据的单个 `SHA-1` 哈希：

- 固定字符串 `putty-private-key-file-mac-key` ，没有任何前缀长度字段。
- 密码短语，不带任何前缀长度字段。（如果密钥以未加密的方式存储，则出于这些目的，密码短语被视为空字符串。



### C.5.2 版本 `1`

`PPK` 版本 `1` 是一种设计不佳的格式，仅在初始开发期间使用，不建议用于生产。

`PPK` 版本 `1` 从未被 `PuTTY` 的已发布版本使用过。

它仅由版本 `0.51`（根本不支持 `SSH-2` 公钥）和 `0.52`（已使用此文件格式的版本 `2` ）之间的一些早期开发快照发出。

*我希望*任何地方都没有使用 `PPK v1` 文件。但以防万一，无论如何，这里都记录了旧的设计不佳的格式。



在 `PPK` 版本 `1` 中，`MAC` 的输入不包含任何标头字段或公钥。

它只是私钥数据（仍然是明文形式，包括随机填充），全部单独（没有包装 `string` ）。



因此，`PPK` 版本 `1` 密钥必须在加载后进行严格验证，以确保密钥的公共部分和私有部分彼此一致。

`PPK` 版本 `1` 仅支持 `RSA` 和 `DSA` 密钥类型。

对于 `RSA` ，可以仅使用提供的数据完成此验证（因为私钥 `blob` 包含足够的信息来重新构造公共值）。

但对于 `DSA` 来说，这还不够。

因此，`PPK` 版本 `1` `DSA` 密钥扩展了私有数据，以便在 *x* 之后立即存储一个额外的值：

- `string`：公钥数据的 `SHA-1` 散列，其原映像包括
  - `string`：大素数 *P*
  - `string`：小素数 *Q*
  - `string`：组生成器 *G*



这个想法是，检查此哈希将验证关键参数是否未被篡改，然后加载应用程序可以直接验证 *`g^x = y`*。

在*未加密*的版本 `1` 密钥文件中，`MAC` 将替换为私钥数据的纯 `SHA-1` 哈希。

这由 `Private-MAC:` 替换为 `Private-Hash:` 的标题来表示。





# 附录 D：`PUTTY` 许可证

`PuTTY` 版权所有 `1997-2022` 西蒙·塔瑟姆。

部分版权归罗伯特·德·巴斯、乔里斯·范·兰特韦克、德利安·德尔切夫、安德烈亚斯·舒尔茨、杰罗恩·马萨尔、韦兹·弗隆、尼古拉斯·巴里、贾斯汀·布拉德福德、本·哈里斯、马尔科姆·史密斯、艾哈迈德·哈利法、马库斯·库恩、科林·沃森、克里斯托弗·斯泰特、洛伦兹·迪纳、克里斯蒂安·布拉班特、杰夫·史密斯、帕维尔·克留科夫、马克西姆·库兹涅佐夫、斯维亚托斯拉夫·库兹米奇、尼科·威廉姆斯、维克多·杜霍夫尼、乔什·德施、拉尔斯·布林霍夫和 `CORE SDI S.A.` 版权。

特此免费授予获得本软件和相关文档文件（“软件”）副本的任何人不受限制地处理本软件的权利，包括但不限于使用、复制、修改、合并、发布、分发、再许可和/或销售本软件副本的权利，并允许向其提供本软件的人这样做， 须符合以下条件：

上述版权声明和本许可声明应包含在软件的所有副本或大部分内容中。

本软件按“原样”提供，不提供任何明示或暗示的保证，包括但不限于对适销性、特定用途适用性和不侵权的保证。在任何情况下，版权所有者均不对因本软件或本软件的使用或其他交易而引起、由本软件或本软件的使用或其他交易引起的、由合同、侵权或其他行为引起的任何索赔、损害赔偿或其他责任负责。



# 附录E：`PuTTY` 黑客指南

本附录列出了适用于 `PuTTY` 源代码的设计原则。

如果您打算发送代码贡献，则应先阅读此内容。



## E.1 跨操作系统可移植性

尽管Windows是其主要名气领域，但PuTTY不再是Windows专用的应用程序套件。它有一个工作的Unix端口;Mac 端口正在进行中;以后可能会也可能不会发生更多端口。

因此，在核心模块（如 ）中嵌入特定于 Windows 的代码是不可接受的。我们竭尽全力从我们的核心模块*中删除*所有特定于Windows的内容，并将其转移到特定于Windows的模块中。在应该可移植的代码部分中添加大量特定于Windows的内容几乎可以保证使我们拒绝贡献。`ssh.c`

PuTTY 源库分为特定于平台的模块和平台通用模块。特定于 Unix 的模块都在子目录中;特定于 Windows 的模块位于子目录中。`unix``windows`

主源目录和其他子目录中的所有模块 *- 特别是各种*后端的所有代码 - 都是平台通用的。我们希望保持这种状态。

这也意味着你应该坚持 C 标准保证的 C 语义：尽量不要对基本类型（如 and）的精确大小做出假设;不要使用指针强制转换来执行与字节序相关的操作，等等。`int``long int`

（即使在平台前端*中*，您仍然应该注意其中一些可移植性问题。Windows 前端可在 32 位和 64 位 x86 以及 Arm 上编译。

我们目前选择的C标准版本*主要是*C99。除了几个例外，您可以假定 C99 功能可用（特别是 和 ），但不应使用 C11 中的新功能（例如 或 ）。`````inline````_Generic`

该规则的例外是由于需要Visual Studio兼容性：

- 不要使用可变长度数组。Visual Studio不支持它们，即使现在它已经采用了C99的其余部分。我们在使用 gcc 和 clang 构建时使用，以便更容易避免意外违反该规则。`-Wvla`
- 由于历史原因，我们仍然使用一个缺少 .因此，该文件集中包含在 中，并且为我们使用的 -type 宏提供了一组解决方法定义。如果需要使用其中的另一个宏，则需要在 中添加解决方法定义，并且不要随便重新包含源文件中的任何其他位置。```defs.h``PRIx64``defs.h```

以下是我们目前允许的一些可移植性假设（因为如果需要更改现有代码，我们已经必须彻底审查现有代码，*除非我们真的*必须这样做，否则似乎不值得这样做）：

- 您可以*假设至少* 32 位宽。（我们从未尝试过将 PuTTY 移植到 16 位平台，将来看起来也没有必要。`int``int`
- 同样，您可以假设正好是 8 位。（例外情况甚至比简短更不可能与我们相关。`char``int`
- 您可以假设，使用在整个结构上写入零字节将具有将其所有指针字段设置为 的效果。（标准本身保证了*整型*字段的这一点，但不能保证指针。`memset``NULL`
- 您可以假设它具有 POSIX 语义，即它表示自 1970-01-01 00：00：00 UTC 以来的非闰秒整数。（这种格式的时间用于X授权，但我们可以通过仔细区分本地值和线路协议中使用的时间值来解决这个问题;但是这些语义也被烘焙到GSSAPI身份验证代码使用的共享库API中，这将更难更改。`time_t``time_t``time_t`
- 您可以假定执行字符编码是 ASCII 的可打印字符的超集。（特别是，可以对表示拉丁字母字符的值进行算术运算，而无需费心允许EBCDIC或其他非连续的字母编码。`char`

另一方面，这里有一些*特殊的事情不要*假设：

- 不要对 的*符号性*做出任何假设。特别是，在将值传递给任何函数之前，*必须*将值强制转换为 （因为这些函数需要非负字符值或 ）。如果需要特定的符号，请显式指定 或 ，或使用 C99 或 。`char``char``unsigned char````EOF``signed char``unsigned char``int8_t``uint8_t`
- 根据过去使用MacOS的经验，我们仍然对给定平台上可能具有不寻常的含义感到有些紧张。因此，在您要传递给的字符串中说是可以的，但是在这些字符以标准化线路协议或二进制文件格式出现的任何上下文中，它们应该分别拼写。`'\n'``'\r'``\n``printf``'\012'``'\015'`

## E.2 多个后端同等对待

PuTTY不是一个SSH客户端，旁边还有一些其他的东西。PuTTY 是一个通用的、多后端的、远程的 VT 终端客户端，它恰好支持一个比其他后端更大、更受欢迎、更有用的后端。任何可能在所有后端通用的额外功能都应该如此：将功能不必要地本地化到 SSH 后端是一个设计错误。（例如，我们有几个代码提交用于代理支持，这些代码通过黑客攻击工作。显然这是完全错误的：抽象是放置它的地方，这样它就可以平等地应用于所有后端，事实上，在另一个贡献者发送了一个更好的补丁后，我们最终把它放在那里。`ssh.c``network.h`

如果可能的话，PuTTY 的其余部分应该尽量避免了解特定后端的任何信息。例如，为了支持仅在一个网络协议中可用的功能，后端接口应以一般方式扩展，以便能够提供该功能*的任何*后端都可以这样做。如果碰巧只有一个后端实际这样做，那就是它的方式，但任何代码都不应该依赖它。

## E.3 某些平台上每个进程多个会话

PuTTY 的某些端口（尤其是正在进行的 Mac 端口）受到操作系统的限制，只能作为单个进程运行，从而可能管理多个会话。

因此，PuTTY 与平台无关的部分从不使用全局变量来存储每个会话的数据。可以容忍确实存在的全局变量，因为它们不特定于特定的登录会话。中的随机数状态、计时器列表和顶级回调队列平等地为所有会话提供服务。但大多数数据特定于特定的网络会话，因此存储在动态分配的数据结构中，并且指向这些结构的指针在函数之间传递。`sshrand.c``timing.c``callback.c`

特定于平台的代码可以根据需要撤消此决定。由于历史原因，Windows 代码将其大部分数据存储为全局变量。没关系，因为在*Windows上*我们知道每个PuTTY进程只有一个会话，所以这样做是安全的。但是，对独立于平台的代码的更改应避免引入全局变量，除非它们确实是跨会话的。

## E.4 C，不是C++

PuTTY完全用C语言编写，而不是用C++编写。

我们已经做了*一些*努力，以便使用C++编译器轻松编译代码：值得注意的是，我们的 和宏显式地将 和 的返回值强制转换为目标类型。（即使在 C 语言中，这也具有类型检查的优点：这意味着您永远不会意外地为要分配给它的指针类型分配错误大小的内存。C++友好确实是一个附带的好处。`snew``snewn``sresize``malloc``realloc`

我们希望 PuTTY 继续是纯 C，至少在独立于平台的部分和当前存在的端口中。切换 Makefile 以将其编译为C++并开始使用类的补丁将不被接受。

唯一的例外：如果有必要在新平台上编码，则移植到新平台可以使用 C 以外的语言。如果您最喜欢的 PDA 具有带有C++ API 的 GUI，那么您不可能在不使用 C++的情况下进行 PuTTY 移植，因此请继续使用它。但将C++限制在该平台的子目录中;如果您的更改强制将 Unix 或 Windows 端口编译为C++，我们将无法接受它们。

## E.5 安全意识编码

PuTTY是一个网络应用程序，也是一个安全应用程序。假设您的代码最终会被攻击者故意提供恶意数据，并尝试以不太可能构成安全风险的方式进行编码。

特别是，尽量不要对可变大小的数据（例如从网络（甚至用户）接收的字符串）使用固定大小的缓冲区。我们提供了诸如 和 之类的函数，这些函数可以为它们构造的字符串动态分配正确大小的缓冲区。尽可能使用这些。`dupcat``dupprintf`

## E.6 特定编译器的独立性

Windows PuTTY目前可以使用三种Windows编译器中的任何一个进行编译：MS Visual C，Cygwin / GNU工具和（在MS兼容模式下）。`mingw32``clang`

这是 PuTTY 的一个非常有用的属性，因为这意味着想要为编码做出贡献的人不依赖于拥有特定的编译器;因此，如果他们还没有MSVC，他们不必为MSVC掏钱，但另一方面，如果他们*确实*拥有它，他们也不必花费精力与它一起安装。他们可以使用他们碰巧可用的任何编译器，或者如果他们没有编译器，则可以安装最便宜和最简单的编译器。`gcc`

因此，我们不希望 PuTTY 根据您使用的编译器启动。例如，使用 C 语言的 GNU 扩展会破坏这个有用的属性（并不是说有人尝试过它！更现实地说，依赖于 MSVC C 库提供的特定于 MS 的库函数（例如）是一个错误，因为该函数在其他编译器下不可用。作为Windows API的一部分，官方Windows DLL中提供的任何函数都可以，C库标准中定义的任何函数也可以，因为无论编译环境如何，这些函数都应该可用。但是介于两者之间的东西，仅在一个编译器中作为非标准库和语言扩展提供，是不允许的。`_snprintf`

(`_snprintf`特别是应该是不必要的，因为我们提供;请参阅[第 E.5 节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixE.html#udp-security)。`dupprintf`

编译器独立性应该适用于所有平台，当然，而不仅仅是Windows。

## E.7 代码小

与许多其他Windows应用程序相比，PuTTY很小。而且它易于安装：它不依赖于DLL，不依赖于其他应用程序，不依赖于服务包或系统升级。它只是一个可执行文件。您可以将该可执行文件安装在您想要的任何位置，然后运行它。

如果可能的话，我们希望保留这两个特性 - 小尺寸和易于安装。因此，严重依赖外部 DLL 的代码贡献，或者为仅对少数用户有用的功能增加大量代码大小的代码贡献可能会立即被丢弃。

我们确实模糊地打算为 PuTTY 引入一个 DLL 插件接口，从而可以在插件模块中实现非常大的额外功能。不过，重要的是这些 DLL 将是*可选的*;如果 PuTTY 在启动时找不到它们，它应该运行得非常愉快，只是不会提供这些特定功能。有一天，PuTTY 的完整安装可能包含十个或二十个小 DLL 插件，这会降低安装的便利性 - 但如果你真的需要易于安装*，你仍然可以*只安装一个 PuTTY 二进制文件，或者只是你真正需要的 DLL，它仍然可以正常工作。

如果可能的话，我们希望避免依赖*外部* DLL（尽管出于某些目的，例如复杂的 SSH 身份验证机制，这可能是不可避免的）。如果无法避免，重要的是遵循相同的优雅降级原则：如果找不到 DLL，那么 PuTTY 应该快乐运行，而不是提供依赖于它的功能。

## E.8 单线程代码

PuTTY及其支持工具，或者至少绝大多数，只在一个操作系统线程中运行。

这意味着，如果您正在设计一些内部机制，则无需使用锁来确保它不会同时被两个线程调用。可以重入调用代码的唯一方法是递归。

也就是说，大多数 Windows PuTTY 的网络处理都是由 请求的 Windows 消息触发的，因此，如果您在某些网络事件处理代码中深入调用，您应该知道，如果网络事件进入并通过消息循环传递到我们的窗口过程，您可能会重新输入。`WSAAsyncSelect()``MessageBox()``MessageBox()`

此外，前端可以根据需要使用多个线程。例如，Windows 前端代码生成子线程以处理非网络流（如 Windows 管道）上的双向阻塞 I/O。但是，它严格控制其辅助线程，并且仅将它们用于该目的，作为 的一种形式。几乎所有外部代码*都只*从一个主线程调用;其他人只是在文件句柄上循环阻塞，并在需要执行某些实际工作时向主线程发出信号（通过 Windows 事件对象）。这不被视为可移植性危险，因为该代码已经特定于 Windows，需要在其他平台上重写。`select()``windows/handle-io.c`

这样做的一个重要结果是：PuTTY只有一个线程可以做所有事情。“一切”可能包括管理多个登录会话（[E.3节](https://the.earth.li/~sgtatham/putty/0.78/htmldoc/AppendixE.html#udp-globals)），管理SSH会话中的多个数据通道，即使网络上没有发生任何事情也响应GUI事件，以及响应来自服务器的网络请求（例如重复密钥交换），即使程序正在处理复杂的用户交互，例如重新配置对话框。这意味着*几乎没有*一个 PuTTY 代码可以安全地阻止。

## E.9 尽可能发送到服务器的击键

在几乎所有情况下，PuTTY 都会向服务器发送击键。甚至是您认为应该是控制 PuTTY 的热键的奇怪击键。例如，甚至是Alt-F4或Alt-Space。如果击键具有明确定义的转义序列，它可以有效地发送到服务器，那么它应该这样做，或者至少它应该能够配置地这样做。

无条件地将组合键转换为热键来控制PuTTY几乎总是设计错误。如果确实需要热键，请尝试为它找到现有 PuTTY 中*尚未*使用的键组合（要么它不向服务器发送任何内容，要么发送与其他组合相同的内容）。即便如此，也要为有一天可能需要该组合键向服务器发送某些内容的可能性做好准备 - 因此请确保有另一种方法来调用它控制的任何 PuTTY 功能。

## E.10 640×480 配置面板的友好性

我们有很多小的配置面板而不是几个巨大的配置面板是有原因的，这个原因是不是每个人都有 1600×1200 桌面。640×480 仍然是运行 Windows 的可行分辨率（事实上，如果您以安全模式启动，它仍然是默认设置），因此它仍然是我们关心的解决方案。

因此，PuTTY 配置盒和 PuTTYgen 控制窗口故意保持足够小，以舒适地安装在 640×480 显示器上。如果要向这些框中的任何一个添加控件，并且发现自己想要增加整个框*的大小，请不要*这样做。改为将其拆分为更多面板。

## E.11 协议代码中的协程

实现线路协议（主要是SSH）的模块中的大部分代码都是使用一组宏构建的，这些宏在C中实现（接近）Donald Knuth的“协程”概念。

从本质上讲，这些宏的目的是安排函数可以调用以返回到其调用方，并且下次调用它时，控件将从该语句之后恢复。`crReturn()``crReturn`

这意味着每次调用 时，在此类函数中声明的任何局部（自动）变量都将损坏。如果您需要一个变量持续超过这个时间*，则必须使其成为*某个适当结构中的字段，其中包含协程的持久状态 - 通常是协议层的主要状态结构。`crReturn`

有关这些宏的用途及其工作原理的更深入讨论，请参阅 [`https://www.chiark.greenend.org.uk/~sgtatham/coroutines.html`](https://www.chiark.greenend.org.uk/~sgtatham/coroutines.html)。

另一个警告：这些协程中的大多数不能*保证*运行完成，因为它们所属的SSH连接（或其他任何连接）可能随时被意外的网络事件或用户操作中断。因此，每当协程管理的变量引用需要释放的资源时，还应确保其包含状态结构的清理函数可以可靠地释放它，即使协程在任意点中止也是如此。

例如，如果 SSH 数据包协议层必须具有有时指向已分配内存片段的字段，则应确保在释放该内存时将指针字段重置为 。然后，无论何时调用协议层的清理函数，它都可以可靠地释放内存（如果有），如果没有，则不会崩溃。`NULL`

## E.12 实现特征的显式 vtable 结构

PuTTY的许多代码都是以一种在结构上看起来很像面向对象的语言的风格编写的，尽管PuTTY是一个纯粹的C程序。

例如，有一个名为 的单一数据类型，它是安全哈希函数的抽象，以及一堆称为 *foo* 之类的函数，它们使用这些数据类型执行操作。但实际上，PuTTY 支持许多不同的哈希函数，每个函数都必须提供自己的这些函数实现。`ssh_hash``ssh_hash_`

用C++术语来说，这更像是一个抽象基类，以及它的多个具体子类，每个子类都以与子类的数据字段兼容的方式填充所有纯虚拟方法。实现也或多或少是相同的：在 C 中，我们在源代码中显式地执行 C++ 编译器在编译时将在幕后执行的操作。

但也许在函数术语中更接近的类比是 Rust 的“特征”概念，或 Java 的“接口”概念。C++支持多级继承层次结构，而 PuTTY 的系统（如特征或接口）只有两个级别，一个描述某个类型的通用对象（例如哈希函数），另一个描述该类型的特定实现（例如 SHA-256）。

PuTTY 代码库有一个在 C 语言中执行此操作的标准习语，如下所示。

首先，我们为我们的特征定义了两种类型。其中一个描述了该特征的特定*实现*，它充满了（大部分）函数指针。另一个描述该特征的实现的特定实例，它将包含指向第一种类型的*实例*的指针。例如：`struct``const`

```
typedef struct MyAbstraction MyAbstraction;
typedef struct MyAbstractionVtable MyAbstractionVtable;

struct MyAbstractionVtable {
    MyAbstraction *(*new)(const MyAbstractionVtable *vt);
    void (*free)(MyAbstraction *);
    void (*modify)(MyAbstraction *, unsigned some_parameter);
    unsigned (*query)(MyAbstraction *, unsigned some_parameter);
};

struct MyAbstraction {
    const MyAbstractionVtable *vt;
};
```

在这里，我们想象这可能是某种包含可变状态的对象。关联的 vtable 结构显示了您可以对 ： 您可以创建一个（动态分配），释放您已有的，或调用示例方法“修改”（以某种方式更改对象的状态）和“查询”（返回从对象的当前状态派生的一些值）。`MyAbstraction``MyAbstraction`

（在大多数情况下，vtable 结构的名称以 '' 结尾。但由于历史原因，许多使用这种方案的加密原语——密码、哈希函数、公钥方法等——的名称以“”结尾，因为它们实现的原语通常被称为“加密算法”、“哈希算法”等。`vtable``alg`

现在，要定义此特征的具体实例，您需要定义一个包含字段以及它可能需要的任何其他数据：`struct``MyAbstraction`

```
struct MyImplementation {
    unsigned internal_data[16];
    SomeOtherType *dynamic_subthing;

    MyAbstraction myabs;
};
```

接下来，您将以这种样式实现该特征的所有必要方法：

```
static MyAbstraction *myimpl_new(const MyAbstractionVtable *vt)
{
    MyImplementation *impl = snew(MyImplementation);
    memset(impl, 0, sizeof(*impl));
    impl->dynamic_subthing = allocate_some_other_type();
    impl->myabs.vt = vt;
    return &impl->myabs;
}

static void myimpl_free(MyAbstraction *myabs)
{
    MyImplementation *impl = container_of(myabs, MyImplementation, myabs);
    free_other_type(impl->dynamic_subthing);
    sfree(impl);
}

static void myimpl_modify(MyAbstraction *myabs, unsigned param)
{
    MyImplementation *impl = container_of(myabs, MyImplementation, myabs);
    impl->internal_data[param] += do_something_with(impl->dynamic_subthing);
}

static unsigned myimpl_query(MyAbstraction *myabs, unsigned param)
{
    MyImplementation *impl = container_of(myabs, MyImplementation, myabs);
    return impl->internal_data[param];
}
```

定义这些方法后，现在我们可以定义一个包含指向它们的指针的 vtable 结构实例：`const`

```
const MyAbstractionVtable MyImplementation_vt = {
    .new = myimpl_new,
    .free = myimpl_free,
    .modify = myimpl_modify,
    .query = myimpl_query,
};
```

*原则上*，这就是您所需要的。客户端代码可以通过从 vtable 中挖掘方法并调用它（将 vtable 本身作为参数）来构造特定实现的新实例，该方法返回一个标识新创建的实例的指针，其中字段将包含指向您传入的相同 vtable 结构的指针。一旦你有一个实例对象，比如说，你可以从它指向的 vtable 中挖出其他方法指针之一，并调用它，将对象本身作为参数传递。`MyAbstraction``new``MyAbstraction *``vt``MyAbstraction *myabs`

但事实上，我们不会这样做，因为它在所有呼叫站点上看起来都非常丑陋。相反，我们在此代码库中通常做的是在定义结构类型的同一头文件中编写一组包装函数，如下所示：`static inline``MyAbstraction`

```
static inline MyAbstraction *myabs_new(const MyAbstractionVtable *vt)
{ return vt->new(vt); }
static inline void myabs_free(MyAbstraction *myabs)
{ myabs->vt->free(myabs); }
static inline void myimpl_modify(MyAbstraction *myabs, unsigned param)
{ myabs->vt->modify(myabs, param); }
static inline unsigned myimpl_query(MyAbstraction *myabs, unsigned param)
{ return myabs->vt->query(myabs, param); }
```

现在，调用站点可以使用那些看起来相当干净的包装器函数，并且永远不必直接引用它们持有的任何对象内的字段。例如，你可以写这样的东西：`vt``myabs`

```
MyAbstraction *myabs = myabs_new(&MyImplementation_vtable);
myabs_update(myabs, 10);
unsigned output = myabs_query(myabs, 2);
myabs_free(myabs);
```

然后，所有这些代码都可以使用同一抽象的不同实现，只需更改它在第一行中传入的 vtable 指针即可。

关于此系统需要注意的一些事项：

- 实现实例类型（此处为“”包含抽象类型（“”）作为其字段之一。但该字段不一定位于结构的开头。因此，您不能只是在两种类型之间来回*投*射指针。相反：

  ```
  MyImplementation
  ```

  ```
  MyAbstraction
  ```

  - 通过获取字段的地址，从实现“向上转换”到抽象。您可以看到上面的示例方法执行此操作，返回 .所有方法在返回时执行此操作。`MyAbstraction``new``&impl->myabs``new`
  - 在另一个方向上，传递泛型参数的每个方法都必须恢复指向特定实现类型的指针。这样做的习惯用法是使用 '' 宏，在 Linux 内核代码中也可以看到。通常，说：“我相信指针值”指向较大类型中名为“”的字段。请将指向包含结构的指针返回给我。所以在这种情况下，我们获取传递给函数的 '' 指针，并将其“向下投射”为指向更大、更具体的结构类型的指针，方法是根据名为 '' 的字段结构内的偏移量调整指针值。`MyAbstraction *myabs``MyImplementation *impl``container_of``container_of(p, Type, field)``p``field``struct``Type``myabs``MyImplementation``myabs`

  该系统足够灵活，允许“多重继承”，或者更确切地说，多重实现：让一个对象类型*实现*多个特征。例如，类型同时实现特征和连接到它的特征，因为它必须充当每种类型的另一个实例之间的适配器。`ProxySocket``Socket``Plug`

  也完全有可能让同一个对象以两种不同的方式实现*相同的*特征。在撰写本文时，我想不出我们实际这样做的任何情况，但一个理论上的例子可能是，如果您需要以两种按不同标准排序的方式支持一种特征。在 PuTTY 系统中这样做不会有任何困难：只需让您的实现包含两个（或多个）相同抽象类型的字段即可。这些字段将具有不同的名称，这样就可以轻松显式指定在向上转换期间返回指针的字段，或者使用 向下转换的指针。然后，两组实现方法都可以恢复指向同一包含结构的指针。`Comparable``struct``container_of`

- 与C++不同，PuTTY 中使用此系统的所有对象都是动态分配的。“构造函数”函数（无论它们是在整个抽象中虚拟化的还是特定于每个实现的）始终分配内存并返回指向它的指针。“free”方法（我们的析构函数类似物）总是期望动态分配输入指针，并释放它。因此，客户端代码不需要知道实现对象类型有多大，因为它永远不需要分配它（在堆栈或其他任何地方）。

- 与C++不同，抽象的“vtable”结构不仅包含可以在实例对象上调用的方法。它还可以容纳其他几种东西：

  - 您可以在没有实例对象*的情况下*调用的方法，仅给定标识特征的特定实现的 vtable 结构。您可能会将这些视为“静态方法”，就像在C++中一样，除了它们是*虚拟*的——给定不同的 vtable 指针，相同的代码可以调用不同“类”的静态方法。所以它们更像是“虚拟静态方法”，这是C++没有的概念。例如，中的方法。`pubkey_bits``ssh_keyalg`
  - “虚拟静态方法”最重要的情况是分配和返回新对象的方法。你可以把它想象成一个“虚拟构造函数”——C++没有的另一个概念。（但是，并非所有类型都需要其中之一：见下文。`new`
  - vtable 还可以包含与整个类相关的常量数据——“虚拟常量数据”。例如，加密哈希函数将包含一个整数字段，提供输出哈希的长度，大多数加密原语将包含一个字符串字段，该字符串字段提供描述该原语的 SSH 协议中使用的标识符。

  所有这些的效果是，您可以通过将实际的 vtable 作为参数传递给其他代码段，使其他代码段能够使用其中一种类型的任何实例。例如，该函数采用一个 vtable 指针，指定您喜欢的任何哈希算法，并在内部创建该类型的对象，使用它并释放它。在C++中，您可能会使用模板来执行此操作，这意味着您有多个专业化 - 然后在*运行时*决定需要使用哪一个会更加困难。在这里，仍然只是一个函数，您可以根据需要决定将哪个 vtable 传递给它。`hash_simple``ssh_hashalg``hash_simple``hash_simple`

- 抽象*实例*结构还可以包含公开可见的数据字段（这次，通常被视为可变的），这些数据字段对于特征的所有实现都是通用的。例如，有很多这样的。`BinaryPacketProtocol`

- 并非所有此类抽象都需要虚拟构造函数。这取决于实现的不同程度。

  对于像哈希算法这样的加密原语，构造函数调用对于每个实现类型看起来都是一样的，因此在 vtable 中拥有一个标准化的虚拟构造函数和一个包装函数是有意义的，它可以创建您传递的任何 vtable 的实例。然后，使所有 vtable 对象本身在整个源代码中全局可见，以便任何模块都可以调用（例如）。`ssh_hash_new``ssh_hash_new(&ssh_sha256)`

  但是对于其他类型的对象，每个实现类型的构造函数必须采用一组不同的参数。例如，在构造时，实现通常不可互换，因为构造不同类型的套接字需要完全不同的地址参数。在这种情况下，将 vtable 结构本身保留为实现源文件私有更有意义，而是发布一个普通构造函数，该函数分配并返回该特定子类型的实例，采用适合该子类型的任何参数。`Socket`

- 如果您有虚拟构造函数，则可以选择它们是将 vtable 指针作为参数（如上所示）还是*现有*实例对象。在后一种情况下，它们可以引用对象本身以及 vtable。例如，你可以有一个特征带有一个名为“clone”的虚拟构造函数，意思是“复制这个对象，无论它是哪个实现。

- 有时，单个 vtable 结构类型可以在两个完全不同的对象类型之间共享，并包含两者的所有方法。例如，包含用于创建、使用和释放的方法以及不可互换的对象 - 但是将它们的方法放在同一个 vtable 中意味着很容易创建一对相互兼容的匹配对象。`ssh_compression_alg``ssh_compressor``ssh_decompressor`

- 将 vtable 本身作为参数传递给该方法不是强制性的：如果给定的实现仅由单个 vtable 使用，则该函数可以简单地对它写入其构造对象的 vtable 指针进行硬编码。但是传递 vtable 更灵活，因为它允许在多个略有不同的对象类型之间共享单个构造函数。例如，SHA-384 和 SHA-512 共享相同的方法和相同的实现数据类型，因为它们几乎是相同的哈希算法——但它们的 vtables 中的其他几个方法不同，因为“重置”函数必须以不同的方式设置初始算法状态，而“摘要”方法必须写出不同数量的数据。

  ```
  new
  ```

  ```
  new
  ```

  ```
  new
  ```

  在头文件中拥有*foo*系列内联包装器函数的一个实际优点是，如果您以后改变主意是否需要将vtable传递给，则只需更新包装器，然后现有的调用站点就不需要更改。`myabs_``new``myabs_new`

- 此方案实现的另一个“特技对象定向”是，您可以编写两个 vtable，它们都对实现对象使用相同的结构布局，并通过覆盖其自己的 vtable 指针字段，让对象在其生命周期中*从一个部分转换为另一个*部分。例如，处理 SSH 终端会话的服务器端的类型有时会在生命周期中期以这种方式转换为 SCP 或 SFTP 文件传输通道，此时客户端发送“”或“”请求，指示这就是它想要对通道执行的操作。

  ```
  sesschan
  ```

  ```
  exec
  ```

  ```
  subsystem
  ```

  这个概念很难在C++安排。在 Rust 中，它甚至没有*意义*，因为在 Rust 中，实现 trait 的对象甚至根本不包含 vtable 指针——相反，“trait 对象”类型（标识给定特征的某些实现的特定实例）由一对指针组成，一个指向对象本身，一个指向 vtable。在该模型中，使现有对象变成不同特征的唯一方法是知道指向它的所有指针存储在程序其他地方的位置，并说服其所有所有者重写它们。

- 你可以做的另一个噱头是拥有一个根本没有相应实现结构的 vtable，因为其中实现的唯一方法是构造函数，它们最终总是返回其他一些 vtable 的实现。例如，PuTTY的一些加密原语具有硬件加速版本和纯软件版本，并在运行时决定使用哪一个（基于它们运行的CPU是否支持必要的加速指令）。因此，例如，有 vtables for 和 ，每个 vtables 都有自己的数据布局和所有方法的实现;然后有一个顶级 vtable ，它只提供“new”方法，并通过在一种或另一种子类型上调用“new”方法来实现它，具体取决于它发现的有关运行它的机器的内容。该顶级选择器 vtable 几乎总是客户端代码使用的那个。（测试套件除外，它必须实例化这两个子类型以确保它们都通过测试。

  ```
  ssh_sha256_sw
  ```

  ```
  ssh_sha256_hw
  ```

  ```
  ssh_sha256
  ```

  因此，顶级选择器 vtable 不需要实现任何接受参数的方法，因为从未构造过字段指向 的对象：它们都指向其他两个完整实现 vtable 之一。`ssh_sha256``ssh_cipher *``ssh_cipher``vt``&ssh_sha256`

## E.13 照我们说的做，而不是照我们做的做

当前的 PuTTY 代码可能并不严格遵循上面列出的*所有*原则。在应该独立于后端的模块中，可能偶尔会有特定于SSH的代码片段，或者偶尔依赖于Unix下的非标准X库函数。

这不应被视为继续违反规则的许可证。如果我们自己违反了它们，我们对此并不满意，我们欢迎修复任何现有问题的补丁。请尝试帮助我们使代码更好，而不是更糟！

