【快速全面掌握 WAMPServer】08.想玩多个站点？你必须了解虚拟主机的创建和使用

副标题：【快速全面掌握 WAMPServer】08.想玩多个站点？你必须了解虚拟主机的创建和使用

英文：master-wampserver-quickly-and-create-virtual-host

关键字：wamp,wampserver,php,apache,mysql,mariadb,js,html,虚拟主机,virtualhost





> **WAMPSERVER免费仓库镜像（中文）**
> https://www.sysadm.cc/index.php/xitongyunwei/720-repository-of-wampserver-files



有的时候，我们手头上同时推进的项目可能有好几个而不是只有一个。

例如像我，一会儿要用 `Wordpress` ，一会儿又要用 `Joomla` ，一会儿还要用个其他的什么某某系统。

那能不能不用来回切换就可以达到同时调试多个项目的目的呢？



提出这个问题，就会有肯定的回答。

在 `WAMPServer` 之下应该有两种可以实现上述效果的做法。



### 共用 `www` 目录的虚拟形式

一种是通过多项目的方法，就是将多个项目按子文件夹的形式分别放到 `wamp(64)/www` 主目录中。

形式就如这样：

```
wamp(64)
  |-- www
       |-- Project1
       |-- Project2
       |-- etc
```

使用这种方法的情况下，我们就必须以 `域名/子目录` 的链接形式来访问了。

比如对于 `Project1` 来说，应该这样访问。

```
http://localhost/Project1/
```

注意，`localhost` 也可以是其他域名，此外 `Project1` 子目录必须注意英文字母的大小写。



这种将项目直接放到 `wamp(64)/www` 中的做法非常简便。

它是基于默认 `DocumentRoot` 设定为 `c:/wamp(64)/www/` 的基础上的。

```
DocumentRoot "c:/wamp(64)/www/"
```



只要把项目文件夹放进去，就可以以域名加子目录的形式访问了，我们不需要额外做什么动作。

但这种方法在方便之余也有不足之处，比如，它可能与实际生产环境中的某些配置不兼容。

比方说，在实际生产环境中，对于项目来说，根目录应该是 `/` 。

而以域名加子目录的形式情况下，它的根目录就变成了 `/子目录/` ，显然这会造成一些严重的路径访问兼容问题。



一个鲜明而流行的示例，就是 `Laravel` 。

`Laravel` 为了提高安全性，通常会让用户访问 `/public` ，而不是直接访问其根目录。

如果我们使用了 `域名/子目录` 的形式，那么 `Laravel` 的访问就变成了诸如 `localhost/xxxx/public` 这样子。

虽说对于调试程序并无特别影响，但在迁移至生产环境时，修改配置也就变成了一件不大不小的麻烦事。

还好，我们还有另一种方法！



### 独立虚拟主机

另一种方法，可以使用虚拟主机，这有别于前面介绍的以同域名加子目录访问形式的方法。



使用虚拟主机的好处有这么几个：

* 它不用 `域名/子目录` 的形式，直接就和实际生产环境一样的，让项目感觉是独立运行环境一样。
* 域名不局限于本机域名，只要可以正确解析都可以使用。
* 不再局限于 `wamp(64)/www` 目录，你可以将项目目录放到磁盘驱动器的任何地方。
* 也可以创建多个，项目互相之间独立，没有干扰。
* 可以定义自己的 `Apache` 及 `PHP` 等配置参数，这有利于调试对环境要求不同的网站。



既然虚拟主机有这么多好处，那赶紧来看看，这个虚拟主机怎么玩的吧！



### 创建虚拟主机很简单

使用 `WAMPServer` 来创建虚拟主机只需要点击几下就可以实现。

在创建之前，我们需要先明确一些项目。

* 站点所在目录 `sitefolder` ：托管给虚拟主机所要实际访问指向的那个文件夹
* 站点域名名称 `sitename` ：给虚拟主机单独起的一个域名（比如 `http://sitename/` 中的 `sitename` ）



首先，选择我们要托管的本地站点位置，它可以是 `WAMPServer` 中的一个文件夹。

```
wamp(64)/www/sitefolder
```

也可以是其他位于磁盘驱动器上的任何位置。

```
D:/foo/sitefolder
```

只是需要注意的是，这些路径字符中要避免空格。



其次，在创建虚拟主机之前，我们指定的 `sitefolder` 目录必须事先存在，因此我们可以先将其新建出来。



再次，启动 `WAMPServer` ，等待图标 `W` 变成绿色。

然后通过以下两种中的任意一种方法打开创建虚拟主机页面。



**方法一：**

* 依次点击 `WAMPServer 图标` > `localhost` ，打开 `WAMPServer` 主页。

  图01

  

* 在 `WAMPServer` 主页的右下角 `你的虚拟主机` （ `Your VirtualHosts` ）区域中只有一个 `localhost` 而没有其他任何虚拟主机。

  这是正常的，等会儿我们创建好虚拟主机后就会看到的。

  图02

  

* 点击左下角的 `添加一个虚拟主机` ，我们就可以开启创建虚拟主机的页面。

  图03

  图04



**方法二：**

* 右键依次点击 `WAMPServer 图标` > `Wamp 设置` > 勾选 `显示虚拟主机菜单` 。

  图05

  

* 左键依次点击 `WAMPServer 图标` >  `虚拟主机列表` > `虚拟主机管理` ，我们就可以开启创建虚拟主机的页面。

  图06



打开了创建虚拟主机的页面后，我们就可以尝试建立一个我们自己的虚拟主机了。

创建步骤非常简单，只要在页面上按照提示填写即可。

注意其中有**必填项**和**选填项**，选填项具体要不要填写，我们在后面会详细介绍。



**第一项，主机域名。**

这个没什么问题吧，只要将你想要的主机域名写上去就行了。

注意点有两个，一是不能有空格或下划线。

二是这个域名并不一定是你当前主机的名字，随便啥都行，但要保证 `DNS` 可解析。



`DNS` 可解析是啥意思？

简单地说，就是这个域名要可以被正确识别并转变为 `IP` 地址。

在这里因为我们的域名都是随便起的，并不是互联网上的公共域名，因此无法正确解析。

不过不用担心，作为调试程序，最常用的方法我们可以通过修改 `etc/hosts` 文件来人为指定解析条目。

比如我们在 `Windows` 上的 `hosts` 文件中加上一条解析条目。

```
# 管理员权限打开并编辑 C:\Windows\System32\drivers\etc\hosts
# 在文件最后添加以下一行
192.168.66.88	sysadm.local
```

这样，我们使用 `sysadm.local` 这个域名时就可以正确解析到 `192.168.66.88` 这个 `IP` 地址了。

**（注意：在这里先不要照此添加解析条目，后面用到会再次说明的。）**



好，有了正确的解析，我们就可以放心在主机域名一项写下：

```
sysadm.local
```

那么我们之后来访问这个虚拟主机时，就应该用下面的链接。

```
http://sysadm.local
```



**第二项，虚拟主机站点目录。**

这个前面也已经介绍过了，可以是磁盘驱动器中任意目录。

但要注意，一是确保目录是完整的绝对路径，二是这个目录要事先创建好。

比如我设定了以下路径（作为参考提示这里使用斜杠 `/` ）。

```
C:/sysadm.local/
```



作为事先准备，我们可以在这个目录中放上一个测试文件，或者你直接放上你自己的站点文件都可以。

图07



OK，这两项是必填项，可以参考如下我填写的图示。

图08



我们填写好两个必填项就可以直接点击最下方的 `开始创建虚拟主机` 按钮了。

很快，虚拟主机创建完成！

图09



根据页面上的提示，如果主机名无法正常访问，那么我们就要修正域名解析功能。

其实这个在前面第一项中有说明过，务必确保你填写的域名可以正确解析。

重启 `DNS` 之后我们就可以访问这个新建的虚拟主机啦，让我们来试一试！

图10



我们在浏览器的地址栏内输入如下链接：

```
http://sysadm.local/index.html
```

图11



为啥结果却出现了乱码，这是怎么回事呢？

原因很简单，就是页面编码设定的问题。

前面我们只是简单地用记事本程序写了几句话，关闭时文本是以 `UTF-8` 编码保存的。

因此我们只要将页面编码改为 `UTF-8` 即可修正乱码问题。

在实际应用中，网页中会有专门指定编码的代码，因此不用担心会出现乱码情况。

图12

图13



最后，如果你在刚创建并使用虚拟主机时出现了问题，那么至少需要确认一下以下两个地方是否出现虚拟主机名称。

如果没有，那么就说明没有创建成功，或者没有重启服务生效。

图14

图15



作为补充说明，虚拟主机的创建修改实际上就是操作 `httpd-vhosts.conf` 这个文件。

```
\wamp(64)\bin\apache\apache2.4.xx\conf\extra\httpd-vhosts.conf 
```



实际上 `localhost` 也是一个虚拟主机，只是最好不要去乱修改它，因为它涉及到很多其他 `WAMPServer` 系统的操作。

默认情况下，它的样子是这样。

```
<VirtualHost *:80>
  DocumentRoot "${INSTALL_DIR}/www"
  ServerName localhost
  ServerAlias localhost
  <Directory "${INSTALL_DIR}/www">
    Options +Indexes +Includes +FollowSymLinks +MultiViews
    AllowOverride All
 	Require local
  </Directory>
</VirtualHost>
```

其中 `${INSTALL_DIR}` 实指安装目录 `c:/wamp(64)` 。



然后，我们想要建立一个虚拟主机，比如 `sysadm.local` ，应该怎么办呢？

在前面代码的后面添加以下内容就OK了。

```
<VirtualHost *:80>
  DocumentRoot "d:/sysadm.local"
  ServerName sysadm.local
  <Directory  "d:/sysadm.local">
    Options +Indexes +Includes +FollowSymLinks +MultiViews
    AllowOverride All
 	Require local
  </Directory>
</VirtualHost>
```



这些代码可能对于初学者来说有点小复杂，因此建议最好先不要直接编辑这个文件，还是等熟练了以后再动手。

如果想尝试亲自动手调试这些代码，那么可以使用 `WAMPServer` 的 `Apache` 配置语法测试功能。

或者直接用命令。

```
cd \wamp(64)\bin\apache\apache2.4.xx\bin
httpd -t 
```



### 让网站获得 `PHP` 解析支持

到目前为止，我仅仅填写了两个必填项就创建了一个虚拟主机。

但是请小伙伴们注意了，这样创建出来的虚拟主机只能看看 `html` 之类的“固定”网页文件。

换句话说，它并不能识别并解析含有 `PHP` 等动态语言代码的文件。

如果你只是拿它当静态网页用，那么目前这个虚拟主机就够用了。

但如果你要调试个博客或 `CMS` 系统，那么这个虚拟主机是不行的，它必须追加其他一些设定。

要追加其他哪些设定呢？



我们回到添加虚拟主机的主页，点击右侧 `修改虚拟主机表单` （ `Modify VirtualHost form` ），并点选修改。

图16

图17



在填写好前两个必填项后（修改状态是无法编辑的），我还需要接着填写下面的选填项。

勾选启用 `FCGI` 模式，并选择 `PHP` 版本。

图18



确认并完成修改，别忘记重启 `DNS` 服务。

然后我们将原来的 `C:/sysadm.local` 目录中新建一个文件 `index.php` （注意后缀），并添加以下代码。

```
<?php
echo '大家好！我是网管小贾，感谢各位的关注！<br>
网管小贾 / sysadm.cc';
?>
```



好了，让我们来访问看看吧！

```
http://sysadm.local/index.php
```

效果OK！`PHP` 代码被成功解析啦！

图19



虽然OK了，但可能有心的小伙伴会问，这个虚拟主机怎么没有 `IP` 地址项设定？

是的，被创建到 `localhost` 也就是 `127.0.0.1` 上的虚拟主机只能在这上面跑。

若要是想设定为其他人也可访问，那么就必须设定 `IP` 地址而不能是本地回环地址了。

怎么做呢？

这我们就要回到最初创建虚拟主机时的最后一个选填项了。



### 虚拟主机的 `IP` 地址设定

设定域名需要解析到的非回环 `IP` 地址，通常是用于将虚拟主机开放以便让其他人也能访问。

注意，这一项可根据实际情况来设定，如果你只是自己用，那么用本地回环地址就OK了。

这个 `IP` 地址应该填写为本机网卡的 `IP` ，比如图示。

如果你有多块网卡，那么你就填写想要开放的那个即可。

图20



好，之后我们就可以通知其他用户，使用 `IP` 地址即可访问虚拟主机了。

```
http://192.168.66.88
```

图21



如果你还想通过域名让其他用户访问，那么务必确保用户端可以将这个域名解析为前面的 `IP` 地址。

比如以当前演示为例，将 `hosts` 文件中原域名解析修改为实际 `IP` 地址。

图22



注：`index.php` 会被识别为默认的首页，因此如下两者实质上是一样的效果。

```
http://sysadm.local
http://sysadm.local/index.php
```



另外，考虑到其他用户访问时需要开放目录的访问权限，那么我们还需要在 `httpd-vhosts.conf` 中确认权限是否正确。

比如开放所有用户都可访问。

```
<RequireALL>
	Require all granted
</RequireALL
```

具体请参考 `Apache` 关于访问权限的参数说明。



### 删除虚拟主机

前面折腾了一大堆，但是删除虚拟主机是真心简单。

在创建虚拟主机的主页右侧，点击 `显示删除虚拟主机` 。

图23



在出现的虚拟主机列表中勾选你想要删除的一项或多项，然后点击 `删除虚拟主机` 。

图24



揍四这么简单哈！



### 教程小结

本文为小伙伴们初步地地介绍了关于 `WAMPServer` 中虚拟主机的概念以及设定方法。

虚拟主机实质上是 `Apache` 上面的内容，然而又关联着 `FCGI` 等动态代码解释器等内容，因此也算是比较重要的内容。

在实际使用中，站点多是以虚拟主机形式存在并运行的。

`WAMPServer` 默认的 `localhost` 其实就是一个虚拟主机，我们在前面的介绍中也能看到，很多的操作实际上都是在这个 `localhost` 的站点页面上完成的。

此外学好 `WAMPServer` 的虚拟主机概念后，你会发现将自己的项目迁移到网上空间主机时会变得非常容易理解和操作。

虚拟主机很重要、很重要、很重要，希望小伙伴们能够快速学习和掌握。

好了，今天就讲这么多吧，下一期教程敬请各位期待！



*PS：《【小白PHP入坑必备系列】快速全面掌握 WAMPServer》教程列表：*

* *【快速全面掌握 WAMPServer】01.初次见面，请多关照*
* *【快速全面掌握 WAMPServer】02.亲密接触之前你必须知道的事情*
* *【快速全面掌握 WAMPServer】03.玩转安装和升级*
* *【快速全面掌握 WAMPServer】04.人生初体验*
* *【快速全面掌握 WAMPServer】05.整明白 Apache*
* *【快速全面掌握 WAMPServer】06.整明白 PHP*
* *【快速全面掌握 WAMPServer】07.整明白 MySQL 和 MariaDB*
* *【快速全面掌握 WAMPServer】08.想玩多个站点，你必须了解虚拟主机的创建和使用*
* *【快速全面掌握 WAMPServer】09.如何在 WAMPServer 中安装 Composer*
* *【快速全面掌握 WAMPServer】10.HTTP2.0时代，让 WampServer 开启 SSL 吧！*
* *【快速全面掌握 WAMPServer】11.安装 PHP 扩展踩过的坑*
* *【快速全面掌握 WAMPServer】12.WAMPServer 故障排除经验大总结*
* *【快速全面掌握 WAMPServer】13.PHP调试麻烦？请 xDebug 来帮忙！*
* *【快速全面掌握 WAMPServer】14.各种组件的升级方法*



**扫码关注@网管小贾，个人微信：sysadmcc**

网管小贾的博客 / www.sysadm.cc











