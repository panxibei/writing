【快速全面掌握 WAMPServer】06.整明白 PHP

副标题：【快速全面掌握 WAMPServer】05.整明白 PHP

英文：master-wampserver-quickly-and-understand-php

关键字：wamp,wampserver,php,apache,mysql,mariadb,js,html



`PHP` 是 `Hypertext Preprocessor` 即“超文本预处理器”的缩写，是在服务端执行的一种脚本语言。

通常它被用于 `Web` 开发，并可以嵌入 `HTML` 中，是具有交互功能一种动态高级语言。



虽然 `PHP` 历史悠久、应用广泛，在上个世纪的90年代就已经诞生，但是它有个基金会却是去年（2021年）才刚刚建立的。

难怪网络上充斥着黑色幽默： `PHP` 是世界上最好的语言！

当然在基金会建立之前 `PHP` 就已经是小伙伴们调侃的对象。

那这句话是真的吗？

如果你还在纠结这个问题的真假，只能说明你的确有必要好好学习一下这里的内容。

我们不得不承认，很多人就是被绑缚于无尽的纠结而束手束脚，最终一事无成。

你管它是不是最好的呢，有用就行，有用就学啊！

而事实上，到目前为止仍有大量的网站是建立在 `PHP` 基础之上。

比如你一直想要拥有的个人主流博客软件之一的 `Wordpress` 就是跑 `PHP` 的。

那么多人在用，你说 `PHP` 有没有用呢？

不要管别人说什么，自己看到听到想到的才最真实！

好了，来到这儿就已经说明你是个头脑清晰、学习劲头十足的三好学生了，那就开始我们的 `PHP` 学习之路吧！



### 几个重要概念

为了方便入门 `PHP` ，我们先来简单介绍几个常用的概念。



##### `PHP` 的运行模式

`PHP` 有两种运行模式，分别是 `CLI` 模式和 `WEB` 模式。

`CLI` 模式就是终端模式，顾名思义，是指我们在终端输入 `PHP` 命令或语句，它就解释执行并同样在终端输出结果。

`WEB` 模式可能大家就知道了，当我们向 `WEB` 服务器发送请求，`PHP` 就会解释执行并通过 `WEB` 方式返回结果到我们的浏览器上。



##### `TS` 和 `NTS`

`TS` 就是 `Thread Safe` 线程安全，是指支持多线程的构建。

`NTS` 就是 `None Thread Safe` 非线程安装，是指仅单线程的构建。

`TS` 应用到多线程的服务端应用编程接口 `SAPI` 方式，而 `NTS` 则用于 `PHP` 作为模块加载到 `WEB` 服务器的方式。



比如 `Linux` 下的 `PHP-FPM` ，用来解释 `PHP` 代码的 `FastCGI` 管理器，它就是使用的 `NTS` 。

图a01



而在 `Windows` 上跑的 `WampServer` 就是用的多线程 `SAPI` ，因此使用的是 `TS` 。

图a02



以上可以在 `phpinfo` 上查看到，`WampServer` 可通过在浏览器中输入以下链接查看。

```
http://localhost/?phpinfo=-1
```



如果你实在记不住也没关系，我们只要简单大概地记得，在 `Linux` 上一般是 `NTS` ，而在 `Windows` 上一般是 `TS` 。

这有什么用吗？

当我们选择 `PHP` 扩展时就会知道，这些扩展 `DLL` 分 `TS` 或 `NTS` ，可不要选错了哦！



##### `PECL`

`PHP` 扩展社区托管库的简称，有很多扩展库就放在这里。

当我们需要某个扩展支持时，就可以到这里来淘一淘。

比如 `Redis` 缓存扩展，双比如第三方数据库扩展等等。

> http://pecl.php.net/



##### VC15 & VS16

较新版本的 `PHP` 是使用 `VC15` 或 `VS16` （分别指 `Visual Studio 2017` 或 `2019` 编译器）构建的。

`VC15` 和 `VS16` 版本需要安装 `C++ Redistributable for Visual Studio 2015-2019 x64/x86` 。

需要记住的是，以后只要我们看到 `VC` 或 `VS` 字样，自然而然就应该想到，这里所指的 `PHP` 是在 `Windows` 上跑的。

而不同版本的 `PHP` 应该对应不同版本的 `VC` 或 `VS` 。

我们使用的 `WampServer` 中的 `PHP` 正是需要相应的 `VC` 组件，并且通常 `x64` 和 `x86` 版本的都要安装，这在前面的安装篇教程中已经说明过了，道理就在这儿。



### `Apache` 是如何调用 `PHP` 的

如果我们只安装了一个 `httpd` （也就是 `Apache` ），那么我们也只能得到一个静态网站，什么交互功能都不能做。

因此我们要想办法，在我们访问网站时让 `Apache` 调用 `PHP` 来解析相应的程序文件，以此来响应交互信息。

通常最原始的访问方法是，我们建立一个以 `php` 为后缀的文件，将其放到网站上，那么它应该识别这个文件是含有交互信息的，而不是单纯地将它的所有内容以 `html` 形式显示在浏览器上。

OK，我们前面说过，在 `Windows` 下它应该是通过连接 `SAPI` （服务端应用程序编程接口）来实现的。

那具体是怎么做的呢？



分两步走。

**第一步，让 `Apache` 加载 `PHP` 模块。**

我们以 `WampServer` 为例，打开 `Apache` 的配置文件 `httpd.conf` ，找到加载 `PHP` 模块的位置。

如下图，我们可以很清楚地看到，`Apache` 当前加载了 `php7.4` 的模块，这个模块文件名就是 `php7apache2_4.dll` 。

```
PHPIniDir "${APACHE_DIR}/bin"
LoadModule php7_module "${INSTALL_DIR}/bin/php/php7.4.26/php7apache2_4.dll"
```

图b01



**第二步，让 `Apache` 识别 `.php` 扩展名**

光加载模块还不够，还要让 `Apache` 知道如果碰到 `.php` 的文件就去找模块解析才行。

同样我们以 `WampServer` 为例，还是在配置文件 `httpd.conf` 中，查找识别文件类型的设定。

```
    AddType application/x-httpd-php .php
    AddType application/x-httpd-php .php3
```

图b02



经过以上两步，我们可以自己做一个简单的 `PHP` 文件来测试。

将以下代码保存为一个文件，比如 `phpinfo.php` ，然后将它放到网站根目录中。

```
<?php phpinfo(); ?>
```



如果打开浏览器访问这个文件能够正常看到 `PHP` 信息，那么恭喜你 `PHP` 环境安装成功了！



### `WampServer` 中的 `PHP`

既然我明白了前面的原理，那么接下来再看 `WampServer` 中的 `PHP` 就会清晰很多。



##### `PHP` 版本

首先我们来看一下 `PHP` 版本，在 `WampServer` 中安装有很多不同的版本。

图c01



从图中我们可以看到，当前有效的版本是 `7.4.26` 。

目前为止，`7.4` 版本还是在有效维护周期内的，不过今年（2022年）也即将过期。

通常一个版本它的维护周期是三年，具体可以查看官方说明。

> https://www.php.net/supported-versions.php

图c02



`WampServer` 中之所以保留部分旧版本，实际上是为了兼容适应部分老旧系统。

如果你有一个 `PHP` 的系统挺好用的，但它是用 `PHP 5.6` 写的，所以即使这个版本早已不被官方维护，但我们还是可以继续使用的。

`WampServer` 提供了多版本的 `PHP` ，并且我们可以随时切换版本，只需要点下鼠标即可，真心方便啊！



##### `PHP` 设置

`WampServer` 为我们提供了方便的 `PHP` 设置，我们可以在菜单中直接进行编辑，只需要点击鼠标选择，或是直接写入新参数值。

图c03



即使很方便，但我还是建议小伙伴们尽可能地编辑 `PHP.ini` 配置文件，这样会对搞懂 `PHP` 更有帮助。



##### `PHP` 扩展

`PHP` 在安装之初就已经集成了一部分扩展，不过有的是有效（被勾选）有的则无效（没被勾选）。

注意啦，这里显示出来的，仅仅是配置文件中所罗列出来的扩展。

如果你没有将扩展写进配置文件，那么它只能是默默无闻地呆在原地哭泣而无人知道了。

图c04



此外，如果你还需要其他诸如第三方的扩展，那么就需要将下载下来的扩展文件放到指定的目录中。

这里需要注意的是，存放扩展文件的目录务必要对应好相应的 `PHP` 版本号。

比如，当前我们使用的是 `PHP 7.4.26` ，那么真正生效的扩展目录是这个。

```
C:\wamp64\bin\php\php7.4.26\ext
```



我们将扩展文件放到目录中后，就像前面所说还需要在配置文件中写明这个扩展所在目录。

具体做法是，打开配置文件 `php.ini` ，然后找到 `extension` 字样的行，将扩展名称添加进去。

```
extension=xxx
```

注意，在 `WampServer` 中，扩展的文件名应该是 `php_xxx.dll` ，而配置文件中应该写成 `xxx` ，请小心了！

好了，现在你可以去菜单中的 `PHP 扩展` 看看了，如果它还没有出现，那就重启一下服务再看看。



##### `PHP` 错误日志

和 `Apache` 一样，对于 `PHP` 配置是否正确、工作是否正常，我们可以通过查看错误日志来进一步判断问题所在。

在以后不管是添加扩展功能，还是判断用户连接问题等等，都需要我们灵活运用这个错误日志。

图c07



### 浅谈在 `CLI` 中运用 `PHP`

前面说过 `CLI` 就是命令行方式，或者说是终端模式也可以，与图形模式相对，现在我们简单聊一聊以命令行方式运行 `PHP` 的问题。



实际上我们可以像用 `DOS` 命令一样来使用 `PHP` ，这一点很重要，因为两点。

一是有些场合，代码可能会以 `CLI` 方式在后台运行，而你必须学会区分它。

比如我有一次在使用著名的 `Swoole` 框架时，它并没有将结果返回到浏览器，而是输出到了终端，让我困惑了好一阵。



二是一些比如扩展或依赖库的安装需要用到 `Composer` 这样的命令来完成。

关于第二点我们会在以后的教程中专用来讲解。

我们先来了解第一点。



我们打开一个命令提示符窗口，然后进入当前版本的 `PHP` 所在目录中。

```
cd C:\wamp64\bin\php\php7.4.26
```

接着我们输入以下命令查看。

```
php -v
```

输出结果是当前 `PHP` 的版本信息，以及编译所需的环境组件。

图c08



我们可以从中看到 `cli` 的字样，这就是在终端模式中使用 `PHP` 。

接下来我们可以尝试解析 `php` 文件。

保存以下内容到一个新建文件中，并将其命名为 `test.php` ，保存目录无所谓。

```
<?php echo 'Hello！欢迎关注网管小贾！！'; ?>
```



保存好文件后，我们使用如下命令执行看看。

```
php <目录>\test.php
```

这样便可以在终端中得到 `PHP` 解析后的结果，说明一切OK。

图c09



说到这儿，我不得不讲一下，在 `WampServer` 中存在一个坑。

实际上默认情况下，`PHP` 的 `CLI` 模式使用的是 `5.6` 版本而非当前的 `7.4` 版本，因此可能会给使用者造成一些困扰。

想要清除这个问题困扰，我们需要右键点击 `WampServer` 图标，记住是右键点击哦！

然后在 `工具` 一项中找到 `更改 PHP CLI 版本` 这一设定。

从图中我们也能看到，`CLI` 版本是 `5.6` ，而 `WEB` 版本是 `7.4` 。

图c10





### 教程小结





*PS：《【小白PHP入坑必备系列】快速全面掌握 WAMPServer》教程列表：*

* *【快速全面掌握 WAMPServer】01.初次见面，请多关照*
* *【快速全面掌握 WAMPServer】02.亲密接触之前你必须知道的事情*
* *【快速全面掌握 WAMPServer】03.玩转安装和升级*
* *【快速全面掌握 WAMPServer】04.人生初体验*
* *【快速全面掌握 WAMPServer】05.整明白 Apache*
* *【快速全面掌握 WAMPServer】06.整明白 PHP*
* *【快速全面掌握 WAMPServer】07.整明白 MySQL 和 MariaDB*
* *【快速全面掌握 WAMPServer】08.想玩多个站点，你必须了解虚拟主机的创建和使用*
* *【快速全面掌握 WAMPServer】09.如何在 WAMPServer 中安装 Composer*
* *【快速全面掌握 WAMPServer】10.HTTP2.0时代，让 WampServer 开启 SSL 吧！*
* *【快速全面掌握 WAMPServer】11.安装 PHP 扩展踩过的坑*
* *【快速全面掌握 WAMPServer】12.WAMPServer 故障排除经验大总结*
* *【快速全面掌握 WAMPServer】13.PHP调试麻烦？请 xDebug 来帮忙！*
* *【快速全面掌握 WAMPServer】14.各种组件的升级方法*



**扫码关注@网管小贾，阅读更多**

网管小贾的博客 / www.sysadm.cc
