UrBackup Server 2.4.x 管理手册中文版（十） 恢复备份 

副标题：恢复备份~

英文：administration-manual-for-urbackup-server-10

关键字：administration,manual,urbackup,backup,server,client,architecture



 本节将向小伙伴们阐述 `UrBackup` 服务器是如何配置的相关内容。 



#### `UrBackup` 的恢复备份

`UrBackup` 通过创建灾难恢复映像备份来保护整机，以及创建文件备份来保护用户或服务器文件。

因为文件备份的大小通常可以根据机器上的重要数据来筛选精简，所以它们通常可以比映像备份运行得更频繁。

串联使用映像和文件备份是有意义的，与通过文件备份来备份重要文件相比，备份整个机器的频率更低。 



##### 10.1 恢复镜像备份

可以使用基于 `Debian GNU/Linux` 的可引导的 `CD` 或 `U` 盘来恢复映像备份。

在此映像恢复期间，要恢复的机器必须为可访问，而无需从服务器进行网络地址转换（或者你将第 `11.3` 节中的客户端端口转发到恢复客户端）。

虽然 `Linux`支持许多主板、磁盘控制器等，但你应该始终验证恢复 `CD` 是否适用于你的特定硬件，尤其是在你使用新硬件或新硬件时。

包括一些无线设备的驱动程序和固件以及要配置的程序，但通过有线网络连接进行恢复会更省事、更快，应该是首选。

这样恢复就很容易做到。

启动后，它将寻找备份服务器。

如果找不到，你可以输入备份服务器的 `IP/主机名` 并更改你的网络设置。

找到备份服务器后，它会要求输入用户名和密码。

例如，使用你的管理员帐户访问所有客户端及其映像备份。

然后你可以选择一个镜像备份，选择你要恢复到的磁盘，然后它就会恢复。

目标磁盘必须至少与映像备份的磁盘一样大。

某些硬件更改可能会导致  `Windows` 在恢复之后在系统启动时出现蓝屏。

如果启动修复失败，你可能必须使用 `Windows` 磁盘进行修复安装。

如果你计划将  `Windows` 还原到不同的硬件，则应事先测试不同的硬件组合。



##### 10.2 恢复文件备份

在执行文件备份时，`UrBackup` 会创建一个与当时客户端文件系统相同的文件系统快照。

因此，你可以通过任何文件共享协议或应用程序（例如  `Windows` 文件共享（或 `samba` ）、 `FTP/SFTP` 、 `WebDAV`……）简单地将这些文件系统快照提供给客户端。



你还可以为客户端创建一个用户，允许用户通过 `UrBackup` 的 `Web` 界面浏览客户端的所有备份，并以 `ZIP` 格式下载单个文件或整个目录（限制为最大 `4GB` ）。



从 `UrBackup 2.0.x` 开始，如果配置了服务器 `URL` ，用户可以直接从客户端访问 `Web` 界面。

他们可以右键单击  `UrBackup`  托盘图标，然后单击打开浏览器的 `访问/恢复备份` ，或者他们可以右键单击备份路径中的文件/目录，然后单击 `访问/恢复备份` 以访问所有文件/目录的备份（仅在带有 `Windows Explorer` 的 `Windows` 上）。



浏览备份时，如果客户端在线，`Web` 界面将显示一个恢复按钮。

恢复将要求用户确认。

如果客户端包含 `GUI` 组件（托盘图标），则将弹出用户确认以供客户端上的所有活动用户恢复。

如果未及时确认（超时）或拒绝，则还原将失败。

你可以在  `C:\Program files\UrBackup\args.txt` 中更改此行为，方法是在 `Windows`  上将 `default` 更改为 `server-confirms` ，或者在 `Linux` 上更改 `/etc/default/urbackupclient` 或  `/etc/sysconfig/urbackupclient` 中的恢复设置。

`UrBackup` 就是这样设置的，因为理论上的数据丢失场景是攻击者控制了你的备份服务器，删除了所有备份，然后通过还原来删除客户端上的所有文件。

在 `Linux`（和其他操作系统）上，你还可以在客户端通过命令行 `urbackupclientctl browse` 和 `urbackupclientctl restore-start` 进行恢复。



### 小结

本节内容不多，主要阐述了 `UrBackup` 恢复备份的相关内容。

虽然内容不多，但还建议各位小伙伴重视起来，毕竟如果备份恢复失败等同于没有备份一样。

因此与如何备份同样重要的恢复备份方法，也需要我们认真阅读学习。

恢复备份的方法有很多种，不同的方法适合不同的场景，而相同的场景又可能有不止一种的恢复方法。

所以说，我们应该在实际操作中来熟悉如何恢复备份，这样也可以很好地为今后在实战中打下基础。



**扫码关注@网管小贾，个人微信：sysadmcc**

网管小贾 / sysadm.cc

