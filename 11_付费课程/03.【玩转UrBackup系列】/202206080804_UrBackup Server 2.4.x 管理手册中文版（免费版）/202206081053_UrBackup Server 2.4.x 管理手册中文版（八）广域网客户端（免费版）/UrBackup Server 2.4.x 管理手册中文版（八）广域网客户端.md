UrBackup Server 2.4.x 管理手册中文版（八）广域网客户端

副标题：广域网客户端~

英文：administration-manual-for-urbackup-server-8

关键字：administration,manual,urbackup,backup,server,client,architecture



---

**推荐：UrBackup Server 2.4.x 管理手册中文版（网管小贾进阶版）**

格式：`html`  、 `pdf`

1、修正了大量官网英文版中不通顺的语句，使之更便于阅读、易于理解。

2、根据实际场景操作添加了大量说明配图插画。

3、根据实际场景操作调整修正了部分说明内容（有部分官网内容并不准确甚至存在错误）。

4、根据实际场景操作添加了大量官网没有提到的其他实用内容。

---



***参考目录***

* *1 开篇介绍*
* *2 服务器安装*
  * *2.1 `Windows` 上的服务器安装*
  * *2.2 `Ubuntu` 上的服务器安装*
  * *2.3 `Debian` 上的服务器安装*
  * *2.4 在其他 `GNU/Linux` 发行版或 `FreeBSD` 上安装服务器*
  * *2.5 `GNU/Linux` 服务器安装提示*
  * *2.6 操作系统独立服务器安装步骤*

* *3 客户端安装*
  * *3.1 `Windows` 客户端安装*
  * *3.2 自动部署到多台 `Windows` 计算机*
  * *3.3 `Linux` 客户端安装*
  * *3.4 `Mac OS X` 客户端安装（追加内容，官网手册无此内容）*

* *4 架构*
  * *4.1 服务器架构*
  * *4.2 客户端架构*

* *5 安全*

  * *5.1 服务端 `Web` 界面的权限管理*
  * *5.2 让 `Web` 页面可通过 `SSL` 访问*
    * *5.2.1 `Apache` 配置*
    * *5.2.2 `Lighttp` 配置*

  * *5.3 客户端安全*
  * *5.4 传输安全*
  * *5.5 广域网模式安全*

* *6 局域网中的客户端发现*

* *7 备份过程*
  * *7.1 文件备份*
  * *7.2 映像备份*
  * *7.3 数据冲突概率*
    * *7.3.1 文件备份冲突概率*
    * *7.3.2 映像备份冲突概率*
  * *7.4 客户端和服务器上的备份前后脚本*
    * *7.4.1 客户端备份前后脚本*
    * *7.4.2 服务器后备脚本*

* *8 广域网客户端*
  * *8.1 自动推送服务器配置到客户端*
  * *8.2 下载预配置的客户端安装程序*
  * *8.3 手动添加和配置客户端*
  * *8.4 通过 `Internet` 传输文件*

* *9 服务器设置*

  * *9.1 全局服务器设置*
    * *9.1.1 备份存储路径*
    * *9.1.2 服务器网址*
    * *9.1.3 禁止磁盘镜像备份*
    * *9.1.4 禁止文件备份*
    * *9.1.5 自动关闭服务器*
    * *9.1.6 从更新服务器下载客户端*
    * *9.1.7 当新有服务器版本可用时通知我*
    * *9.1.8 自动更新客户端*
    * *9.1.9 最大同时备份数*
    * *9.1.10 最近活动客户端的最大数量*
    * *9.1.11 清理时间窗口*
    * *9.1.12 自动备份 `UrBackup` 数据库*
    * *9.1.13 本地网络的总体最大备份速度*
    * *9.1.14 全局软文件系统配额*
  * *9.2 邮件设置*
    * *9.2.1 邮件服务器设置*
    * *9.2.2 配置报告*

  * *9.3 客户端特定设置*

    * *9.3.1 备份窗口*
    * *9.3.2 高级备份间隔*
    * *9.3.3 排除文件*
    * *9.3.4 要备份的默认目录*
    * *9.3.5 虚拟子客户端名称*

  * *9.4 广域网设置*

    * *9.4.1 数据使用限额预估*

  * *9.5 高级设置*

    * *9.5.1 启用临时文件缓冲区*

    * *9.5.2 传输模式*
    * *9.5.3 增量映像备份样式*
    * *9.5.4 完整映像备份样式*
    * *9.5.5 批处理期间的数据库缓存大小*

  * *9.6 在增量文件备份期间使用符号链接*

  * *9.7 调试：所有文件备份的端到端验证*

  * *9.8 调试：使用客户端哈希验证文件备份*

  * *9.9 定期将 `Internet` 客户端的文件条目读入数据库*

  * *9.10 文件备份后为客户端上的每个用户创建符号链接视图*

  * *9.11 每个客户端同时作业的最大数量*

  * *9.12 映像备份期间要分组快照的卷*

  * *9.13 文件备份期间要分组快照的卷*
  * *9.14 `Windows` 组件备份配置*

* *10 恢复备份*
  * *10.1 恢复镜像备份*
  * *10.2 恢复文件备份*

* *11 杂项*

  * *11.1 手动更新 `UrBackup` 客户端*

  * *11.2 日志记录*
  * *11.3 使用的网络端口*
  * *11.4 在 `GNU/Linux` 上挂载（压缩）`VHD` 文件*
  * *11.5 在 `Windows` 上将 `VHD` 挂载为卷*

  * *11.6 解压 `VHD` 文件*

  * *11.7 将多个卷 `VHD` 映像组装到一个磁盘 `VHD` 映像中*

  * *11.8 迁移非 `btrfs` 备份存储*

* *12 存储*

  * *12.1 每晚备份删除*
  * *12.2 紧急清理*
  * *12.3 清理具有大量备份文件的服务器*
  * *12.4 清理具有 `UrBackup` 未知文件的存储文件夹*
  * *12.5 归档*
    * *12.5.1 归档窗口*
  * *12.6 合适的文件系统*
    * *12.6.1 `Ext4/XFS`*
    * *12.6.2 `NTFS`*
    * *12.6.3 `btrfs`*
    * *12.6.4 `ZFS`*

  * *12.7 存储设置建议*
    * *12.7.1 `ZFS`*
    * *12.7.2 `Btrfs`*



### 8 `UrBackup` 的广域网客户端

`UrBackup` 官方称之为 `Internet` 客户端，叫作互联网客户端也行，不过个人感觉广域网客户端更加契合。

`UrBackup` 能够通过 `Internet` 备份客户端，支持 `LAN` 和 `Internet` 混合备份。

例如，对于并非一直在 `LAN` 中使用但连接到 `Internet` 的移动设备，这可能很有用。

由于它会对备份文件系统造成额外的压力，因此默认情况下此功能是被禁用的。

你需要在设置中启用和配置它并重新启动服务器才能使用它。

你必须设定的最小配置是指定备份服务器在 `Internet` 上可访问的服务器域名或 `IP` 地址。

由于可能在备份服务器和 `Internet` 之间存在防火墙或路由器，因此你还需要在这些设备上配置将 `UrBackup` 端口（默认值：`55415` ）转发到备份服务器。

以下分三个部分来说明三种配置客户端的方法。



##### 8.1 自动推送服务器配置给客户端

如果客户端是一个移动设备，它将是最容易让服务器推动其名称和设置的，推送将自动发生。

服务器也会自动生成针对每个客户端的密钥并且推送以对应客户端。

这假设当前的局域网是一个安全通道。

如果客户端已经被入侵，你仍然可以更新服务器和客户端上的密钥。



##### 8.2 下载预配置的客户端安装程序

如果你在服务器设置中启用 `从更新服务器下载客户端` ，或者手动下载客户端更新并将其放在相应的文件夹中（参见第 `11.1` 节），用户可以在 `状态` 页面从服务器下载预配置的客户端安装程序。

安装程序包括服务器 IP/域名、它正在侦听的端口、客户端名称和身份验证密钥。

这允许已安装的客户端自动连接到下载安装程序的服务器。



##### 8.3 手动添加和配置客户端

`UrBackup` 还允许手动添加客户端和手动配置共享密钥。

要添加这样的客户端，需要执行以下步骤：

1. 以管理员身份进入 `状态` 页面。

2. 单击 `添加新客户端` 并在 `添加广域网客户端名/NAT后端的客户端名` 下输入您要添加的电脑名称。

3.  `UrBackup` 将为该客户端生成并显示一个身份验证密钥。

4. 在客户端上，打开设置并在 `广域网` 选项卡中输入相同的密钥，并在 `客户端` 选项卡中输入你为客户端提供的电脑名称。

   还要输入备份服务器的公共 `IP` 或域名以及可访问的端口。

5. 服务器和客户端现在应该可以相互连接了，如果它不起作用，客户端会在 `状态` 窗口中显示出了什么问题。



##### 8.4 通过 `Internet` 传输文件

如果客户端通过 `Internet` 连接，`UrBackup` 会自动使用节省带宽的文件传输模式。

此模式仅传输已更改的文件块，因此应节省未完全更改的文件的带宽，例如数据库文件、虚拟磁盘等。

这是有代价的：`UrBackup` 必须保存每个文件的哈希值。

如果文件的哈希值不存在，例如因为 `Internet` 模式刚刚启用，则它们是在备份期间根据文件创建的，因此可能会减慢备份过程。





**扫码关注@网管小贾，个人微信：sysadmcc**

网管小贾 / sysadm.cc

