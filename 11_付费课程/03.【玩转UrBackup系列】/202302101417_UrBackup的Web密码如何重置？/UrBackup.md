没想到UrBackup的Web密码重置这种简单问题还让我踩到坑里了！

副标题：没想到UrBackup的Web密码重置这种简单问题还让我踩到坑里了！

英文：unexpectedly-i-meet-troubles-to-reset-urbackup-web-password-issue

关键字：urbackup,password,web,密码,重置



小伙伴们，你们好啊！

最近遇上点闹心事，向大伙儿吐吐苦水，别嫌弃哈！



之前我也写过不少关于 `UrBackup` 的教程和文章，大体上可以说我算是入门 `UrBackup` ，基本的操作也问题不大。

不过由于老板比较器重我，强烈希望我能够将有限的生命投入到无限的工作之中。

这不最近又给我安排了不少很有挑战性的事情，并且承诺事后优先考虑保留我不裁员资格。

说实话，当时可把我给感动坏了，我那小心脏激动得“扑腾扑腾”直跳！



这现在事儿一多，之前的一些事儿也就不怎么管了，于是渐渐地对 `UrBackup` 有些生疏了。

通常吧，备份这事，基本上设定好后就不怎么管了，只要备份成功，最多定期验证一下备份文件是否有效。

我估摸着应该有不少小伙伴和我差不多，也不会太多地去考虑再调整些什么。

主要是我懒，杂事又多，因此不出问题一般也就不去过多深究。

就这样时间一久，有部分细节也就淡忘了，结果把 `Web` 登录密码还给整忘了！



糟糕，老师傅遇到新问题，时间久了，密码记不住了。

图01



尝试了各种密码，什么生日啊，三围啊，连老板小蜜的都试过了，就是想不起来这密码是啥！

还能咋办呢，找找密码重置功能吧！

其实 `UrBackup` 还真自带了密码恢复功能。



火速查了下官网，在 `Linux` 平台下重置密码非常方便，一条命令完事。

```
# Reset web interface administrator password
/usr/bin/urbackupsrv reset-admin-pw
```



但是 `Windows` 平台怎么重置，这方法居然没找到，于是只好自己摸索。

我心里就猜想，看 `Linux` 的那个命令行，会不会 `Windows` 也可以这么搞呢？

结果尝试了不行，没有这样的参数，自然也没有效果。



后来好像想起点什么，记得 `Windows` 下好像有一些批处理文件，专门用于自动化处理 `UrBackup` 的一些问题的，比如清理 `CleanUp` 之类的，要不到 `UrBackup` 文件夹内找找？

结果还真在文件夹内找到一个名为 `reset_pw.bat` 的批处理文件，哈哈，这不就是嘛！

图02



哎，先别高兴，打开看看里面都有啥，万一要有彩蛋呢！

图03



打开一看，代码倒也不难，关键是最后一行代码。

```
"%~dp0\urbackup_srv.exe" --cmdline --no-server --plugin cryptoplugin.dll --plugin urbackupserver.dll --set_admin_pw "%newpw%"
```



只要给对参数，单独运行这行代码效果也是一样一样的。

嗯，唷西，很好，没啥特别的，先运行试试看吧！

结果这么一跑，毛毛了，输了个重置密码后就报了一堆错。

图04



等会哈，我先瞅瞅，好像是一些什么插件加载错误。

什么插件啊，你这让我上哪儿去整这些插件去啊！

难道说这命令参数有误？

我尝试着查看命令参数，蹦出来好几行让人眼花缭乱的参数。

图05



我咬着后槽牙心想，这踏马都是啥呀！

哎，慢着慢着，不对啊！

我回头一瞧批处理的这条命令，有个 `--plugin` 参数，不是已经加载了两个插件了嘛！

这时我突然好像想起了什么，这加载的两个插件好像就在那文件夹里躺着呢！

果不其然，亏得我这两眼加起来近500度的大近视眼眼力好，真是踏破铁鞋无觅处，得来全不费功夫啊！

图06



得，赶紧给加上吧，再走一次！

结果插件是加载正常了，怎么后面的错误还有呢！

图07



这上面好像写着什么打开 `LMDB` 数据库文件失败。

```
ERROR: LMDB: Failed to open LMDB database file
```



这是又个什么茬？什么数据库？

思前想后，猜测应该是 `UrBackup` 的数据库吧。

难道是数据库文件路径又不对了？

遂切换到数据库所在目录后再执行批处理，发现问题依旧。



上网查了半天也查不出个所以然来，这可如何是好？

就在这山穷水尽之时，我突然想到，会不会是 `UrBackup` 服务正在运行占用了数据库文件呢？

想到这儿，我找到了 `UrBackup` 服务所在项，一记重拳将其击倒，服务停止了。

图08



来吧，大胆尝试一下！

先直接用命令行走一遍，直接给密码参数看看。

嘿！老天显灵，奇迹出现了！

图09



真的搞定了？

别慌，再用批处理跑一下，先输入密码 `123456` 。

图10



定定神后果断回车，OK，成功了！

图11



最后总结一下。

首先，要将所需插件（ `dll` 文件）都加载上。

其次，务必先将 `UrBackup` 服务停止，待密码修改完成后再重启服务。

最后，就是验证确认密码是否可以成功登录。



批处理命令行中，如下补充修正代码。

```
"%~dp0\urbackup_srv.exe" --cmdline --no-server --plugin cryptoplugin.dll --plugin fsimageplugin.dll --plugin fileservplugin.dll --plugin luaplugin.dll --plugin urbackupserver.dll --set_admin_pw "%newpw%"
```



懒的复制粘贴的小伙伴可以直接下载我打包好的重置批处理文件。

下载链接：





**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc