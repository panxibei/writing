UrBackup Server 2.4.x 管理手册中文版（八）广域网客户端

副标题：广域网客户端~

英文：administration-manual-for-urbackup-server-8

关键字：administration,manual,urbackup,backup,server,client,architecture



 本节将向小伙伴们说明关于不在同一局域网下 `UrBackup` 是如何实现备份的问题。 



### 8 广域网客户端

`UrBackup` 官方称之为 `Internet` 客户端，叫作互联网客户端也行，不过个人感觉广域网客户端更加契合。

`UrBackup` 能够通过 `Internet` 备份客户端，支持 `LAN` 和 `Internet` 混合备份。

例如，对于并非一直在 `LAN` 中使用但连接到 `Internet` 的移动设备，这可能很有用。

由于它会对备份文件系统造成额外的压力，因此默认情况下此功能是被禁用的。

你需要在设置中手动启用和配置它并重新启动服务器才能使用它。

图01



你必须设定的最小配置是指定备份服务器在 `Internet` 上可被访问的域名或 `IP` 地址。

由于可能在备份服务器和 `Internet` 之间存在防火墙或路由器，因此你还需要在这些设备上配置将 `UrBackup` 端口（默认值：`55415` ）映射转发到备份服务器。

以下分三个部分来说明三种配置客户端的方法。



##### 8.1 自动推送服务器配置给客户端

如果客户端是一个移动设备，它将是最容易让服务器推动其名称和设置的，推送将自动发生。

服务器也会自动生成针对每个客户端的密钥并且将其推送至对应的客户端。

假设当前的局域网是一个安全通道。

如果客户端已经被入侵，你仍然可以更新服务器和客户端上的密钥。



##### 8.2 下载预配置的客户端安装程序

如果你在服务器设置中启用 `从更新服务器下载客户端` ，或者手动下载客户端更新并将其放在相应的文件夹中（参见第 `11.1` 节），用户可以在 `状态` 页面从服务器下载预配置的客户端安装程序。

（注意，我在测试过程中并没有发现预配置客户端安装程序。可能对于工作得非常好的自动发现功能来说，这个并不是十分重要。）

图02



安装程序包括服务器 `IP` /域名、它正在侦听的端口、客户端名称和身份验证密钥。

这允许已安装的客户端自动连接到下载安装程序的服务器。



##### 8.3 手动添加和配置客户端

`UrBackup` 还允许手动添加客户端和手动配置共享密钥。

要添加这样的客户端，需要执行以下步骤：

1. 以管理员身份进入 `状态` 页面。

2. 单击 `添加新客户端` 并在 `添加广域网客户端名/NAT后端的客户端名` 下输入您要添加的电脑名称。

   图03

   

3. `UrBackup` 将为该客户端生成并显示一个身份验证密钥。

   图04

   

4. 在客户端上，打开设置并在 `广域网` 选项卡中输入相同的密钥，并在 `客户端` 选项卡中输入你为客户端提供的电脑名称。

   还要输入备份服务器的公共 `IP` 或域名以及可访问的端口。

   图05

   

5. 服务器和客户端现在应该可以相互连接了，如果它不起作用，客户端会在 `状态` 窗口中提示出了什么问题。



##### 8.4 通过 `Internet` 传输文件

如果客户端通过 `Internet` 连接，`UrBackup` 会自动使用节省带宽的文件传输模式。

此模式仅传输已更改的文件块，因此会节省消耗未完全更改文件的带宽，例如数据库文件、虚拟磁盘等。

不过这也是有代价的，`UrBackup` 必须保存每个文件的哈希检验值。

如果文件的哈希值不存在，例如由于 `Internet` 模式刚刚启用，则这些哈希值是在备份期间根据文件创建的，因此可能会减慢备份进程。



### 小结

本节阐述了 `UrBackup` 的广域网客户端的相关内容。

当我们要实现异地备份，或是不在同一局域网的远程备份等情况的话，`UrBackup` 的广域网模式就可以发挥它的作用了！

虽然广域网模式非常有用，但是它也有相对不足之处，比如限于带宽网速等等的制约因素。

因此基于各种因素，我们应该根据实际情况做出合理有效的备份解决方案。



**扫码关注@网管小贾，个人微信：sysadmcc**

网管小贾 / sysadm.cc

