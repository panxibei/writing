智取天狼星计划（一）

副标题：腥风血雨似猛虎，定下巧计破困局



傍晚时分，夜幕降临，周围的一切似乎又平静了下来。

叶冲双眉紧锁，目光凝视着前方，脑海中飞快地回想着白天发生的一切，生怕有哪个细节出了错。



今天一大早，他像往常一样到军政厅上班，却发现其他的工作人员与以往不同，已经早早地忙碌开了。

从佐藤将军办公室出来的机要秘书见了他也只是草草地打了个招呼，让他一会马上就去会议室开会，然后行色匆匆地走开了。

叶冲顿时生起了一丝不祥的预感，难道又有什么重大行动吗，心思敏锐的他不由得警觉起来。

他不敢耽搁，稍做收拾后迅速来到会议室，宫本早已在那里等候了。



会议上宣布了一份最新的绝密计划，代号“天狼星”。

这项秘密计划将于三天后正式展开行动，其中列有数十名香岛抗日爱国志士名字的名单，是彻头彻尾的血腥暗杀计划！

叶冲竖起耳朵，仔细地听着每一个词语，生怕漏听了什么信息。

最后叶冲得知，秘密暗杀名单只保存在佐藤的专用U盘中，而为了保证行动的绝密，每次只通过打印名单的方式将打印件交给行动队，完成行动后再销毁，电脑中并不保存名单文档。

而这关键的U盘却被隐藏在某个秘密场所，除了佐藤本人外任何人都不知道它的下落。



自从宫本苍野经常在佐藤大藏面前打小报告，作为当前香岛军政厅最高领导的佐藤也慢慢对叶冲起了疑心。

而在这次重要会议上，佐藤也基本上把主要的行动任务交给了宫本，而叶冲只是作为配合协助人员被通知在电讯课内部活动。

拿不到名单，就无法及时通知组织，势必会造成同志们无谓的牺牲。

叶冲此时表面镇静自如，心中却早已波涛汹涌，有如热锅上的蚂蚁！

怎么办？！

事态紧急，查找U盘下落已然是来不及了。

况且U盘丢失必定会引起佐藤的怀疑和警觉！

电脑里植入木马程序窃取名单文档？

风险太大也行不通，太容易被发现。

思考再三，唯一的办法就只有秘密截获打印内容。

叶冲决心拼一下！



#### 行动一：定位打印机

佐藤的办公室里不止只有一台打印机，短时间内是无法确定他会使用哪一台打印行动计划和名单的。

叶冲想到，必须要监视每一台他可能使用的打印机，才能成功地截获计划内容。

于是，他使用VB代码很快实现了列出所有打印机的功能。

```vb
' 引用 Microsoft WMI Scripting V1.2 Library
' 加载打印机列表
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
Set wmiObjSet = objWMIService.InstancesOf("Win32_Printer")

' 获取所有打印机名称
cboPrinters.Clear
For Each wmiObj In wmiObjSet
    cboPrinters.AddItem wmiObj.DeviceID
Next

Set wmiObj = Nothing
Set wmiObjSet = Nothing
Set objWMIService = Nothing
```



#### 行动二：寻找后台打印文件夹

叶冲闭上眼睛，努力在脑海中搜索着以前在电讯课中所学的计算机知识。

忽然，他回想到系统通常会通过一个叫做 `Print Spooler` 的打印后台处理服务来管理所有本地和网络打印队列及控制所有打印工作。

而 `Print Spooler` 服务会把打印文档依次排队，并在打印的时候统一放在后台打印文件夹中存放。

嗯，一定要先找到这个文件夹的位置，然后才能对文档进行下一步处理。



为了寻找Windows10的后台打印文件夹，需要按以下步骤走。

1、依次点击 `开始菜单` > `设置` > `设备` 。

2、找到 `打印机和扫描仪` ，点击 `打印服务器属性` 。

图1

3、选择 `高级` 选项卡，可以看到 `后台打印文件夹` 实际路径。

Windows10的后台打印文件夹默认位于 `C:\Windows\System32\Spool\Printers` 。

图2

4、如果想要更改，可以点击按钮 `更改高级设置` 。



这个后台打印文件夹其实是所有打印机的默认设置。

当有多台不同的打印机时，也可以分别设置各自不同的后台打印文件夹。

方法很简单，只要修改相应打印机的注册表项即可。

```shell
# 比如打印名称为 Microsoft Print to PDF
# 修改 SpoolDirectory 键值为自定义文件夹，默认键值为空则指向C:\Windows\System32\Spool\Printers
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Print\Printers\Microsoft Print to PDF]
"SpoolDirectory"=""
```

图3



注意事项：

1. `SpoolDirectory` 必须指定非根目录的实际目录路径，如果指定了根目录路径（如：`C:\`），那么系统自动恢复为默认设置（即 `C:\Windows\System32\Spool\Printers` ）。
2. 如果 `SpoolDirectory` 所在驱动器为NTFS文件系统，需要保证给予可访问的权限。



后台打印文件夹虽然找到了，可是叶冲想到，修改默认值一旦被人发现暴露的风险极高，况且修改的时间成本也太大。

思来想去，于是决定不做任何改动。



#### 行动三：设法保留打印的文档

叶冲想起当年学习计算机的知识点，意识到光有后台打印文件夹还不够，因为系统默认是不会保留打印过的文档的，必须让系统保留文档才有可能完整获取它。

能否通过设定让系统暂时保留打印文档，然后在获取文档内容之后再删除文档呢？

想法不错，那么具体怎么让系统可以保留打印文档呢？



依次打开 `控制面板` > `设备和打印机` ，右击需要设定的打印机后选择 `打印机属性` ，选择 `高级` 选项卡。

图4



可以看到，默认 `保留打印的文档` 一项是没有被勾选的。

怎么是灰色不可用状态呢？

其实是权限问题，选择 `常规` 选项卡，点击 `更改属性` 按钮后就可以勾选 `保留打印的文档` 了。

图5



这样的操作看上去简单，可是时间紧、任务重，还是要再快点为妙。

叶冲还是想到了VB代码。

```vb
' 使用WMI遍历打印机属性来设定是否保留打印文档
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
Set wmiObjSet = objWMIService.InstancesOf("Win32_Printer")

For Each wmiObj In wmiObjSet
    If wmiObj.DeviceID = lstPrintersSelected.List(lstPrintersSelected.ListIndex) Then

        If chkSaveDocument.Value = vbUnchecked Then
            wmiObj.KeepPrintedJobs = False
        Else
            wmiObj.KeepPrintedJobs = True
        End If

        wmiObj.Put_
        Exit For
    End If
Next

Set wmiObj = Nothing
Set wmiObjSet = Nothing
Set objWMIService = Nothing
```



很快，使用VB代码操作，所有的打印机都可以保留打印文档了。



到目前为止，叶冲觉得还算比较顺利，只是接下来问题就比较头痛。

在打印文件夹内获取文档似乎没什么大问题，但**如何掌握打印时间点**，以及**文档后续如何处理**呢？

叶冲站起身来，万分焦急地在屋中来回踱步。

猛然间，他灵光一现，有了主意......



> 敬请期待下一篇：《盗取天狼星计划（二）》



> WeChat @网管小贾 | Blog @www.sysadm.cc









