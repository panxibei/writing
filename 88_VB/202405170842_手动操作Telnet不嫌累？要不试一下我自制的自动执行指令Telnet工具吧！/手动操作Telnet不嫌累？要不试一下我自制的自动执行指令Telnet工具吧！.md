手动操作Telnet不嫌累？要不试一下我自制的自动执行指令Telnet工具吧！

副标题：手动操作Telnet不嫌累？要不试一下我自制的自动执行指令Telnet工具吧！

英文：isnt-manually-operating-telnet-tiring-why-dont-you-try-my-homemade-telnet-tool-for-automatic-command-execution

关键字：telnet,cmd,ssh,putty,自动化,工具,自制



昨天发生了一件事，我现在仍记忆犹新。

一大早我就被秘书喊进了胡总的办公室……



一进门，只见我们部门的赖经理也在。

我打完招呼，胡总就问我，最近调到我们部门实习的小王表现如何。

我偷偷瞥了一眼赖经理，发现他暗戳戳冲我挤眉弄眼。

转过脸我再看胡总的办公桌上，赫然放着一张写满1、2、3的A4纸。

哦哦，我想起来了，那是一张赖经理让我收集的“罪证”。

谁的“罪证”？

当然是新来实习的那个小王了！

哎，慢着，不对啊！

一个小小实习生的表现为啥会引起胡总的关注，这里面会不会……有坑？



一周前，赖经理告诉我，公司最近会安排一个实习生过来，让我带着。

没几天，果然来了个小年轻，没错，就是这个小王。

听别的部门说，他之前已经在好几个部门实习过，表现都很不错。

可经过短短一个礼拜的观察，我越来越发现这个小王比我还能摸鱼，压根和他们说的完全不是一回事啊！

我跟赖经理反映，他让我整理整理材料，到时候也好向上级领导汇报，实在不行就给他弄走算了，他也不希望往他这儿塞人。

行，咱说干就干，没两天我就给他列了一份负面清单。



公司8:30上班，17:30下班，我每天早早8点刚过就到公司，收拾这个整理那个的。

可这小王愣是雷打不动坚持在 8:35 到 8:45这个区间来公司。

来你就来吧，还不准备准备工作，他居然慢慢吞吞吃起了早餐。

什么大饼油条肉包子，饭团烧麦蛋黄粽，搞得满屋子那个味儿，嘁，也不知道给我带一份！

吃罢了早餐再来壶水，咕嘟咕嘟，又是5分钟。

吃喝完毕，你说这下可以开始工作了吧，不，他往厕所里钻，一蹲就是2000年。

每次出来都是满脸愁容拉着个脸，您是吃啥了，这表情？

嘿，结果不知道又从哪掏出个烟盒，“啪啪”嘬起了烟卷，还能不能工作啊！

这么一来二去能折腾到9:45，才算是勉勉强强开始工作。



这还没玩呢，午休12点到下午2点，这小王11:45就人不见了。

怎么不见的从来没看清过，去哪了更不知道。

下午14:15之后才晃晃悠悠出现，端着个手机开始点奶茶。

随后找了个怕外卖员辛苦的蹩脚借口，自个下楼去拿，接着一路喝上来。

你倒是回来啊，不，他半路上往楼道里一躲，好么，一手端茶，一手夹烟，这架势您细品。

开始下午的工作吧，17:20人又不见了，我都严重怀疑他会法术！

于是乎，我整理好了这些“斑斑劣迹、条条罪状”，交给了赖经理。



不过吧，现在胡总问起这个人，我在脑海里又用了2.08秒钟回溯了前几天的一个情况。

有一次不见人影，我就去找他，想劝劝他能不能认真对待这份来之不易的工作。

没成想，我正巧听到他在楼道里接电话，尽说着一些不着边际的词。

什么公司人员结构不合理啊，什么管理理念有问题啊，什么躺平的都不是兄弟是路人啊，吧啦吧啦……

嘁，我看这新来的小年轻都一个样，你以为你是谁啊，不认真踏实工作，好高骛远，净玩些虚的。

什么？还妄想调到总公司去？

嗯？慢着……该不会是……



想到这儿，我眼珠一转，计上心来！

我笑着和胡总说，小王虽然是新来的，和大家还太熟悉，不过最近表现却非常好，工作非常认真务实。

一听我说这话，赖经理眼睛大了两圈，嘴张着下巴差点没接住。

胡总冲我点了点头，让我实话实说，具体好的表现都有哪些。

这个……这个嘛……



赖经理在一旁咬着后槽牙，斜着眼看我，估计心里在想，我看这孙子玩的什么“里格隆”！

我一低脑袋，看见我手里的笔记本电脑，于是顺手将电脑打开。

我就说，年轻人就是年轻人，思维灵活，最近工作上有个小问题就是新来的小王给解决的。

接着我就当场给两位领导演示开了“杰作”……



在系统运维中，我们常常会遇到设备的调试工作。

在诸多调试工作中，我们又常常会用到 `Telnet` 方式的连接操作。

现在，有一些设备，需要自动化地通过 `Telnet` 方式来远程管理控制。

因此需要编写程序代码来实现，比如远程修改设备的参数或密码等等。



然而这个 `Telnet` 出生的太早了，它没有像其他后来者一样，在程序代码中有安全加密等说法。

因此在实际使用过程中，我们往往会碰到一些基于安全访问的尴尬问题。

比如，有些程序通过 `Telnet` 连接设备，那么有可能会出现如下无法正常连接设备的警告提示。

> Raw mode will not be supported, Closing connection.



这句话大概意思就是不让用 `Raw` 也就是原始模式来建立连接，究其原因正是出于安全问题设备不让你这么操作。

这种情况往往发生在输入完密码之后，当然你手动用命令行来连接是没问题的，但用程序自动连接就是不行。

所以说一般的老旧的程序代码很有可能不再适合现今的使用了。

于是我就换了个思路：既然手动命令行没问题，那么我就通过模拟命令行终端来实现。



如下是使用 `CMD` 通过 `Telnet` 登录设备。

图01



我们常用的 `PuTTY` ，也可以用它来登录 `Telnet` 。

连接类型 `Connection type` 一定要选择其他 `Other` ，并且右侧框中定位为 `Telnet` 。

图02



或者干脆直接来一条命令行，加个 `-telnet` 参数即可。

```
putty -telnet 192.168.1.123
```



登录显示和直接使用 `Telnet` 类似，不过当然是 `PuTTY` 模样的窗口了。

图03



基于以上两种方式，我重新写了一款工具程序。

只要在命令行列表中罗列需要的 `Telnet` 指令，那么就可以成功连接并操作设备了。

图04



当然了，自动化总是离不开定时操作的。

你可以设定某一个时间点，在开启定时发送命令后，每天就会定时发送这些命令了。

此外这些命令会保存在程序目录下的一个文本文件中，直接编辑它当然也是可以的。

图05



目前先简单地做成这样，初步已经测试成功了。

比如每天定时导出设备配置，或定时执行一些特定操作。



**网管小贾的TELNET自动发送命令程序.7z**

下载链接：https://pan.baidu.com/s/1OW1KNoR6HaAQi6qg5cap2w

提取码：x13f



整整十多分钟，我在那儿口若悬河、吐沫横飞，把这些说得是天花乱坠。

胡总眨巴眨巴眼睛，问我这是小王做的？

我信心满满地回答，那是当然，不过我也有提供小小的帮助哈！



事后我和赖经理从胡总办公室退了出来，直擦头上的冷汗。

回去的路上赖经理不停地夸我机敏，问我为啥知道小王的背景，不早告诉他，好险……好险！

我长叹一声说，我们都是受害者，我们都被“00后整顿职场”给骗了啊！





**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc