资源文件大小修正

副标题：

英文：

关键字：



提纲：

1、发现释放文件大小不正确。

2、怀疑资源文件添加的有问题，遂验证

3、上网查找原因，发现1到3空字节的BUG说法

4、验证这种BUG，编译前正常，编译后不正常

5、解决多出字节的问题，给出示例







打开记事本，输入以下代码，单词之间用 `TAB` 或空格分隔。

```
101	CUSTOM	FOO1.DLL
102	CUSTOM	FOO2.DLL
```



将其保存到打包文件所在文件夹内。



`RC.exe` 命令所在文件夹。

```
C:\Program Files (x86)\Microsoft Visual Studio\VB98
```



通常释放资源文件的代码。

```
intFreeFile = FreeFile
Open strResFile For Binary As #intFreeFile
Put #intFreeFile, , arr
Close #intFreeFile
```





释放资源文件大小不正确的问题，其实是 `VB6` 的一个 `BUG` 。

据说在 `SP6` 时已被修复，这个 `BUG` 所呈现的现象是，它会在释放出来的文件屁股后边随机加上 `1` 个或 `3` 个空字节 `vbNullChar` 。

为啥会这样，大神解释是由于 `DWord` 对齐。

至于这个所谓的 `Dword` 对齐到底是什么东西什么情况，作为小白的我就不得而知了。

或许是为了确保某些文件格式的正确性吧，比如 `HTML/XML` 类型的文件。

因而像这类文件的尾部，如果混入了 `vbNullChar` ，那么可能就没办法读取了。

图d01



说到 `SP6` 已修复此 `BUG` ，这纯属虾扯蛋，大神在后来的帖子中也验证了这个荒谬的说法。

按官方文档所说，`VB6.exe` 在 `6.0.91.15` 及 `VBA6.dll` 在 `6.0.0.8965` 版本以上就算修复了。

图d02



其实我也测试过，根本就没有修复嘛！

如下图，我使用的版本肯定是高于官方文档所述的版本。

图d03

图d04



可结果还是出现了释放文件大小不正确的问题。

其实这个问题的现象，严格来说应该是在编译前（即 `IDE` 环境下），输出文件的大小是正确的。

而在编译后，也就是生成了 `EXE` 文件后，输出文件的大小就有偏差了。





















