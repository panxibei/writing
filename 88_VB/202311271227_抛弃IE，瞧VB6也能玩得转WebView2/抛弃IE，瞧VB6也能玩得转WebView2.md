抛弃IE，瞧VB6也能玩得转WebView2

副标题：抛弃IE，瞧VB6也能玩得转WebView2

英文：abandoning-ie-you-can-also-use-webview2-in-vb6

关键字：ie,vb6,webview2,web,edge,microsoft,浏览器,rc6.dll,rc6,webview2loader





专为 `VB6` 打造的 `VBRichclient` 框架似乎无所不能。

除了之前介绍过的 `WebServer` ，以及 `TCP/UDP` 通讯等，还有众多牛P闪闪的高级功能。

要说和如今主流的 `Web` 相关的，那么就应该还有浏览器了。

下面我们就来聊聊，如何通过 `VBRichclient` 来实现非 `IE` 内核的浏览器调用。



众所周知，在传统方法中 `VB6` 调用浏览器通常都不外乎用的是 `IE` 内核，也就是 `WebBrowser` 这个控件。

由于 `IE` 早已驾鹤西游退出历史大舞台，微软BaBa也把它老人家的尸体封印起来不再让它露脸了。

因此在新一代浏览器大行其道的今天我们再用 `WebBrower` 似乎有种说出来怕别人笑话，不说出来吧又自己憋着难受的赶脚。

难道说我们应该抛弃以前的旧思想，拥抱未来之新事物？

什么？让我放弃 `VB` ？

你知道对于一个有尊严的男人意味着什么嘛！

`VB` 就是我心中的红旗，放弃断然是不可能滴！

那么……对于一个心中有红旗的男人……只能是……嘿嘿……换彩旗！

嗯，别想歪了，千言万语汇成一句话，用 `VB6` 调用非 `IE` 内核的浏览器，这个……能行吗？

伟大的领袖毛主席教导我们：扫帚不到，灰尘照例不会自己跑掉！

甭废话，不纠结，干脆动手试试！



第一个遇上的，就是选择题。

现在是互联网众多新星粉墨登场的新时代，非 `IE` 内核可海了去了，用哪个比较好呢？

其实微软早就推出过 `MicrosoftEdgeWebview2` ，简称为 `WebView2` 控件，可以非常方便地让应用嵌入 `Microsoft Edge` 。

简单地说，就是我们可以让 `VB6` 调用 `WebView2` 控件，从而实现 `Edge` 浏览器的使用。

按理说 `WebView2` 就是让你来调用的，对高级程序语言来说这都不是事儿！

说得没错，不过嘛你如果想要用古老的 `VB6` 来做这件事情，似乎就不太好办了吧！

别担心，本文开头就提到了，`VBRichclient` 就是来帮助我们实现调用 `WebView2` 的神助攻。



打开 `VB6` 的对象浏览器，我们可以看到 `RC6` 库文件中已经包含了 `cWebView2` ，也就是对 `WebView2` 的调用功能。

图01



那么这玩意怎么玩呢？

我研究了一段时间，一开始也是毫无头绪，不过最终还是将基本的功能用法掌握了。

**（文末提供示例程序下载）**

注意，如果你对 `Web` 方面不是太了解，建议你先学习了解一下，比如 `HTML` 、`JavaScript` 等，和这些关系有点密切。



我做了一个演示示例程序，上半部分是一些功能按钮，下半部分是浏览器，同时也是效果验证显示区。

图02



在这儿我简单的介绍介绍和 `WebView2` 相关的一切情况。

首先，它可以载入你自定义的 `HTML` 页面代码。

图03



我按照网上大神的示例自行改写了部分代码，加了三个示例按钮。

头一个按钮，可以获取指定文本框的 `Value` 值。

图04



第二个按钮，可以执行 `JS` 代码。

图05



第三个按钮，可以控制页面元素的 `CSS` 值。



说到这儿，可能有的小伙伴会说，你这不就是 `Web` 页面上按钮本身的功能嘛！

是的，不过需要说明两点。

一，这些本身的功能代码，是通过 `VB6` 调用 `RC6` 将 `JS` 代码嵌入到应用程序中的，相当于 `VB` 调用了 `JS` 。

二，不通过点击页面按钮，就用 `VB6` 按钮也完全能做到这些功能的效果。

你们来看！



按下 `各元素查询选择器演示` 按钮，可以获取各种你想要的效果。

比如通过元素 `ID` 获取 `HTML` 代码。

图06



比如通过元素 `Class` 获取 `HTML` 代码。

图07



不管是 `innerHTML` 还是 `outerHTML` 还是 `Value` 啥的，统统都到碗里来！



按下 `设定元素值演示` 按钮，那个 `Button3` 就会变成红色，元素设定没得说。

图08



对于自定义编写的 `JS` 代码，什么变量也好函数也罢，想怎么调用就怎么调用，非常方便。

另外还可以截图。

图09



还可以通过命令打开 `DevTools` 调试窗口。

图10



话说回来，浏览器本身使用方面自然也是没问题的。

地址栏内输入任意网址，只要网站是正常的，那么打开它也不会出乎意料之外。

图11



百度自然也能打开。

图12



各位小伙伴也应该看到了，向前向后，访问停止刷新，各功能一应俱全，和我们平时操作浏览器别无二致。



最后说一下可能会遇到的问题。

要想正确调用使用这个程序，需要事先做好两点准备工作。

一个是正确注册 `RC6` 库，方法我已经放到了下载包中，可自行阅读，非常简单。

二个是要安装好官方提供的 `WebView2` 组件包，这个也已经包含在本文下载包中，当然你也可以到官网下载，都是一样的。

搞定这两个问题，那么就可以用 `VB6` 正常调用 `WebView2` 了。



请注意，插一嘴哈，如果你是较新的 `Windows 10/11 22H2` 版本以上，那么不需要安装 `WebView2` 组件包了，因为官方已经将它内置到系统中了。

反之就需要手动安装一下子，比如像 `Windows 7` ，会报错。

图13



**网管小贾的WebView2演示程序安装包.7z**

下载链接：https://pan.baidu.com/s/1JnfIpakA7OICgpahyNbaiw

提取码：uxk6



欢迎有兴趣的小伙伴和我交流讨论！

最后祝大家在新的一年，万事如意、心想事成！





**将技术融入生活，打造有趣之故事**

网管小贾 / sysadm.cc



