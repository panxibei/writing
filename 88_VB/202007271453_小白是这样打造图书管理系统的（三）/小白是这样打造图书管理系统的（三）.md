小白是这样打造图书管理系统的（三）

副标题：界面设计及程序实现~





> 前文参考：
>
> * 《小白是这样打造图书管理系统的（一）》
> * 《小白是这样打造图书管理系统的（二）》



书接上文



## 三、界面设计

使用VB构建界面是非常简单的，主要能实现CRUD功能即可。

以下给出我设计的参考样图。



封面

图6



图书信息界面

图7



图书借阅操作界面

图8



图书借阅记录界面

图9





## 四、程序实现

#### 一、前期环境配置

在VB开发环境中添加 `引用` 和 `部件` 。



首先是引用，依次点击菜单 `工程(P)` > `引用(N)...` 。

需要使用到 `Microsoft ActiveX Data Objects 2.5 Library` 和 `Microsoft Data Formatting Object Library 6.0 (SP6)` 。

前者是用来连接 `SQL Server` 数据库的，后者是用来格式化数据的。

图1



其次是部件，依次点击菜单 `工程(P)` > `部件(O)...` 。

分别需要用到对话框、数据表格、选项卡等组件。

图2



#### 二、部分代码实现

我们以图书信息的增删改查为例，演示代码实现。



##### 1、增

```vb
' ********添加图书，先判断是否已录入，如果已存在，则提示退出，否则添加新记录信息。********

	strSql = "SELECT TOP 1 book_ID FROM bms4l_Book WHERE book_ID='" & Trim(txtBookID.Text) & "'"
    Set rst = SelectSQL(strSql, strmsg)
    
    ' 如果bookID存在，则刷新使用最新时间做为ID编号
    If rst.RecordCount = 0 Then
        MsgBox "记录已存在！", vbCritical + vbOKOnly, "网管小贾的图书管理系统"
        Exit Sub
    End If
    
    ' 添加新记录
    strSql = "INSERT INTO dbo.bms4l_Book (book_ID,book_Title,book_Volume,book_Press,book_Author,book_ISBN,book_PublishTime,book_Price,book_DateStorage,book_BeLent,book_BeLentCounts,book_Remark)"
    strSql = strSql & " VALUES('" & Trim(txtBookID.Text) & "','" & Trim(txtBookTitle.Text) & "','" & Trim(txtBookVolume.Text) & "','" & Trim(txtBookPress.Text) & "','" & Trim(txtBookAuthor.Text) & "','" & Trim(txtBookISBN.Text)
    strSql = strSql & "','" & Trim(txtBookPublishTime.Text) & "','" & Trim(txtBookPrice.Text) & "','" & Trim(txtBookDateStorage.Text) & "','" & Trim(txtBookBeLent.Text) & "','0','" & Trim(txtBookRemark.Text) & "')"
    Call ExecuteSQL(strSql, strmsg)
    
    If InStr(1, strmsg, "执行成功") = 0 Then
        MsgBox "数据库操作失败！请稍后重试！", vbCritical + vbOKOnly, "网管小贾的图书管理系统"
    Else
        MsgBox "添加图书成功！！", vbInformation + vbOKOnly, "网管小贾的图书管理系统"
    End If
```



##### 2、删

```vb
' ******** 找出ID，删除记录 ********
	strSql = "SELECT TOP 1 book_Title FROM dbo.bms4l_Book WHERE book_ID='" & tmpMsfgBookText & "'"
    Set rst = SelectSQL(strSql, msg)
    
    If rst.RecordCount > 0 Then
        
        '如果选择的是存在的记录，则确认是否删除此记录
        If MsgBox("真的要删除该记录吗？？", vbQuestion + vbYesNo + vbDefaultButton2, "网管小贾的图书管理系统") = vbYes Then
            strSql = "DELETE FROM dbo.bms4l_Book WHERE book_ID='" & tmpMsfgBookText & "'"
            Call ExecuteSQL(strSql, msg)

            If InStr(1, msg, "执行成功") = 0 Then
                MsgBox "数据库操作失败！请稍后重试！", vbCritical + vbOKOnly, "网管小贾的图书管理系统"
            Else
                MsgBox "指定图书删除成功！！", vbInformation + vbOKOnly, "网管小贾的图书管理系统"
            End If

            cmdBookDelete.Enabled = False

        End If

    End If
```



##### 3、改

```vb
' ******** 修改记录分两步，一是显示要修改的记录，二才是修改记录后保存。 ********

` 一、选择需要修改的记录，然后显示记录内容
    strSql = "SELECT TOP 1 * FROM dbo.bms4l_Book WHERE book_ID='" & tmpMsfgBookText & "'"
    Set rst = SelectSQL(strSql, msg)
    
    If rst.RecordCount > 0 Then
        
        '如果选择的是存在的记录，则打开修改窗口
        With frmBookModify
        
            '加载当前记录到各项目文本框中
            .txtBookID.Text = Trim(rst("book_ID").value)
            .txtBookTitle.Text = Trim(rst("book_Title").value)
            .txtBookPress.Text = Trim(rst("book_Press").value)
            .txtBookAuthor.Text = Trim(rst("book_Author").value)
            .txtBookISBN.Text = Trim(rst("book_ISBN").value)
            .txtBookPublishTime.Text = Trim(rst("book_PublishTime").value)
            .txtBookPrice.Text = Trim(rst("book_Price").value)
            .txtBookDateStorage.Text = Trim(rst("book_DateStorage").value)
            .txtBookBeLent.Text = Trim(rst("book_BeLent").value)
            .txtBookBeLentCounts.Text = Trim(rst("book_BeLentCounts").value)
            .txtBookRemark.Text = Trim(rst("book_Remark").value)
            .Show vbModal, Me
        
        End With
    
    End If

' 二、修改记录并提交到数据库中
    strSql = "UPDATE bms_book "
    strSql = strSql & "SET book_Title='" & Trim(txtBookTitle)
    strSql = strSql & "', book_Volume='" & Trim(txtBookVolume)
    strSql = strSql & "', book_Press='" & Trim(txtBookPress)
    strSql = strSql & "', book_Author='" & Trim(txtBookAuthor)
    strSql = strSql & "', book_ISBN='" & Trim(txtBookISBN)
    strSql = strSql & "', book_PublishTime='" & Trim(txtBookPublishTime)
    strSql = strSql & "', book_Price='" & Trim(txtBookPrice)
    strSql = strSql & "', book_Remark='" & Trim(txtBookRemark)
    strSql = strSql & "' WHERE book_ID='" & Trim(txtBookID.Text) & "'"
    Call ExecuteSQL(strSql, strmsg)

    If InStr(1, strmsg, "执行成功") = 0 Then
        MsgBox "数据库操作失败！请稍后重试！", vbCritical + vbOKOnly, "网管小贾的图书管理系统"
    Else
        MsgBox "图书信息更新成功！", vbInformation + vbOKOnly, "网管小贾的图书管理系统"
    End If
```



##### 4、查

看似简单，实际还是比较复杂的，因为要构建筛选条件。

```vb
' ******** 构建Where查询条件 ********
	If chkBookID.value = vbChecked Then
        If Trim(txtBookQueryBookID.Text) <> "" Then
            strSql = "book_ID LIKE '%" & Trim(txtBookQueryBookID.Text) & "%'"
        End If
    End If
    
    If chkBookTitle.value = vbChecked Then
        If Trim(txtBookTitle.Text) <> "" Then
            If Trim(strSql) <> "" Then
                strSql = strSql & " AND book_Title LIKE '%" & Trim(txtBookTitle.Text) & "%'"
            Else
                strSql = "book_Title LIKE '%" & Trim(txtBookTitle.Text) & "%'"
            End If
        End If
    End If
    
    If chkBookAuthor.value = vbChecked Then
        If Trim(txtBookAuthor.Text) <> "" Then
            If Trim(strSql) <> "" Then
                strSql = strSql & " AND book_Author LIKE '%" & Trim(txtBookAuthor.Text) & "%'"
            Else
                strSql = "book_Author LIKE '%" & Trim(txtBookAuthor.Text) & "%'"
            End If
        End If
    End If
    
    If chkBookDateStorage.value = vbChecked Then
        If Trim(txtBookDateStorage(0).Text) = "" Or Trim(txtBookDateStorage(1).Text) = "" Then
        Else
            If IsDate(Trim(txtBookDateStorage(0).Text)) And IsDate(Trim(txtBookDateStorage(1).Text)) Then
                If Trim(strSql) <> "" Then
                    strSql = strSql & " AND book_DateStorage BETWEEN '" & Trim(txtBookDateStorage(0).Text) & "' AND '" & Trim(txtBookDateStorage(1).Text) & "'"
                Else
                    strSql = " book_DateStorage BETWEEN '" & Trim(txtBookDateStorage(0).Text) & "' AND '" & Trim(txtBookDateStorage(1).Text) & "'"
                End If
            Else
                MsgBox "登记日期格式错误！", vbExclamation + vbOKOnly, ""
                cmdBookQuery.Enabled = True
                Exit Sub
            End If
        End If

    End If
    
    If chkBookPress.value = vbChecked Then
        If Trim(txtBookPress.Text) <> "" Then
            If Trim(strSql) <> "" Then
                strSql = strSql & " AND book_Press LIKE '%" & Trim(txtBookPress.Text) & "%'"
            Else
                strSql = "book_Press LIKE '%" & Trim(txtBookPress.Text) & "%'"
            End If
        End If
    End If

    If chkBookBeLent.value = vbChecked Then
        If Trim(cboBookBeLent.Text) <> "" Then
            If Trim(strSql) <> "" Then
                strSql = strSql & " AND book_BeLent='" & Trim(cboBookBeLent.Text) & "'"
            Else
                strSql = "book_BeLent='" & Trim(cboBookBeLent.Text) & "'"
            End If
        End If
    End If
  
  
    If chkBookBeLentCounts.value = vbChecked Then
        If Trim(txtBookBeLentCounts(0).Text) <> "" And Trim(txtBookBeLentCounts(1).Text) <> "" Then
            If IsNumeric(Trim(txtBookBeLentCounts(0).Text)) Or IsNumeric(Trim(txtBookBeLentCounts(1).Text)) Then
                If Trim(strSql) <> "" Then
                    strSql = strSql & " AND book_BeLentCounts BETWEEN '" & Trim(txtBookBeLentCounts(0).Text) & "' AND '" & Trim(txtBookBeLentCounts(1).Text) & "'"
                Else
                    strSql = "book_BeLentCounts BETWEEN '" & Trim(txtBookBeLentCounts(0).Text) & "' AND '" & Trim(txtBookBeLentCounts(1).Text) & "'"
                End If
            Else
                MsgBox "借阅次数不是数字！", vbExclamation + vbOKOnly, ""
                cmdBookQuery.Enabled = True
                Exit Sub
            End If
        End If
    End If
        
        
' ******** 筛选条件有了，则构建完整的查询语句 ********
    If strSql = "" Then
        If MsgBox("没有选择任何查询条件。确定要查询所有图书记录吗？？", vbQuestion + vbYesNo + vbDefaultButton2, "网管小贾的图书管理系统") = vbNo Then
            cmdBookQuery.Enabled = True
            Exit Sub
        Else
            strSql = "SELECT TOP 10000 * FROM dbo.bms4l_Book ORDER BY book_ID ASC"
        End If
    Else
        strSql = "SELECT TOP 10000 * FROM dbo.bms4l_Book WHERE " & strSql & " ORDER BY book_ID ASC"
    End If
    
    msfgBook.Redraw = False
    msfgBook.Tag = ""
    Call fillGrid_Book(msfgBook, strSql)
    Call ChangeMsflexGridColor(msfgBook)
```



